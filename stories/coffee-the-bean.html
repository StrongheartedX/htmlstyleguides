<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bean — A Coffee Interactive Story</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-primary: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-accent: 'Caveat', cursive;

            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --space-7: 48px;
            --space-8: 64px;

            --espresso: #2C1810;
            --dark-roast: #3D251E;
            --mocha: #5D3A2E;
            --coffee: #6F4E37;
            --cappuccino: #8B6B5D;
            --latte: #C4A484;
            --oat-milk: #D4C4A8;
            --cream: #F5F0E8;
            --foam: #FAF8F5;
            --white: #FFFFFF;

            --caramel: #C68E17;
            --caramel-light: #D4A84B;
            --caramel-dark: #A67610;
            --cinnamon: #B5651D;
            --honey: #EB9605;

            --success: #5D8A4E;
            --warning: #C68E17;
            --error: #B54D4D;
            --info: #5D7A8A;

            --text-primary: var(--espresso);
            --text-secondary: var(--coffee);
            --text-muted: var(--cappuccino);
            --bg-primary: var(--foam);
            --bg-secondary: var(--cream);
            --bg-card: var(--white);
            --border-color: var(--oat-milk);
            --border-strong: var(--latte);
            --accent: var(--caramel);

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;

            --shadow-sm: 0 2px 8px rgba(44, 24, 16, 0.06);
            --shadow-md: 0 4px 16px rgba(44, 24, 16, 0.08);
            --shadow-lg: 0 8px 32px rgba(44, 24, 16, 0.12);

            --transition-fast: 0.15s ease;
            --transition-base: 0.25s ease;
            --transition-slow: 0.4s ease;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; scroll-behavior: smooth; }

        body {
            font-family: var(--font-primary);
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ═══════════════════════════════════════════
           COFFEE STAIN DECORATIONS
        ═══════════════════════════════════════════ */
        .coffee-stain {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.04;
            z-index: 0;
        }
        .coffee-stain-1 { width: 180px; height: 180px; top: 120px; right: 3%; border: 4px solid var(--coffee); }
        .coffee-stain-2 { width: 120px; height: 120px; top: 500px; left: 2%; border: 3px solid var(--mocha); opacity: 0.05; }
        .coffee-stain-3 { width: 200px; height: 200px; bottom: 200px; right: 6%; border: 5px solid var(--latte); }

        /* ═══════════════════════════════════════════
           STEAM ANIMATION
        ═══════════════════════════════════════════ */
        @keyframes steam {
            0% { transform: translateY(0) scaleX(1); opacity: 0; }
            15% { opacity: 0.5; }
            50% { transform: translateY(-20px) scaleX(1.2); opacity: 0.3; }
            100% { transform: translateY(-40px) scaleX(0.8); opacity: 0; }
        }

        .steam-container { position: relative; display: inline-block; }

        .steam {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
        }

        .steam-line {
            width: 8px;
            height: 30px;
            background: linear-gradient(to top, var(--latte), transparent);
            border-radius: var(--radius-full);
            animation: steam 2s ease-in-out infinite;
            opacity: 0;
        }

        .steam-line:nth-child(1) { animation-delay: 0s; }
        .steam-line:nth-child(2) { animation-delay: 0.3s; }
        .steam-line:nth-child(3) { animation-delay: 0.6s; }

        /* ═══════════════════════════════════════════
           LAYOUT
        ═══════════════════════════════════════════ */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* ═══════════════════════════════════════════
           TITLE SCREEN
        ═══════════════════════════════════════════ */
        .title-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
            padding: var(--space-7) 0;
        }

        .title-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1.5rem;
            padding: var(--space-1) var(--space-4);
            background: var(--cream);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--accent);
        }

        .title-screen h1 {
            font-family: var(--font-primary);
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 0.5rem;
            color: var(--espresso);
            letter-spacing: -0.02em;
        }

        .title-subtitle {
            font-family: var(--font-accent);
            font-size: 1.75rem;
            color: var(--coffee);
            margin-bottom: 1rem;
        }

        .title-tagline {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            max-width: 500px;
            line-height: 1.7;
        }

        .title-start {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-7);
            font-family: var(--font-primary);
            font-size: 1rem;
            font-weight: 700;
            border: 2px solid transparent;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--mocha) 0%, var(--dark-roast) 100%);
            color: var(--cream);
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .title-start::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left var(--transition-slow);
        }

        .title-start:hover {
            background: linear-gradient(135deg, var(--dark-roast) 0%, var(--espresso) 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .title-start:hover::before { left: 100%; }

        .title-credits {
            margin-top: 2.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* ═══════════════════════════════════════════
           SCENE CONTAINER
        ═══════════════════════════════════════════ */
        .scene-wrapper {
            display: none;
            flex-direction: column;
            flex: 1;
            padding-top: 1rem;
        }

        .scene-wrapper.active { display: flex; }

        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .scene-era-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .scene-fact-count {
            font-size: 0.75rem;
            color: var(--coffee);
            font-weight: 600;
        }

        /* ═══════════════════════════════════════════
           PROGRESS BAR
        ═══════════════════════════════════════════ */
        .progress-wrapper {
            margin-bottom: 1.5rem;
        }

        .progress-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: var(--space-2);
            font-weight: 600;
        }

        .progress-container {
            background: var(--cream);
            border-radius: var(--radius-full);
            height: 10px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--latte), var(--caramel));
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
        }

        /* ═══════════════════════════════════════════
           SCENE CONTENT STYLES
        ═══════════════════════════════════════════ */

        /* Scene Section Number */
        .section-number {
            font-family: var(--font-accent);
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: var(--space-2);
        }

        /* General scene text */
        .scene-text p { margin-bottom: 1rem; }
        .scene-text p:last-child { margin-bottom: 0; }

        .lead {
            font-size: 1.25rem;
            line-height: 1.7;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .handwritten {
            font-family: var(--font-accent);
            font-size: 1.5em;
            color: var(--coffee);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--latte), var(--caramel), var(--coffee));
            opacity: 1;
        }

        .card h3 {
            font-family: var(--font-primary);
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: var(--space-3);
            color: var(--text-primary);
        }

        .card h4 {
            font-weight: 700;
            font-size: 1.125rem;
            margin-bottom: var(--space-3);
        }

        .card p {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            margin-bottom: var(--space-3);
        }

        .card p:last-child { margin-bottom: 0; }

        .card-featured {
            background: linear-gradient(135deg, var(--mocha) 0%, var(--dark-roast) 100%);
            color: var(--cream);
            border-color: var(--mocha);
        }

        .card-featured::before {
            background: linear-gradient(90deg, var(--caramel), var(--honey), var(--caramel));
        }

        .card-featured h3, .card-featured h4 { color: var(--cream); }
        .card-featured p { color: var(--latte); }

        /* Quote Block */
        .quote-block {
            background: var(--cream);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            position: relative;
            margin: 1.5rem 0;
        }

        .quote-block::before {
            content: '\201C';
            font-family: var(--font-accent);
            font-size: 4rem;
            color: var(--accent);
            position: absolute;
            top: var(--space-3);
            left: var(--space-4);
            line-height: 1;
        }

        .quote-text {
            font-family: var(--font-accent);
            font-size: 1.75rem;
            color: var(--text-primary);
            padding-left: var(--space-7);
            margin-bottom: 0;
        }

        .quote-attribution {
            font-size: 0.875rem;
            color: var(--text-muted);
            padding-left: var(--space-7);
            margin-top: var(--space-2);
            font-style: italic;
        }

        /* Alert */
        .alert {
            padding: var(--space-4) var(--space-5);
            border-radius: var(--radius-md);
            margin: 1.5rem 0;
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }

        .alert-icon { font-size: 1.25rem; line-height: 1.4; }
        .alert-content { flex: 1; }
        .alert-title { font-weight: 700; margin-bottom: var(--space-1); }

        .alert-info {
            background: rgba(93, 122, 138, 0.1);
            border: 1px solid rgba(93, 122, 138, 0.3);
            color: var(--info);
        }

        .alert-success {
            background: rgba(93, 138, 78, 0.1);
            border: 1px solid rgba(93, 138, 78, 0.3);
            color: var(--success);
        }

        .alert-warning {
            background: rgba(198, 142, 23, 0.1);
            border: 1px solid rgba(198, 142, 23, 0.3);
            color: var(--warning);
        }

        .alert-error {
            background: rgba(181, 77, 77, 0.1);
            border: 1px solid rgba(181, 77, 77, 0.3);
            color: var(--error);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: var(--radius-full);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-espresso { background: var(--espresso); color: var(--cream); }
        .badge-latte { background: var(--latte); color: var(--espresso); }
        .badge-caramel { background: var(--caramel); color: var(--white); }
        .badge-cream { background: var(--cream); color: var(--coffee); border: 1px solid var(--border-color); }

        .badge-row {
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
            margin-bottom: var(--space-4);
        }

        /* Tags */
        .tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-1) var(--space-3);
            background: var(--cream);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.8125rem;
            color: var(--text-secondary);
            margin-right: var(--space-2);
            margin-bottom: var(--space-2);
        }

        /* Warmth Glow */
        @keyframes pulse-warm {
            0%, 100% { box-shadow: 0 0 0 0 rgba(198, 142, 23, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(198, 142, 23, 0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ═══════════════════════════════════════════
           FACT DISCOVERED TOAST
        ═══════════════════════════════════════════ */
        .fact-found {
            display: inline-block;
            background: linear-gradient(135deg, var(--caramel) 0%, var(--caramel-dark) 100%);
            color: var(--white);
            padding: 8px 20px 8px 36px;
            font-size: 0.8rem;
            font-weight: 700;
            border-radius: var(--radius-full);
            margin-top: 1.5rem;
            position: relative;
            animation: factSlideIn 0.6s ease-out;
        }

        .fact-found::before {
            content: '';
            position: absolute;
            left: 14px; top: 50%;
            transform: translateY(-50%);
            width: 10px; height: 10px;
            background: var(--white);
            border-radius: 50%;
            opacity: 0.8;
        }

        @keyframes factSlideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* ═══════════════════════════════════════════
           CHOICES
        ═══════════════════════════════════════════ */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
            opacity: 0;
            animation: choicesFadeIn 0.6s ease-out 0.5s forwards;
        }

        @keyframes choicesFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .choice-btn {
            display: flex;
            align-items: center;
            padding: var(--space-3) var(--space-5);
            font-family: var(--font-primary);
            font-size: 0.9375rem;
            font-weight: 600;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--white);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .choice-btn::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 4px; height: 100%;
            background: var(--accent);
            transform: scaleY(0);
            transition: transform 0.2s ease;
            transform-origin: bottom;
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
        }

        .choice-btn:hover {
            border-color: var(--accent);
            background: var(--cream);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .choice-btn:hover::before { transform: scaleY(1); }

        .choice-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 26px; height: 26px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            margin-right: var(--space-3);
            flex-shrink: 0;
            transition: all var(--transition-fast);
        }

        .choice-btn:hover .choice-key {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(198, 142, 23, 0.1);
        }

        /* ═══════════════════════════════════════════
           TRANSITION
        ═══════════════════════════════════════════ */
        .transition-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 500;
            pointer-events: none;
            opacity: 0;
            background: var(--cream);
        }

        .transition-overlay.active {
            pointer-events: all;
            animation: steamTransition 1s ease-in-out;
        }

        @keyframes steamTransition {
            0% { opacity: 0; }
            30% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* ═══════════════════════════════════════════
           SCENE FADE IN
        ═══════════════════════════════════════════ */
        .scene-content {
            animation: sceneFadeIn 0.8s ease-out;
        }

        @keyframes sceneFadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ═══════════════════════════════════════════
           KNOWLEDGE TRACKER (SIDEBAR)
        ═══════════════════════════════════════════ */
        .fact-tracker {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
            max-width: 260px;
        }

        .fact-tracker-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--accent);
            font-family: var(--font-primary);
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: auto;
            box-shadow: var(--shadow-sm);
        }

        .fact-tracker-toggle:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .fact-tracker-panel {
            display: none;
            margin-top: 0.5rem;
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            max-height: 70vh;
            overflow-y: auto;
        }

        .fact-tracker-panel.open {
            display: block;
            animation: panelSlideIn 0.3s ease-out;
        }

        @keyframes panelSlideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fact-tracker-panel h4 {
            font-family: var(--font-primary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            font-weight: 700;
        }

        .fact-item {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            animation: factSlideIn 0.4s ease-out;
            line-height: 1.4;
        }

        .fact-item:last-child { border-bottom: none; }

        .fact-item strong {
            color: var(--accent);
            font-weight: 700;
        }

        .no-facts {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
        }

        /* ═══════════════════════════════════════════
           GAME CONTROLS
        ═══════════════════════════════════════════ */
        .game-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border-color);
        }

        .ctrl-btn {
            padding: 8px 20px;
            font-family: var(--font-primary);
            font-size: 0.8rem;
            font-weight: 600;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-full);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .ctrl-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
            background: var(--cream);
        }

        /* ═══════════════════════════════════════════
           ENDING SCENE
        ═══════════════════════════════════════════ */
        .scene-ending {
            text-align: center;
            padding: var(--space-7) var(--space-5);
        }

        .scene-ending .ending-label {
            font-family: var(--font-accent);
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: var(--space-3);
        }

        .scene-ending .ending-title {
            font-family: var(--font-primary);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--espresso);
            margin-bottom: var(--space-6);
        }

        .scene-ending .scene-text {
            max-width: 550px;
            margin: 0 auto;
            text-align: left;
        }

        .scene-ending .scene-text p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .scene-ending .the-end {
            font-family: var(--font-accent);
            font-size: 1.5rem;
            color: var(--text-muted);
            margin-top: 2rem;
        }

        /* ═══════════════════════════════════════════
           RESPONSIVE
        ═══════════════════════════════════════════ */
        @media (max-width: 768px) {
            .game-container { padding: 1rem; }
            .fact-tracker { right: 0.75rem; top: 0.75rem; max-width: 220px; }
            .coffee-stain { display: none; }
            .card { padding: var(--space-5); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--cream); }
        ::-webkit-scrollbar-thumb { background: var(--latte); border-radius: var(--radius-full); }
        ::selection { background: var(--caramel); color: var(--white); }
    </style>
</head>
<body>
    <!-- Decorative Coffee Stains -->
    <div class="coffee-stain coffee-stain-1"></div>
    <div class="coffee-stain coffee-stain-2"></div>
    <div class="coffee-stain coffee-stain-3"></div>

    <!-- Steam Transition Overlay -->
    <div class="transition-overlay" id="transition"></div>

    <!-- Fact Tracker -->
    <div class="fact-tracker" id="factTracker" style="display: none;">
        <button class="fact-tracker-toggle" id="factToggle">
            <span>Knowledge</span>
            <span id="factCount">0</span>
        </button>
        <div class="fact-tracker-panel" id="factPanel">
            <h4>Historical Facts Discovered</h4>
            <div id="factList">
                <p class="no-facts">No facts discovered yet...</p>
            </div>
        </div>
    </div>

    <div class="game-container">
        <!-- Title Screen -->
        <div class="title-screen" id="titleScreen">
            <div class="title-badge">Interactive History</div>
            <div class="steam-container">
                <div class="steam">
                    <span class="steam-line"></span>
                    <span class="steam-line"></span>
                    <span class="steam-line"></span>
                </div>
            </div>
            <h1 style="margin-top: 1rem;">The Bean</h1>
            <div class="title-subtitle">1,100 Years of Coffee</div>
            <p class="title-tagline">From a legendary Ethiopian goat herder to the modern espresso bar — trace coffee's extraordinary journey across continents and centuries.</p>
            <button class="title-start" id="startBtn">Begin the Journey</button>
            <p class="title-credits">A story brewed from history</p>
            <a href="index.html" class="back-to-stories" style="display:inline-block;margin-top:1.5rem;color:inherit;text-decoration:none;font-size:0.8rem;opacity:0.5;transition:opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">&larr; All Stories</a>
        </div>

        <!-- Scene Container -->
        <div class="scene-wrapper" id="sceneWrapper">
            <div class="scene-header">
                <span class="scene-era-label" id="eraLabel">850 CE - Ethiopia</span>
            </div>

            <div class="progress-wrapper">
                <div class="progress-label" id="progressLabel">Journey: 850 CE</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: 5%;"></div>
                </div>
            </div>

            <div id="sceneContent"></div>

            <div class="game-controls">
                <button class="ctrl-btn" id="restartBtn">Start Over</button>
            </div>
        </div>
    </div>

    <script>
    // ═══════════════════════════════════════════════════════════════
    //  THE BEAN — Story Data
    // ═══════════════════════════════════════════════════════════════

    const STORY = {

        // --- SCENE 1: The Discovery ---
        kaldi: {
            era: '850 CE - Ethiopia',
            progress: 5,
            content: `
                <div class="section-number">Scene 1</div>
                <h3 style="margin-bottom: var(--space-5);">The Goat Herder's Discovery</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">850 CE</span>
                    <span class="badge badge-latte">Kaffa, Ethiopia</span>
                </div>
                <p class="lead" style="margin: var(--space-5) 0;">The sun hangs low over the highlands of Kaffa. You are walking alongside a goat herder named Kaldi, watching over his flock as they graze on the steep hillsides.</p>
                <p>Something is wrong with the goats. They are bleating wildly, leaping and prancing among the rocks with an energy you have never seen before. Kaldi frowns and follows their trail to a bush covered in bright red berries.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <p class="handwritten">"The goats will not settle. They ate from that bush — the one with the red berries. I have never seen them so restless."</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: var(--space-2);">-- Kaldi, goat herder of Kaffa</p>
                </div>
                <p>The berries gleam in the afternoon light. Wild coffee plants grow naturally here in the Ethiopian highlands, though no one has yet thought to brew a drink from them.</p>
            `,
            fact: '<strong>~850 CE:</strong> According to legend, a goat herder named Kaldi in the Ethiopian region of Kaffa discovered coffee when his flock became unusually energetic after eating red berries. This legend did not appear in written form until 1671.',
            choices: [
                { text: 'Pick the berries and taste one yourself', next: 'taste_berry' },
                { text: 'Bring the berries to the nearby monastery', next: 'monastery' }
            ]
        },

        // --- SCENE 2A: Taste the Berry ---
        taste_berry: {
            era: '850 CE - Ethiopia',
            progress: 12,
            content: `
                <div class="section-number">Scene 2</div>
                <h3 style="margin-bottom: var(--space-5);">The First Taste</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">850 CE</span>
                    <span class="badge badge-latte">Kaffa Highlands</span>
                </div>
                <p>You pluck one of the bright red berries and bite into it. The fruit is sweet, almost cherry-like, but there is a bitter seed at the center. You chew it slowly.</p>
                <p>Within minutes, a strange clarity washes over you. Your exhaustion from the long walk fades. Your mind sharpens. The colors of the hillside seem brighter, the birdsong clearer.</p>
                <div class="alert alert-info" style="margin: var(--space-5) 0;">
                    <span class="alert-icon">&#8505;</span>
                    <div class="alert-content">
                        <p class="alert-title">A Discovery</p>
                        <p style="margin: 0; font-size: 0.9375rem;">You have just experienced what millions will come to rely on — the stimulating effect of caffeine. But you do not have a name for it yet.</p>
                    </div>
                </div>
                <p>Kaldi watches you with wide eyes. "You feel it too?" he asks. He has already eaten several.</p>
                <p>Word of the strange berries must spread. Kaldi suggests bringing them to the monks at the monastery down the valley.</p>
            `,
            fact: '<strong>Wild Coffee Origins:</strong> The coffee plant (Coffea arabica) originates in the Ethiopian region of Kaffa, where wild coffee plants grew naturally long before the beverage was ever created.',
            choices: [
                { text: 'Take the berries to the monastery', next: 'first_cup' }
            ]
        },

        // --- SCENE 2B: The Monastery ---
        monastery: {
            era: '850 CE - Ethiopia',
            progress: 12,
            content: `
                <div class="section-number">Scene 2</div>
                <h3 style="margin-bottom: var(--space-5);">The Monk's Judgment</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">850 CE</span>
                    <span class="badge badge-latte">Ethiopian Monastery</span>
                </div>
                <p>You and Kaldi carry handfuls of the red berries down the hillside to the monastery. The head monk examines them with suspicion, turning them over in his weathered hands.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <p class="handwritten">"These are the devil's work! They make the goats dance as though possessed."</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: var(--space-2);">-- The head monk</p>
                </div>
                <p>He throws the berries into the fire. But as they roast, an incredible aroma fills the room — rich, dark, intoxicating. The monks gather around, drawn by the scent.</p>
                <div class="alert alert-warning" style="margin: var(--space-5) 0;">
                    <span class="alert-icon">&#9749;</span>
                    <div class="alert-content">
                        <p class="alert-title">An Accidental Roast</p>
                        <p style="margin: 0; font-size: 0.9375rem;">The fire has roasted the coffee beans. The aroma changes everything — the monks quickly rake the beans from the coals.</p>
                    </div>
                </div>
                <p>A younger monk crushes the roasted beans, dissolves them in hot water, and takes the first sip. His eyes widen. He can stay awake through evening prayers with ease.</p>
            `,
            fact: '<strong>Wild Coffee Origins:</strong> The coffee plant (Coffea arabica) originates in the Ethiopian region of Kaffa, where wild coffee plants grew naturally long before the beverage was ever created.',
            choices: [
                { text: 'Continue to the first cup', next: 'first_cup' }
            ]
        },

        // --- SCENE 3: The First Cup ---
        first_cup: {
            era: '850 CE - Ethiopia',
            progress: 20,
            content: `
                <div class="section-number">Scene 3</div>
                <h3 style="margin-bottom: var(--space-5);">The First Cup</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">850 CE</span>
                    <span class="badge badge-cream">Origin Story</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">The monks perfect their method. Roast the berries. Crush the seeds within. Pour hot water over the grounds. Wait.</p>
                <p>The dark liquid that emerges is bitter, earthy, and unlike anything anyone has ever tasted. But the effect is unmistakable — alertness, focus, a warmth that radiates from within.</p>
                <div class="quote-block">
                    <p class="quote-text">The monks found they could pray deep into the night without drowsiness. The drink became their secret.</p>
                </div>
                <p>But secrets do not stay secrets forever. Word of the miraculous drink begins to travel along trade routes, carried by merchants and travelers heading north toward the Arabian Peninsula.</p>
                <div class="card-featured card" style="margin: var(--space-5) 0;">
                    <h4>A Journey Begins</h4>
                    <p>Centuries pass. Coffee travels from Ethiopia across the Red Sea to Yemen, where Sufi monks adopt it for their own nighttime devotions. The practice of roasting and brewing spreads to the great cities of Islam.</p>
                </div>
                <p>The world is about to change. Will you follow the bean on its journey?</p>
            `,
            choices: [
                { text: 'Follow coffee to Arabia and the Ottoman Empire', next: 'trade_route' },
                { text: 'Skip ahead to the coffeehouses of Istanbul', next: 'istanbul_rising' }
            ]
        },

        // --- SCENE 4: The Trade Route ---
        trade_route: {
            era: '16th Century - Arabia',
            progress: 30,
            content: `
                <div class="section-number">Scene 4</div>
                <h3 style="margin-bottom: var(--space-5);">The Trade Route</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">Early 1500s</span>
                    <span class="badge badge-latte">Yemen to Mecca</span>
                    <span class="badge badge-espresso">Trade</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">You are now a merchant, traveling with a caravan that carries something more precious than spices — sacks of roasted coffee beans.</p>
                <p>By the early 16th century, the coffee beverage has spread from Yemen to the major Islamic centers: Mecca, Cairo, Damascus, and Istanbul. Everywhere it goes, people gather to drink it together.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <h4>The Spread of Coffee</h4>
                    <div class="tag">Yemen</div>
                    <div class="tag">Mecca</div>
                    <div class="tag">Cairo</div>
                    <div class="tag">Damascus</div>
                    <div class="tag">Istanbul</div>
                    <p style="margin-top: var(--space-3);">Coffee becomes intertwined with Islamic culture. Sufi monks use it for nighttime prayer. Scholars drink it for focus. Merchants share it to seal deals.</p>
                </div>
                <p>In the markets of Mecca, you face a choice. Coffee is growing popular, but some religious authorities are suspicious of this new drink and its intoxicating effects.</p>
                <div class="alert alert-warning" style="margin: var(--space-5) 0;">
                    <span class="alert-icon">&#9888;</span>
                    <div class="alert-content">
                        <p class="alert-title">Tensions Rising</p>
                        <p style="margin: 0; font-size: 0.9375rem;">Some leaders view coffee as a threat. Will you trade openly and risk confrontation, or operate quietly?</p>
                    </div>
                </div>
            `,
            fact: '<strong>Early 16th Century:</strong> Coffee beverage spreads from Yemen to major Islamic centers including Mecca, Cairo, Damascus, and Istanbul as the practice of roasting and brewing coffee beans becomes established.',
            choices: [
                { text: 'Trade openly in the markets — let everyone taste it', next: 'istanbul_rising' },
                { text: 'Sell quietly to trusted customers only', next: 'istanbul_rising' }
            ]
        },

        // --- SCENE 5: Istanbul Rising ---
        istanbul_rising: {
            era: '1555 - Ottoman Empire',
            progress: 40,
            content: `
                <div class="section-number">Scene 5</div>
                <h3 style="margin-bottom: var(--space-5);">Istanbul Rising</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1555 CE</span>
                    <span class="badge badge-latte">Istanbul</span>
                    <span class="badge badge-espresso">Ottoman Empire</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Istanbul, 1555. The reign of Suleiman the Magnificent. The greatest city in the world is about to discover a new obsession.</p>
                <p>The first coffeehouse in the Ottoman Empire opens its doors. It is called a <em>kahvehane</em>, and it is unlike any institution the city has known.</p>
                <div class="card-featured card" style="margin: var(--space-5) 0;">
                    <h4>The First Coffeehouse</h4>
                    <p>Under high ceilings, on cushioned seats, merchants sit beside poets, scholars beside soldiers. The only price of admission is the cost of a cup. Here, for the first time, conversation flows freely across the boundaries of class and profession.</p>
                </div>
                <p>You step inside. The air is thick with the aroma of roasting beans and the hum of animated discussion. A poet recites verses in one corner. A merchant argues with a ship captain in another. A scholar reads aloud from a manuscript.</p>
                <div class="quote-block">
                    <p class="quote-text">The coffeehouse became the "school of the wise" — a place where news was shared, ideas debated, and alliances formed over tiny cups of dark, potent brew.</p>
                </div>

                <div style="margin: 1.5rem 0; text-align: center;"><img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Interior_of_a_London_Coffee-house%2C_17th_century.JPG" alt="Interior of a London coffeehouse, 17th century" style="max-width: 100%; height: auto; filter: sepia(0.15) contrast(1.05); border: 1px solid var(--caramel, #c68e17); border-radius: 8px; opacity: 0.9; max-height: 400px; object-fit: contain; box-shadow: 0 4px 16px rgba(44, 24, 16, 0.2);"><div style="font-size: 0.75rem; margin-top: 0.5rem; opacity: 0.6; font-style: italic; color: var(--cappuccino, #8B6B5D);">Interior of a London coffeehouse, 17th century — where ideas brewed alongside coffee</div></div>

                <p>The coffeehouses multiply at an astonishing rate. Within decades, they number in the hundreds.</p>
            `,
            fact: '<strong>1555 CE:</strong> The first coffeehouse in the Ottoman Empire opens in Istanbul during the reign of Suleiman the Magnificent, marking the beginning of coffee culture\'s expansion beyond home consumption.',
            choices: [
                { text: 'Open your own coffeehouse in Istanbul', next: 'coffeehouse_owner' },
                { text: 'Continue traveling as a coffee merchant', next: 'forbidden_years' }
            ]
        },

        // --- SCENE 6A: Coffeehouse Owner ---
        coffeehouse_owner: {
            era: '1555-1633 - Ottoman Empire',
            progress: 48,
            content: `
                <div class="section-number">Scene 6</div>
                <h3 style="margin-bottom: var(--space-5);">The Golden Age</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1555-1633</span>
                    <span class="badge badge-latte">Istanbul</span>
                </div>
                <p>Your coffeehouse thrives. Years pass, and coffee culture explodes across Istanbul. By the end of the 1600s, the city will have approximately 600 coffeehouses — each one a buzzing center of social life.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <div style="font-family: var(--font-accent); font-size: 3.5rem; font-weight: 700; color: var(--accent); line-height: 1; margin-bottom: var(--space-3);">600</div>
                    <h4>Coffeehouses in Istanbul</h4>
                    <p>By the late 1600s, Istanbul has approximately 600 coffeehouses, demonstrating the explosive growth of coffee culture and the establishment of coffeehouses as major social institutions.</p>
                </div>
                <p>But this golden age carries a seed of danger. The coffeehouses are becoming too popular, too influential. Political discussions grow bold. Rumors circulate. The Sultan's advisors whisper that these gathering places are breeding grounds for dissent.</p>
                <div class="alert alert-error" style="margin: var(--space-5) 0;">
                    <span class="alert-icon">&#9888;</span>
                    <div class="alert-content">
                        <p class="alert-title">Danger Approaches</p>
                        <p style="margin: 0; font-size: 0.9375rem;">Word reaches you: Sultan Murad IV is considering a ban on all coffeehouses. What will you do?</p>
                    </div>
                </div>
            `,
            fact: '<strong>Late 1600s:</strong> By the end of the 1600s, Istanbul had approximately 600 coffeehouses, demonstrating explosive growth in coffee culture and the establishment of coffeehouses as major social institutions.',
            choices: [
                { text: 'Prepare to operate underground', next: 'forbidden_years' },
                { text: 'Close up shop and flee to Europe', next: 'enlightenment_london' }
            ]
        },

        // --- SCENE 7: The Forbidden Years ---
        forbidden_years: {
            era: '1633 - Ottoman Empire',
            progress: 52,
            content: `
                <div class="section-number">Scene 7</div>
                <h3 style="margin-bottom: var(--space-5);">The Forbidden Years</h3>
                <div class="badge-row">
                    <span class="badge badge-espresso">1633 CE</span>
                    <span class="badge badge-latte">Istanbul</span>
                    <span class="badge badge-caramel">Crisis</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Sultan Murad IV has made his decree. Every coffeehouse in Istanbul is to be shut down. The penalty for disobedience is severe.</p>
                <div class="card-featured card" style="margin: var(--space-5) 0;">
                    <h4>The Ban of 1633</h4>
                    <p>Sultan Murad IV abolishes coffeehouses entirely, viewing them as potential threats to social order and political stability. Coffee drinkers are persecuted. The vibrant coffeehouse culture is driven underground.</p>
                </div>
                <p>The streets are quiet where they were once alive with conversation. Doors are boarded. The aroma of roasting beans no longer drifts from the windowsills.</p>
                <p>But coffee does not die. It cannot. In hidden rooms and private homes, people continue to brew and drink. The desire for coffee — and the community it creates — proves stronger than any sultan's decree.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <p class="handwritten">"They can close the doors, but they cannot close our cups. Coffee will outlast any ruler."</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: var(--space-2);">-- An anonymous coffee lover, 1633</p>
                </div>
                <p>And indeed, coffee does outlast the ban. By the end of the 19th century, Istanbul will have nearly 2,500 coffeehouses — a testament to coffee culture's unstoppable resilience.</p>
            `,
            fact: '<strong>1633 CE:</strong> Sultan Murad IV abolished coffeehouses in the Ottoman Empire entirely, viewing them as threats to social order. Despite this, by 1899 Istanbul had nearly 2,500 coffeehouses, showing coffee culture\'s unstoppable resilience.',
            choices: [
                { text: 'Travel west — follow coffee to Enlightenment London', next: 'enlightenment_london' },
                { text: 'Journey to Paris and the Cafe de Procope', next: 'voltaire_table' }
            ]
        },

        // --- SCENE 8: Enlightenment London ---
        enlightenment_london: {
            era: '17th-18th Century - London',
            progress: 60,
            content: `
                <div class="section-number">Scene 8</div>
                <h3 style="margin-bottom: var(--space-5);">Enlightenment London</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1600s-1700s</span>
                    <span class="badge badge-latte">London</span>
                    <span class="badge badge-espresso">Enlightenment</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Coffee crosses the Mediterranean, arriving in Europe through Italian trade routes. But it is in London where coffeehouses become something truly revolutionary.</p>
                <p>English coffeehouses are known as "penny universities." For the price of a single penny — the cost of a cup of coffee — anyone can enter and join the conversation.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <h4>The Penny University</h4>
                    <div class="tag">One Penny Admission</div>
                    <div class="tag">All Social Classes</div>
                    <div class="tag">Rational Debate</div>
                    <div class="tag">News Exchange</div>
                    <p style="margin-top: var(--space-3);">English coffeehouses became engines of Enlightenment thought, allowing patrons from all social classes to gather for a penny admission and engage in serious discussion, rational debate, and the exchange of ideas — creating an alternative intellectual sphere outside the universities.</p>
                </div>
                <p>You push open the heavy door of a London coffeehouse. Inside, the air is warm with steam and spirited debate. A merchant argues shipping routes with a naval officer. A pamphleteer distributes his latest broadsheet. A young scientist sketches diagrams on the back of a bill.</p>
                <div class="quote-block">
                    <p class="quote-text">Before coffee, the common drink of London was ale. People started their day mildly drunk and ended it thoroughly so. Coffee changed everything — it sharpened minds instead of dulling them.</p>
                </div>
                <p>A man at a nearby table leans over. "Have you heard? There is a remarkable cafe in Paris — the Procope. They say Voltaire himself drinks forty cups a day there."</p>
            `,
            fact: '<strong>17th-18th Centuries:</strong> English coffeehouses became "penny universities" — engines of Enlightenment thought where patrons from all social classes gathered for a penny admission to engage in rational debate and exchange ideas, creating an alternative intellectual sphere outside universities.',
            choices: [
                { text: 'Travel to Paris and meet Voltaire at the Cafe de Procope', next: 'voltaire_table' },
                { text: 'Stay in London and witness the birth of modern commerce', next: 'voltaire_table' }
            ]
        },

        // --- SCENE 9: Voltaire's Table ---
        voltaire_table: {
            era: '1755-1778 - Paris',
            progress: 68,
            content: `
                <div class="section-number">Scene 9</div>
                <h3 style="margin-bottom: var(--space-5);">Voltaire's Table at the Procope</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1755-1778</span>
                    <span class="badge badge-latte">Paris</span>
                    <span class="badge badge-espresso">Enlightenment</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Paris, the City of Light. You stand before the Cafe de Procope, the most famous coffeehouse in France — perhaps in all the world.</p>
                <p>Inside, the atmosphere crackles with intellectual energy. The Cafe de Procope is the favorite gathering place of the French Enlightenment. Its patrons include the greatest minds of the age.</p>
                <div class="card-featured card" style="margin: var(--space-5) 0;">
                    <h4>The Cafe de Procope, 1755-1778</h4>
                    <p>Jean-Jacques Rousseau debates the social contract. Denis Diderot plans his great Encyclopedia. And at his favorite table in the corner, Voltaire — the sharpest wit in Europe — drinks cup after cup of coffee while composing the works that will help reshape Western civilization.</p>
                </div>
                <p>You are serving coffee today. As you approach Voltaire's table with a fresh pot, you overhear him speaking to Diderot.</p>
                <div class="quote-block">
                    <p class="quote-text">If this is the devil's drink, then the devil makes a fine brew. It clears the fog that ale and wine have cast over Europe for centuries.</p>
                    <p class="quote-attribution">-- Attributed to Voltaire</p>
                </div>
                <p>Diderot nods thoughtfully. "It is not the coffee alone," he says. "It is the gathering. The coffeehouse gives us a place to think out loud, together."</p>
                <p>The ideas discussed at these tables — reason, liberty, human rights — will fuel revolutions. Coffee has become the drink of radical thought.</p>
            `,
            fact: '<strong>1755-1778:</strong> The Cafe de Procope in Paris became the favorite gathering place for members of the French Enlightenment, hosting luminaries like Jean-Jacques Rousseau, Voltaire, and Denis Diderot.',
            choices: [
                { text: 'Follow coffee into the age of invention — Italy, 1884', next: 'the_invention' },
                { text: 'Speak up and share an idea with the philosophers', next: 'speak_up' }
            ]
        },

        // --- SCENE 9B: Speak Up ---
        speak_up: {
            era: '1755-1778 - Paris',
            progress: 72,
            content: `
                <div class="section-number">Scene 9b</div>
                <h3 style="margin-bottom: var(--space-5);">A Word at the Table</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1770s</span>
                    <span class="badge badge-latte">Cafe de Procope</span>
                </div>
                <p>You set down the coffee pot and speak. "Messieurs, if I may — you speak of reason and liberty, but this very drink proves your point. Coffee crossed borders, defied sultans, survived bans. It thrives because people want to gather, to talk, to think."</p>
                <p>Voltaire raises an eyebrow. Diderot pauses mid-sentence. Rousseau looks up from his writing.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <p class="handwritten">"The server speaks truth. Coffee is democracy in a cup — it cares nothing for rank, only for the thirst of the mind."</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: var(--space-2);">-- Voltaire, smiling</p>
                </div>
                <p>Your words are forgotten by tomorrow, of course. History does not record the names of coffee servers. But the ideas live on — in the pages these men write, in the revolutions that follow, in every cup of coffee shared between people who have something to say.</p>
                <div class="alert alert-success" style="margin: var(--space-5) 0;">
                    <span class="alert-icon">&#10003;</span>
                    <div class="alert-content">
                        <p class="alert-title">A Small Moment</p>
                        <p style="margin: 0; font-size: 0.9375rem;">Sometimes the greatest contributions to history are the ones nobody remembers.</p>
                    </div>
                </div>
                <p>The years pass. Coffee continues its march across the world. And in Italy, someone is about to change everything about how it is made.</p>
            `,
            choices: [
                { text: 'Travel to Milan, 1884 — the age of invention', next: 'the_invention' }
            ]
        },

        // --- SCENE 10: The Invention ---
        the_invention: {
            era: '1884 - Milan, Italy',
            progress: 78,
            content: `
                <div class="section-number">Scene 10</div>
                <h3 style="margin-bottom: var(--space-5);">The Invention</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1884</span>
                    <span class="badge badge-latte">Milan, Italy</span>
                    <span class="badge badge-espresso">Innovation</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Milan, 1884. The Industrial Revolution has transformed Europe. Steam powers factories, railways, and ships. And now, an Italian inventor named Angelo Moriondo has a radical idea: what if steam could power coffee?</p>
                <div class="card-featured card" style="margin: var(--space-5) 0;">
                    <h4>Angelo Moriondo's Patent, 1884</h4>
                    <p>Moriondo patents the earliest known espresso machine, using steam to propel water through coffee grounds at high pressure. His prototype brews coffee in bulk rather than individual servings — but the principle is revolutionary. Coffee, which has been brewed slowly for a thousand years, can now be made in seconds.</p>
                </div>
                <p>You stand in Moriondo's workshop as he demonstrates the machine. Steam hisses. Pressure builds. Dark liquid pours forth — concentrated, intense, unlike any coffee you have ever tasted.</p>
                <p>"It is too strong!" protests a traditional cafe owner who has come to observe. "Coffee should be savored slowly, not shot from a cannon."</p>
                <p>But Moriondo shakes his head. "The world is moving faster. Coffee must keep pace."</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <p class="handwritten">"Speed without quality is waste. But speed with quality — that is progress."</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: var(--space-2);">-- Angelo Moriondo, inventor</p>
                </div>
            `,
            fact: '<strong>1884:</strong> Angelo Moriondo, an Italian inventor, patents the earliest known espresso machine, using steam to propel water through coffee grounds. This bulk-brewing prototype was the ancestor of the modern single-serving espresso.',
            choices: [
                { text: 'Support the invention — invest in espresso technology', next: 'milan_fair' },
                { text: 'Side with tradition — slow coffee has served us well', next: 'milan_fair' }
            ]
        },

        // --- SCENE 11: The Milan Fair ---
        milan_fair: {
            era: '1901-1906 - Milan, Italy',
            progress: 85,
            content: `
                <div class="section-number">Scene 11</div>
                <h3 style="margin-bottom: var(--space-5);">The Milan Fair</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1901-1906</span>
                    <span class="badge badge-latte">Milan</span>
                    <span class="badge badge-espresso">World Stage</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Moriondo's invention inspires others. In 1901, Luigi Bezzera of Milan patents significant improvements to the espresso machine design — making it smaller, faster, and capable of producing individual servings.</p>
                <div class="card" style="margin: var(--space-5) 0;">
                    <h4>The Bezzera-Pavoni Breakthrough</h4>
                    <p>In 1906, Desiderio Pavoni acquires Bezzera's patents and debuts the improved espresso machine at the Milan International Fair. For the first time, the world sees espresso as it will come to be known — a single concentrated shot, made to order, in moments.</p>
                    <div class="badge-row" style="margin-top: var(--space-3);">
                        <span class="badge badge-caramel">1901: Bezzera Patent</span>
                        <span class="badge badge-espresso">1906: Milan Fair Debut</span>
                    </div>
                </div>
                <p>You are at the Milan International Fair. The Pavoni booth draws enormous crowds. People line up to taste this new "espresso" — fast coffee for a fast world. The machine gleams with polished brass and chrome, hissing like a living thing.</p>
                <p>A shot is placed in your hand. It is small — barely two ounces — but the flavor is extraordinary. Dense, syrupy, with a thin layer of golden foam on top that no one has a name for yet.</p>
                <div class="alert alert-info" style="margin: var(--space-5) 0;">
                    <span class="alert-icon">&#9749;</span>
                    <div class="alert-content">
                        <p class="alert-title">The Birth of Crema</p>
                        <p style="margin: 0; font-size: 0.9375rem;">That golden foam will eventually be called "crema" — the hallmark of a properly extracted espresso shot.</p>
                    </div>
                </div>
                <p>But the machine is not yet perfect. The steam pressure produces inconsistent results, and the high temperatures can burn the coffee. One more breakthrough is needed.</p>
            `,
            fact: '<strong>1901-1906:</strong> Luigi Bezzera patented improvements to the espresso machine in 1901. In 1906, Desiderio Pavoni acquired these patents and debuted the improved espresso machine at the Milan International Fair, introducing it to a global audience.',
            choices: [
                { text: 'Wait for the final breakthrough — Gaggia, 1948', next: 'gaggia' },
                { text: 'Invest in espresso and skip to the modern age', next: 'ending_progress' }
            ]
        },

        // --- SCENE 12: Achille's Perfection ---
        gaggia: {
            era: '1948 - Milan, Italy',
            progress: 92,
            content: `
                <div class="section-number">Scene 12</div>
                <h3 style="margin-bottom: var(--space-5);">Achille's Perfection</h3>
                <div class="badge-row">
                    <span class="badge badge-caramel">1948</span>
                    <span class="badge badge-latte">Milan</span>
                    <span class="badge badge-espresso">Revolution</span>
                </div>
                <p class="lead" style="margin-bottom: var(--space-5);">Milan, 1948. The war is over. Italy is rebuilding. And in a small cafe, a barista named Achille Gaggia is about to perfect what Moriondo began sixty-four years ago.</p>
                <div class="card-featured card" style="margin: var(--space-5) 0;">
                    <h4>The Gaggia Revolution</h4>
                    <p>Achille Gaggia perfects the modern espresso machine by introducing pressure extraction methods — using a lever-driven piston instead of steam alone. The result is consistent, lower-temperature extraction that produces espresso as we know it today: rich, complex, crowned with a thick layer of crema.</p>
                </div>
                <p>You watch Gaggia demonstrate his machine for a group of skeptical cafe owners. He pulls the lever with a practiced motion. The machine produces a deep, rumbling hiss. Dark liquid flows into a small white cup.</p>
                <p>The crema is perfect — a golden-brown layer that clings to the surface like velvet. The cafe owners taste it in silence. Then, one by one, they begin to nod.</p>
                <div class="quote-block">
                    <p class="quote-text">This is not just coffee. This is the future, compressed into a single perfect cup.</p>
                    <p class="quote-attribution">-- A Milanese cafe owner, 1948</p>
                </div>
                <p>From this moment forward, espresso will conquer the world. Italian cafes become the model for coffee culture everywhere — from Paris to Tokyo, from New York to Melbourne.</p>
                <p>The humble bean from Kaffa has traveled over a thousand years and thousands of miles to arrive at this moment.</p>
            `,
            fact: '<strong>1948:</strong> Achille Gaggia, a Milanese barista, perfected the modern espresso machine by introducing pressure extraction methods, fundamentally changing how espresso is prepared and consumed worldwide.',
            choices: [
                { text: 'Celebrate progress — see what coffee becomes next', next: 'ending_progress' },
                { text: 'Reflect on what was lost along the way', next: 'ending_tradition' },
                { text: 'Return to Ethiopia, where it all began', next: 'ending_circle' }
            ]
        },

        // --- ENDING 1: Progress ---
        ending_progress: {
            era: 'The Modern World',
            progress: 100,
            content: `
                <div class="scene-ending">
                    <div class="ending-label">Journey Complete</div>
                    <div class="ending-title">The Future in Every Cup</div>
                    <div class="scene-text">
                        <p>Coffee has become the second most traded commodity on Earth, after oil. Over 2.25 billion cups are consumed every day. From Kaldi's dancing goats to Gaggia's gleaming machine, the bean has traveled farther than any spice, any drink, any idea in human history.</p>
                        <p>You chose the path of progress — and coffee rewarded that choice. Every espresso shot pulled, every latte poured, every cold brew steeped is a testament to human ingenuity and the relentless drive to make something better.</p>
                        <div class="card" style="margin: var(--space-5) 0; text-align: left;">
                            <h4>What Coffee Built</h4>
                            <p>Coffeehouses gave birth to insurance (Lloyd's of London started in a coffeehouse), stock exchanges, newspapers, and the Enlightenment itself. Coffee did not just wake people up — it woke up civilization.</p>
                        </div>
                        <p>The journey continues. New roasting techniques, new brewing methods, new regions of cultivation. Coffee is still evolving, still connecting people, still fueling the conversations that shape the world.</p>
                    </div>
                    <div class="the-end">Fin</div>
                </div>
            `,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // --- ENDING 2: Tradition ---
        ending_tradition: {
            era: 'Reflection',
            progress: 100,
            content: `
                <div class="scene-ending">
                    <div class="ending-label">Journey Complete</div>
                    <div class="ending-title">The Slow Cup</div>
                    <div class="scene-text">
                        <p>You sit in a quiet cafe, far from the rush of modern espresso bars. The coffee in your cup was brewed slowly — ground by hand, steeped in a copper pot in the Ottoman tradition, poured with care into a small porcelain cup.</p>
                        <p>For a thousand years, coffee was not fast. It was a ritual. A reason to sit down, to look another person in the eye, to share an hour instead of a minute. The monks of Kaffa did not drink coffee to be more productive. They drank it to be more present.</p>
                        <div class="quote-block" style="text-align: left;">
                            <p class="quote-text">In the rush to make coffee faster, did we forget what coffee was for?</p>
                        </div>
                        <p>The coffeehouse of Istanbul, the penny university of London, Voltaire's corner table at the Procope — these were places of connection, not convenience. The value of coffee was never just the caffeine. It was the conversation.</p>
                        <p>You take another sip. The coffee is cooling now, but the flavor deepens. Some things are better slow.</p>
                    </div>
                    <div class="the-end">Fin</div>
                </div>
            `,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // --- ENDING 3: Full Circle ---
        ending_circle: {
            era: 'Contemporary - Ethiopia',
            progress: 100,
            content: `
                <div class="scene-ending">
                    <div class="ending-label">Journey Complete</div>
                    <div class="ending-title">Full Circle</div>
                    <div class="scene-text">
                        <p>You return to Ethiopia. The highlands of Kaffa are green and bright, just as they were a thousand years ago. Wild coffee plants still grow on the hillsides. Goats still graze among them.</p>
                        <p>A family invites you to participate in a traditional Ethiopian coffee ceremony — the <em>buna</em>. Green beans are roasted over an open flame. The aroma fills the room, just as it filled that monastery so long ago. The beans are ground by hand, brewed in a clay pot called a <em>jebena</em>, and poured into small handleless cups.</p>
                        <div class="card-featured card" style="margin: var(--space-5) 0; text-align: left;">
                            <h4>The Ethiopian Coffee Ceremony</h4>
                            <p>The ceremony has three rounds: <em>abol</em>, <em>tona</em>, and <em>baraka</em> — each progressively weaker, each with its own meaning. The third round is said to bestow a blessing. The ceremony can last over an hour. It is a gift of time, given freely.</p>
                        </div>
                        <p>You drink the third cup. The <em>baraka</em>. The blessing.</p>
                        <p>From Kaldi's goats to Suleiman's Istanbul, from Voltaire's pen to Gaggia's lever — coffee has traveled the world and returned home. The bean that launched a thousand coffeehouses, sparked revolutions, and wired the modern world still grows wild on these Ethiopian hills, still brewed with the same ancient care.</p>
                        <p>Some journeys end where they began. This one does too.</p>
                    </div>
                    <div class="the-end">Fin</div>
                </div>
            `,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        }
    };

    // ═══════════════════════════════════════════════════════════════
    //  STORY ENGINE
    // ═══════════════════════════════════════════════════════════════

    const engine = {
        currentScene: null,
        history: [],
        facts: [],
        factsPanelOpen: false,

        init() {
            document.getElementById('startBtn').addEventListener('click', () => this.start());
            document.getElementById('restartBtn').addEventListener('click', () => this.restart());
            document.getElementById('factToggle').addEventListener('click', () => this.toggleFacts());

            document.addEventListener('keydown', (e) => {
                if (e.key >= '1' && e.key <= '9') {
                    const idx = parseInt(e.key) - 1;
                    const btns = document.querySelectorAll('.choice-btn');
                    if (btns[idx]) btns[idx].click();
                }
            });
        },

        start() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('sceneWrapper').classList.add('active');
            document.getElementById('factTracker').style.display = 'block';
            this.goTo('kaldi');
        },

        restart() {
            this.currentScene = null;
            this.history = [];
            this.facts = [];
            this.factsPanelOpen = false;
            document.getElementById('factPanel').classList.remove('open');
            document.getElementById('sceneWrapper').classList.remove('active');
            document.getElementById('titleScreen').style.display = 'flex';
            document.getElementById('factTracker').style.display = 'none';
            this.updateFactUI();
            window.scrollTo(0, 0);
        },

        goTo(sceneId) {
            if (sceneId === '_restart') {
                this.restart();
                return;
            }

            const scene = STORY[sceneId];
            if (!scene) return;

            if (this.currentScene) {
                const overlay = document.getElementById('transition');
                overlay.classList.add('active');
                setTimeout(() => {
                    this.renderScene(sceneId, scene);
                    window.scrollTo({ top: 0, behavior: 'auto' });
                }, 400);
                setTimeout(() => {
                    overlay.classList.remove('active');
                }, 1000);
            } else {
                this.renderScene(sceneId, scene);
            }

            if (this.currentScene) {
                this.history.push(this.currentScene);
            }
            this.currentScene = sceneId;
        },

        renderScene(sceneId, scene) {
            // Update era label
            if (scene.era) {
                document.getElementById('eraLabel').textContent = scene.era;
            }

            // Update progress bar
            if (scene.progress !== undefined) {
                document.getElementById('progressBar').style.width = scene.progress + '%';
                document.getElementById('progressLabel').textContent = 'Journey: ' + scene.era;
            }

            const container = document.getElementById('sceneContent');
            const gameControls = document.querySelector('.game-controls');
            if (gameControls) gameControls.style.display = sceneId.startsWith('ending') ? 'none' : '';
            let html = '<div class="scene-content">';

            // Scene content (raw HTML from the story data)
            html += scene.content;

            // Fact notification
            if (scene.fact) {
                this.addFact(scene.fact);
            }

            // Choices
            if (scene.choices && scene.choices.length > 0) {
                html += '<div class="choices">';
                scene.choices.forEach((choice, i) => {
                    html += '<button class="choice-btn" onclick="engine.goTo(\'' + choice.next + '\')">';
                    html += '<span class="choice-key">' + (i + 1) + '</span>';
                    html += choice.text;
                    html += '</button>';
                });
                html += '</div>';
            }

            html += '</div>';
            container.innerHTML = html;

            this.updateFactUI();
        },

        addFact(fact) {
            if (!this.facts.includes(fact)) {
                this.facts.push(fact);
            }
        },

        updateFactUI() {
            const count = this.facts.length;
            document.getElementById('factCount').textContent = count;

            const list = document.getElementById('factList');
            if (count === 0) {
                list.innerHTML = '<p class="no-facts">No facts discovered yet...</p>';
            } else {
                list.innerHTML = this.facts.map(f => '<div class="fact-item">' + f + '</div>').join('');
            }
        },

        toggleFacts() {
            this.factsPanelOpen = !this.factsPanelOpen;
            document.getElementById('factPanel').classList.toggle('open', this.factsPanelOpen);
        }
    };

    engine.init();
    </script>
</body>
</html>
