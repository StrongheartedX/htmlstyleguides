<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Summer of Love — A Psychedelic Interactive Story</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Fredoka:wght@400;500;600;700&family=Josefin+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-display: 'Righteous', cursive;
            --font-heading: 'Fredoka', sans-serif;
            --font-body: 'Josefin Sans', sans-serif;

            --acid-orange: #ff6b00;
            --electric-purple: #9b30ff;
            --lime-green: #39ff14;
            --hot-magenta: #ff1493;
            --sunshine-yellow: #ffed00;
            --cosmic-blue: #00bfff;
            --tangerine: #ff9966;
            --grape: #6b3fa0;
            --deep-violet: #1a0033;
            --cream: #fff8dc;

            --gradient-sunset: linear-gradient(135deg, var(--acid-orange), var(--hot-magenta), var(--electric-purple));
            --gradient-acid: linear-gradient(45deg, var(--lime-green), var(--sunshine-yellow), var(--acid-orange));
            --gradient-cosmic: linear-gradient(180deg, var(--deep-violet), var(--electric-purple), var(--hot-magenta));
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; }

        body {
            font-family: var(--font-body);
            font-size: 1rem;
            line-height: 1.6;
            color: var(--cream);
            background: var(--deep-violet);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Swirling animated background */
        .psychedelic-bg {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.4;
            background:
                radial-gradient(ellipse 80% 50% at 20% 30%, var(--electric-purple) 0%, transparent 50%),
                radial-gradient(ellipse 60% 80% at 80% 60%, var(--hot-magenta) 0%, transparent 50%),
                radial-gradient(ellipse 70% 60% at 50% 80%, var(--acid-orange) 0%, transparent 40%),
                radial-gradient(ellipse 50% 40% at 70% 20%, var(--lime-green) 0%, transparent 45%);
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); filter: hue-rotate(0deg); }
            50% { transform: scale(1.1); filter: hue-rotate(30deg); }
        }

        /* Op-art pattern overlay */
        .op-art-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.08;
            background-image: repeating-conic-gradient(
                from 0deg at 50% 50%,
                var(--cream) 0deg 10deg,
                transparent 10deg 20deg
            );
            background-size: 60px 60px;
            animation: spin-slow 120s linear infinite;
        }

        @keyframes spin-slow { to { transform: rotate(360deg); } }

        /* Layout */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* Liquid blob shapes */
        .liquid-blob {
            position: absolute;
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            filter: blur(1px);
            animation: morph 8s ease-in-out infinite;
        }

        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; transform: rotate(0deg) scale(1); }
            25% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
            50% { border-radius: 40% 60% 60% 40% / 70% 30% 50% 50%; transform: rotate(180deg) scale(1.1); }
            75% { border-radius: 60% 30% 40% 70% / 40% 70% 30% 60%; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 0, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.2); }
            50% { box-shadow: 0 0 40px rgba(255, 107, 0, 0.8), inset 0 0 20px rgba(255, 255, 255, 0.3); }
        }

        @keyframes warp-text {
            0%, 100% { transform: perspective(500px) rotateX(0deg) skewX(0deg); letter-spacing: 0.05em; }
            25% { transform: perspective(500px) rotateX(5deg) skewX(-2deg); letter-spacing: 0.08em; }
            50% { transform: perspective(500px) rotateX(0deg) skewX(0deg); letter-spacing: 0.02em; }
            75% { transform: perspective(500px) rotateX(-5deg) skewX(2deg); letter-spacing: 0.06em; }
        }

        @keyframes trippy-colors {
            0%, 100% { filter: hue-rotate(0deg); }
            33% { filter: hue-rotate(60deg); }
            66% { filter: hue-rotate(-60deg); }
        }

        @keyframes melt {
            0%, 100% { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); }
            50% { clip-path: polygon(0 0, 100% 0, 100% 85%, 80% 95%, 60% 85%, 40% 95%, 20% 85%, 0 95%); }
        }

        @keyframes orb-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px currentColor; }
            50% { transform: scale(1.3); box-shadow: 0 0 25px currentColor; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes pulse-rings {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }

        @keyframes sceneFadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========================================
           TITLE SCREEN
        ======================================== */
        .title-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
            position: relative;
        }

        .title-screen h1 {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 12vw, 6rem);
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            line-height: 1;
            margin-bottom: 0.5rem;
            background: var(--gradient-acid);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 30px rgba(255, 107, 0, 0.5));
            animation: warp-text 6s ease-in-out infinite;
        }

        .title-subtitle {
            font-family: var(--font-heading);
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: 500;
            color: var(--sunshine-yellow);
            text-shadow: 2px 2px 0 var(--hot-magenta), 4px 4px 0 var(--electric-purple);
            animation: float 4s ease-in-out infinite;
            margin-bottom: 1.5rem;
        }

        .title-tagline {
            font-family: var(--font-body);
            font-style: italic;
            color: var(--cream);
            opacity: 0.8;
            margin-bottom: 2.5rem;
            max-width: 500px;
            font-size: 1.05rem;
        }

        .title-era {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 2rem;
            padding: 6px 20px;
            background: rgba(155, 48, 255, 0.3);
            border: 2px solid var(--electric-purple);
            border-radius: 50px;
            color: var(--sunshine-yellow);
            font-family: var(--font-heading);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .title-start {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 16px 48px;
            font-family: var(--font-heading);
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--gradient-acid);
            color: var(--deep-violet);
            box-shadow: 0 5px 20px rgba(57, 255, 20, 0.4), 0 0 40px rgba(57, 255, 20, 0.2);
        }

        .title-start::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .title-start:hover::before { transform: translateX(100%); }

        .title-start:hover {
            transform: scale(1.1) rotate(-3deg);
            box-shadow: 0 10px 40px rgba(57, 255, 20, 0.6), 0 0 60px rgba(57, 255, 20, 0.4);
        }

        .title-credits {
            margin-top: 2rem;
            font-size: 0.75rem;
            color: var(--cream);
            opacity: 0.4;
            letter-spacing: 0.1em;
        }

        /* ========================================
           SCENE WRAPPER
        ======================================== */
        .scene-wrapper {
            display: none;
            flex-direction: column;
            flex: 1;
            padding-top: 1rem;
        }

        .scene-wrapper.active { display: flex; }

        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid;
            border-image: var(--gradient-sunset) 1;
        }

        .scene-era-label {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--sunshine-yellow);
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .scene-fact-count {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            color: var(--lime-green);
            letter-spacing: 0.1em;
        }

        .scene-content {
            animation: sceneFadeIn 0.8s ease-out;
        }

        /* ========================================
           TYPOGRAPHY
        ======================================== */
        .type-display {
            font-family: var(--font-display);
            font-size: clamp(2rem, 6vw, 3.5rem);
            line-height: 1;
            background: var(--gradient-acid);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(3px 3px 0 var(--hot-magenta));
        }

        .type-heading {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--sunshine-yellow);
            text-shadow: 2px 2px 0 var(--electric-purple);
        }

        .type-subheading {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            font-weight: 500;
            color: var(--hot-magenta);
        }

        .type-body {
            font-family: var(--font-body);
            font-size: 1.05rem;
            max-width: 60ch;
            line-height: 1.8;
            color: var(--cream);
        }

        .trippy-text {
            animation: trippy-colors 3s ease-in-out infinite;
        }

        .melt {
            animation: melt 4s ease-in-out infinite;
        }

        /* ========================================
           CARDS
        ======================================== */
        .card {
            padding: 1.5rem;
            border-radius: 30px;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .card-orange { background: linear-gradient(135deg, var(--acid-orange), var(--hot-magenta)); box-shadow: 0 10px 40px rgba(255, 107, 0, 0.3); }
        .card-green { background: linear-gradient(135deg, var(--lime-green), var(--cosmic-blue)); box-shadow: 0 10px 40px rgba(57, 255, 20, 0.3); }
        .card-purple { background: linear-gradient(135deg, var(--electric-purple), var(--hot-magenta)); box-shadow: 0 10px 40px rgba(155, 48, 255, 0.3); }
        .card-cosmic { background: linear-gradient(135deg, var(--grape), var(--cosmic-blue)); box-shadow: 0 10px 40px rgba(107, 63, 160, 0.3); }
        .card-yellow { background: linear-gradient(135deg, var(--sunshine-yellow), var(--acid-orange)); box-shadow: 0 10px 40px rgba(255, 237, 0, 0.3); color: var(--deep-violet); }

        .card-icon {
            width: 50px;
            height: 50px;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            backdrop-filter: blur(10px);
            animation: float 3s ease-in-out infinite;
        }

        .card-title {
            font-family: var(--font-heading);
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cream);
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .card-yellow .card-title { color: var(--deep-violet); }

        .card-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: rgba(255, 248, 220, 0.9);
        }

        .card-yellow .card-content { color: rgba(26, 0, 51, 0.85); }

        /* ========================================
           BADGES
        ======================================== */
        .badge {
            font-family: var(--font-heading);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 4px 14px;
            border-radius: 20px;
            display: inline-block;
            margin: 2px 4px;
        }

        .badge-orange { background: var(--acid-orange); color: var(--deep-violet); box-shadow: 0 0 15px rgba(255, 107, 0, 0.4); }
        .badge-purple { background: var(--electric-purple); color: var(--cream); box-shadow: 0 0 15px rgba(155, 48, 255, 0.4); }
        .badge-lime { background: var(--lime-green); color: var(--deep-violet); box-shadow: 0 0 15px rgba(57, 255, 20, 0.4); }
        .badge-magenta { background: var(--hot-magenta); color: var(--cream); box-shadow: 0 0 15px rgba(255, 20, 147, 0.4); }
        .badge-outline { background: transparent; color: var(--sunshine-yellow); border: 2px solid var(--sunshine-yellow); box-shadow: 0 0 10px rgba(255, 237, 0, 0.2); }
        .badge-yellow { background: var(--sunshine-yellow); color: var(--deep-violet); box-shadow: 0 0 15px rgba(255, 237, 0, 0.4); }

        /* ========================================
           ALERTS
        ======================================== */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: 20px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .alert::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
        }

        .alert-groovy {
            background: rgba(57, 255, 20, 0.15);
            border: 1px solid rgba(57, 255, 20, 0.3);
            color: var(--lime-green);
        }
        .alert-groovy::before { background: var(--lime-green); }

        .alert-far-out {
            background: rgba(255, 237, 0, 0.15);
            border: 1px solid rgba(255, 237, 0, 0.3);
            color: var(--sunshine-yellow);
        }
        .alert-far-out::before { background: var(--sunshine-yellow); }

        .alert-bummer {
            background: rgba(255, 107, 0, 0.15);
            border: 1px solid rgba(255, 107, 0, 0.3);
            color: var(--acid-orange);
        }
        .alert-bummer::before { background: var(--acid-orange); }

        .alert-trippy {
            background: rgba(155, 48, 255, 0.15);
            border: 1px solid rgba(155, 48, 255, 0.3);
            color: var(--electric-purple);
        }
        .alert-trippy::before { background: var(--electric-purple); }

        /* ========================================
           DIVIDER
        ======================================== */
        .divider {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            position: relative;
        }

        .divider-orbs {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .divider-orb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            animation: orb-pulse 2s ease-in-out infinite;
        }

        .divider-orb:nth-child(1) { background: var(--acid-orange); animation-delay: 0s; }
        .divider-orb:nth-child(2) { background: var(--hot-magenta); animation-delay: 0.2s; }
        .divider-orb:nth-child(3) { background: var(--electric-purple); animation-delay: 0.4s; }
        .divider-orb:nth-child(4) { background: var(--lime-green); animation-delay: 0.6s; }
        .divider-orb:nth-child(5) { background: var(--sunshine-yellow); animation-delay: 0.8s; }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--acid-orange), var(--hot-magenta), var(--electric-purple), var(--lime-green), transparent);
        }

        /* ========================================
           PEACE SYMBOL
        ======================================== */
        .peace-symbol {
            position: relative;
            display: inline-block;
            width: 30px;
            height: 30px;
            margin: 0 4px;
            vertical-align: middle;
        }

        .peace-symbol::before {
            content: '';
            position: absolute;
            inset: 0;
            border: 3px solid var(--sunshine-yellow);
            border-radius: 50%;
        }

        .peace-symbol::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 50%;
            width: 3px;
            height: 24px;
            background: var(--sunshine-yellow);
            transform: translateX(-50%);
        }

        /* ========================================
           SCENE TYPE STYLES
        ======================================== */

        /* Standard narrative prose */
        .scene-prose {
            background: linear-gradient(135deg, rgba(107, 63, 160, 0.4), rgba(26, 0, 51, 0.6));
            border-radius: 30px;
            border: 2px solid rgba(255, 237, 0, 0.15);
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .scene-prose::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent 0deg 340deg, rgba(255, 237, 0, 0.05) 340deg 360deg);
            animation: rotate-highlight 12s linear infinite;
        }

        @keyframes rotate-highlight { to { transform: rotate(360deg); } }

        .scene-prose .scene-text { position: relative; z-index: 1; }
        .scene-prose .scene-text p { margin-bottom: 1rem; line-height: 1.8; font-size: 1.05rem; }
        .scene-prose .scene-text p:last-child { margin-bottom: 0; }

        /* Psychedelic trip / altered state scene */
        .scene-trip {
            position: relative;
            padding: 2.5rem 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            background:
                radial-gradient(ellipse at 30% 30%, rgba(155, 48, 255, 0.4), transparent 50%),
                radial-gradient(ellipse at 70% 70%, rgba(255, 20, 147, 0.3), transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 107, 0, 0.2), transparent 60%),
                linear-gradient(135deg, rgba(107, 63, 160, 0.5), rgba(26, 0, 51, 0.7));
            border-radius: 40px;
            border: 3px solid;
            border-image: var(--gradient-sunset) 1;
            overflow: hidden;
            animation: breathe 8s ease-in-out infinite;
        }

        .scene-trip .scene-text { position: relative; z-index: 2; max-width: 600px; margin: 0 auto; }
        .scene-trip .scene-text p { margin-bottom: 1.2rem; font-size: 1.1rem; line-height: 1.9; }

        /* Concert / event scene */
        .scene-concert {
            position: relative;
            padding: 2rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(180deg, rgba(255, 107, 0, 0.2), rgba(155, 48, 255, 0.3), rgba(26, 0, 51, 0.6));
            border-radius: 30px;
            border: 2px solid rgba(255, 107, 0, 0.3);
            overflow: hidden;
        }

        .scene-concert::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-radial-gradient(circle at center, transparent 0, transparent 10px, rgba(255, 255, 255, 0.02) 10px, rgba(255, 255, 255, 0.02) 20px);
            animation: pulse-rings 4s ease-in-out infinite;
        }

        .scene-concert .scene-text { position: relative; z-index: 2; }
        .scene-concert .scene-text p { margin-bottom: 1rem; line-height: 1.8; font-size: 1.05rem; }

        /* Dark / somber scene */
        .scene-dark {
            position: relative;
            padding: 2rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.9), rgba(107, 63, 160, 0.2));
            border-radius: 30px;
            border: 2px solid rgba(155, 48, 255, 0.15);
        }

        .scene-dark .scene-text p { margin-bottom: 1rem; line-height: 1.8; font-size: 1.05rem; color: rgba(255, 248, 220, 0.8); }

        /* Ending scene */
        .scene-ending {
            text-align: center;
            padding: 3rem 2rem;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .scene-ending .ending-label {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: var(--hot-magenta);
            margin-bottom: 1rem;
        }

        .scene-ending .ending-title {
            font-family: var(--font-display);
            font-size: clamp(2rem, 6vw, 3rem);
            background: var(--gradient-acid);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            filter: drop-shadow(0 0 20px rgba(255, 237, 0, 0.5));
        }

        .scene-ending .scene-text { max-width: 550px; margin: 0 auto; }
        .scene-ending .scene-text p { margin-bottom: 1rem; color: rgba(255, 248, 220, 0.8); }

        .scene-ending .the-end {
            font-family: var(--font-display);
            font-size: 0.85rem;
            letter-spacing: 0.3em;
            color: var(--electric-purple);
            margin-top: 2rem;
            text-transform: uppercase;
        }

        /* ========================================
           FACT FOUND TOAST
        ======================================== */
        .fact-found {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--sunshine-yellow);
            color: var(--deep-violet);
            padding: 8px 20px;
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-radius: 25px;
            margin-top: 1.5rem;
            animation: factSlideIn 0.6s ease-out;
            box-shadow: 0 0 20px rgba(255, 237, 0, 0.4);
        }

        @keyframes factSlideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* ========================================
           CHOICES
        ======================================== */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
            opacity: 0;
            animation: choicesFadeIn 0.6s ease-out 0.8s forwards;
        }

        @keyframes choicesFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .choice-btn {
            display: flex;
            align-items: center;
            padding: 14px 24px;
            font-family: var(--font-heading);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            text-align: left;
            color: var(--deep-violet);
        }

        .choice-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .choice-btn:hover::before { transform: translateX(100%); }

        .choice-btn-primary {
            background: var(--gradient-acid);
            box-shadow: 0 5px 20px rgba(57, 255, 20, 0.4);
        }

        .choice-btn-primary:hover {
            transform: scale(1.03) rotate(-1deg);
            box-shadow: 0 10px 40px rgba(57, 255, 20, 0.6);
        }

        .choice-btn-secondary {
            background: var(--gradient-sunset);
            color: var(--cream);
            box-shadow: 0 5px 20px rgba(255, 107, 0, 0.4);
        }

        .choice-btn-secondary:hover {
            transform: scale(1.03) rotate(1deg);
            box-shadow: 0 10px 40px rgba(255, 107, 0, 0.6);
        }

        .choice-btn-outline {
            background: transparent;
            color: var(--sunshine-yellow);
            border: 3px solid var(--sunshine-yellow);
            box-shadow: 0 0 20px rgba(255, 237, 0, 0.2);
        }

        .choice-btn-outline:hover {
            background: var(--sunshine-yellow);
            color: var(--deep-violet);
            transform: scale(1.03);
            box-shadow: 0 0 40px rgba(255, 237, 0, 0.5);
        }

        .choice-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(26, 0, 51, 0.3);
            color: inherit;
            font-size: 0.8rem;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .choice-btn-outline .choice-key {
            background: rgba(255, 237, 0, 0.2);
        }

        .choice-btn-outline:hover .choice-key {
            background: rgba(26, 0, 51, 0.3);
        }

        /* ========================================
           TRANSITION OVERLAY
        ======================================== */
        .transition-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 500;
            pointer-events: none;
            opacity: 0;
            background:
                radial-gradient(ellipse at 30% 30%, var(--electric-purple) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 70%, var(--hot-magenta) 0%, transparent 50%),
                var(--deep-violet);
        }

        .transition-overlay.active {
            pointer-events: all;
            animation: psychTransition 1s ease-in-out;
        }

        @keyframes psychTransition {
            0% { opacity: 0; filter: hue-rotate(0deg); }
            30% { opacity: 1; filter: hue-rotate(60deg); }
            50% { opacity: 1; filter: hue-rotate(120deg); }
            70% { opacity: 1; filter: hue-rotate(60deg); }
            100% { opacity: 0; filter: hue-rotate(0deg); }
        }

        /* ========================================
           FACT TRACKER (SIDEBAR)
        ======================================== */
        .fact-tracker {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
            max-width: 260px;
        }

        .fact-tracker-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, rgba(107, 63, 160, 0.6), rgba(26, 0, 51, 0.8));
            border: 2px solid var(--sunshine-yellow);
            border-radius: 30px;
            color: var(--sunshine-yellow);
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: auto;
            box-shadow: 0 0 15px rgba(255, 237, 0, 0.2);
        }

        .fact-tracker-toggle:hover {
            box-shadow: 0 0 25px rgba(255, 237, 0, 0.4);
            transform: scale(1.05);
        }

        .fact-tracker-panel {
            display: none;
            margin-top: 0.5rem;
            background: linear-gradient(135deg, rgba(107, 63, 160, 0.5), rgba(26, 0, 51, 0.9));
            border: 2px solid rgba(255, 237, 0, 0.3);
            border-radius: 20px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            max-height: 60vh;
            overflow-y: auto;
        }

        .fact-tracker-panel.open {
            display: block;
            animation: panelSlideIn 0.3s ease-out;
        }

        @keyframes panelSlideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fact-tracker-panel h4 {
            font-family: var(--font-heading);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--lime-green);
            margin-bottom: 0.75rem;
        }

        .fact-item {
            font-size: 0.78rem;
            color: var(--sunshine-yellow);
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 237, 0, 0.15);
            animation: factSlideIn 0.4s ease-out;
            line-height: 1.4;
        }

        .fact-item:last-child { border-bottom: none; }

        .no-facts {
            font-size: 0.78rem;
            color: var(--cream);
            opacity: 0.4;
            font-style: italic;
        }

        /* ========================================
           GAME CONTROLS
        ======================================== */
        .game-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid rgba(155, 48, 255, 0.2);
        }

        .ctrl-btn {
            padding: 10px 20px;
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border: 2px solid rgba(155, 48, 255, 0.3);
            border-radius: 30px;
            background: transparent;
            color: var(--cream);
            opacity: 0.5;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ctrl-btn:hover {
            opacity: 1;
            border-color: var(--electric-purple);
            box-shadow: 0 0 15px rgba(155, 48, 255, 0.3);
        }

        /* ========================================
           SCROLLBAR
        ======================================== */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--deep-violet); }
        ::-webkit-scrollbar-thumb { background: var(--grape); border-radius: 4px; }
        ::selection { background: var(--hot-magenta); color: var(--cream); }

        /* ========================================
           RESPONSIVE
        ======================================== */
        @media (max-width: 768px) {
            .game-container { padding: 1rem; }
            .fact-tracker { right: 0.75rem; top: 0.75rem; max-width: 200px; }
            .scene-prose, .scene-trip, .scene-concert, .scene-dark { padding: 1.5rem; }
            .choice-btn { font-size: 0.85rem; padding: 12px 20px; }
        }
    </style>
</head>
<body>
    <div class="psychedelic-bg"></div>
    <div class="op-art-overlay"></div>

    <!-- Transition overlay -->
    <div class="transition-overlay" id="transition"></div>

    <!-- Fact Tracker -->
    <div class="fact-tracker" id="factTracker" style="display: none;">
        <button class="fact-tracker-toggle" id="factToggle">
            <span>History</span>
            <span id="factCount">0</span>
        </button>
        <div class="fact-tracker-panel" id="factPanel">
            <h4>Historical Facts Discovered</h4>
            <div id="factList">
                <p class="no-facts">No facts discovered yet...</p>
            </div>
        </div>
    </div>

    <div class="game-container">
        <!-- Title Screen -->
        <div class="title-screen" id="titleScreen">
            <div class="title-era">San Francisco, 1966-1967</div>
            <h1>The Summer of Love</h1>
            <div class="title-subtitle">An Interactive Psychedelic Story</div>
            <p class="title-tagline">"If you're going to San Francisco, be sure to wear some flowers in your hair."</p>
            <button class="title-start" id="startBtn">Begin the Journey</button>
            <p class="title-credits">A story told in colors, music, and choices</p>
            <a href="index.html" class="back-to-stories" style="display:inline-block;margin-top:1.5rem;color:inherit;text-decoration:none;font-size:0.8rem;opacity:0.5;transition:opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">&larr; All Stories</a>
        </div>

        <!-- Scene Container -->
        <div class="scene-wrapper" id="sceneWrapper">
            <div class="scene-header">
                <span class="scene-era-label" id="sceneEraLabel">Winter 1966</span>
            </div>

            <div id="sceneContent"></div>

            <div class="game-controls">
                <button class="ctrl-btn" id="restartBtn">Start Over</button>
            </div>
        </div>
    </div>

    <script>
    // ================================================================
    //  THE SUMMER OF LOVE - Story Data
    // ================================================================

    const STORY = {

        // ---- SCENE 1: Arrival ----
        arrival: {
            type: 'prose',
            era: 'Winter 1966 - San Francisco',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">The City Calls</h2>',
                '<p class="type-body">The Greyhound bus wheezes to a stop at the San Francisco terminal and you step out into a world that smells like fog, diesel, and possibility. You are twenty years old and you have thirty-seven dollars in your pocket.</p>',
                '<p class="type-body">The city hums around you. On a telephone pole, a hand-painted poster advertises something called a "happening" at a gallery you have never heard of. The lettering is fluid, warped, barely readable - like the words themselves are melting off the paper.</p>',
                '<div class="alert alert-far-out"><span>&#9733;</span> <span>You notice two people watching you from across the street. A young man with a guitar case and flowers tucked behind his ear, and a woman in a business suit clutching a briefcase.</span></div>',
                '<p class="type-body">The guitarist grins and waves you over. The businesswoman hurries past without a glance. Between them, San Francisco stretches out in every direction, full of secrets you haven\'t learned yet.</p>',
                '<div class="card card-cosmic"><div class="card-icon">&#9774;</div><div class="card-title">Historical Context</div><div class="card-content">The Haight-Ashbury neighborhood became the counterculture epicenter between 1965 and 1969, thanks to cheap rents in deteriorating Victorian mansions. Notable residents would include the Grateful Dead, Janis Joplin, and Jefferson Airplane.</div></div>'
            ],
            fact: 'Haight-Ashbury became the counterculture epicenter (1965-1969) due to cheap rents in Victorian mansions, housing the Grateful Dead, Janis Joplin, and Jefferson Airplane.',
            choices: [
                { text: 'Follow the guitarist to a folk club', next: 'folk_club', style: 'primary' },
                { text: 'Head to UC Berkeley to witness the activism', next: 'berkeley', style: 'secondary' },
                { text: 'Find a cheap hotel and observe from a distance', next: 'hotel', style: 'outline' }
            ]
        },

        // ---- SCENE 1 Branches ----
        folk_club: {
            type: 'prose',
            era: 'Winter 1966 - North Beach',
            text: [
                '<p class="type-body">The guitarist\'s name is Danny. He leads you through narrow streets to a basement club called <span class="type-subheading">The Purple Onion</span>, where the air is thick with cigarette smoke and acoustic guitar.</p>',
                '<p class="type-body">"This city\'s about to change, man," Danny says, ordering you both coffee. "There\'s something happening. You can feel it in the music, in the art. People are waking up."</p>',
                '<div class="alert alert-groovy"><span>&#10004;</span> <span>Danny introduces you to the regulars - poets, painters, musicians. They speak of consciousness expansion, of a world beyond the nine-to-five. You feel the first stirrings of something new.</span></div>',
                '<p class="type-body">After the last set, Danny mentions an underground art show happening across town. "There\'s this artist - she\'s making these wild concert posters. You\'ve never seen anything like it."</p>'
            ],
            choices: [
                { text: 'Continue to the art show', next: 'underground_art', style: 'primary' }
            ]
        },

        berkeley: {
            type: 'prose',
            era: 'Winter 1966 - UC Berkeley',
            text: [
                '<p class="type-body">You take the bus across the Bay Bridge to Berkeley. The campus is electric with tension and purpose. Students cluster around bulletin boards plastered with anti-war flyers.</p>',
                '<div class="card card-orange"><div class="card-icon">&#9888;</div><div class="card-title">Vietnam War Opposition</div><div class="card-content">The US military escalation in Vietnam in 1964-1965 sparked widespread campus protests and "teach-ins," particularly at UC Berkeley. Students for a Democratic Society (SDS) led the opposition, with youth burning draft cards and blocking military induction centers.</div></div>',
                '<p class="type-body">A young woman with a megaphone stands on the library steps, her voice cutting through the crowd. "They cannot draft our brothers and sons into an unjust war! The Civil Rights Act showed us what organized resistance can achieve - now we turn that same energy against this war!"</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>You feel the urgency in their words. The world is bigger than you thought, and more broken. But also more alive with the possibility of change.</span></div>',
                '<p class="type-body">Afterward, a student named Maria tells you about an underground art show happening in San Francisco. "The real revolution isn\'t just politics," she says. "It\'s in how we see the world."</p>'
            ],
            fact: 'The Vietnam War escalation in 1964-1965 sparked campus protests at UC Berkeley. Students for a Democratic Society (SDS) led opposition with teach-ins, draft card burnings, and blocking induction centers.',
            choices: [
                { text: 'Go to the art show', next: 'underground_art', style: 'primary' }
            ]
        },

        hotel: {
            type: 'prose',
            era: 'Winter 1966 - The Tenderloin',
            text: [
                '<p class="type-body">You find a room at a flophouse hotel for two dollars a night. The wallpaper is peeling and the radiator clanks, but the window looks out over a street that never sleeps.</p>',
                '<p class="type-body">For three days you walk the city. You eat cheap Chinese food in Chinatown. You watch the fog roll through the Golden Gate. You sit in coffeehouses and listen to conversations about things you don\'t fully understand - acid tests, be-ins, consciousness expansion.</p>',
                '<div class="alert alert-far-out"><span>&#9733;</span> <span>On the third night, you find a poster taped to a lamppost. It advertises an underground art exhibition. The lettering melts and swirls. The colors vibrate. Even on paper, it feels like it\'s breathing.</span></div>',
                '<p class="type-body">You tear off the address and put it in your pocket. Tomorrow night, you\'ll go see what all the fuss is about.</p>'
            ],
            choices: [
                { text: 'Attend the art show', next: 'underground_art', style: 'primary' }
            ]
        },

        // ---- SCENE 2: Underground Art ----
        underground_art: {
            type: 'concert',
            era: 'Winter 1966 - Gallery District',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">Underground Tremors</h2>',
                '<p class="type-body">The gallery is a converted warehouse. Inside, the walls pulse with color. Posters with impossible lettering hang everywhere - words that seem to writhe and breathe, rendered in colors that vibrate against each other so intensely your eyes can\'t settle.</p>',
                '<div class="card card-purple"><div class="card-icon">&#10047;</div><div class="card-title">Psychedelic Poster Art</div><div class="card-content">Pop Art was peaking in the 1960s, with Andy Warhol and Roy Lichtenstein democratizing fine art through mass-produced imagery. This artistic rebellion paralleled the psychedelic poster art of Wes Wilson and Victor Moscoso, both questioning what "high art" could be.</div></div>',
                '<p class="type-body">You meet <span class="type-subheading">Sunny</span>, an art student with paint-stained fingers and a laugh that fills the room. She\'s working on a concert poster for a band called the Grateful Dead.</p>',
                '<p class="type-body">"There\'s something happening in January," Sunny tells you, her eyes bright. "A huge gathering in Golden Gate Park. They\'re calling it the <span class="trippy-text" style="font-weight:700;">Human Be-In</span>. Timothy Leary is going to speak. Allen Ginsberg. All the bands. It\'s going to change everything."</p>',
                '<div class="alert alert-groovy"><span>&#10004;</span> <span>Sunny invites you to help promote the event. But you could also use your energy for the anti-war organizing happening at Berkeley. Or you could just wait and watch.</span></div>'
            ],
            fact: 'Pop Art peaked in the 1960s with Andy Warhol and Roy Lichtenstein. Their artistic rebellion paralleled psychedelic poster art by Wes Wilson and Victor Moscoso, both questioning what "high art" could be.',
            choices: [
                { text: 'Help Sunny promote the Human Be-In', next: 'be_in', style: 'primary' },
                { text: 'Get involved in anti-war organizing instead', next: 'be_in_skeptic', style: 'secondary' },
                { text: 'Stay on the margins and observe', next: 'be_in', style: 'outline' }
            ]
        },

        // ---- SCENE 3: The Human Be-In ----
        be_in_skeptic: {
            type: 'prose',
            era: 'January 14, 1967 - Golden Gate Park',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">Turn On, Tune In, Drop Out</h2>',
                '<p class="type-body">You spent the weeks leading up to the event helping with anti-war leaflets at Berkeley instead. But curiosity pulls you to Golden Gate Park on January 14th anyway.</p>',
                '<p class="type-body">Nothing could have prepared you for what you find.</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>The park is a sea of humanity. Young people everywhere - sitting cross-legged on the grass, dancing, playing flutes, passing flowers to strangers. The air shimmers with incense and possibility.</span></div>',
                '<div class="card card-yellow"><div class="card-icon">&#9788;</div><div class="card-title">The Human Be-In</div><div class="card-content">On January 14, 1967, the Human Be-In at Golden Gate Park launched the Summer of Love. Organized by artist Michael Bowen, it featured Timothy Leary, Allen Ginsberg, the Grateful Dead, and Jefferson Airplane. Leary voiced his iconic phrase: "Turn On, Tune In, Drop Out."</div></div>',
                '<p class="type-body">From the stage, a voice rises above the crowd. Timothy Leary, his words ringing out across the meadow: <span class="trippy-text" style="font-family:var(--font-display);font-size:1.3rem;">"Turn on, tune in, drop out."</span></p>',
                '<p class="type-body">The phrase enters your bloodstream like a chemical. Around you, thousands of people seem to collectively exhale. The Grateful Dead launch into their set. The world tilts on its axis.</p>'
            ],
            fact: 'The Human Be-In on January 14, 1967 in Golden Gate Park launched the Summer of Love. Organized by Michael Bowen, it featured Timothy Leary coining "Turn On, Tune In, Drop Out," with the Grateful Dead and Jefferson Airplane performing.',
            choices: [
                { text: 'Embrace the moment fully', next: 'haight', style: 'primary' },
                { text: 'Help others as a trip sitter - stay grounded', next: 'haight', style: 'secondary' },
                { text: 'Feel overwhelmed and retreat to find quiet', next: 'haight', style: 'outline' }
            ]
        },

        be_in: {
            type: 'trip',
            era: 'January 14, 1967 - Golden Gate Park',
            text: [
                '<h2 class="type-heading trippy-text" style="margin-bottom:1rem;">Turn On, Tune In, Drop Out</h2>',
                '<p class="type-body" style="text-align:center;">The day arrives. January 14, 1967. Golden Gate Park.</p>',
                '<p class="type-body" style="text-align:center;">You walk through the park entrance and the world <em>opens</em>.</p>',
                '<div class="divider"><div class="divider-orbs"><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div></div></div>',
                '<div class="card card-yellow"><div class="card-icon">&#9788;</div><div class="card-title">The Human Be-In</div><div class="card-content">On January 14, 1967, the Human Be-In at Golden Gate Park launched the Summer of Love. Organized by artist Michael Bowen, it featured Timothy Leary, Allen Ginsberg, the Grateful Dead, and Jefferson Airplane. Leary voiced his iconic phrase: "Turn On, Tune In, Drop Out."</div></div>',
                '<p class="type-body" style="text-align:center;">Thousands upon thousands of people fill the meadow. Flower garlands hang from trees. The Grateful Dead and Jefferson Airplane fill the air with sound that seems to have color and weight.</p>',
                '<div style="margin: 1.5rem 0; text-align: center;"><img src="https://upload.wikimedia.org/wikipedia/commons/f/fd/Woodstock_redmond_crowd.JPG" alt="The crowd at Woodstock" style="max-width: 100%; height: auto; filter: saturate(1.2) contrast(1.05); border: 2px solid #9b30ff; opacity: 0.85; max-height: 400px; object-fit: contain; box-shadow: 0 0 20px rgba(155, 48, 255, 0.3);"><div style="font-size: 0.75rem; margin-top: 0.5rem; opacity: 0.6; font-style: italic; color: #c0b0d0;">The crowd at Woodstock, August 1969 — 400,000 strong</div></div>',
                '<p class="type-body" style="text-align:center;">Then Timothy Leary steps to the microphone, and the words ring out like a bell across the meadow:</p>',
                '<p class="type-display trippy-text" style="text-align:center;margin:1.5rem 0;font-size:clamp(1.5rem,5vw,2.5rem);">TURN ON, TUNE IN, DROP OUT</p>',
                '<p class="type-body" style="text-align:center;">The crowd roars. You feel it in your chest. Something has begun that cannot be stopped.</p>'
            ],
            fact: 'The Human Be-In on January 14, 1967 in Golden Gate Park launched the Summer of Love. Organized by Michael Bowen, it featured Timothy Leary coining "Turn On, Tune In, Drop Out," with the Grateful Dead and Jefferson Airplane performing.',
            choices: [
                { text: 'Surrender to the experience completely', next: 'haight', style: 'primary' },
                { text: 'Stay sober and serve as a trip sitter for others', next: 'haight', style: 'secondary' },
                { text: 'Retreat to the edges - it\'s too much', next: 'haight', style: 'outline' }
            ]
        },

        // ---- SCENE 4: Haight-Ashbury ----
        haight: {
            type: 'prose',
            era: 'Spring 1967 - Haight-Ashbury',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">The District</h2>',
                '<p class="type-body">In the weeks after the Be-In, you move into a shared Victorian house on Ashbury Street. The rent is almost nothing. Your housemates are a poet, a potter, two musicians, and a woman named Grace who claims she can read auras.</p>',
                '<p class="type-body">The Haight is its own universe now. Head shops sell incense and rolling papers. The Diggers give away free food in the park every afternoon - no questions asked, no strings attached. Record stores blast Jefferson Airplane from open doorways.</p>',
                '<div class="alert alert-groovy"><span>&#10004;</span> <span>Sunny shows up at your door one evening with a stack of concert posters and a wide grin. "Scott McKenzie just recorded a song about us," she says, turning up the radio. The lyrics float through the room: <em>"If you\'re going to San Francisco, be sure to wear some flowers in your hair..."</em></span></div>',
                '<div class="card card-green"><div class="card-icon">&#127804;</div><div class="card-title">"San Francisco" by Scott McKenzie</div><div class="card-content">Written by John Phillips of the Mamas and the Papas, "San Francisco (Be Sure to Wear Some Flowers in Your Hair)" became the anthem that drew thousands of young people westward to join the Summer of Love movement in 1967.</div></div>',
                '<p class="type-body">The song spreads across the country like wildfire. And then the people start coming. Thousands of them, pouring into the Haight with flowers in their hair and dreams in their pockets.</p>'
            ],
            fact: 'Scott McKenzie\'s "San Francisco (Be Sure to Wear Some Flowers in Your Hair)," written by John Phillips, became the anthem that drew thousands of young people to San Francisco in 1967.',
            choices: [
                { text: 'Get a job to help support the collective', next: 'monterey', style: 'primary' },
                { text: 'Fully embrace communal living and sharing', next: 'monterey', style: 'secondary' },
                { text: 'Keep your distance - plan an escape route home', next: 'monterey', style: 'outline' }
            ]
        },

        // ---- SCENE 5: Monterey Pop ----
        monterey: {
            type: 'concert',
            era: 'June 16-18, 1967 - Monterey, California',
            text: [
                '<h2 class="type-heading trippy-text" style="margin-bottom:1rem;">The Moment the World Changed</h2>',
                '<p class="type-body">Sunny borrows a VW bus and you drive south to Monterey. The coastal air whips through the open windows as <span class="type-subheading">Sgt. Pepper\'s Lonely Hearts Club Band</span> plays on the radio - the Beatles\' new album, released just weeks ago.</p>',
                '<div class="card card-orange"><div class="card-icon">&#127925;</div><div class="card-title">Sgt. Pepper\'s Lonely Hearts Club Band</div><div class="card-content">The Beatles released their landmark album on May 26, 1967 (UK) and June 2 (US). It stayed at number one for 27 weeks in the UK and 15 weeks in the US, becoming the definitive soundtrack of the Summer of Love era.</div></div>',
                '<p class="type-body">The Monterey International Pop Festival is three days of pure, distilled magic. Somewhere between 35,000 and 100,000 people gather to witness something unprecedented.</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>You watch Janis Joplin tear her soul open onstage. You see The Who smash their instruments in glorious destruction. And then Jimi Hendrix sets his guitar on fire, and the flames seem to reach up and touch the sky itself.</span></div>',
                '<div class="card card-purple"><div class="card-icon">&#127928;</div><div class="card-title">Monterey Pop Festival</div><div class="card-content">The three-day festival (June 16-18, 1967) attracted 35,000 to 100,000 attendees, marking the musical pinnacle of the Summer of Love. It introduced psychedelic rock to mainstream audiences through historic performances by The Who, Jefferson Airplane, Janis Joplin, and Jimi Hendrix.</div></div>',
                '<p class="type-body">On the drive back, Sunny is quiet for a long time. Then she says, "That was the peak, wasn\'t it? It can\'t get any higher than this." She pauses. "So where does it go from here?"</p>',
                '<p class="type-body">The question hangs in the salt air. As many as <span class="badge badge-lime">100,000</span> young people are converging on San Francisco this summer. The movement is exploding. But Sunny\'s question echoes: where does it go?</p>'
            ],
            fact: 'The Monterey Pop Festival (June 16-18, 1967) attracted 35,000-100,000 people, introducing psychedelic rock to mainstream audiences with performances by Janis Joplin, Jimi Hendrix, The Who, and Jefferson Airplane.',
            choices: [
                { text: 'This is the peak - commit to spreading the message', next: 'activist_path', style: 'primary' },
                { text: 'Beautiful, but you\'re not sure you belong anymore', next: 'doubt_path', style: 'secondary' },
                { text: 'Get pulled deeper into the psychedelic scene', next: 'deeper_path', style: 'outline' }
            ]
        },

        // ---- SCENE 6A: Activist Path ----
        activist_path: {
            type: 'prose',
            era: 'Summer 1967 - Berkeley & San Francisco',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">Make Love Not War</h2>',
                '<span class="peace-symbol"></span>',
                '<p class="type-body">The experience at Monterey crystallizes something in you. This isn\'t just about music and art - it\'s about building a better world. And right now, the most urgent battle is against the war in Vietnam.</p>',
                '<p class="type-body">You begin attending anti-war meetings in Berkeley. The rooms are packed with students, veterans, and ordinary citizens who\'ve seen enough. Draft resistance is growing. Young men are burning their draft cards on the steps of the Federal Building.</p>',
                '<div class="card card-orange"><div class="card-icon">&#9774;</div><div class="card-title">Dr. King Opposes the War</div><div class="card-content">On April 4, 1967, Martin Luther King Jr. delivered his "Beyond Vietnam" speech at Riverside Church in New York, connecting racial justice with ending the war. His moral opposition resonated powerfully with young people in San Francisco, linking the peace movement and civil rights struggle.</div></div>',
                '<p class="type-body">You read the text of Dr. King\'s <span class="type-subheading">"Beyond Vietnam"</span> speech from April, and the words burn into you: the moral argument against the war, the connection between injustice at home and violence abroad. It changes how you see everything.</p>',
                '<div class="alert alert-groovy"><span>&#10004;</span> <span>You help organize a major demonstration in Golden Gate Park. Thousands march peacefully, carrying signs and singing. For one afternoon, it feels like the world might actually listen.</span></div>'
            ],
            fact: 'Martin Luther King Jr. delivered his "Beyond Vietnam" speech on April 4, 1967, connecting racial justice with ending the war. His moral opposition linked the peace movement and civil rights, resonating with counterculture youth.',
            choices: [
                { text: 'Train for nonviolent civil disobedience', next: 'summer_peak', style: 'primary' },
                { text: 'Document the movement through photography', next: 'summer_peak', style: 'secondary' },
                { text: 'Become a local organizer and recruiter', next: 'summer_peak', style: 'outline' }
            ]
        },

        // ---- SCENE 6B: Deeper Trip Path ----
        deeper_path: {
            type: 'trip',
            era: 'Summer 1967 - The Haight',
            text: [
                '<h2 class="type-heading trippy-text" style="margin-bottom:1rem;">Further</h2>',
                '<p class="type-body" style="text-align:center;">After Monterey, you go deeper. The psychedelic scene in the Haight is an ocean and you dive headfirst into it.</p>',
                '<p class="type-body" style="text-align:center;">You attend acid tests. You listen to the Grateful Dead play for six hours straight in Golden Gate Park, the music spiraling out like galaxies being born. You experiment with your own art - concert posters inspired by Wes Wilson\'s fluid, warped letterforms.</p>',
                '<div class="divider"><div class="divider-orbs"><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div></div></div>',
                '<p class="type-body" style="text-align:center;">Sunny introduces you to a collective of artists. They paint murals on the sides of buildings. They screen-print posters for the Fillmore and Avalon Ballroom. They believe that art is the most powerful form of revolution.</p>',
                '<div class="alert alert-far-out"><span>&#9733;</span> <span>The colors are brighter. The music is deeper. Time moves differently. Some mornings you wake up and aren\'t sure what day it is. But the art you\'re making feels real. Alive. Important.</span></div>',
                '<p class="type-body" style="text-align:center;">But in the spaces between the highs, a shadow flickers. Some of the people around you are using harder drugs. Some are losing their way. The line between expansion and escape is getting blurry.</p>'
            ],
            choices: [
                { text: 'Pour yourself into the art - it\'s what matters', next: 'summer_peak', style: 'primary' },
                { text: 'Join a band - express it through music', next: 'summer_peak', style: 'secondary' },
                { text: 'Fall in with a harder crowd - you want to go further', next: 'summer_peak', style: 'outline' }
            ]
        },

        // ---- SCENE 6C: Doubt Path ----
        doubt_path: {
            type: 'dark',
            era: 'Summer 1967 - Haight-Ashbury',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">The View from the Margins</h2>',
                '<p class="type-body">You pull back after Monterey. Something about the festival - the scale of it, the intensity - made you realize you\'re in over your head. You\'re not sure you believe the way everyone else seems to believe.</p>',
                '<p class="type-body">As summer deepens, the Haight fills with new arrivals. Kids as young as fourteen, with no money and nowhere to go, drawn by Scott McKenzie\'s song and the promise of a new world. Some of them look scared.</p>',
                '<div class="alert alert-bummer"><span>&#10006;</span> <span>The neighborhood is changing. There are too many people and not enough resources. The Diggers can barely keep up with the demand for free food. Drug dealers are moving in - and they\'re not selling gentle acid. They\'re pushing harder stuff.</span></div>',
                '<p class="type-body">Sunny finds you sitting on the stoop one evening. "You look like you\'ve seen a ghost," she says.</p>',
                '<p class="type-body">"Maybe I have," you say. "Maybe I\'m watching one being born."</p>'
            ],
            choices: [
                { text: 'Stay and try to help the newcomers', next: 'summer_peak', style: 'primary' },
                { text: 'Start making plans to leave', next: 'summer_peak', style: 'secondary' }
            ]
        },

        // ---- SCENE 7: Summer's Peak ----
        summer_peak: {
            type: 'prose',
            era: 'July-August 1967 - Haight-Ashbury',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">Ain\'t It Heavy?</h2>',
                '<p class="type-body">Summer reaches its zenith and the Haight is bursting at the seams. <span class="badge badge-lime">100,000</span> young people have flooded into San Francisco. The Beatles\' <span class="type-subheading">Sgt. Pepper\'s</span> still plays from every open window, but the music is starting to sound different now. More desperate. Like a prayer that isn\'t sure it\'s being heard.</p>',
                '<div class="card card-orange"><div class="card-icon">&#9888;</div><div class="card-title">The Summer of Love at its Peak</div><div class="card-content">As many as 100,000 young people - hippies, beatniks, and counterculture figures - converged on Haight-Ashbury and Golden Gate Park during the summer of 1967, seeking to reject conformist values and embrace spiritual awakening, free love, and psychedelic experience.</div></div>',
                '<p class="type-body">Tour buses roll down Haight Street now, full of tourists gawking at the hippies like they\'re animals in a zoo. Shop owners sell "hippie souvenirs" to suburbanites. A TV crew films a girl putting a daisy in a National Guardsman\'s rifle barrel, and the image goes national.</p>',
                '<div class="alert alert-bummer"><span>&#10006;</span> <span>Police harassment is intensifying. Drug busts are becoming common. And the people arriving now aren\'t all dreamers - some are runaways, some are predators, some are simply lost.</span></div>',
                '<p class="type-body">Sunny has bags under her eyes. She hasn\'t painted in weeks. "It was supposed to be about love," she says quietly. "When did it get so heavy?"</p>'
            ],
            fact: 'During the Summer of 1967, approximately 100,000 young people converged on San Francisco\'s Haight-Ashbury district, seeking to reject conformist values and embrace spiritual awakening and psychedelic experience.',
            choices: [
                { text: 'Double down - the movement is still worth fighting for', next: 'free_clinic', style: 'primary' },
                { text: 'Something\'s going wrong - try to help from within', next: 'free_clinic', style: 'secondary' },
                { text: 'Think about leaving - go home for a while', next: 'the_funeral', style: 'outline' }
            ]
        },

        // ---- SCENE 8: The Free Clinic ----
        free_clinic: {
            type: 'prose',
            era: 'Late August 1967 - Haight-Ashbury',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">Something\'s Breaking</h2>',
                '<p class="type-body">The Haight-Ashbury Free Clinic has been open since June, and it\'s the only thing standing between many young people and disaster. Dr. David Smith and his volunteers treat everything from bad acid trips to hepatitis, from malnutrition to overdoses. They don\'t judge. They just help.</p>',
                '<div class="card card-green"><div class="card-icon">&#9764;</div><div class="card-title">The Free Clinic</div><div class="card-content">The Haight-Ashbury Free Clinic opened on June 7, 1967, providing healthcare without charge to the flood of young people in the district. This practical manifestation of counterculture ideals reflected the community\'s emphasis on mutual aid and collective responsibility.</div></div>',
                '<p class="type-body">You volunteer there three nights a week. You hold the hands of kids having bad trips. You bring water to people who haven\'t eaten in days. You watch the clinic\'s staff work themselves to the bone, night after night.</p>',
                '<div class="alert alert-bummer"><span>&#10006;</span> <span>One evening, Danny - the guitarist who first welcomed you to San Francisco - is brought in. He\'s barely conscious. Not acid this time. Something harder. His eyes are vacant, his face gaunt. He doesn\'t recognize you.</span></div>',
                '<p class="type-body">Sunny arrives and sees Danny on the cot. She goes very quiet. Then she sits beside him and takes his hand. Neither of them speaks. The clinic hums around you with the sound of a dream slowly coming apart.</p>'
            ],
            fact: 'The Haight-Ashbury Free Clinic opened June 7, 1967, providing free healthcare to the counterculture community. It embodied the movement\'s ideals of mutual aid, treating bad trips, malnutrition, and overdoses without judgment.',
            choices: [
                { text: 'Try to save Danny - risk your own stability', next: 'the_funeral', style: 'primary' },
                { text: 'Accept you can\'t save everyone - step back', next: 'the_funeral', style: 'secondary' },
                { text: 'Get pulled into the darker current yourself', next: 'the_funeral_dark', style: 'outline' }
            ]
        },

        // ---- SCENE 9: Death of Hippie (dark variant) ----
        the_funeral_dark: {
            type: 'dark',
            era: 'October 6, 1967 - Haight Street',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">The Funeral</h2>',
                '<p class="type-body">The weeks after Danny\'s collapse blur together. You stopped volunteering at the clinic. You stopped making art. You stopped doing much of anything except drifting through the Haight, looking for something you can\'t name.</p>',
                '<div class="alert alert-bummer"><span>&#10006;</span> <span>Then one morning in October, you wake to the sound of drums on Haight Street. A funeral procession is passing beneath your window.</span></div>',
                '<div class="card card-purple"><div class="card-icon">&#9760;</div><div class="card-title">Death of Hippie</div><div class="card-content">On October 6, 1967, remaining counterculture residents of Haight-Ashbury staged a symbolic "Death of Hippie" funeral march down Haight Street. Frustrated by commercialization and media exploitation, they carried a coffin to mark the end of the Summer of Love\'s innocent idealism.</div></div>',
                '<p class="type-body">They\'re carrying a coffin down Haight Street. A wooden coffin filled with beads, flowers, and underground newspapers. A cardboard headstone reads: <span class="type-subheading">"HIPPIE - Son of Media."</span></p>',
                '<p class="type-body">Hundreds of people march behind it, their faces a mixture of grief, rage, and weary acceptance. They\'re burying the word "hippie" - and with it, the innocent dream that brought 100,000 people to this street.</p>',
                '<p class="type-body">You watch from your window. You can\'t bring yourself to join them. You can\'t bring yourself to look away.</p>'
            ],
            fact: 'On October 6, 1967, Haight-Ashbury residents staged a symbolic "Death of Hippie" funeral march, carrying a coffin down Haight Street to protest the commercialization and media exploitation of their movement.',
            choices: [
                { text: 'Try to pull yourself together', next: 'reckoning', style: 'primary' },
                { text: 'Keep drifting - you\'re not ready to face this', next: 'ending_lost', style: 'outline' }
            ]
        },

        // ---- SCENE 9: Death of Hippie ----
        the_funeral: {
            type: 'concert',
            era: 'October 6, 1967 - Haight Street',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">The Funeral</h2>',
                '<p class="type-body">October 6, 1967. The morning air on Haight Street carries the sound of drums - but this isn\'t a celebration. It\'s a funeral.</p>',
                '<div class="card card-purple"><div class="card-icon">&#9760;</div><div class="card-title">Death of Hippie</div><div class="card-content">On October 6, 1967, remaining counterculture residents of Haight-Ashbury staged a symbolic "Death of Hippie" funeral march down Haight Street. Frustrated by commercialization and media exploitation, they carried a coffin to mark the end of the Summer of Love\'s innocent idealism.</div></div>',
                '<p class="type-body">Hundreds of people march down Haight Street behind a wooden coffin. Inside it: beads, flowers, underground newspapers, and the ashes of psychedelic posters. A cardboard headstone reads: <span class="type-subheading">"HIPPIE - Son of Media."</span></p>',
                '<p class="type-body">The people who remain - the true believers, the ones who lived here before the media circus and will stay after - are burying the word. Not the idea. The word. The label that the television cameras pinned on them like a butterfly under glass.</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>Sunny stands beside you, watching the procession. She\'s been crying, but her jaw is set. "It was real," she says. "What we felt. What we built. The media can\'t take that away. Nobody can."</span></div>',
                '<p class="type-body">The coffin reaches the end of the street. Someone lights it on fire. The flames climb into the October sky, bright against the gray, and for a moment you can see every color of the Summer of Love burning in that pyre.</p>'
            ],
            fact: 'On October 6, 1967, Haight-Ashbury residents staged a symbolic "Death of Hippie" funeral march, carrying a coffin down Haight Street to protest the commercialization and media exploitation of their movement.',
            choices: [
                { text: 'March in the funeral - acknowledge the dream has changed', next: 'reckoning', style: 'primary' },
                { text: 'The movement isn\'t dead - it\'s evolving', next: 'reckoning', style: 'secondary' },
                { text: 'You\'ve already moved on inside', next: 'reckoning', style: 'outline' }
            ]
        },

        // ---- SCENE 10: Reckoning ----
        reckoning: {
            type: 'prose',
            era: 'November 1967 - Haight-Ashbury',
            text: [
                '<h2 class="type-heading" style="margin-bottom:1rem;">Who Are We Now?</h2>',
                '<p class="type-body">November. The tourists are gone. The TV cameras have moved on to the next spectacle. Haight Street is quieter now, but the quiet has a different quality - less peaceful, more exhausted.</p>',
                '<p class="type-body">You run into Danny on the corner of Haight and Ashbury. He looks better than the last time you saw him - thinner, older, but his eyes are clear. He\'s going back to Oregon. "I came here looking for something," he says. "I found it. And then I lost it. And then I found something else."</p>',
                '<p class="type-body">"What\'s that?"</p>',
                '<p class="type-body">"That the something was always inside me. I didn\'t need the Haight to find it. I just needed the Haight to know it was there."</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>Sunny is still here. She\'s painting again - different work now. Darker, more complex, but shot through with fierce, defiant beauty. She says the Summer of Love taught her what matters, and the autumn taught her what it costs.</span></div>',
                '<p class="type-body">The Haight is becoming a different place. Some residents are leaving. Others are hardening into institutions - co-ops, free schools, the clinic. The revolution isn\'t over. It\'s just growing up. The question is: what are you going to do next?</p>'
            ],
            choices: [
                { text: 'Stay in San Francisco and help build something lasting', next: 'ending_builder', style: 'primary' },
                { text: 'Go home - carry the idealism forward in your own way', next: 'ending_returnee', style: 'secondary' },
                { text: 'Keep moving - head east, the story isn\'t over', next: 'ending_wanderer', style: 'outline' }
            ]
        },

        // ---- ENDING A: The Builder ----
        ending_builder: {
            type: 'ending',
            era: 'December 1967 - San Francisco',
            endingTitle: 'The Long Revolution',
            text: [
                '<p class="type-body">You stay. Not because the dream survived intact - it didn\'t. But because the pieces that remain are worth protecting. Worth building on.</p>',
                '<p class="type-body">You help Sunny open a community art studio in a converted garage on Page Street. It\'s small and it leaks when it rains, but the walls fill with color. Kids from the neighborhood come in after school. Veterans of the Summer of Love teach them to screen-print, to paint, to see the world as something that can be remade.</p>',
                '<p class="type-body">You volunteer at the Free Clinic. You attend planning meetings for the anti-war movement, which is growing sharper, more focused, more determined. The war is escalating, and the draft lottery is coming. There is real work to do.</p>',
                '<div class="alert alert-groovy"><span>&#10004;</span> <span>On a cold December evening, you stand on the corner of Haight and Ashbury. The street is nearly empty. A hundred thousand people stood here six months ago, and now it\'s just you and the fog and the Victorian houses leaning into each other like old friends.</span></div>',
                '<p class="type-body">The Summer of Love is over. But what it planted - in this street, in this city, in you - is still growing. The roots go deep. The flowers will come again, different next time, but just as real.</p>',
                '<p class="type-body">You pull your coat tighter and walk home. There is so much work to do. And for the first time in months, that thought fills you not with exhaustion but with something close to joy.</p>',
                '<div class="divider"><div class="divider-orbs"><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div></div></div>'
            ],
            choices: [
                { text: 'Start Over', next: '_restart', style: 'primary' }
            ]
        },

        // ---- ENDING B: The Returnee ----
        ending_returnee: {
            type: 'ending',
            era: 'December 1967 - Somewhere East',
            endingTitle: 'Flowers in Your Hair',
            text: [
                '<p class="type-body">You board a Greyhound bus heading east on a Tuesday morning. The same terminal where you arrived a year ago. Sunny comes to see you off.</p>',
                '<p class="type-body">"You\'ll be back," she says.</p>',
                '<p class="type-body">"Maybe. Or maybe I\'ll build something where I\'m going. Carry the spark."</p>',
                '<p class="type-body">She puts a flower in your hair and hugs you hard enough to crack your ribs. You climb on the bus and don\'t look back, because if you look back you\'ll never leave.</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>The bus crosses the Bay Bridge and San Francisco shrinks in the rear window. The fog wraps around the city like a blanket, and then it\'s gone. But the colors remain - in your mind, in your memory, in the way you see the world now.</span></div>',
                '<p class="type-body">You carry the Summer of Love home with you like a seed. In your hometown, you will start a food co-op. You will organize against the war. You will teach people that another way of living is possible - not the wide-eyed utopia of the Haight, but something quieter, steadier, rooted in the real earth of a real place.</p>',
                '<p class="type-body">Years later, you\'ll find one of Sunny\'s posters in a museum. The colors still vibrate. The letters still melt. And for a moment you\'ll be twenty years old again, standing in Golden Gate Park, hearing Timothy Leary\'s voice echo across the meadow, feeling the entire world shift beneath your feet.</p>',
                '<div class="divider"><div class="divider-orbs"><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div></div></div>'
            ],
            choices: [
                { text: 'Start Over', next: '_restart', style: 'primary' }
            ]
        },

        // ---- ENDING C: The Wanderer ----
        ending_wanderer: {
            type: 'ending',
            era: 'December 1967 - The Open Road',
            endingTitle: 'Further',
            text: [
                '<p class="type-body">East. You hitchhike east, through the desert, through the mountains, through small towns where people stare at your long hair and your beaded jacket like you\'re an alien.</p>',
                '<p class="type-body">You carry nothing but a backpack, Sunny\'s last poster rolled up inside it, and a head full of music. The road unspools in front of you like a song that hasn\'t been written yet.</p>',
                '<div class="alert alert-far-out"><span>&#9733;</span> <span>In New Mexico, you meet a commune that\'s building something new from scratch - adobe houses, organic gardens, a school for their children. The Summer of Love didn\'t end, they tell you. It scattered. Like seeds in the wind.</span></div>',
                '<p class="type-body">In New York, you stand in the crowd at a massive anti-war rally and feel the energy of a hundred thousand voices raised together. The movement is bigger than San Francisco. It\'s everywhere. It\'s in the music on the radio, in the art on the walls, in the eyes of every young person who ever looked at the world and said: <em>we can do better than this.</em></p>',
                '<p class="type-body">The Summer of Love was one season in one city. But what it awakened doesn\'t have an address. It lives in the road between places, in the space between what the world is and what it could be.</p>',
                '<p class="type-body">You keep moving. The story isn\'t over. It\'s barely begun.</p>',
                '<div class="divider"><div class="divider-orbs"><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div></div></div>'
            ],
            choices: [
                { text: 'Start Over', next: '_restart', style: 'primary' }
            ]
        },

        // ---- ENDING D: The Lost ----
        ending_lost: {
            type: 'ending',
            era: 'Winter 1967 - Haight-Ashbury',
            endingTitle: 'The Long Way Home',
            text: [
                '<p class="type-body">The autumn fades into winter and you fade with it. The Haight is emptying out. The Victorians that once glowed with color and music are going dark, one by one. You drift from crash pad to crash pad, looking for warmth.</p>',
                '<div class="alert alert-bummer"><span>&#10006;</span> <span>Sunny finds you in late November, sitting on the steps of a boarded-up head shop. She brings you soup from the Diggers and sits beside you in silence for a long time.</span></div>',
                '<p class="type-body">"Come to the clinic," she says finally. Not a question. A statement.</p>',
                '<p class="type-body">You go. The people there don\'t judge you. They never did. They just help. And in the helping, in the simple human act of being cared for without conditions, something cracks open inside you.</p>',
                '<p class="type-body">Recovery isn\'t a single moment. It\'s a thousand small choices, one after another, day after day. But the first choice - the choice to accept help - that\'s the one that matters most.</p>',
                '<div class="alert alert-trippy"><span>&#9733;</span> <span>Months later, you\'ll sit in a circle with others who went too far and found their way back. You\'ll tell your story. And when someone asks what the Summer of Love taught you, you\'ll say: "That love is real. And that it\'s not enough by itself. You have to do the work."</span></div>',
                '<p class="type-body">It\'s the hardest lesson the Haight ever taught. But it might be the truest one.</p>',
                '<div class="divider"><div class="divider-orbs"><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div><div class="divider-orb"></div></div></div>'
            ],
            choices: [
                { text: 'Start Over', next: '_restart', style: 'primary' }
            ]
        }
    };

    // ================================================================
    //  STORY ENGINE
    // ================================================================

    const engine = {
        currentScene: null,
        history: [],
        facts: [],
        factsPanelOpen: false,

        init() {
            document.getElementById('startBtn').addEventListener('click', () => this.start());
            document.getElementById('restartBtn').addEventListener('click', () => this.restart());
            document.getElementById('factToggle').addEventListener('click', () => this.toggleFacts());

            document.addEventListener('keydown', (e) => {
                if (e.key >= '1' && e.key <= '9') {
                    const idx = parseInt(e.key) - 1;
                    const btns = document.querySelectorAll('.choice-btn');
                    if (btns[idx]) btns[idx].click();
                }
            });
        },

        start() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('sceneWrapper').classList.add('active');
            document.getElementById('factTracker').style.display = 'block';
            this.goTo('arrival');
        },

        restart() {
            this.currentScene = null;
            this.history = [];
            this.facts = [];
            this.factsPanelOpen = false;
            document.getElementById('factPanel').classList.remove('open');
            document.getElementById('sceneWrapper').classList.remove('active');
            document.getElementById('titleScreen').style.display = 'flex';
            document.getElementById('factTracker').style.display = 'none';
            this.updateFactUI();
            window.scrollTo(0, 0);
        },

        goTo(sceneId) {
            if (sceneId === '_restart') {
                this.restart();
                return;
            }

            const scene = STORY[sceneId];
            if (!scene) return;

            if (this.currentScene) {
                const overlay = document.getElementById('transition');
                overlay.classList.add('active');
                setTimeout(() => {
                    this.renderScene(sceneId, scene);
                    window.scrollTo({ top: 0, behavior: 'auto' });
                }, 400);
                setTimeout(() => {
                    overlay.classList.remove('active');
                }, 1000);
            } else {
                this.renderScene(sceneId, scene);
            }

            if (this.currentScene) {
                this.history.push(this.currentScene);
            }
            this.currentScene = sceneId;
        },

        renderScene(sceneId, scene) {
            const container = document.getElementById('sceneContent');
            const gameControls = document.querySelector('.game-controls');
            if (gameControls) gameControls.style.display = sceneId.startsWith('ending') ? 'none' : '';

            // Update era label
            if (scene.era) {
                document.getElementById('sceneEraLabel').textContent = scene.era;
            }

            let html = '<div class="scene-content">';

            switch (scene.type) {
                case 'prose':
                    html += this.renderProse(scene);
                    break;
                case 'trip':
                    html += this.renderTrip(scene);
                    break;
                case 'concert':
                    html += this.renderConcert(scene);
                    break;
                case 'dark':
                    html += this.renderDark(scene);
                    break;
                case 'ending':
                    html += this.renderEnding(scene);
                    break;
            }

            // Fact notification
            if (scene.fact) {
                this.addFact(scene.fact);
            }

            // Choices
            if (scene.choices && scene.choices.length > 0) {
                html += '<div class="choices">';
                scene.choices.forEach((choice, i) => {
                    const style = choice.style || 'primary';
                    html += '<button class="choice-btn choice-btn-' + style + '" onclick="engine.goTo(\'' + choice.next + '\')">';
                    html += '<span class="choice-key">' + (i + 1) + '</span>';
                    html += choice.text;
                    html += '</button>';
                });
                html += '</div>';
            }

            html += '</div>';
            container.innerHTML = html;

            this.updateFactUI();
        },

        renderProse(scene) {
            let html = '<div class="scene-prose"><div class="scene-text">';
            scene.text.forEach(function(p) { html += p; });
            html += '</div></div>';
            return html;
        },

        renderTrip(scene) {
            let html = '<div class="scene-trip"><div class="scene-text">';
            scene.text.forEach(function(p) { html += p; });
            html += '</div></div>';
            return html;
        },

        renderConcert(scene) {
            let html = '<div class="scene-concert"><div class="scene-text">';
            scene.text.forEach(function(p) { html += p; });
            html += '</div></div>';
            return html;
        },

        renderDark(scene) {
            let html = '<div class="scene-dark"><div class="scene-text">';
            scene.text.forEach(function(p) { html += p; });
            html += '</div></div>';
            return html;
        },

        renderEnding(scene) {
            let html = '<div class="scene-ending">';
            html += '<div class="ending-label">Journey\'s End</div>';
            html += '<div class="ending-title">' + scene.endingTitle + '</div>';
            html += '<div class="scene-text">';
            scene.text.forEach(function(p) { html += p; });
            html += '</div>';
            html += '<div class="the-end">The End</div>';
            html += '</div>';
            return html;
        },

        addFact(fact) {
            if (!this.facts.includes(fact)) {
                this.facts.push(fact);
            }
        },

        updateFactUI() {
            const count = this.facts.length;
            document.getElementById('factCount').textContent = count;

            const list = document.getElementById('factList');
            if (count === 0) {
                list.innerHTML = '<p class="no-facts">No facts discovered yet...</p>';
            } else {
                list.innerHTML = this.facts.map(function(f) {
                    return '<div class="fact-item">' + f + '</div>';
                }).join('');
            }
        },

        toggleFacts() {
            this.factsPanelOpen = !this.factsPanelOpen;
            document.getElementById('factPanel').classList.toggle('open', this.factsPanelOpen);
        }
    };

    engine.init();
    </script>
</body>
</html>
