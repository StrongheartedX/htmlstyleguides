<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Forbidden Library — A Dark Academia Interactive Story</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-display: 'Cormorant Garamond', Georgia, serif;
            --font-heading: 'EB Garamond', Georgia, serif;
            --font-body: 'Source Serif 4', Georgia, serif;

            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --space-7: 48px;
            --space-8: 64px;
            --space-9: 96px;

            --parchment: #f4f1e8;
            --parchment-dark: #e8e4d9;
            --sepia: #704214;
            --sepia-light: #8b5a2b;
            --brown-deep: #3d2914;
            --brown-dark: #2a1a0a;
            --burgundy: #722f37;
            --burgundy-dark: #4a1c23;
            --forest: #2d4a3e;
            --forest-dark: #1a2f26;
            --gold-antique: #b8860b;
            --gold-muted: #9a7b4f;
            --cream: #faf7f0;
            --ink: #1c1612;
            --ink-faded: #3d352e;

            --text-primary: var(--parchment);
            --text-secondary: rgba(244, 241, 232, 0.75);
            --text-muted: rgba(244, 241, 232, 0.5);
            --bg-primary: var(--brown-dark);
            --bg-secondary: var(--brown-deep);
            --accent: var(--gold-antique);

            --border-ornate: 2px solid var(--gold-muted);
            --shadow-warm: 0 4px 24px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 20px rgba(184, 134, 11, 0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { font-size: 17px; }

        body {
            font-family: var(--font-body);
            font-size: 1rem;
            line-height: 1.75;
            color: var(--text-primary);
            background: var(--bg-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* Parchment Texture Background */
        .texture-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.04;
            background-image:
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Vignette Effect */
        .vignette {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(26, 16, 10, 0.4) 100%);
        }

        /* ═══════════════════════════════════════════
           LAYOUT
        ═══════════════════════════════════════════ */
        .game-container {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ═══════════════════════════════════════════
           TITLE SCREEN
        ═══════════════════════════════════════════ */
        .title-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
            padding: var(--space-9) var(--space-6);
        }

        .title-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 60px;
            background: linear-gradient(to bottom, transparent, var(--gold-muted));
        }

        .title-flourish {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--gold-muted);
            letter-spacing: 0.5em;
            margin-bottom: var(--space-5);
        }

        .title-screen h1 {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 7vw, 4.5rem);
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.08em;
            color: var(--parchment);
            margin-bottom: var(--space-4);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .title-subtitle {
            font-family: var(--font-heading);
            font-size: 1.125rem;
            font-style: italic;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
            max-width: 500px;
            margin: 0 auto var(--space-6);
        }

        .title-quote {
            font-family: var(--font-display);
            font-size: 0.875rem;
            color: var(--text-muted);
            font-style: italic;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-7);
            max-width: 480px;
        }

        .title-start {
            font-family: var(--font-display);
            font-size: 0.9375rem;
            font-style: italic;
            letter-spacing: 0.1em;
            padding: var(--space-3) var(--space-7);
            border: 1px solid var(--gold-muted);
            background: transparent;
            color: var(--parchment);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .title-start::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: var(--burgundy-dark);
            transition: left 0.4s ease;
            z-index: -1;
        }

        .title-start:hover {
            border-color: var(--burgundy);
            color: var(--cream);
        }

        .title-start:hover::before { left: 0; }

        .title-credits {
            margin-top: var(--space-7);
            font-family: var(--font-body);
            font-size: 0.7rem;
            color: var(--text-muted);
            letter-spacing: 0.15em;
            font-style: italic;
        }

        /* ═══════════════════════════════════════════
           ORNATE DIVIDER
        ═══════════════════════════════════════════ */
        .ornate-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-4);
            margin: var(--space-7) 0;
            color: var(--gold-muted);
        }

        .ornate-divider::before,
        .ornate-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-muted), transparent);
        }

        .ornate-divider span {
            font-family: var(--font-display);
            font-size: 1.25rem;
            letter-spacing: 0.3em;
        }

        /* ═══════════════════════════════════════════
           SCENE CONTAINER
        ═══════════════════════════════════════════ */
        .scene-wrapper {
            display: none;
            flex-direction: column;
            flex: 1;
        }

        .scene-wrapper.active {
            display: flex;
        }

        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: var(--space-4);
            margin-bottom: var(--space-6);
            border-bottom: 1px solid rgba(154, 123, 79, 0.3);
        }

        .scene-chapter {
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-style: italic;
            letter-spacing: 0.15em;
            color: var(--gold-muted);
        }

        .scene-fact-count {
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-style: italic;
            color: var(--gold-antique);
            letter-spacing: 0.1em;
        }

        /* ═══════════════════════════════════════════
           SCENE TYPES
        ═══════════════════════════════════════════ */

        /* --- Manuscript (main narrative) --- */
        .scene-manuscript {
            position: relative;
            padding: var(--space-6);
            background: linear-gradient(to right, rgba(61, 41, 20, 0.3) 0%, rgba(42, 26, 10, 0.5) 2%, rgba(42, 26, 10, 0.5) 98%, rgba(61, 41, 20, 0.3) 100%);
            border-top: 1px solid rgba(154, 123, 79, 0.3);
            border-bottom: 1px solid rgba(154, 123, 79, 0.3);
            margin-bottom: var(--space-6);
        }

        .scene-manuscript::before {
            content: '';
            position: absolute;
            left: 60px;
            top: 0; bottom: 0;
            width: 1px;
            background: rgba(114, 47, 55, 0.3);
        }

        .scene-manuscript .scene-text {
            padding-left: var(--space-7);
        }

        .scene-manuscript .scene-text p {
            margin-bottom: var(--space-4);
        }

        .scene-manuscript .scene-text p:last-child {
            margin-bottom: 0;
        }

        /* --- Page Frame (flashbacks, historical) --- */
        .scene-pageframe {
            position: relative;
            background: linear-gradient(135deg, rgba(61, 41, 20, 0.6) 0%, rgba(42, 26, 10, 0.8) 100%);
            border: 1px solid var(--gold-muted);
            padding: var(--space-7);
            margin-bottom: var(--space-6);
            box-shadow:
                inset 0 0 60px rgba(0, 0, 0, 0.3),
                var(--shadow-warm);
        }

        .scene-pageframe::before {
            content: '';
            position: absolute;
            top: 8px; left: 8px; right: 8px; bottom: 8px;
            border: 1px solid rgba(154, 123, 79, 0.3);
            pointer-events: none;
        }

        .scene-pageframe .scene-text p {
            margin-bottom: var(--space-4);
        }

        .scene-pageframe .scene-text p:last-child {
            margin-bottom: 0;
        }

        /* --- Card (character profiles, historical context) --- */
        .scene-card {
            background: linear-gradient(145deg, rgba(61, 41, 20, 0.5) 0%, rgba(42, 26, 10, 0.7) 100%);
            border: 1px solid rgba(154, 123, 79, 0.3);
            padding: var(--space-6);
            position: relative;
            margin-bottom: var(--space-6);
            transition: all 0.4s ease;
        }

        .scene-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--burgundy-dark), var(--burgundy), var(--gold-muted));
            opacity: 1;
        }

        .scene-card .card-title {
            font-family: var(--font-display);
            font-size: 1.375rem;
            font-style: italic;
            letter-spacing: 0.05em;
            color: var(--parchment);
            margin-bottom: var(--space-3);
        }

        .scene-card .scene-text {
            font-size: 0.9375rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .scene-card .scene-text p {
            margin-bottom: var(--space-4);
        }

        .scene-card .scene-text p:last-child {
            margin-bottom: 0;
        }

        .scene-card .card-footer {
            margin-top: var(--space-5);
            padding-top: var(--space-4);
            border-top: 1px solid rgba(154, 123, 79, 0.2);
            font-family: var(--font-display);
            font-size: 0.8125rem;
            font-style: italic;
            color: var(--text-muted);
        }

        /* --- Ending --- */
        .scene-ending {
            text-align: center;
            padding: var(--space-8) var(--space-6);
            margin-bottom: var(--space-6);
        }

        .scene-ending .ending-label {
            font-family: var(--font-display);
            font-size: 0.8rem;
            letter-spacing: 0.3em;
            color: var(--gold-antique);
            margin-bottom: var(--space-4);
            font-style: italic;
        }

        .scene-ending .ending-title {
            font-family: var(--font-display);
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.08em;
            color: var(--parchment);
            margin-bottom: var(--space-6);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .scene-ending .scene-text {
            max-width: 550px;
            margin: 0 auto;
        }

        .scene-ending .scene-text p {
            margin-bottom: var(--space-4);
            color: var(--text-secondary);
        }

        .scene-ending .the-end {
            font-family: var(--font-display);
            font-size: 1rem;
            letter-spacing: 0.5em;
            color: var(--gold-muted);
            margin-top: var(--space-7);
            font-style: italic;
        }

        /* ═══════════════════════════════════════════
           DROP CAP
        ═══════════════════════════════════════════ */
        .dropcap {
            position: relative;
        }

        .dropcap::first-letter {
            float: left;
            font-family: var(--font-display);
            font-size: 5rem;
            line-height: 0.75;
            padding-right: var(--space-3);
            padding-top: var(--space-2);
            color: var(--burgundy);
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        }

        /* ═══════════════════════════════════════════
           BLOCKQUOTE
        ═══════════════════════════════════════════ */
        blockquote, .scene-blockquote {
            font-family: var(--font-display);
            font-size: 1.375rem;
            font-style: italic;
            line-height: 1.6;
            padding: var(--space-6);
            margin: var(--space-5) 0;
            border-left: 3px solid var(--burgundy);
            background: rgba(114, 47, 55, 0.08);
            color: var(--text-secondary);
        }

        blockquote cite, .scene-blockquote cite {
            display: block;
            font-family: var(--font-body);
            font-size: 0.8125rem;
            font-style: normal;
            letter-spacing: 0.1em;
            margin-top: var(--space-4);
            color: var(--text-muted);
        }

        /* ═══════════════════════════════════════════
           BADGES
        ═══════════════════════════════════════════ */
        .badge {
            display: inline-block;
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-style: italic;
            letter-spacing: 0.1em;
            padding: var(--space-2) var(--space-4);
            border: 1px solid rgba(154, 123, 79, 0.5);
            color: var(--text-secondary);
            background: transparent;
            margin-right: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .badge-burgundy {
            border-color: var(--burgundy);
            color: var(--burgundy);
            background: rgba(114, 47, 55, 0.1);
        }

        .badge-forest {
            border-color: var(--forest);
            color: var(--forest);
            background: rgba(45, 74, 62, 0.15);
        }

        .badge-gold {
            border-color: var(--gold-antique);
            color: var(--gold-antique);
            background: rgba(184, 134, 11, 0.1);
        }

        /* ═══════════════════════════════════════════
           FACT DISCOVERED TOAST
        ═══════════════════════════════════════════ */
        .fact-found {
            display: inline-block;
            background: rgba(184, 134, 11, 0.15);
            border: 1px solid var(--gold-antique);
            color: var(--gold-antique);
            padding: 6px 16px 6px 28px;
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-style: italic;
            letter-spacing: 0.1em;
            margin-top: var(--space-5);
            position: relative;
            animation: factSlideIn 0.6s ease-out;
        }

        .fact-found::before {
            content: '';
            position: absolute;
            left: 10px; top: 50%;
            transform: translateY(-50%);
            width: 8px; height: 8px;
            background: var(--gold-antique);
            border-radius: 50%;
        }

        @keyframes factSlideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* ═══════════════════════════════════════════
           CHOICES
        ═══════════════════════════════════════════ */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: var(--space-5);
            opacity: 0;
            animation: choicesFadeIn 0.6s ease-out 0.8s forwards;
        }

        @keyframes choicesFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .choice-btn {
            display: flex;
            align-items: center;
            padding: var(--space-3) var(--space-6);
            font-family: var(--font-display);
            font-size: 0.9375rem;
            font-style: italic;
            letter-spacing: 0.1em;
            border: 1px solid var(--gold-muted);
            background: transparent;
            color: var(--parchment);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            text-align: left;
        }

        .choice-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: var(--burgundy-dark);
            transition: left 0.4s ease;
            z-index: -1;
        }

        .choice-btn:hover {
            border-color: var(--burgundy);
            color: var(--cream);
        }

        .choice-btn:hover::before { left: 0; }

        .choice-btn .choice-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px; height: 24px;
            border: 1px solid var(--gold-muted);
            font-size: 0.7rem;
            color: var(--gold-muted);
            margin-right: var(--space-4);
            flex-shrink: 0;
            font-style: normal;
        }

        .choice-btn:hover .choice-key {
            border-color: var(--burgundy);
            color: var(--cream);
        }

        .choice-btn.btn-danger {
            border-color: var(--burgundy);
        }

        .choice-btn.btn-safe {
            border-color: var(--forest);
        }

        .choice-btn.btn-safe::before {
            background: var(--forest-dark);
        }

        .choice-btn.btn-safe:hover {
            border-color: var(--forest);
        }

        /* ═══════════════════════════════════════════
           TRANSITION
        ═══════════════════════════════════════════ */
        .transition-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 500;
            pointer-events: none;
            opacity: 0;
            background: var(--brown-dark);
        }

        .transition-overlay.active {
            pointer-events: all;
            animation: pageTransition 1s ease-in-out;
        }

        @keyframes pageTransition {
            0% { opacity: 0; }
            30% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* ═══════════════════════════════════════════
           SCENE FADE IN
        ═══════════════════════════════════════════ */
        .scene-content {
            animation: sceneFadeIn 0.8s ease-out;
        }

        @keyframes sceneFadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ═══════════════════════════════════════════
           KNOWLEDGE TRACKER (SIDEBAR)
        ═══════════════════════════════════════════ */
        .fact-tracker {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
            max-width: 260px;
        }

        .fact-tracker-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 1px solid rgba(154, 123, 79, 0.4);
            color: var(--gold-antique);
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-style: italic;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: auto;
        }

        .fact-tracker-toggle:hover {
            border-color: var(--gold-antique);
            box-shadow: var(--shadow-glow);
        }

        .fact-tracker-panel {
            display: none;
            margin-top: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid rgba(154, 123, 79, 0.4);
            padding: var(--space-5);
            max-height: 60vh;
            overflow-y: auto;
        }

        .fact-tracker-panel.open {
            display: block;
            animation: panelSlideIn 0.3s ease-out;
        }

        @keyframes panelSlideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fact-tracker-panel h4 {
            font-family: var(--font-display);
            font-size: 0.8rem;
            font-style: italic;
            letter-spacing: 0.15em;
            color: var(--gold-muted);
            margin-bottom: var(--space-4);
        }

        .fact-item {
            font-family: var(--font-body);
            font-size: 0.75rem;
            color: var(--gold-antique);
            padding: 6px 0;
            border-bottom: 1px solid rgba(154, 123, 79, 0.2);
            animation: factSlideIn 0.4s ease-out;
            line-height: 1.5;
        }

        .fact-item:last-child { border-bottom: none; }

        .no-facts {
            font-family: var(--font-display);
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
        }

        /* ═══════════════════════════════════════════
           GAME CONTROLS
        ═══════════════════════════════════════════ */
        .game-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: var(--space-6);
            padding-top: var(--space-5);
            border-top: 1px solid rgba(154, 123, 79, 0.2);
        }

        .ctrl-btn {
            padding: 8px 16px;
            font-family: var(--font-display);
            font-size: 0.8rem;
            font-style: italic;
            letter-spacing: 0.1em;
            border: 1px solid rgba(154, 123, 79, 0.3);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s;
        }

        .ctrl-btn:hover {
            border-color: var(--gold-muted);
            color: var(--parchment);
        }

        /* ═══════════════════════════════════════════
           SECTION HEADER WITHIN SCENES
        ═══════════════════════════════════════════ */
        .scene-section-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.1em;
            color: var(--parchment);
            margin-bottom: var(--space-4);
            text-align: center;
        }

        .scene-section-numeral {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 400;
            color: var(--gold-muted);
            opacity: 0.6;
            margin-bottom: var(--space-2);
            letter-spacing: 0.2em;
            text-align: center;
        }

        /* ═══════════════════════════════════════════
           HISTORICAL CARD WITHIN SCENE
        ═══════════════════════════════════════════ */
        .historical-card {
            background: linear-gradient(145deg, rgba(61, 41, 20, 0.5) 0%, rgba(42, 26, 10, 0.7) 100%);
            border: 1px solid rgba(154, 123, 79, 0.3);
            padding: var(--space-5);
            margin: var(--space-5) 0;
            position: relative;
            box-shadow: var(--shadow-glow);
        }

        .historical-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold-antique), var(--gold-muted), var(--gold-antique));
        }

        .historical-card .card-label {
            font-family: var(--font-display);
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            color: var(--gold-antique);
            margin-bottom: var(--space-2);
            font-style: italic;
        }

        .historical-card .card-title {
            font-family: var(--font-display);
            font-size: 1.125rem;
            font-style: italic;
            color: var(--parchment);
            margin-bottom: var(--space-3);
        }

        .historical-card .card-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* ═══════════════════════════════════════════
           SCROLLBAR
        ═══════════════════════════════════════════ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--gold-muted); }
        ::selection { background: var(--burgundy); color: var(--parchment); }

        /* ═══════════════════════════════════════════
           RESPONSIVE
        ═══════════════════════════════════════════ */
        @media (max-width: 768px) {
            html { font-size: 16px; }
            .game-container { padding: var(--space-6) var(--space-4); }
            .title-screen { padding: var(--space-7) var(--space-4); }
            .scene-pageframe { padding: var(--space-5); }
            .scene-pageframe::before {
                top: 4px; left: 4px; right: 4px; bottom: 4px;
            }
            .scene-manuscript::before { left: 30px; }
            .scene-manuscript .scene-text { padding-left: var(--space-5); }
            .dropcap::first-letter { font-size: 3.5rem; }
            .fact-tracker { right: 0.75rem; top: 0.75rem; max-width: 220px; }
            .choice-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="texture-bg"></div>
    <div class="vignette"></div>

    <!-- Page transition overlay -->
    <div class="transition-overlay" id="transition"></div>

    <!-- Knowledge Tracker -->
    <div class="fact-tracker" id="factTracker" style="display: none;">
        <button class="fact-tracker-toggle" id="factToggle">
            <span>Discovered Knowledge</span>
            <span id="factCount">0</span>
        </button>
        <div class="fact-tracker-panel" id="factPanel">
            <h4>Historical Facts Uncovered</h4>
            <div id="factList">
                <p class="no-facts">No knowledge yet discovered...</p>
            </div>
        </div>
    </div>

    <div class="game-container">
        <!-- Title Screen -->
        <div class="title-screen" id="titleScreen">
            <div class="title-flourish">* * *</div>
            <h1>The Forbidden Library</h1>
            <div class="title-subtitle">An Interactive Dark Academia Story</div>
            <p class="title-quote">"Some knowledge is kept hidden not because it is false, but because it is dangerous to those who rule."</p>
            <button class="title-start" id="startBtn">Enter the College</button>
            <p class="title-credits">A story of scholars, secrets, and the cost of truth</p>
            <a href="index.html" class="back-to-stories" style="display:inline-block;margin-top:1.5rem;color:inherit;text-decoration:none;font-size:0.8rem;opacity:0.5;transition:opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">&larr; All Stories</a>
        </div>

        <!-- Scene Container -->
        <div class="scene-wrapper" id="sceneWrapper">
            <div class="scene-header">
                <span class="scene-chapter" id="sceneChapter">Chapter I</span>
                <span class="scene-fact-count" id="headerFactCount"></span>
            </div>

            <div id="sceneContent"></div>

            <div class="game-controls">
                <button class="ctrl-btn" id="restartBtn">Return to Title</button>
            </div>
        </div>
    </div>

    <script>
    // ═══════════════════════════════════════════════════════════════
    //  THE FORBIDDEN LIBRARY — Story Data
    // ═══════════════════════════════════════════════════════════════

    const STORY = {

        // -------------------------------------------------------
        // SCENE 1: THE SUMMONS
        // -------------------------------------------------------
        summons: {
            type: 'manuscript',
            chapter: 'Chapter I',
            text: [
                '<p class="dropcap">The letter arrived on a Tuesday, folded inside a volume of Aristotle\'s <em>Metaphysics</em> that had been returned to the Bodleian with no borrower\'s name. Written in a cipher you recognized from your doctoral research on medieval Oxford, it contained a single instruction: come to the oldest college at twilight, and bring no one.</p>',
                '<p>Now you stand before the gates of University College, your breath fogging in the December air. Founded in <strong>1249</strong> by a bequest from William of Durham&mdash;310 marks left to support scholars&mdash;it is the oldest college in Oxford, the first stone laid in what would become the world\'s most storied university system.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">University College, Oxford (1249)</div><div class="card-text">William of Durham died in 1249, bequeathing 310 marks to support Oxford scholars. This endowment established the first college system, transforming Oxford from informal gatherings of teachers and students into structured residential colleges that persist to this day.</div></div>',
                '<p>The quad is empty. The porter\'s lodge glows with faint candlelight. Two paths lie before you: the main gate, where you would need to announce yourself and explain your purpose, or the narrow tradesman\'s entrance along the side wall, half-hidden behind bare winter ivy.</p>'
            ],
            fact: 'University College, founded 1249 by William of Durham\'s bequest of 310 marks, is Oxford\'s oldest college.',
            choices: [
                { text: 'Enter through the main gate', next: 'official', style: 'btn-safe' },
                { text: 'Slip through the tradesman\'s entrance', next: 'secret', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 2a: THE CHANCELLOR'S SHADOW
        // -------------------------------------------------------
        official: {
            type: 'card',
            chapter: 'Chapter II',
            cardTitle: 'The Master\'s Lodge',
            text: [
                '<p>The porter nods and waves you through. Inside the paneled lodge, the College Master sits behind a desk older than most nations. He regards you with the practiced warmth of a man who has denied a thousand requests without raising his voice.</p>',
                '<p>"The library is closed after dark. Has been since the incident in \'73." He adjusts his spectacles. "However, if your business is legitimate, I can arrange supervised access. What exactly are you researching?"</p>',
                '<p>You recall that Oxford\'s chancellors have held extraordinary power since <strong>June 20, 1214</strong>, when a Papal Legate issued the Oxford Ordinance granting the university authority above the town itself. That power has never truly diminished.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">The Oxford Ordinance (June 20, 1214)</div><div class="card-text">Following the crisis of 1209&mdash;when two students were killed by townspeople and scholars fled Oxford entirely&mdash;a Papal Legate issued this decree granting scholars extraordinary legal privileges. The Chancellor was placed above town authority, students received controlled rent and exemption from civil law through "benefit of clergy." It remains one of the most significant documents in university history.</div></div>',
                '<p>The Master watches you carefully. His power descends from seven centuries of institutional authority. What you say next will determine everything.</p>'
            ],
            fact: 'The Oxford Ordinance of June 20, 1214 placed the Chancellor above town authority and granted scholars legal privileges including exemption from civil law.',
            choices: [
                { text: 'Reveal your true purpose: the forbidden manuscript', next: 'alliance', style: 'btn-danger' },
                { text: 'Claim you are studying canon law', next: 'heist', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 2b: UNDERGROUND PASSAGES
        // -------------------------------------------------------
        secret: {
            type: 'pageframe',
            chapter: 'Chapter II',
            text: [
                '<p class="dropcap">You press through the narrow entrance and descend stone steps worn smooth by five centuries of footsteps. The passage smells of damp earth and old mortar. On the walls, scratched into limestone, you find student graffiti dating to the 1300s&mdash;Latin curses against tutors, crude drawings, a date: <em>MCCLXIII</em>.</p>',
                '<p>That date: <strong>1263</strong>. The year John I de Balliol founded Balliol College, later consolidated by his widow Dervorguilla of Galloway in 1282. These passages must connect the oldest foundations.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">Balliol College (1263)</div><div class="card-text">John I de Balliol founded this college in 1263, which was later consolidated by his widow Dervorguilla of Galloway in 1282. Along with University College (1249) and Merton (1264), these three colleges form the oldest triad in the English-speaking world&mdash;and their underground passages have never been fully mapped.</div></div>',
                '<p>At the passage\'s end, a door. Beyond it, the muffled sound of someone moving through stacks of books. You push it open and find yourself in the restricted wing of the library, face to face with a woman in a librarian\'s gown. She does not seem surprised to see you.</p>',
                '<p>"You received the letter," she says. It is not a question.</p>'
            ],
            fact: 'Balliol College was founded in 1263 by John I de Balliol and consolidated by his widow Dervorguilla of Galloway in 1282.',
            choices: [
                { text: 'Ask the librarian what she knows', next: 'alliance', style: '' },
                { text: 'Demand the library keys and proceed alone', next: 'heist', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 3a: THE LIBRARIAN'S CONFESSION
        // -------------------------------------------------------
        alliance: {
            type: 'manuscript',
            chapter: 'Chapter III',
            text: [
                '<p class="dropcap">Her name is Dr. Helena Voss. She has been the college\'s special collections librarian for fourteen years, and for twelve of those years, she has been secretly studying the texts in the restricted vault&mdash;texts the university officially claims do not exist.</p>',
                '<p>"I found the first one by accident," she tells you, her voice barely above a whisper as she leads you through narrow corridors between towering shelves. "A manuscript attributed to Roger Bacon. Not the <em>Opus Majus</em> that everyone knows. Something else. Something the Franciscans tried to destroy."</p>',
                '<div class="scene-blockquote">"For the things of this world cannot be made known without a knowledge of mathematics."<cite>&mdash; Roger Bacon, Opus Majus (c. 1267)</cite></div>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">Roger Bacon\'s Imprisonment (1277&ndash;1279)</div><div class="card-text">Roger Bacon (c. 1219&ndash;1292), a Franciscan friar and polymath who studied and lectured at Oxford, pioneered the scientific method and advanced empiricism centuries before the Enlightenment. Between 1277 and 1279, he was imprisoned by his own Franciscan order for "suspected novelties" in his teaching&mdash;his crime was pursuing knowledge the Church deemed forbidden.</div></div>',
                '<p>Dr. Voss stops before a locked iron door. "Bacon was imprisoned for two years for daring to suggest that observation matters more than authority. Seven hundred years later, and this university still keeps his most radical work under lock and key." She holds up a brass key. "I can take you to the manuscript vault. But you should understand&mdash;once you read what is there, you cannot unread it."</p>'
            ],
            fact: 'Roger Bacon (c. 1219-1292) was imprisoned by his fellow Franciscans from 1277-1279 for "suspected novelties" in his teaching about the scientific method.',
            choices: [
                { text: 'Enter the manuscript vault', next: 'discovery', style: 'btn-danger' },
                { text: 'Hesitate and suggest abandoning the search', next: 'safe_choice', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 3b: THE LOCKED WING
        // -------------------------------------------------------
        heist: {
            type: 'card',
            chapter: 'Chapter III',
            cardTitle: 'The Restricted Collection',
            text: [
                '<p>You move through the restricted wing alone, guided only by the faint glow of emergency lighting. The shelves here are behind glass cases, some sealed with wax bearing the university\'s ancient seal. You find what you are looking for in the third case: a manuscript bound in cracked leather, its pages darkened with age.</p>',
                '<p>The text is dense and difficult, but you recognize the philosophical framework immediately. This is a copy of William of Ockham\'s suppressed arguments&mdash;the ones that went beyond his famous "razor" and attacked the very foundations of Church authority.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">William of Ockham\'s Nominalism (c. 1287&ndash;1347)</div><div class="card-text">This Oxford theologian pioneered nominalism and empiricism, arguing that only individuals exist&mdash;not universal essences. His philosophy was radical: if universals are merely names, then the Church\'s claim to universal spiritual authority collapses. Ockham\'s ideas challenged institutional power so fundamentally that he was summoned to Avignon and charged with heresy. He spent the last two decades of his life in exile.</div></div>',
                '<p>As you carefully open the manuscript, a loose page falls out. It is a catalog&mdash;a list of other forbidden texts hidden throughout Oxford\'s colleges, with locations marked in cipher. Someone has been preserving these works for centuries.</p>',
                '<p>Footsteps echo in the corridor outside. Someone else is in the library at this hour.</p>'
            ],
            fact: 'William of Ockham (c. 1287-1347) pioneered nominalism, arguing only individuals exist, challenging Church authority so deeply he was charged with heresy and exiled.',
            choices: [
                { text: 'Read the manuscripts immediately', next: 'discovery', style: 'btn-danger' },
                { text: 'Carefully transcribe what you can and prepare to leave', next: 'preparation', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 4a: FORBIDDEN KNOWLEDGE
        // -------------------------------------------------------
        discovery: {
            type: 'pageframe',
            chapter: 'Chapter IV',
            text: [
                '<p class="dropcap">By the light of a single candle&mdash;electric light seems wrong in this place&mdash;you read. The manuscript is a palimpsest: beneath the surface text of approved theology, an earlier hand has written arguments so dangerous they were scraped away and overwritten. But not well enough. With a magnifying glass, the forbidden words emerge like ghosts.</p>',
                '<p>The argument is devastating in its simplicity: that all authority&mdash;church, king, and university alike&mdash;derives its power not from God but from the consent of those it governs. That knowledge cannot be owned or suppressed, only shared. That the burning of books is the confession of those who fear what books contain.</p>',
                '<div class="scene-blockquote">"It is licit to resist an unjust authority, for authority that suppresses truth has abdicated its claim to obedience."<cite>&mdash; Attributed to the anonymous Oxford manuscript, c. 1340</cite></div>',
                '<p>You think of the violence these ideas once provoked. On <strong>February 10, 1355</strong>, a dispute over bad wine in a tavern escalated into the St Scholastica Day Riot&mdash;three days of warfare between scholars and townspeople. Armed gangs from the countryside attacked student halls. Scholars were scalped. Approximately 63 university members and 20 townspeople died. It was the climax of 146 years of tensions.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">The St Scholastica Day Riot (February 10, 1355)</div><div class="card-text">A dispute over bad wine in a tavern escalated into a three-day violent conflict between townspeople and university scholars. Armed gangs from the countryside attacked student halls; reports describe the scalping of scholars. Approximately 20 townspeople and up to 63 university members were killed, marking the climax of 146 years of town-gown tensions that had simmered since Oxford\'s founding.</div></div>',
                '<p>The candle gutters. The manuscript reveals one final reference: to a meeting place beneath this very library, where scholars have gathered in secret for centuries to preserve what authority sought to destroy.</p>'
            ],
            fact: 'The St Scholastica Day Riot (Feb 10, 1355) killed up to 63 scholars and 20 townspeople over 3 days, the climax of 146 years of Oxford town-gown conflict.',
            choices: [
                { text: 'Descend to the secret meeting place', next: 'deeper', style: 'btn-danger' },
                { text: 'Hide the manuscript and leave now', next: 'caught', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 4b: THE SAFE CHOICE
        // -------------------------------------------------------
        safe_choice: {
            type: 'manuscript',
            chapter: 'Chapter IV',
            text: [
                '<p>Dr. Voss studies your face. The candle between you flickers, casting shifting shadows across the ancient spines that line the walls.</p>',
                '<p>"You\'re afraid," she says. Not accusingly. With understanding.</p>',
                '<p>"I\'ve spent twelve years in these stacks," she continues quietly. "I\'ve read about what happened to those who sought forbidden knowledge. The Index of Prohibited Books wasn\'t just a Catholic invention. Every institution of learning has its own list of texts too dangerous to read."</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">The Index of Prohibited Books (1559&ndash;1966)</div><div class="card-text">The Catholic Church\'s Index Librorum Prohibitorum banned works by Enlightenment philosophers including Montesquieu\'s <em>Spirit of the Laws</em> (placed on the Index in 1751). The very idea of encyclopedic knowledge became forbidden, illustrating the centuries-long battle over censorship that originated in medieval universities. The Index was not formally abolished until 1966.</div></div>',
                '<p>She extinguishes the candle. "Perhaps some knowledge should remain hidden. Perhaps we are not meant to find it."</p>',
                '<p>You walk together through the darkened library, past centuries of accumulated wisdom, toward the exit. Dawn is still hours away. The college sleeps.</p>'
            ],
            fact: 'The Index of Prohibited Books banned Enlightenment works including Montesquieu\'s Spirit of the Laws (1751). It was not abolished until 1966.',
            choices: [
                { text: 'Accept the retreat and return to your dormitory', next: 'ending_innocent', style: 'btn-safe' },
                { text: 'Return alone the next night to continue the search', next: 'discovery', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 4c: DOCUMENTED EVIDENCE
        // -------------------------------------------------------
        preparation: {
            type: 'card',
            chapter: 'Chapter IV',
            cardTitle: 'Careful Documentation',
            text: [
                '<p>You work methodically, transcribing key passages by hand&mdash;your phone seems too modern, too traceable for this work. The Latin flows beneath your pen as you capture Ockham\'s forbidden arguments and the cipher catalog of hidden texts.</p>',
                '<p>A sound from the corridor freezes your hand. Footsteps. Then Dr. Voss appears in the doorway, breathless.</p>',
                '<p>"The Chancellor\'s office has been notified. Someone triggered the restricted-access log." Her eyes are bright with fear. "The Ordinance of 1214 gave the Chancellor authority above the town itself. That power has never been revoked. If they find you here with these manuscripts&mdash;"</p>',
                '<p>She does not need to finish. The Chancellor\'s authority over scholars is absolute. It has been since a Papal Legate granted it eight hundred years ago, and the modern university has never willingly surrendered a privilege.</p>',
                '<p>You have your transcriptions. The original manuscript remains on its shelf. Two paths forward.</p>'
            ],
            fact: 'Oxford\'s Chancellor has held authority above the town since the 1214 Ordinance, a privilege the university has never surrendered.',
            choices: [
                { text: 'Escape now with your transcriptions', next: 'chase', style: 'btn-safe' },
                { text: 'Take the original manuscript with you', next: 'deeper', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 5a: THE SECRET SOCIETY
        // -------------------------------------------------------
        deeper: {
            type: 'pageframe',
            chapter: 'Chapter V',
            text: [
                '<p class="dropcap">Beneath the library, behind a panel that pivots on a mechanism older than the Reformation, you find it: a vaulted chamber carved from living rock. The ceiling is low. Beeswax candles burn in iron sconces. And on every surface&mdash;shelves, tables, alcoves cut into stone&mdash;books. Hundreds of them. Texts that should not exist.</p>',
                '<p>You are not alone. Five figures in academic gowns sit around a heavy oak table. Their faces are half-lit, half-shadow. One of them stands.</p>',
                '<p>"We have been expecting you. We sent the letter."</p>',
                '<p>They call themselves the <em>Societas Veritatis</em>&mdash;the Society of Truth. They claim descent from a tradition of secret scholarly societies that traces back to the eighteenth century, when knowledge itself became dangerous enough to require organized protection.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">Origins of Secret Scholarly Societies</div><div class="card-text">Collegiate secret societies trace their documented origins to the 1750s. The Flat Hat Club (F.H.C.) at the College of William &amp; Mary, founded around 1750, is considered the oldest secret society in the United States. At Oxford and Cambridge, similar societies formed to preserve and discuss texts considered too radical for open scholarship, continuing a tradition of intellectual resistance.</div></div>',
                '<p>The standing figure extends a hand. "You have read the forbidden texts. You know what they contain. We exist to protect this knowledge&mdash;as scholars have done for seven centuries, since Oxford first began teaching in 1096."</p>',
                '<p>But before you can respond, a sound echoes from above: heavy footsteps. Voices. The Chancellor\'s men are searching the library.</p>'
            ],
            fact: 'Secret scholarly societies trace to the 1750s; the Flat Hat Club at William & Mary (c. 1750) is the oldest documented in America.',
            choices: [
                { text: 'Join the Society and help hide the books', next: 'climax_society', style: 'btn-danger' },
                { text: 'Flee upstairs before you are trapped', next: 'climax_flight', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 5b: THE WITNESS
        // -------------------------------------------------------
        caught: {
            type: 'card',
            chapter: 'Chapter V',
            cardTitle: 'The Chancellor\'s Man',
            text: [
                '<p>You make it to the library\'s main corridor before a figure steps from the shadows. He wears the dark suit of university administration, and his expression holds the practiced neutrality of a man accustomed to asking questions he already knows the answers to.</p>',
                '<p>"Rather late for scholarly work," he says pleasantly. "The library closed at ten."</p>',
                '<p>You think of the crisis of <strong>1209</strong>&mdash;when two Oxford students were killed by townspeople and the entire university nearly collapsed. The institutional memory of that violence created the system of control you now face. The university protects its scholars, yes. But it also controls them.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">The 1209 Student Murder Crisis</div><div class="card-text">In 1209, two students were killed by Oxford townspeople in retaliation for a woman\'s death. Scholars abandoned the city, some founding what became Cambridge University. The crisis threatened to close Oxford entirely and led directly to the formal written privileges of the 1214 Ordinance&mdash;the same authority this man now represents.</div></div>',
                '<p>His eyes move to your bag. To your hands. He is looking for evidence of what you have been reading.</p>'
            ],
            fact: 'In 1209, two Oxford students were killed by townspeople, causing scholars to flee. Some founded Cambridge; the crisis led to the 1214 Ordinance.',
            choices: [
                { text: 'Claim innocent insomnia and scholarly restlessness', next: 'interrogation', style: 'btn-safe' },
                { text: 'Admit your interest in the restricted collection', next: 'climax_caught', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 5c: PURSUIT
        // -------------------------------------------------------
        chase: {
            type: 'manuscript',
            chapter: 'Chapter V',
            text: [
                '<p class="dropcap">You move through the college\'s medieval corridors with your transcriptions pressed against your chest. The stonework around you dates to the thirteenth century. Scholars have walked these passages for nearly eight hundred years, and some of them&mdash;like you&mdash;walked in fear.</p>',
                '<p>Behind you, the sounds of search: doors opening, voices calling. The Chancellor\'s office works efficiently when it chooses to.</p>',
                '<p>You pass the chapel, its stained glass throwing faint colored light across the floor. Ahead, the college garden&mdash;and beyond it, the gate to the town. If you can reach the town, you reach freedom. Medieval scholars knew this: they often hid their most dangerous manuscripts inside the walls of buildings, trusting stone to keep secrets that paper could not.</p>',
                '<p>Through a window, you glimpse the garden. Stone paths wind between hedgerows and classical statuary. Duns Scotus himself once walked these grounds.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">Duns Scotus at Oxford (1266&ndash;1308)</div><div class="card-text">Born around 1266, this Franciscan scholar taught at Oxford and became known as "Doctor Subtilis"&mdash;the Subtle Doctor&mdash;for his groundbreaking theories of individuality and being. His work challenged the dominance of Thomas Aquinas and influenced an entire century of philosophical thought. Like Bacon before him, Scotus pursued ideas that institutional authority viewed with suspicion.</div></div>',
                '<p>Two exits present themselves.</p>'
            ],
            fact: 'Duns Scotus (1266-1308), the "Doctor Subtilis," taught at Oxford and challenged Aquinas\'s dominance with groundbreaking theories of individuality.',
            choices: [
                { text: 'Escape through the garden to town', next: 'garden_escape', style: 'btn-safe' },
                { text: 'Vault through the chapel window for a faster exit', next: 'climax_flight', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 6: INTERROGATION
        // -------------------------------------------------------
        interrogation: {
            type: 'manuscript',
            chapter: 'Chapter VI',
            text: [
                '<p>You weave a careful story about insomnia, about the scholar\'s restless mind, about seeking the comfort of old books in the small hours. The Chancellor\'s man listens with the patience of a predator.</p>',
                '<p>"Curious," he says at last. "The restricted-wing access log shows entry at 11:47 PM. You\'d have needed a key. Or a friend with a key."</p>',
                '<p>His eyes search yours. You think of Duns Scotus, who also navigated the treacherous waters between intellectual ambition and institutional power. The Subtle Doctor earned his name by being clever enough to pursue forbidden ideas without being caught&mdash;at least, not in his lifetime.</p>',
                '<p>"I wonder," the man continues, "whether you have heard of Dr. Voss. Our special collections librarian. She has been under observation for some time."</p>',
                '<p>A cold thread of fear. If they know about Dr. Voss, then they know about the restricted texts. The question is whether they know about you.</p>'
            ],
            fact: null,
            choices: [
                { text: 'Confess your interest in medieval history and ask for mercy', next: 'professor_sympathy', style: 'btn-safe' },
                { text: 'Maintain your story and reveal nothing', next: 'perfect_lie', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 6d: THE GARDEN ESCAPE
        // -------------------------------------------------------
        garden_escape: {
            type: 'pageframe',
            chapter: 'Chapter VI',
            text: [
                '<p class="dropcap">The garden is silver with frost. Your footsteps crunch on gravel paths that were laid when Edward III sat the throne. Statues of forgotten benefactors watch your passage with blind stone eyes.</p>',
                '<p>You are almost at the gate when you see the night porter standing in the archway, his lantern casting a warm circle of light. He is an old man, part of the college\'s fabric, and he misses nothing.</p>',
                '<p>"Evening," he says. "Or morning, I suppose. Bit late for a constitutional."</p>',
                '<p>Oxford\'s porters have served as the college\'s first line of defense for centuries. When Henry II banned English students from the University of Paris in <strong>1167</strong>, and scholars flooded into Oxford, it was the porters who controlled who entered and who left.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">Henry II\'s Student Ban (1167)</div><div class="card-text">King Henry II of England banned all English students from attending the University of Paris following his conflict with Thomas Becket, Archbishop of Canterbury. This expulsion prompted scholars to establish Oxford as a major academic center. Oxford grew explosively from roughly 50 scholars to an estimated 3,000 students by 1209, becoming one of Europe\'s most prestigious universities.</div></div>',
                '<p>The porter watches you with mild, immovable curiosity.</p>'
            ],
            fact: 'Henry II banned English students from the University of Paris in 1167, causing Oxford to grow from 50 scholars to 3,000 by 1209.',
            choices: [
                { text: 'Claim you are a visiting scholar returning to your inn', next: 'ending_wanderer', style: 'btn-safe' },
                { text: 'Offer to share what you have found, scholar to scholar', next: 'professor_sympathy', style: '' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 7: PROFESSOR SYMPATHY
        // -------------------------------------------------------
        professor_sympathy: {
            type: 'card',
            chapter: 'Chapter VII',
            cardTitle: 'An Unexpected Ally',
            text: [
                '<p>Something shifts in the man\'s expression. The institutional mask cracks, just slightly, and beneath it you see something unexpected: curiosity. Genuine, hungry curiosity.</p>',
                '<p>"I was a medievalist once," he says quietly. "Before I took this position. I know what those manuscripts contain. I\'ve known for years."</p>',
                '<p>He leans forward. "The university suppresses these texts not because they are dangerous to <em>knowledge</em>, but because they are dangerous to <em>authority</em>. Ockham\'s argument that consent, not divine right, legitimizes power. Bacon\'s insistence that observation outweighs tradition. These ideas terrified the medieval Church, and they still terrify institutions today."</p>',
                '<p>He reaches into his jacket and produces a card. An address. A meeting time.</p>',
                '<p>"There are others who think as we do. Come to this address tomorrow evening. Bring what you have found."</p>'
            ],
            fact: null,
            choices: [
                { text: 'Trust him and accept the invitation', next: 'ending_society', style: '' },
                { text: 'Decline politely and plan your own path', next: 'ending_wanderer', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 7b: PERFECT LIE
        // -------------------------------------------------------
        perfect_lie: {
            type: 'manuscript',
            chapter: 'Chapter VII',
            text: [
                '<p>You hold his gaze without flinching. Your story is simple, consistent, and utterly unremarkable. A scholar, unable to sleep. A walk through the college. A wrong turn in unfamiliar corridors.</p>',
                '<p>He studies you for a long moment. Then, slowly, he nods.</p>',
                '<p>"Very well. I\'ll note this as an accidental entry. Do be more careful with doors after hours." He straightens his coat. "Good evening."</p>',
                '<p>He walks away. You stand in the empty corridor, heart hammering, and realize that you are still inside the library. The restricted wing is thirty feet behind you. The manuscripts are still there.</p>',
                '<p>You think of Duns Scotus, who navigated between the demands of the Franciscan order and his own relentless intellect. The Subtle Doctor survived by being careful. By being patient. By never revealing his full hand.</p>',
                '<p>The night stretches before you. What will you do with it?</p>'
            ],
            fact: null,
            choices: [
                { text: 'Return to the manuscripts and continue your research', next: 'underground_press', style: 'btn-danger' },
                { text: 'Leave now and plan a careful return', next: 'ending_patient', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 7c: CLIMAX - SOCIETY UNDER PRESSURE
        // -------------------------------------------------------
        climax_society: {
            type: 'pageframe',
            chapter: 'Chapter VII',
            text: [
                '<p class="dropcap">The Society moves with practiced urgency. They have done this before. Books are wrapped in oilcloth and placed in hidden compartments carved into the stone walls. False panels slide into place. The oak table is cleared, the candles extinguished one by one until only darkness remains.</p>',
                '<p>"Through here," whispers the leader, guiding you into a passage so narrow your shoulders brush both walls. Behind you, overhead, the sound of the library door being forced open. The Chancellor\'s men have arrived.</p>',
                '<p>As you move through the dark, you carry a single manuscript&mdash;Ockham\'s suppressed arguments, the most dangerous text in the collection. The Society\'s leader presses it into your hands.</p>',
                '<p>"Take this. If they find the vault, we lose everything. But if even one copy survives&mdash;"</p>',
                '<p>You think of Oxford\'s earliest days. Teaching was documented here as early as <strong>1096</strong>&mdash;over nine hundred years of scholars fighting to preserve knowledge against those who would destroy it.</p>',
                '<div class="historical-card"><div class="card-label">Historical Fact</div><div class="card-title">Oxford\'s First Teaching (1096)</div><div class="card-text">Though no clear founding date exists, teaching was documented at Oxford in 1096, making it one of Europe\'s oldest continuous universities. For over nine centuries, scholars have gathered here to learn, to argue, and occasionally to resist the authority that sought to control what could be known.</div></div>',
                '<p>The passage opens into a courtyard you do not recognize. Cold air hits your face. Behind you, the sounds of discovery: shouts, the crash of furniture. The Society\'s vault has been found.</p>'
            ],
            fact: 'Teaching was documented at Oxford as early as 1096, making it one of Europe\'s oldest continuous universities.',
            choices: [
                { text: 'Flee to the printing press to publish the manuscript', next: 'printing_press', style: 'btn-danger' },
                { text: 'Hide the manuscript and formally join the Society in exile', next: 'ending_society', style: '' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 7d: CLIMAX - CAUGHT
        // -------------------------------------------------------
        climax_caught: {
            type: 'card',
            chapter: 'Chapter VII',
            cardTitle: 'Confrontation with Authority',
            text: [
                '<p>The Chancellor himself arrives within the hour. He is a tall man with silver temples and the absolute composure of someone who has never doubted his own authority. The manuscript lies between you on the table like a weapon.</p>',
                '<p>"You understand what you have done," he says. It is not a question. "This manuscript is the property of the college. Its removal constitutes theft. Its contents are restricted by order of the governing body." He pauses. "Since 1751."</p>',
                '<p>Since 1751. The year the Catholic Church placed Montesquieu\'s <em>Spirit of the Laws</em> on the Index of Prohibited Books. The year when even the Enlightenment\'s greatest works could be silenced by institutional decree.</p>',
                '<p>"I am offering you a choice," the Chancellor continues. "Surrender the manuscript. Accept a formal reprimand. Leave Oxford quietly. And this incident will be forgotten." His eyes harden. "Or I will involve the authorities, and your academic career will end tonight."</p>',
                '<p>You look at the manuscript. Seven hundred years of suppressed knowledge. Ockham\'s razor, turned against the institution itself.</p>'
            ],
            fact: null,
            choices: [
                { text: 'Surrender the manuscript but refuse to condemn the ideas', next: 'ending_sacrifice', style: '' },
                { text: 'Refuse to surrender anything', next: 'printing_press', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 7e: CLIMAX - FLIGHT
        // -------------------------------------------------------
        climax_flight: {
            type: 'manuscript',
            chapter: 'Chapter VII',
            text: [
                '<p class="dropcap">You run. Through corridors that have stood since the thirteenth century, past portraits of masters and benefactors whose painted eyes seem to follow you, past locked doors and sleeping students and the accumulated weight of nine hundred years of scholarship.</p>',
                '<p>Your footsteps echo on stone. Behind you, voices and the clatter of pursuit. But you know something the Chancellor\'s men do not: these buildings were designed by scholars, for scholars, and scholars have always needed escape routes.</p>',
                '<p>A door you had noted earlier&mdash;half-hidden behind a tapestry&mdash;opens onto a staircase that descends to the college\'s medieval foundations. You plunge into darkness, one hand trailing along cold stone, the other clutching your evidence.</p>',
                '<p>When you emerge, gasping, into the predawn streets of Oxford, the medieval spires rise around you like the fingers of a hand reaching for something it can never quite grasp. You are free. For now.</p>',
                '<p>The question is what to do with your freedom.</p>'
            ],
            fact: null,
            choices: [
                { text: 'Head to the printers to publish what you have found', next: 'printing_press', style: 'btn-danger' },
                { text: 'Hide in town and contact the scholarly underground', next: 'ending_society', style: '' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 8: UNDERGROUND PRESS
        // -------------------------------------------------------
        underground_press: {
            type: 'pageframe',
            chapter: 'Chapter VIII',
            text: [
                '<p class="dropcap">Over the following weeks, you work in secret. A sympathetic lecturer provides access to a departmental printer after hours. You transcribe the forbidden texts carefully, cross-referencing with Dr. Voss\'s notes and the cipher catalog of hidden manuscripts scattered across Oxford\'s colleges.</p>',
                '<p>The work is slow. It must be. During the Enlightenment, banned books were illegally published and circulated through networks of sympathetic printers and booksellers. Voltaire, Diderot, Montesquieu&mdash;their most important works reached readers through exactly this kind of clandestine infrastructure.</p>',
                '<p>You begin to understand what the <em>Societas Veritatis</em> understood: that the battle between knowledge and authority is not won in a single night. It is won over decades, over centuries, through the patient accumulation of truth.</p>',
                '<p>By spring, you have circulated copies of six forbidden manuscripts to trusted scholars across three continents. The ideas that Oxford locked away are beginning to breathe again.</p>'
            ],
            fact: null,
            choices: [
                { text: 'Dedicate yourself to years of this secret work', next: 'ending_legacy', style: '' },
                { text: 'Accelerate publication and accept the increased risk', next: 'printing_press', style: 'btn-danger' }
            ]
        },

        // -------------------------------------------------------
        // SCENE 9: THE PRINTING PRESS
        // -------------------------------------------------------
        printing_press: {
            type: 'card',
            chapter: 'Chapter IX',
            cardTitle: 'The Oxford University Press',
            text: [
                '<p>There is an irony in this: the oldest university press in the world, printing continuously since 1478, will be the instrument of the university\'s own embarrassment. You have contacted a journalist. The story&mdash;a medieval university suppressing texts that challenge institutional authority&mdash;is exactly the kind of scandal that cannot be contained once it is told.</p>',
                '<p>But telling it requires your name. Your reputation. Your career.</p>',
                '<p>You think of the scholars who came before you. Bacon, imprisoned. Ockham, exiled. Scotus, silenced by death at forty-two. Every one of them paid a price for knowledge. Every one of them is remembered.</p>',
                '<div class="scene-blockquote">"Entities should not be multiplied beyond necessity."<cite>&mdash; William of Ockham\'s Razor, simplifying everything, including the question of what to do next</cite></div>',
                '<p>The journalist waits for your answer. Your name, or your anonymity. Your reputation, or your safety.</p>'
            ],
            fact: null,
            choices: [
                { text: 'Publish with your name attached', next: 'ending_martyr', style: 'btn-danger' },
                { text: 'Publish anonymously and preserve your position', next: 'ending_wanderer', style: 'btn-safe' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE INNOCENT
        // -------------------------------------------------------
        ending_innocent: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Innocent',
            text: [
                '<p>You walk through the college courtyard at dawn. Frost glitters on the grass. Students will wake soon, attend lectures, argue about ideas in tutorials that have continued unbroken for nine centuries. The library will open. Its secrets will remain.</p>',
                '<p>Dr. Voss nods to you across the quad. A small, sad smile. You both know what lies beneath this place. You both know you will not speak of it again.</p>',
                '<p>Some knowledge, you tell yourself, is not meant to be found. Some doors are locked for a reason.</p>',
                '<p>But late at night, when you cannot sleep, you think of Bacon in his cell. Of Ockham in exile. Of the anonymous scholars who wrote their most dangerous truths in invisible ink, hoping that someday, someone braver would read them.</p>',
                '<div class="scene-blockquote">"Ignorance is not innocence. It is merely the choice not to know."<cite>&mdash; The Scholar\'s Reflection</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE WANDERER
        // -------------------------------------------------------
        ending_wanderer: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Wanderer',
            text: [
                '<p>You leave Oxford with copies of the forbidden manuscripts hidden in your luggage. The train carries you south, through a landscape of grey fields and winter hedgerows, away from the dreaming spires and toward an uncertain future.</p>',
                '<p>The evidence is saved. The knowledge survives. But the price is exile&mdash;not the formal exile of Ockham, summoned to Avignon and cast out for heresy, but the quieter exile of someone who has seen behind the curtain and can never again pretend it is not there.</p>',
                '<p>In a foreign city, months later, you open the manuscripts again. The Latin is familiar now. The arguments feel like old friends. You begin to write&mdash;not a copy, but a commentary. Your own contribution to a conversation that has continued, in secret, since Oxford first gathered scholars to teach in 1096.</p>',
                '<div class="scene-blockquote">"Some truths require exile. The wanderer carries what the institution refuses to hold."<cite>&mdash; The Scholar\'s Reflection</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE SOCIETY
        // -------------------------------------------------------
        ending_society: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Continuing Mission',
            text: [
                '<p>The ceremony takes place by candlelight in a vaulted chamber that smells of beeswax and old stone. Five scholars stand around you. The oath is simple: to protect forbidden knowledge for future generations. To resist censorship in all its forms. To ensure that what Bacon discovered, what Ockham argued, what Scotus imagined, will never be lost again.</p>',
                '<p>You are given a key. A brass key, old beyond dating, that opens a door somewhere in Oxford that you have not yet seen. "When you are ready," the leader says, "the door will be waiting."</p>',
                '<p>In the years that follow, you become what the Society has always been: a guardian. You teach by day, openly and conventionally. By night, you preserve what authority fears most&mdash;the idea that knowledge belongs to everyone.</p>',
                '<p>Bacon would recognize this work. Ockham would approve. And somewhere in the medieval foundations of Oxford, the forbidden texts rest secure, waiting for the next scholar brave enough to read them.</p>',
                '<div class="scene-blockquote">"Seven centuries, and the battle continues unchanged. We are the heirs of Bacon, of Ockham, of every scholar who chose knowledge over safety."<cite>&mdash; The Oath of the Societas Veritatis</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE MARTYR
        // -------------------------------------------------------
        ending_martyr: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Martyr',
            text: [
                '<p>The article runs on a Tuesday. By Wednesday, your name is in every paper. By Thursday, the university has issued a statement calling you "a disgruntled former researcher" and denying the existence of any restricted manuscripts. By Friday, your academic career is over.</p>',
                '<p>But the manuscripts are public now. Scholars around the world are reading Ockham\'s suppressed arguments, Bacon\'s forbidden observations, the anonymous texts that challenge seven centuries of institutional authority. The ideas that Oxford locked away in darkness have finally reached the light.</p>',
                '<p>You think of the price paid by those who came before. The St Scholastica Day Riot, where 63 scholars died in the streets. Bacon\'s imprisonment. Ockham\'s exile. The countless anonymous scribes who hid forbidden words in the walls of buildings, trusting future generations to find them.</p>',
                '<p>Your sacrifice is smaller than theirs. Your name will be remembered.</p>',
                '<div class="scene-blockquote">"Truth does not require the permission of authority. It requires only the courage of one who will speak it."<cite>&mdash; The Scholar\'s Reflection</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE SACRIFICE
        // -------------------------------------------------------
        ending_sacrifice: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Bittersweet Sacrifice',
            text: [
                '<p>You hand over the manuscript. The Chancellor takes it with both hands, almost reverently. He knows what it contains. Perhaps he has always known.</p>',
                '<p>"You understand," he says, "that this is for the best. Some ideas are too dangerous for the unprepared mind."</p>',
                '<p>"No," you say quietly. "I understand that you are afraid of what these ideas would do to your authority. Just as the Church was afraid of Ockham. Just as the Franciscans were afraid of Bacon."</p>',
                '<p>He says nothing. You leave Oxford that night.</p>',
                '<p>But knowledge, once learned, cannot be unlearned. The arguments in that manuscript are written now in the only vault that cannot be locked: your memory. And in the months that follow, in lectures and papers and quiet conversations with students, you begin to share what you remember. Not the manuscript itself&mdash;that is gone. But the ideas it contained.</p>',
                '<p>Ideas, as Ockham knew, are harder to imprison than their authors.</p>',
                '<div class="scene-blockquote">"Some truths are too dangerous to preserve on parchment, and yet they survive&mdash;carried in the minds of those who dared to read them."<cite>&mdash; The Scholar\'s Reflection</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE LEGACY
        // -------------------------------------------------------
        ending_legacy: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Legacy',
            text: [
                '<p>Years pass. You become a master of the quiet art of preservation. Dozens of forbidden works circulate through your network&mdash;scholars in Paris, Florence, Prague, and cities you have never visited read texts that were meant to be destroyed centuries ago.</p>',
                '<p>The work is slow. It must be. You think often of the timeline: teaching at Oxford since 1096. The Paris ban of 1167. The murders of 1209. The Ordinance of 1214. The founding of colleges in 1249, 1263, 1264. Bacon\'s imprisonment in 1277. The riot of 1355. The Index of Prohibited Books persisting until 1966. Nine hundred years of struggle between those who seek knowledge and those who seek to control it.</p>',
                '<p>When you are old, you see the first signs of change. The forbidden manuscripts begin to appear in legitimate academic journals. Ideas that were suppressed for centuries enter mainstream scholarship. The battle is not won&mdash;it never is&mdash;but the line has moved.</p>',
                '<p>You were a seed scattered in winter. The spring belongs to those who follow.</p>',
                '<div class="scene-blockquote">"We were seeds scattered in winter; the spring belongs to those who follow."<cite>&mdash; The Scholar\'s Reflection</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        },

        // -------------------------------------------------------
        // ENDING: THE PATIENT SCHOLAR
        // -------------------------------------------------------
        ending_patient: {
            type: 'ending',
            chapter: 'Epilogue',
            endingTitle: 'The Patient Scholar',
            text: [
                '<p>You return to your college rooms and begin to plan. Not a dramatic escape, not a public revelation, but something quieter and more powerful: a long game.</p>',
                '<p>You apply for a permanent position at Oxford. You are accepted. Over the following years, you build a reputation as a careful, conventional medievalist&mdash;the perfect cover for work that is anything but conventional.</p>',
                '<p>Slowly, methodically, you compile the greatest private collection of forbidden texts in Oxford\'s history. Each manuscript is transcribed, annotated, and hidden in places you alone know. Your public work earns you the trust of the institution. Your private work preserves what the institution fears most.</p>',
                '<p>When you die, decades later, your students discover the collection. It transforms the field. Ideas suppressed since the thirteenth century finally enter the scholarly canon. Your obituary calls you "a quiet revolutionary." You would have appreciated the irony.</p>',
                '<div class="scene-blockquote">"Patience is the scholar\'s truest weapon against tyranny."<cite>&mdash; The Scholar\'s Reflection</cite></div>'
            ],
            fact: null,
            choices: [
                { text: 'Begin Again', next: '_restart' }
            ]
        }
    };

    // ═══════════════════════════════════════════════════════════════
    //  STORY ENGINE
    // ═══════════════════════════════════════════════════════════════

    const engine = {
        currentScene: null,
        history: [],
        facts: [],
        factsPanelOpen: false,

        init() {
            document.getElementById('startBtn').addEventListener('click', () => this.start());
            document.getElementById('restartBtn').addEventListener('click', () => this.restart());
            document.getElementById('factToggle').addEventListener('click', () => this.toggleFacts());

            // Keyboard support
            document.addEventListener('keydown', (e) => {
                if (e.key >= '1' && e.key <= '9') {
                    const idx = parseInt(e.key) - 1;
                    const btns = document.querySelectorAll('.choice-btn');
                    if (btns[idx]) btns[idx].click();
                }
            });
        },

        start() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('sceneWrapper').classList.add('active');
            document.getElementById('factTracker').style.display = 'block';
            this.goTo('summons');
        },

        restart() {
            this.currentScene = null;
            this.history = [];
            this.facts = [];
            this.factsPanelOpen = false;
            document.getElementById('factPanel').classList.remove('open');
            document.getElementById('sceneWrapper').classList.remove('active');
            document.getElementById('titleScreen').style.display = 'flex';
            document.getElementById('factTracker').style.display = 'none';
            this.updateFactUI();
            window.scrollTo(0, 0);
        },

        goTo(sceneId) {
            if (sceneId === '_restart') {
                this.restart();
                return;
            }

            const scene = STORY[sceneId];
            if (!scene) return;

            // Transition effect
            if (this.currentScene) {
                const overlay = document.getElementById('transition');
                overlay.classList.add('active');
                setTimeout(() => {
                    this.renderScene(sceneId, scene);
                    window.scrollTo({ top: 0, behavior: 'auto' });
                }, 400);
                setTimeout(() => {
                    overlay.classList.remove('active');
                }, 1000);
            } else {
                this.renderScene(sceneId, scene);
            }

            if (this.currentScene) {
                this.history.push(this.currentScene);
            }
            this.currentScene = sceneId;
        },

        renderScene(sceneId, scene) {
            const container = document.getElementById('sceneContent');

            // Update chapter
            if (scene.chapter) {
                document.getElementById('sceneChapter').textContent = scene.chapter;
            }

            let html = '<div class="scene-content">';

            // Build scene based on type
            switch (scene.type) {
                case 'manuscript':
                    html += this.renderManuscript(scene);
                    break;
                case 'pageframe':
                    html += this.renderPageframe(scene);
                    break;
                case 'card':
                    html += this.renderCard(scene);
                    break;
                case 'ending':
                    html += this.renderEnding(scene);
                    break;
            }

            // Fact notification
            if (scene.fact) {
                this.addFact(scene.fact);
                html += '<div class="fact-found">Knowledge Discovered</div>';
            }

            // Choices
            if (scene.choices && scene.choices.length > 0) {
                html += '<div class="choices">';
                scene.choices.forEach((choice, i) => {
                    const styleClass = choice.style ? ' ' + choice.style : '';
                    html += '<button class="choice-btn' + styleClass + '" onclick="engine.goTo(\'' + choice.next + '\')">';
                    html += '<span class="choice-key">' + (i + 1) + '</span>';
                    html += choice.text;
                    html += '</button>';
                });
                html += '</div>';
            }

            html += '</div>';
            container.innerHTML = html;
            this.updateFactUI();
        },

        renderManuscript(scene) {
            let html = '<div class="scene-manuscript"><div class="scene-text">';
            scene.text.forEach(p => { html += p; });
            html += '</div></div>';
            return html;
        },

        renderPageframe(scene) {
            let html = '<div class="scene-pageframe"><div class="scene-text">';
            scene.text.forEach(p => { html += p; });
            html += '</div></div>';
            return html;
        },

        renderCard(scene) {
            let html = '<div class="scene-card">';
            if (scene.cardTitle) html += '<div class="card-title">' + scene.cardTitle + '</div>';
            html += '<div class="scene-text">';
            scene.text.forEach(p => { html += p; });
            html += '</div></div>';
            return html;
        },

        renderEnding(scene) {
            let html = '<div class="scene-ending">';
            html += '<div class="ending-label">Finis</div>';
            html += '<div class="ending-title">' + scene.endingTitle + '</div>';
            html += '<div class="ornate-divider"><span>* * *</span></div>';
            html += '<div class="scene-text">';
            scene.text.forEach(p => { html += p; });
            html += '</div>';
            html += '<div class="the-end">The End</div>';
            html += '</div>';
            return html;
        },

        addFact(fact) {
            if (!this.facts.includes(fact)) {
                this.facts.push(fact);
            }
        },

        updateFactUI() {
            const count = this.facts.length;
            document.getElementById('factCount').textContent = count;
            document.getElementById('headerFactCount').textContent = count > 0 ? 'Knowledge: ' + count : '';

            const list = document.getElementById('factList');
            if (count === 0) {
                list.innerHTML = '<p class="no-facts">No knowledge yet discovered...</p>';
            } else {
                list.innerHTML = this.facts.map(f => '<div class="fact-item">' + f + '</div>').join('');
            }
        },

        toggleFacts() {
            this.factsPanelOpen = !this.factsPanelOpen;
            document.getElementById('factPanel').classList.toggle('open', this.factsPanelOpen);
        }
    };

    // Boot
    engine.init();
    </script>
</body>
</html>
