<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Forest Survivors</title>
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Cabin:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a1a0a;font-family:'Cabin',sans-serif;color:#d8e8c8}
canvas{display:block;width:100%;height:100%;touch-action:none}
#ui-overlay{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}
#hud{position:absolute;top:0;left:0;width:100%;padding:8px 12px;display:flex;justify-content:space-between;align-items:flex-start;font-family:'Amatic SC',cursive}
#hud-left,#hud-right{display:flex;flex-direction:column;gap:4px}
#hud-right{align-items:flex-end}
.hud-text{font-size:14px;text-shadow:0 0 8px rgba(34,139,34,0.6),1px 1px 2px #000;color:#d8e8c8}
.hud-big{font-size:18px;font-weight:700;color:#daa520}
#xp-bar-container{position:absolute;top:0;left:0;width:100%;height:4px;background:rgba(0,0,0,0.7)}
#xp-bar{height:100%;background:linear-gradient(90deg,#228b22,#daa520);width:0%;transition:width 0.3s}
#hp-bar-container{position:absolute;bottom:60px;left:50%;transform:translateX(-50%);width:200px;height:8px;background:rgba(0,0,0,0.7);border:1px solid #555;border-radius:4px;overflow:hidden}
#hp-bar{height:100%;background:linear-gradient(90deg,#145214,#33cc33);width:100%;transition:width 0.3s}
#weapon-bar{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:4px}
.weapon-slot{width:36px;height:36px;border:2px solid #555;background:rgba(0,0,0,0.6);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:18px}
.weapon-slot.active{border-color:#daa520;box-shadow:0 0 8px rgba(218,165,32,0.5)}
#title-screen,#game-over-screen,#level-up-screen,#pause-screen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;pointer-events:auto}
#title-screen{background:radial-gradient(ellipse at center,#0a1a0a 0%,#050a05 70%)}
#game-over-screen{background:rgba(5,10,5,0.92);display:none}
#level-up-screen{background:rgba(5,10,5,0.85);display:none}
#pause-screen{background:rgba(0,0,0,0.8);display:none}
.screen-title{font-family:'Amatic SC',cursive;font-size:clamp(2.5rem,8vw,5rem);font-weight:700;color:#228b22;text-shadow:0 0 40px rgba(34,139,34,0.6),0 0 80px rgba(218,165,32,0.3);margin-bottom:8px;text-align:center;letter-spacing:0.05em}
.screen-subtitle{font-family:'Cabin',sans-serif;font-size:clamp(1rem,3vw,1.4rem);color:#daa520;font-style:italic;margin-bottom:32px;text-align:center}
.btn{font-family:'Amatic SC',cursive;font-size:1.1rem;font-weight:700;padding:14px 40px;border:2px solid #daa520;background:rgba(34,139,34,0.3);color:#d8e8c8;cursor:pointer;letter-spacing:0.1em;text-transform:uppercase;transition:all 0.2s;pointer-events:auto}
.btn:hover{background:rgba(34,139,34,0.6);box-shadow:0 0 20px rgba(218,165,32,0.4);transform:scale(1.05)}
.stats-line{font-size:1.1rem;color:#a0b8a0;margin:4px 0}
.upgrade-cards{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;max-width:700px;padding:0 16px}
.upgrade-card{width:200px;padding:20px 16px;border:2px solid #333;background:rgba(10,20,10,0.9);cursor:pointer;text-align:center;transition:all 0.2s;pointer-events:auto;border-radius:4px}
.upgrade-card:hover{border-color:#daa520;box-shadow:0 0 20px rgba(218,165,32,0.3);transform:translateY(-4px)}
.upgrade-icon{font-size:2.5rem;margin-bottom:8px}
.upgrade-name{font-family:'Amatic SC',cursive;font-size:1rem;font-weight:700;color:#daa520;margin-bottom:6px}
.upgrade-desc{font-size:0.85rem;color:#a0b8a0;line-height:1.4}
.upgrade-hotkey{position:absolute;top:8px;right:10px;font-family:'Amatic SC',cursive;font-size:0.75rem;color:#777;border:1px solid #555;border-radius:3px;width:22px;height:22px;display:flex;align-items:center;justify-content:center}
.upgrade-card{position:relative}
.upgrade-card.selected{border-color:#daa520;box-shadow:0 0 20px rgba(218,165,32,0.3);transform:translateY(-4px)}
#touch-zone{position:fixed;bottom:0;left:0;width:200px;height:200px;z-index:15;pointer-events:auto;display:none}
@media(hover:none)and(pointer:coarse){#touch-zone{display:block}}
@media(max-width:600px){.upgrade-cards{flex-direction:column;align-items:center}.upgrade-card{width:85%}.weapon-slot{width:28px;height:28px;font-size:14px}}
</style>
</head>
<body>
<canvas id="game-canvas"></canvas>
<div id="ui-overlay">
  <div id="xp-bar-container"><div id="xp-bar"></div></div>
  <div id="hud">
    <div id="hud-left">
      <div class="hud-text hud-big" id="hud-level">Level 1</div>
      <div class="hud-text" id="hud-time">0:00</div>
      <div class="hud-text" id="hud-kills">Kills: 0</div>
    </div>
    <div id="hud-right">
      <div class="hud-text" id="hud-wave">Wave 1</div>
    </div>
  </div>
  <div id="hp-bar-container"><div id="hp-bar"></div></div>
  <div id="weapon-bar"></div>
</div>
<div id="touch-zone"></div>

<div id="title-screen">
  <div class="screen-title">Forest Survivors</div>
  <div class="screen-subtitle">Defend the Grove</div>
  <button class="btn" id="btn-start">Begin</button>
  <div style="margin-top:24px;font-size:0.85rem;color:#777;text-align:center">WASD / Arrows to move &bull; Auto-attack &bull; Survive</div>
</div>

<div id="game-over-screen">
  <div class="screen-title">The Grove Falls</div>
  <div id="go-stats"></div>
  <button class="btn" id="btn-restart" style="margin-top:24px">Regrow</button>
</div>

<div id="level-up-screen">
  <div class="screen-title" style="font-size:clamp(1.5rem,5vw,2.5rem)">Level Up</div>
  <div class="screen-subtitle">Choose your blessing</div>
  <div class="upgrade-cards" id="upgrade-cards"></div>
</div>

<div id="pause-screen">
  <div class="screen-title" style="font-size:clamp(1.5rem,5vw,2.5rem)">Paused</div>
  <button class="btn" id="btn-resume">Resume</button>
</div>

<div id="victory-screen" style="display:none">
  <div class="screen-title" style="color:#33cc33">World Complete!</div>
  <div class="screen-subtitle">The Grove is cleansed</div>
  <div id="victory-stats"></div>
  <div id="victory-next" style="margin-top:24px;font-size:1rem;color:#228b22">Warping to next world...</div>
</div>

<script>
// ============================================================
// FOREST THEME CONFIGURATION
// ============================================================
const THEME = {
  name: 'Forest Survivors',
  fonts: { title: 'Amatic SC', body: 'Cabin' },
  victoryCondition: { timeSeconds: 540, bossName: 'The Blight' },
  worldOrder: { current: 2, next: 'shop-cosmic.html' },
  palette: {
    bg: '#0a1a0a', bgLight: '#152015', accent: '#228b22',
    gold: '#daa520', bone: '#d8e8c8', emerald: '#33cc33',
    purple: '#9966cc', blood: '#cc4444', midnight: '#050a05',
    floorBase: '#0d1a0d', floorLine: '#1a2a1a'
  },
  effectColors: {
    field: { fillRgb: '34,139,34', strokeRgb: '34,139,34' },
    orbit: { ring: 'rgba(34,139,34,0.15)', orb: '#33cc33' },
    area: { rgb: '34,139,34' },
    beam: { rgb: '200,255,100', glow: '#aaff44' },
    chain: { rgb: '51,170,51', particle: '#77bbff' },
    damageFlash: { rgb: '180,0,0' },
    invuln: { rgb: '255,255,255' },
    rain: { particle: '#ff6633' }
  },
  enemies: [
    { name:'Beetle', color:'#554422', size:12, speed:50, hp:3, xp:1, spawnAfter:0, draw:'beetle', movementType:'chase' },
    { name:'Wasp', color:'#ccaa00', size:10, speed:90, hp:2, xp:1, spawnAfter:0, draw:'wasp', movementType:'strafe' },
    { name:'Spider', color:'#333333', size:15, speed:55, hp:6, xp:2, spawnAfter:30, draw:'spider', movementType:'ambush' },
    { name:'Thorned Vine', color:'#336633', size:14, speed:40, hp:8, xp:3, spawnAfter:90, draw:'vine', movementType:'orbit' },
    { name:'Fox Hunter', color:'#cc5500', size:13, speed:95, hp:4, xp:3, spawnAfter:120, draw:'fox', movementType:'flanker' },
    { name:'Wolf Pack', color:'#777788', size:14, speed:100, hp:5, xp:3, spawnAfter:180, draw:'wolf', movementType:'charge' },
    { name:'Hawk', color:'#886644', size:13, speed:75, hp:5, xp:4, spawnAfter:180, draw:'hawk', movementType:'divebomber' },
    { name:'Corrupted Treant', color:'#443322', size:22, speed:25, hp:25, xp:8, spawnAfter:240, draw:'treant', movementType:'shieldbearer' },
    { name:'Forest Warden', color:'#225522', size:18, speed:50, hp:20, xp:6, spawnAfter:300, draw:'warden', movementType:'chase' }
  ],
  bosses: [
    { name:'Giant Spider Queen', color:'#222222', size:50, speed:30, hp:200, xp:50, spawnAt:120, attackPattern:'summon' },
    { name:'Thorned Titan', color:'#336633', size:55, speed:25, hp:400, xp:80, spawnAt:240, attackPattern:'shockwave' },
    { name:'Alpha Wolf', color:'#aaaaaa', size:40, speed:65, hp:600, xp:120, spawnAt:360, attackPattern:'charge' },
    { name:'The Blight', color:'#553300', size:60, speed:35, hp:1200, xp:200, spawnAt:480, attackPattern:'beam' }
  ],
  weapons: [
    { name:'Thorn Shot', desc:'Fires a barbed thorn bolt', icon:'\u273B', type:'projectile' },
    { name:'Fairy Orbit', desc:'Orbiting fairy lights', icon:'\u2748', type:'orbit' },
    { name:'Root Nova', desc:'Expanding root blast', icon:'\u2618', type:'area' },
    { name:'Chain Vine', desc:'Vines lash between foes', icon:'\u2E19', type:'chain' },
    { name:'Sunbeam', desc:'Focused ray of sunlight', icon:'\u2600', type:'beam' },
    { name:'Seed Rain', desc:'Seeds rain from the canopy', icon:'\u2766', type:'rain' },
    { name:'Leaf Blade', desc:'Returning razor leaf', icon:'\u2618', type:'boomerang' },
    { name:'Mushroom Spore Field', desc:'Toxic spore cloud zone', icon:'\u2668', type:'field' }
  ],
  passives: [
    { name:"Nature's Gift", desc:'+20% Max HP', icon:'\u2665', stat:'maxHp', mult:1.2 },
    { name:'Deer Speed', desc:'+15% Move Speed', icon:'\u27A4', stat:'speed', mult:1.15 },
    { name:'Pollen Wind', desc:'+40% Pickup Range', icon:'\u2609', stat:'pickupRadius', mult:1.4 },
    { name:'Bear Strength', desc:'+20% Damage', icon:'\u2694', stat:'damage', mult:1.2 },
    { name:'Hummingbird', desc:'+15% Attack Speed', icon:'\u231A', stat:'attackSpeed', mult:1.15 },
    { name:'Bark Skin', desc:'-15% Damage Taken', icon:'\u26E8', stat:'defense', mult:0.85 }
  ],
  drawPlayer(ctx, x, y, r, time) {
    // Forest druid/ranger - hooded figure in green robes
    ctx.save();
    ctx.translate(x, y);
    // Cloak / robe
    ctx.beginPath();
    ctx.moveTo(-r*0.7, -r*0.3);
    ctx.lineTo(-r*0.9, r);
    ctx.lineTo(r*0.9, r);
    ctx.lineTo(r*0.7, -r*0.3);
    ctx.closePath();
    ctx.fillStyle = '#1a3a1a';
    ctx.fill();
    // Body
    ctx.beginPath();
    ctx.arc(0, -r*0.1, r*0.65, 0, Math.PI*2);
    ctx.fillStyle = '#2a4a2a';
    ctx.fill();
    // Head / hood
    ctx.beginPath();
    ctx.arc(0, -r*0.7, r*0.35, 0, Math.PI*2);
    ctx.fillStyle = '#d8e8c8';
    ctx.fill();
    // Eyes glow (green-gold)
    const glow = 0.5 + 0.5*Math.sin(time*3);
    ctx.fillStyle = `rgba(218,165,32,${0.6+glow*0.4})`;
    ctx.beginPath();
    ctx.arc(-r*0.12, -r*0.75, 2.5, 0, Math.PI*2);
    ctx.arc(r*0.12, -r*0.75, 2.5, 0, Math.PI*2);
    ctx.fill();
    // Wooden staff glow
    ctx.strokeStyle = '#8B6914';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(r*0.5, -r*0.6);
    ctx.lineTo(r*0.5, r*0.9);
    ctx.stroke();
    // Staff top glow
    ctx.fillStyle = `rgba(51,204,51,${0.4+glow*0.3})`;
    ctx.shadowColor = '#33cc33';
    ctx.shadowBlur = 8;
    ctx.beginPath();
    ctx.arc(r*0.5, -r*0.7, 3, 0, Math.PI*2);
    ctx.fill();
    ctx.shadowBlur = 0;
    // Leaf particles around feet
    for(let i = 0; i < 3; i++) {
      const la = time*2 + i*2.1;
      const lx = Math.cos(la) * r*0.6;
      const ly = r*0.7 + Math.sin(la*1.3) * 3;
      ctx.fillStyle = `rgba(34,139,34,${0.3+0.2*Math.sin(time*3+i)})`;
      ctx.beginPath();
      ctx.ellipse(lx, ly, 3, 1.5, la, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  },
  drawEnemy(ctx, e, time) {
    const {x, y, size, type} = e;
    ctx.save();
    ctx.translate(x, y);
    const s = size;
    if(type.draw==='beetle') {
      // Round brown body with shell pattern and small legs
      ctx.fillStyle = type.color;
      ctx.beginPath(); ctx.ellipse(0, 0, s*0.5, s*0.4, 0, 0, Math.PI*2); ctx.fill();
      // Shell line
      ctx.strokeStyle = '#332211';
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(0, -s*0.4); ctx.lineTo(0, s*0.4); ctx.stroke();
      // Legs
      ctx.strokeStyle = '#443322';
      ctx.lineWidth = 1;
      for(let i = -1; i <= 1; i++) {
        ctx.beginPath(); ctx.moveTo(-s*0.4, i*s*0.15); ctx.lineTo(-s*0.65, i*s*0.25); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(s*0.4, i*s*0.15); ctx.lineTo(s*0.65, i*s*0.25); ctx.stroke();
      }
      // Head
      ctx.fillStyle = '#332211';
      ctx.beginPath(); ctx.arc(0, -s*0.45, s*0.15, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='wasp') {
      // Elongated yellow-black striped body with small wings
      ctx.fillStyle = type.color;
      ctx.beginPath(); ctx.ellipse(0, 0, s*0.3, s*0.55, 0, 0, Math.PI*2); ctx.fill();
      // Stripes
      ctx.fillStyle = '#111';
      ctx.fillRect(-s*0.25, -s*0.15, s*0.5, s*0.08);
      ctx.fillRect(-s*0.25, s*0.05, s*0.5, s*0.08);
      ctx.fillRect(-s*0.25, s*0.25, s*0.5, s*0.08);
      // Wings
      const wingFlap = Math.sin(time*20 + e.spawnTime*10);
      ctx.fillStyle = 'rgba(200,220,255,0.4)';
      ctx.beginPath(); ctx.ellipse(-s*0.4, -s*0.1, s*0.25, s*0.1*Math.abs(wingFlap), 0.3, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(s*0.4, -s*0.1, s*0.25, s*0.1*Math.abs(wingFlap), -0.3, 0, Math.PI*2); ctx.fill();
      // Head
      ctx.fillStyle = '#111';
      ctx.beginPath(); ctx.arc(0, -s*0.55, s*0.12, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='spider') {
      // Round body with 8 legs radiating outward
      ctx.fillStyle = type.color;
      ctx.beginPath(); ctx.arc(0, 0, s*0.35, 0, Math.PI*2); ctx.fill();
      // Abdomen
      ctx.beginPath(); ctx.arc(0, s*0.25, s*0.3, 0, Math.PI*2); ctx.fill();
      // 8 legs
      ctx.strokeStyle = type.color;
      ctx.lineWidth = 1.5;
      for(let i = 0; i < 8; i++) {
        const a = (i/8)*Math.PI*2 - Math.PI/2;
        const legLen = s*0.7;
        const midX = Math.cos(a)*s*0.4;
        const midY = Math.sin(a)*s*0.4;
        const endX = Math.cos(a)*legLen + Math.cos(a+0.5)*s*0.3;
        const endY = Math.sin(a)*legLen + Math.sin(a+0.5)*s*0.3;
        ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(midX, midY); ctx.lineTo(endX, endY); ctx.stroke();
      }
      // Eyes (small red dots)
      ctx.fillStyle = '#cc0000';
      ctx.beginPath(); ctx.arc(-s*0.1, -s*0.15, 2, 0, Math.PI*2); ctx.arc(s*0.1, -s*0.15, 2, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='vine') {
      // Snaking green tendril with thorns
      ctx.strokeStyle = type.color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(0, -s*0.5);
      for(let i = 0; i < 5; i++) {
        const vy = -s*0.5 + i*(s*0.25);
        const vx = Math.sin(time*3 + i + e.spawnTime)*s*0.3;
        ctx.lineTo(vx, vy);
      }
      ctx.stroke();
      // Thorns
      ctx.fillStyle = '#225522';
      for(let i = 0; i < 4; i++) {
        const ty = -s*0.35 + i*(s*0.25);
        const tx = Math.sin(time*3 + i + e.spawnTime)*s*0.3;
        ctx.beginPath();
        ctx.moveTo(tx, ty);
        ctx.lineTo(tx + s*0.15, ty - s*0.08);
        ctx.lineTo(tx + s*0.05, ty + s*0.05);
        ctx.closePath();
        ctx.fill();
      }
    } else if(type.draw==='wolf') {
      // Angular canine shape, grey fur
      ctx.fillStyle = type.color;
      // Body
      ctx.beginPath();
      ctx.ellipse(0, 0, s*0.55, s*0.3, 0, 0, Math.PI*2);
      ctx.fill();
      // Head
      ctx.beginPath();
      ctx.arc(0, -s*0.35, s*0.25, 0, Math.PI*2);
      ctx.fill();
      // Ears (pointed)
      ctx.beginPath();
      ctx.moveTo(-s*0.2, -s*0.5); ctx.lineTo(-s*0.1, -s*0.75); ctx.lineTo(0, -s*0.5);
      ctx.closePath(); ctx.fill();
      ctx.beginPath();
      ctx.moveTo(0, -s*0.5); ctx.lineTo(s*0.1, -s*0.75); ctx.lineTo(s*0.2, -s*0.5);
      ctx.closePath(); ctx.fill();
      // Eyes
      ctx.fillStyle = '#ffcc00';
      ctx.beginPath(); ctx.arc(-s*0.08, -s*0.38, 2, 0, Math.PI*2); ctx.arc(s*0.08, -s*0.38, 2, 0, Math.PI*2); ctx.fill();
      // Snout
      ctx.fillStyle = '#555566';
      ctx.beginPath(); ctx.arc(0, -s*0.25, s*0.08, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='treant') {
      // Large tree-like shape with face, brown with green leaves
      // Trunk
      ctx.fillStyle = type.color;
      ctx.fillRect(-s*0.3, -s*0.2, s*0.6, s*0.8);
      // Roots
      ctx.beginPath();
      ctx.moveTo(-s*0.3, s*0.6); ctx.lineTo(-s*0.5, s*0.8);
      ctx.moveTo(s*0.3, s*0.6); ctx.lineTo(s*0.5, s*0.8);
      ctx.strokeStyle = type.color; ctx.lineWidth = 3; ctx.stroke();
      // Canopy / leaves
      ctx.fillStyle = '#225522';
      ctx.beginPath(); ctx.arc(0, -s*0.4, s*0.5, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#338833';
      ctx.beginPath(); ctx.arc(-s*0.2, -s*0.5, s*0.25, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(s*0.2, -s*0.45, s*0.25, 0, Math.PI*2); ctx.fill();
      // Face
      ctx.fillStyle = '#ffcc66';
      ctx.beginPath(); ctx.arc(-s*0.12, -s*0.1, 3, 0, Math.PI*2); ctx.arc(s*0.12, -s*0.1, 3, 0, Math.PI*2); ctx.fill();
      // Mouth
      ctx.strokeStyle = '#ffcc66';
      ctx.lineWidth = 1.5;
      ctx.beginPath(); ctx.arc(0, s*0.05, s*0.1, 0, Math.PI); ctx.stroke();
    } else if(type.draw==='fox') {
      // Sleek orange fox shape
      ctx.fillStyle = type.color;
      ctx.beginPath();
      ctx.moveTo(0, -s*0.5);
      ctx.lineTo(s*0.4, s*0.2);
      ctx.lineTo(s*0.15, s*0.4);
      ctx.lineTo(-s*0.15, s*0.4);
      ctx.lineTo(-s*0.4, s*0.2);
      ctx.closePath();
      ctx.fill();
      // Ears
      ctx.beginPath();
      ctx.moveTo(-s*0.2, -s*0.4); ctx.lineTo(-s*0.35, -s*0.65); ctx.lineTo(-s*0.05, -s*0.35);
      ctx.moveTo(s*0.2, -s*0.4); ctx.lineTo(s*0.35, -s*0.65); ctx.lineTo(s*0.05, -s*0.35);
      ctx.fillStyle = '#ff7700'; ctx.fill();
      // Eyes
      ctx.fillStyle = '#ffcc00';
      ctx.beginPath(); ctx.arc(-s*0.1, -s*0.15, 2, 0, Math.PI*2); ctx.arc(s*0.1, -s*0.15, 2, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='hawk') {
      // Bird with spread wings
      const hover = Math.sin(time * 3 + e.spawnTime) * 4;
      ctx.translate(0, hover);
      ctx.fillStyle = type.color;
      // Body
      ctx.beginPath(); ctx.ellipse(0, 0, s*0.2, s*0.35, 0, 0, Math.PI*2); ctx.fill();
      // Wings
      ctx.beginPath();
      ctx.moveTo(-s*0.15, 0); ctx.lineTo(-s*0.65, -s*0.3); ctx.lineTo(-s*0.5, s*0.1);
      ctx.closePath(); ctx.fill();
      ctx.beginPath();
      ctx.moveTo(s*0.15, 0); ctx.lineTo(s*0.65, -s*0.3); ctx.lineTo(s*0.5, s*0.1);
      ctx.closePath(); ctx.fill();
      // Eye
      ctx.fillStyle = '#ffcc00';
      ctx.beginPath(); ctx.arc(0, -s*0.15, 2, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='warden') {
      // Armored forest guardian
      ctx.fillStyle = type.color;
      ctx.beginPath(); ctx.arc(0, 0, s*0.5, 0, Math.PI*2); ctx.fill();
      // Antlers
      ctx.strokeStyle = '#443322';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(-s*0.15, -s*0.4); ctx.lineTo(-s*0.35, -s*0.7); ctx.lineTo(-s*0.5, -s*0.65);
      ctx.moveTo(s*0.15, -s*0.4); ctx.lineTo(s*0.35, -s*0.7); ctx.lineTo(s*0.5, -s*0.65);
      ctx.stroke();
      // Eyes
      ctx.fillStyle = '#44ff44';
      ctx.beginPath(); ctx.arc(-s*0.12, -s*0.1, 3, 0, Math.PI*2); ctx.arc(s*0.12, -s*0.1, 3, 0, Math.PI*2); ctx.fill();
    }
    ctx.restore();
  },
  drawBoss(ctx, e, time) {
    const {x, y, size} = e;
    ctx.save();
    ctx.translate(x, y);
    const s = size;
    ctx.fillStyle = e.type.color;
    ctx.shadowColor = '#33cc33';
    ctx.shadowBlur = 30;
    ctx.beginPath(); ctx.arc(0, 0, s, 0, Math.PI*2); ctx.fill();
    ctx.shadowBlur = 0;
    // Inner details
    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.beginPath(); ctx.arc(0, 0, s*0.7, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = e.type.color;
    ctx.beginPath(); ctx.arc(0, 0, s*0.4, 0, Math.PI*2); ctx.fill();
    // Eyes
    ctx.fillStyle = '#33cc33';
    ctx.beginPath();
    ctx.arc(-s*0.2, -s*0.15, s*0.1, 0, Math.PI*2);
    ctx.arc(s*0.2, -s*0.15, s*0.1, 0, Math.PI*2);
    ctx.fill();
    // HP bar
    const hpPct = e.hp / e.maxHp;
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(-s, -s-14, s*2, 8);
    ctx.fillStyle = hpPct > 0.5 ? '#228b22' : '#daa520';
    ctx.fillRect(-s, -s-14, s*2*hpPct, 8);
    ctx.strokeStyle = '#888';
    ctx.strokeRect(-s, -s-14, s*2, 8);
    // Name
    ctx.fillStyle = '#daa520';
    ctx.font = '12px Amatic SC';
    ctx.textAlign = 'center';
    ctx.fillText(e.type.name, 0, -s-18);
    ctx.restore();
  },
  drawBackground(ctx, cam, W, H, time) {
    // Forest floor with grass texture
    ctx.fillStyle = THEME.palette.floorBase;
    ctx.fillRect(0, 0, W, H);
    const gs = 64;
    const ox = (-cam.x % gs + gs) % gs;
    const oy = (-cam.y % gs + gs) % gs;
    ctx.strokeStyle = THEME.palette.floorLine;
    ctx.lineWidth = 1;
    ctx.globalAlpha = 0.3;
    for(let x = ox; x < W; x += gs) {
      ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
    }
    for(let y = oy; y < H; y += gs) {
      ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
    }
    ctx.globalAlpha = 1;
    // Scattered grass dots / patches
    const seed = 12345;
    for(let i = 0; i < 40; i++) {
      const gx = ((i * 347 + 50) % 1400) - cam.x % 1400;
      const gy = ((i * 521 + 80) % 1000) - cam.y % 1000;
      ctx.fillStyle = `rgba(34,139,34,${0.08 + 0.04*Math.sin(time*0.5+i)})`;
      ctx.beginPath(); ctx.arc(gx, gy, 2+i%3, 0, Math.PI*2); ctx.fill();
    }
    // Subtle dark tree silhouettes in background
    ctx.globalAlpha = 0.06;
    for(let i = 0; i < 4; i++) {
      const tx = ((i * 431 + 200) % 1200) - cam.x % 1200;
      const ty = ((i * 293 + 100) % 900) - cam.y % 900;
      ctx.fillStyle = '#0a2a0a';
      // Trunk
      ctx.fillRect(tx-4, ty, 8, 60);
      // Canopy
      ctx.beginPath(); ctx.arc(tx, ty-10, 30+i*5, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1;
    // Wildflower spots of color
    for(let i = 0; i < 8; i++) {
      const fx = ((i * 613 + 300) % 1300) - cam.x % 1300;
      const fy = ((i * 401 + 150) % 950) - cam.y % 950;
      const colors = ['rgba(255,100,100,0.12)','rgba(255,200,50,0.12)','rgba(180,100,255,0.12)','rgba(100,200,255,0.12)'];
      ctx.fillStyle = colors[i%4];
      ctx.beginPath(); ctx.arc(fx, fy, 3, 0, Math.PI*2); ctx.fill();
    }
    // Soft dappled light effects
    const flickerT = time * 0.8;
    for(let i = 0; i < 6; i++) {
      const lx = ((i * 347 + 100) % 1200) - cam.x % 1200;
      const ly = ((i * 521 + 200) % 900) - cam.y % 900;
      const flicker = 0.08 + 0.06 * Math.sin(flickerT + i * 1.7);
      const grd = ctx.createRadialGradient(lx, ly, 0, lx, ly, 100);
      grd.addColorStop(0, `rgba(200,220,120,${flicker})`);
      grd.addColorStop(1, 'transparent');
      ctx.fillStyle = grd;
      ctx.fillRect(lx-100, ly-100, 200, 200);
    }
  },
  drawProjectile(ctx, p) {
    ctx.save();
    ctx.translate(p.x, p.y);
    if(p.weaponType === 'projectile') {
      // Green thorn/seed bolt
      ctx.fillStyle = '#33cc33';
      ctx.shadowColor = '#33cc33'; ctx.shadowBlur = 10;
      ctx.beginPath();
      ctx.moveTo(0, -(4+p.level));
      ctx.lineTo(3+p.level*0.5, 0);
      ctx.lineTo(0, 4+p.level);
      ctx.lineTo(-(3+p.level*0.5), 0);
      ctx.closePath();
      ctx.fill();
    } else if(p.weaponType === 'chain') {
      // Vine tendril connecting enemies (green)
      ctx.strokeStyle = '#33aa33';
      ctx.shadowColor = '#33aa33'; ctx.shadowBlur = 12;
      ctx.lineWidth = 2 + p.level;
      ctx.beginPath(); ctx.moveTo(-8,0); ctx.quadraticCurveTo(0, -5, 8, 0); ctx.stroke();
    } else if(p.weaponType === 'rain') {
      // Seeds/acorns falling (brown)
      ctx.fillStyle = '#8B6914';
      ctx.shadowColor = '#daa520'; ctx.shadowBlur = 8;
      ctx.beginPath(); ctx.arc(0,0,4+p.level,0,Math.PI*2); ctx.fill();
      // Acorn cap
      ctx.fillStyle = '#5a4a1a';
      ctx.beginPath(); ctx.arc(0, -(2+p.level*0.5), 3+p.level*0.5, Math.PI, 0); ctx.fill();
    } else if(p.weaponType === 'boomerang') {
      // Spinning leaf (green)
      ctx.fillStyle = '#228b22';
      ctx.rotate(p.angle || 0);
      ctx.beginPath();
      ctx.ellipse(0, 0, 6+p.level, 3+p.level*0.5, 0, 0, Math.PI*2);
      ctx.fill();
      // Leaf vein
      ctx.strokeStyle = '#115511';
      ctx.lineWidth = 0.5;
      ctx.beginPath(); ctx.moveTo(-(6+p.level), 0); ctx.lineTo(6+p.level, 0); ctx.stroke();
    }
    ctx.restore();
  },
  drawGem(ctx, g, time) {
    // Dewdrop/seed shapes
    const pulse = 1 + 0.15*Math.sin(time*5 + g.x);
    ctx.save();
    ctx.translate(g.x, g.y);
    ctx.scale(pulse, pulse);
    ctx.fillStyle = g.value > 5 ? '#daa520' : g.value > 2 ? '#33cc33' : '#9966cc';
    ctx.shadowColor = ctx.fillStyle; ctx.shadowBlur = 8;
    // Dewdrop shape
    ctx.beginPath();
    ctx.moveTo(0, -6);
    ctx.quadraticCurveTo(5, 0, 0, 5);
    ctx.quadraticCurveTo(-5, 0, 0, -6);
    ctx.closePath(); ctx.fill();
    ctx.restore();
  }
};
</script>
<script src="engine.js"></script>
</body>
</html>