<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Cosmic Survivors</title>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&family=Space+Mono&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#050510;font-family:'Space Mono',monospace;color:#d0d8f0}
canvas{display:block;width:100%;height:100%;touch-action:none}
#ui-overlay{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}
#hud{position:absolute;top:0;left:0;width:100%;padding:8px 12px;display:flex;justify-content:space-between;align-items:flex-start;font-family:'Exo 2',sans-serif}
#hud-left,#hud-right{display:flex;flex-direction:column;gap:4px}
#hud-right{align-items:flex-end}
.hud-text{font-size:14px;text-shadow:0 0 8px rgba(153,51,255,0.6),1px 1px 2px #000;color:#d0d8f0}
.hud-big{font-size:18px;font-weight:700;color:#ffd700}
#xp-bar-container{position:absolute;top:0;left:0;width:100%;height:4px;background:rgba(0,0,0,0.7)}
#xp-bar{height:100%;background:linear-gradient(90deg,#3388ff,#ffd700);width:0%;transition:width 0.3s}
#hp-bar-container{position:absolute;bottom:60px;left:50%;transform:translateX(-50%);width:200px;height:8px;background:rgba(0,0,0,0.7);border:1px solid #555;border-radius:4px;overflow:hidden}
#hp-bar{height:100%;background:linear-gradient(90deg,#6600cc,#3388ff);width:100%;transition:width 0.3s}
#weapon-bar{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:4px}
.weapon-slot{width:36px;height:36px;border:2px solid #555;background:rgba(0,0,0,0.6);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:18px}
.weapon-slot.active{border-color:#ffd700;box-shadow:0 0 8px rgba(255,215,0,0.5)}
#title-screen,#game-over-screen,#level-up-screen,#pause-screen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;pointer-events:auto}
#title-screen{background:radial-gradient(ellipse at center,#101025 0%,#050510 70%)}
#game-over-screen{background:rgba(3,3,8,0.92);display:none}
#level-up-screen{background:rgba(3,3,8,0.85);display:none}
#pause-screen{background:rgba(0,0,0,0.8);display:none}
.screen-title{font-family:'Exo 2',sans-serif;font-size:clamp(2.5rem,8vw,5rem);font-weight:900;color:#9933ff;text-shadow:0 0 40px rgba(153,51,255,0.6),0 0 80px rgba(153,51,255,0.3),0 0 4px rgba(255,215,0,0.4);margin-bottom:8px;text-align:center;letter-spacing:0.05em}
.screen-subtitle{font-family:'Space Mono',monospace;font-size:clamp(1rem,3vw,1.4rem);color:#ffd700;font-style:italic;margin-bottom:32px;text-align:center}
.btn{font-family:'Exo 2',sans-serif;font-size:1.1rem;font-weight:700;padding:14px 40px;border:2px solid #ffd700;background:rgba(153,51,255,0.3);color:#d0d8f0;cursor:pointer;letter-spacing:0.1em;text-transform:uppercase;transition:all 0.2s;pointer-events:auto}
.btn:hover{background:rgba(153,51,255,0.6);box-shadow:0 0 20px rgba(255,215,0,0.4);transform:scale(1.05)}
.stats-line{font-size:1.1rem;color:#8088a0;margin:4px 0}
.upgrade-cards{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;max-width:700px;padding:0 16px}
.upgrade-card{width:200px;padding:20px 16px;border:2px solid #333;background:rgba(10,10,25,0.9);cursor:pointer;text-align:center;transition:all 0.2s;pointer-events:auto;border-radius:4px}
.upgrade-card:hover{border-color:#ffd700;box-shadow:0 0 20px rgba(255,215,0,0.3);transform:translateY(-4px)}
.upgrade-icon{font-size:2.5rem;margin-bottom:8px}
.upgrade-name{font-family:'Exo 2',sans-serif;font-size:1rem;font-weight:700;color:#ffd700;margin-bottom:6px}
.upgrade-desc{font-size:0.85rem;color:#8088a0;line-height:1.4}
.upgrade-hotkey{position:absolute;top:8px;right:10px;font-family:'Exo 2',sans-serif;font-size:0.75rem;color:#777;border:1px solid #555;border-radius:3px;width:22px;height:22px;display:flex;align-items:center;justify-content:center}
.upgrade-card{position:relative}
.upgrade-card.selected{border-color:#ffd700;box-shadow:0 0 20px rgba(255,215,0,0.3);transform:translateY(-4px)}
#touch-zone{position:fixed;bottom:0;left:0;width:200px;height:200px;z-index:15;pointer-events:auto;display:none}
@media(hover:none)and(pointer:coarse){#touch-zone{display:block}}
@media(max-width:600px){.upgrade-cards{flex-direction:column;align-items:center}.upgrade-card{width:85%}.weapon-slot{width:28px;height:28px;font-size:14px}}
</style>
</head>
<body>
<canvas id="game-canvas"></canvas>
<div id="ui-overlay">
  <div id="xp-bar-container"><div id="xp-bar"></div></div>
  <div id="hud">
    <div id="hud-left">
      <div class="hud-text hud-big" id="hud-level">Level 1</div>
      <div class="hud-text" id="hud-time">0:00</div>
      <div class="hud-text" id="hud-kills">Kills: 0</div>
    </div>
    <div id="hud-right">
      <div class="hud-text" id="hud-wave">Wave 1</div>
    </div>
  </div>
  <div id="hp-bar-container"><div id="hp-bar"></div></div>
  <div id="weapon-bar"></div>
</div>
<div id="touch-zone"></div>

<div id="title-screen">
  <div class="screen-title">Cosmic Survivors</div>
  <div class="screen-subtitle">Lost Among the Stars</div>
  <button class="btn" id="btn-start">Begin</button>
  <div style="margin-top:24px;font-size:0.85rem;color:#777;text-align:center">WASD / Arrows to move &bull; Auto-attack &bull; Survive</div>
</div>

<div id="game-over-screen">
  <div class="screen-title">Death Claims You</div>
  <div id="go-stats"></div>
  <button class="btn" id="btn-restart" style="margin-top:24px">Rise Again</button>
</div>

<div id="level-up-screen">
  <div class="screen-title" style="font-size:clamp(1.5rem,5vw,2.5rem)">Level Up</div>
  <div class="screen-subtitle">Choose your blessing</div>
  <div class="upgrade-cards" id="upgrade-cards"></div>
</div>

<div id="pause-screen">
  <div class="screen-title" style="font-size:clamp(1.5rem,5vw,2.5rem)">Paused</div>
  <button class="btn" id="btn-resume">Resume</button>
</div>

<script>
// ============================================================
// COSMIC THEME CONFIGURATION
// ============================================================
const THEME = {
  name: 'Cosmic Survivors',
  fonts: { title: 'Exo 2', body: 'Space Mono' },
  palette: {
    bg: '#050510', bgLight: '#101025', accent: '#9933ff',
    gold: '#ffd700', bone: '#d0d8f0', emerald: '#33ff88',
    purple: '#9933ff', blood: '#ff3366', midnight: '#030308',
    floorBase: '#080818', floorLine: '#151530'
  },
  effectColors: {
    field: { fillRgb: '153,51,255', strokeRgb: '153,51,255' },
    orbit: { ring: 'rgba(153,51,255,0.15)', orb: '#9933ff' },
    area: { rgb: '255,215,0' },
    beam: { rgb: '153,51,255', glow: '#9933ff' },
    chain: { rgb: '187,102,255', particle: '#bb66ff' },
    damageFlash: { rgb: '153,0,255' },
    invuln: { rgb: '255,255,255' },
    rain: { particle: '#ff6633' }
  },
  enemies: [
    { name:'Alien Spore', color:'#33ff88', size:10, speed:50, hp:2, xp:1, spawnAfter:0, draw:'spore' },
    { name:'Swarm Drone', color:'#aaaacc', size:12, speed:75, hp:3, xp:1, spawnAfter:0, draw:'swarmdrone' },
    { name:'Asteroid Beast', color:'#996633', size:20, speed:30, hp:10, xp:3, spawnAfter:30, draw:'asteroid' },
    { name:'Void Wraith', color:'#6600cc', size:14, speed:85, hp:5, xp:3, spawnAfter:90, draw:'voidwraith' },
    { name:'Hive Swarm', color:'#ffaa00', size:11, speed:100, hp:3, xp:2, spawnAfter:180, draw:'hiveswarm' },
    { name:'Cosmic Horror', color:'#ff0066', size:18, speed:55, hp:20, xp:8, spawnAfter:300, draw:'cosmichorror' }
  ],
  bosses: [
    { name:'Hive Queen', color:'#ffaa00', size:50, speed:30, hp:200, xp:50, spawnAt:120 },
    { name:'Void Leviathan', color:'#6600cc', size:55, speed:35, hp:400, xp:80, spawnAt:240 },
    { name:'Star Eater', color:'#ff3300', size:50, speed:45, hp:700, xp:120, spawnAt:360 },
    { name:'The Singularity', color:'#ffffff', size:60, speed:40, hp:1200, xp:200, spawnAt:480 }
  ],
  weapons: [
    { name:'Plasma Bolt', desc:'Fires a bolt of plasma', icon:'\u25C6', type:'projectile' },
    { name:'Graviton Orbit', desc:'Orbiting gravity shield', icon:'\u2748', type:'orbit' },
    { name:'Solar Flare', desc:'Expanding solar blast', icon:'\u2600', type:'area' },
    { name:'Chain Tether', desc:'Bounces between foes', icon:'\u26A1', type:'chain' },
    { name:'Ion Beam', desc:'Sustained ion beam', icon:'\u2604', type:'beam' },
    { name:'Comet Rain', desc:'Comets from above', icon:'\u2604', type:'rain' },
    { name:'Quantum Disc', desc:'Returning energy disc', icon:'\u25C9', type:'boomerang' },
    { name:'Singularity Field', desc:'Warped space zone', icon:'\u2742', type:'field' }
  ],
  passives: [
    { name:'Hull Integrity', desc:'+20% Max HP', icon:'\u2665', stat:'maxHp', mult:1.2 },
    { name:'Thrusters', desc:'+15% Move Speed', icon:'\u27A4', stat:'speed', mult:1.15 },
    { name:'Gravity Well', desc:'+40% Pickup Range', icon:'\u2609', stat:'pickupRadius', mult:1.4 },
    { name:'Plasma Core', desc:'+20% Damage', icon:'\u2694', stat:'damage', mult:1.2 },
    { name:'Warp Drive', desc:'+15% Attack Speed', icon:'\u231A', stat:'attackSpeed', mult:1.15 },
    { name:'Shields', desc:'-15% Damage Taken', icon:'\u26E8', stat:'defense', mult:0.85 }
  ],
  drawPlayer(ctx, x, y, r, time) {
    ctx.save();
    ctx.translate(x, y);
    // Engine glow trail
    const enginePulse = 0.6 + 0.4*Math.sin(time*10);
    const grd = ctx.createRadialGradient(0, r*0.8, 0, 0, r*0.8, r*0.6);
    grd.addColorStop(0, `rgba(51,136,255,${enginePulse*0.8})`);
    grd.addColorStop(0.5, `rgba(51,136,255,${enginePulse*0.3})`);
    grd.addColorStop(1, 'transparent');
    ctx.fillStyle = grd;
    ctx.fillRect(-r*0.5, r*0.3, r, r*0.8);
    // Ship body (triangle)
    ctx.beginPath();
    ctx.moveTo(0, -r);
    ctx.lineTo(-r*0.7, r*0.6);
    ctx.lineTo(-r*0.3, r*0.4);
    ctx.lineTo(0, r*0.5);
    ctx.lineTo(r*0.3, r*0.4);
    ctx.lineTo(r*0.7, r*0.6);
    ctx.closePath();
    ctx.fillStyle = '#445577';
    ctx.fill();
    ctx.strokeStyle = '#6688aa';
    ctx.lineWidth = 1;
    ctx.stroke();
    // Cockpit light
    const cockpitGlow = 0.5 + 0.5*Math.sin(time*3);
    ctx.fillStyle = `rgba(153,51,255,${0.6+cockpitGlow*0.4})`;
    ctx.beginPath();
    ctx.arc(0, -r*0.3, r*0.2, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle = `rgba(255,255,255,${0.3+cockpitGlow*0.3})`;
    ctx.beginPath();
    ctx.arc(0, -r*0.3, r*0.1, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  },
  drawEnemy(ctx, e, time) {
    const {x, y, size, type} = e;
    ctx.save();
    ctx.translate(x, y);
    const s = size;
    if(type.draw==='spore') {
      // Pulsing green circle with tendrils
      const pulse = 1 + 0.15*Math.sin(time*6 + e.spawnTime*3);
      ctx.fillStyle = type.color;
      ctx.shadowColor = type.color;
      ctx.shadowBlur = 8;
      ctx.beginPath(); ctx.arc(0, 0, s*0.4*pulse, 0, Math.PI*2); ctx.fill();
      ctx.shadowBlur = 0;
      // Tendrils
      ctx.strokeStyle = type.color;
      ctx.lineWidth = 1.5;
      for(let i=0;i<5;i++) {
        const a = (Math.PI*2*i/5) + time*2;
        const tx = Math.cos(a)*s*0.7;
        const ty = Math.sin(a)*s*0.7;
        ctx.beginPath(); ctx.moveTo(0,0);
        ctx.quadraticCurveTo(Math.cos(a+0.5)*s*0.4, Math.sin(a+0.5)*s*0.4, tx, ty);
        ctx.stroke();
      }
    } else if(type.draw==='swarmdrone') {
      // Angular small ship shape
      ctx.fillStyle = type.color;
      ctx.beginPath();
      ctx.moveTo(0, -s*0.5);
      ctx.lineTo(-s*0.5, s*0.3);
      ctx.lineTo(-s*0.2, s*0.5);
      ctx.lineTo(s*0.2, s*0.5);
      ctx.lineTo(s*0.5, s*0.3);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = '#666688';
      ctx.fillRect(-s*0.15, -s*0.2, s*0.3, s*0.3);
    } else if(type.draw==='asteroid') {
      // Rough irregular rocky circle
      ctx.fillStyle = type.color;
      ctx.beginPath();
      for(let i=0;i<8;i++) {
        const a = (Math.PI*2*i/8);
        const variance = 0.7 + 0.3*Math.sin(i*2.5 + e.spawnTime);
        const px = Math.cos(a)*s*0.5*variance;
        const py = Math.sin(a)*s*0.5*variance;
        if(i===0) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.closePath();
      ctx.fill();
      // Rocky texture dots
      ctx.fillStyle = '#776644';
      ctx.beginPath(); ctx.arc(-s*0.15, -s*0.1, s*0.1, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#554422';
      ctx.beginPath(); ctx.arc(s*0.1, s*0.15, s*0.08, 0, Math.PI*2); ctx.fill();
    } else if(type.draw==='voidwraith') {
      // Semi-transparent purple ghost entity
      const a = 0.4+0.3*Math.sin(time*4+e.spawnTime);
      ctx.globalAlpha = a;
      ctx.fillStyle = '#9933ff';
      ctx.shadowColor = '#6600cc';
      ctx.shadowBlur = 15;
      ctx.beginPath(); ctx.arc(0, -s*0.2, s*0.5, Math.PI, 0);
      ctx.lineTo(s*0.5, s*0.5);
      for(let i=0;i<5;i++){
        const px = s*0.5 - i*(s/5);
        ctx.lineTo(px - s*0.1, s*0.3 + (i%2)*s*0.2);
      }
      ctx.closePath(); ctx.fill();
      ctx.shadowBlur = 0;
      // Eyes
      ctx.globalAlpha = a + 0.3;
      ctx.fillStyle = '#ff66ff';
      ctx.beginPath(); ctx.arc(-s*0.15,-s*0.2,2.5,0,Math.PI*2); ctx.arc(s*0.15,-s*0.2,2.5,0,Math.PI*2); ctx.fill();
      ctx.globalAlpha = 1;
    } else if(type.draw==='hiveswarm') {
      // Small orange insectoid
      ctx.fillStyle = type.color;
      // Body
      ctx.beginPath(); ctx.ellipse(0, 0, s*0.3, s*0.4, 0, 0, Math.PI*2); ctx.fill();
      // Wings buzzing
      const wingAngle = Math.sin(time*30 + e.spawnTime*5)*0.3;
      ctx.fillStyle = 'rgba(255,170,0,0.4)';
      ctx.beginPath(); ctx.ellipse(-s*0.4, -s*0.1, s*0.3, s*0.15, wingAngle, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(s*0.4, -s*0.1, s*0.3, s*0.15, -wingAngle, 0, Math.PI*2); ctx.fill();
      // Eyes
      ctx.fillStyle = '#ff3300';
      ctx.beginPath(); ctx.arc(-s*0.1,-s*0.2,2,0,Math.PI*2); ctx.arc(s*0.1,-s*0.2,2,0,Math.PI*2); ctx.fill();
    } else if(type.draw==='cosmichorror') {
      // Tentacled mass with glowing red eye
      ctx.fillStyle = '#330033';
      ctx.beginPath(); ctx.arc(0, 0, s*0.55, 0, Math.PI*2); ctx.fill();
      // Tentacles
      ctx.strokeStyle = type.color;
      ctx.lineWidth = 2;
      for(let i=0;i<6;i++) {
        const a = (Math.PI*2*i/6) + time*1.5;
        ctx.beginPath(); ctx.moveTo(0,0);
        const cp1x = Math.cos(a)*s*0.4;
        const cp1y = Math.sin(a)*s*0.4;
        const endX = Math.cos(a + Math.sin(time*3+i)*0.5)*s*0.9;
        const endY = Math.sin(a + Math.sin(time*3+i)*0.5)*s*0.9;
        ctx.quadraticCurveTo(cp1x, cp1y, endX, endY);
        ctx.stroke();
      }
      // Central eye
      ctx.fillStyle = '#ff0066';
      ctx.shadowColor = '#ff0066';
      ctx.shadowBlur = 12;
      ctx.beginPath(); ctx.arc(0, 0, s*0.2, 0, Math.PI*2); ctx.fill();
      ctx.shadowBlur = 0;
      ctx.fillStyle = '#000';
      ctx.beginPath(); ctx.arc(0, 0, s*0.08, 0, Math.PI*2); ctx.fill();
    }
    ctx.restore();
  },
  drawBoss(ctx, e, time) {
    const {x, y, size} = e;
    ctx.save();
    ctx.translate(x, y);
    const s = size;
    ctx.fillStyle = e.type.color;
    ctx.shadowColor = e.type.color;
    ctx.shadowBlur = 30;
    ctx.beginPath(); ctx.arc(0, 0, s, 0, Math.PI*2); ctx.fill();
    ctx.shadowBlur = 0;
    // Inner details
    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.beginPath(); ctx.arc(0, 0, s*0.7, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = e.type.color;
    ctx.beginPath(); ctx.arc(0, 0, s*0.4, 0, Math.PI*2); ctx.fill();
    // Eyes
    ctx.fillStyle = '#ff0000';
    ctx.beginPath();
    ctx.arc(-s*0.2, -s*0.15, s*0.1, 0, Math.PI*2);
    ctx.arc(s*0.2, -s*0.15, s*0.1, 0, Math.PI*2);
    ctx.fill();
    // HP bar
    const hpPct = e.hp / e.maxHp;
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(-s, -s-14, s*2, 8);
    ctx.fillStyle = hpPct > 0.5 ? '#9933ff' : '#ff6600';
    ctx.fillRect(-s, -s-14, s*2*hpPct, 8);
    ctx.strokeStyle = '#888';
    ctx.strokeRect(-s, -s-14, s*2, 8);
    // Name
    ctx.fillStyle = '#ffd700';
    ctx.font = '12px Exo 2';
    ctx.textAlign = 'center';
    ctx.fillText(e.type.name, 0, -s-18);
    ctx.restore();
  },
  drawBackground(ctx, cam, W, H, time) {
    // Deep space
    ctx.fillStyle = THEME.palette.floorBase;
    ctx.fillRect(0, 0, W, H);

    // Nebula gradients (subtle purple/blue)
    const nebula1x = W*0.3 - (cam.x*0.05) % W;
    const nebula1y = H*0.4 - (cam.y*0.05) % H;
    const grd1 = ctx.createRadialGradient(nebula1x, nebula1y, 0, nebula1x, nebula1y, 300);
    grd1.addColorStop(0, 'rgba(80,20,120,0.08)');
    grd1.addColorStop(0.5, 'rgba(40,10,80,0.04)');
    grd1.addColorStop(1, 'transparent');
    ctx.fillStyle = grd1;
    ctx.fillRect(0, 0, W, H);

    const nebula2x = W*0.7 - (cam.x*0.03) % W;
    const nebula2y = H*0.6 - (cam.y*0.03) % H;
    const grd2 = ctx.createRadialGradient(nebula2x, nebula2y, 0, nebula2x, nebula2y, 250);
    grd2.addColorStop(0, 'rgba(20,40,120,0.06)');
    grd2.addColorStop(0.5, 'rgba(10,20,80,0.03)');
    grd2.addColorStop(1, 'transparent');
    ctx.fillStyle = grd2;
    ctx.fillRect(0, 0, W, H);

    // Parallax starfield - layer 1 (distant, small, dim)
    ctx.fillStyle = 'rgba(200,210,240,0.3)';
    for(let i = 0; i < 80; i++) {
      const sx = ((i * 347 + 50) % 1600) - (cam.x * 0.1) % 1600;
      const sy = ((i * 521 + 80) % 1200) - (cam.y * 0.1) % 1200;
      const nx = ((sx % 1600) + 1600) % 1600;
      const ny = ((sy % 1200) + 1200) % 1200;
      if(nx < W && ny < H) {
        ctx.fillRect(nx, ny, 1, 1);
      }
    }

    // Parallax starfield - layer 2 (mid, medium)
    ctx.fillStyle = 'rgba(220,225,250,0.5)';
    for(let i = 0; i < 50; i++) {
      const sx = ((i * 233 + 120) % 1400) - (cam.x * 0.3) % 1400;
      const sy = ((i * 419 + 170) % 1000) - (cam.y * 0.3) % 1000;
      const nx = ((sx % 1400) + 1400) % 1400;
      const ny = ((sy % 1000) + 1000) % 1000;
      if(nx < W && ny < H) {
        ctx.beginPath(); ctx.arc(nx, ny, 1.2, 0, Math.PI*2); ctx.fill();
      }
    }

    // Parallax starfield - layer 3 (near, bright, larger)
    for(let i = 0; i < 30; i++) {
      const sx = ((i * 179 + 200) % 1200) - (cam.x * 0.6) % 1200;
      const sy = ((i * 311 + 260) % 900) - (cam.y * 0.6) % 900;
      const nx = ((sx % 1200) + 1200) % 1200;
      const ny = ((sy % 900) + 900) % 900;
      if(nx < W && ny < H) {
        const twinkle = 0.5 + 0.5*Math.sin(time*2 + i*1.7);
        ctx.fillStyle = `rgba(240,240,255,${0.4 + twinkle*0.4})`;
        ctx.beginPath(); ctx.arc(nx, ny, 1.5 + twinkle*0.5, 0, Math.PI*2); ctx.fill();
      }
    }
  },
  drawProjectile(ctx, p) {
    ctx.save();
    ctx.translate(p.x, p.y);
    if(p.weaponType === 'projectile') {
      // Blue-white plasma bolt
      ctx.fillStyle = '#88ccff';
      ctx.shadowColor = '#3388ff'; ctx.shadowBlur = 12;
      ctx.beginPath(); ctx.arc(0,0,4+p.level,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = '#ffffff';
      ctx.beginPath(); ctx.arc(0,0,2+p.level*0.5,0,Math.PI*2); ctx.fill();
    } else if(p.weaponType === 'chain') {
      // Purple energy tether
      ctx.strokeStyle = '#bb66ff';
      ctx.shadowColor = '#9933ff'; ctx.shadowBlur = 12;
      ctx.lineWidth = 2 + p.level;
      ctx.beginPath(); ctx.moveTo(-8,0); ctx.lineTo(8,0); ctx.stroke();
    } else if(p.weaponType === 'rain') {
      // Orange comet trail
      ctx.fillStyle = '#ffaa33';
      ctx.shadowColor = '#ff6600'; ctx.shadowBlur = 15;
      ctx.beginPath(); ctx.arc(0,0,6+p.level*2,0,Math.PI*2); ctx.fill();
      // Tail
      ctx.fillStyle = 'rgba(255,100,0,0.4)';
      ctx.beginPath(); ctx.arc(0,-4,4+p.level,0,Math.PI*2); ctx.fill();
    } else if(p.weaponType === 'boomerang') {
      // Golden spinning disc
      ctx.fillStyle = '#ffd700';
      ctx.shadowColor = '#ffd700'; ctx.shadowBlur = 8;
      ctx.rotate(p.angle || 0);
      ctx.beginPath();
      ctx.arc(0,-4,5+p.level,0,Math.PI);
      ctx.arc(0,4,5+p.level,Math.PI,0);
      ctx.fill();
    }
    ctx.restore();
  },
  drawGem(ctx, g, time) {
    const pulse = 1 + 0.15*Math.sin(time*5 + g.x);
    ctx.save();
    ctx.translate(g.x, g.y);
    ctx.scale(pulse, pulse);
    ctx.fillStyle = g.value > 5 ? '#ffd700' : g.value > 2 ? '#33ff88' : '#9933ff';
    ctx.shadowColor = ctx.fillStyle; ctx.shadowBlur = 8;
    // Star shape
    ctx.beginPath();
    for(let i=0;i<5;i++) {
      const outerA = (Math.PI*2*i/5) - Math.PI/2;
      const innerA = outerA + Math.PI/5;
      ctx.lineTo(Math.cos(outerA)*6, Math.sin(outerA)*6);
      ctx.lineTo(Math.cos(innerA)*3, Math.sin(innerA)*3);
    }
    ctx.closePath(); ctx.fill();
    ctx.restore();
  }
};
</script>
<script src="engine.js"></script>
</body>
</html>
