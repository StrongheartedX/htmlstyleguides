<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terraform â€” Tech Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           CONSTRUCTIVISM DESIGN SYSTEM
           Terraform Tech Guide
           ============================================
           Bold geometric forms. Diagonal energy.
           Red/black/cream contrasts.
           Industrial, utilitarian, purposeful.
           ============================================ */

        :root {
            /* Constructivist Colors */
            --red: #CC0000;
            --red-dark: #990000;
            --black: #0A0A0A;
            --white: #F5F5F0;
            --cream: #E8E4DC;
            --ochre: #C4A35A;
            --grey-industrial: #4A4A4A;
            --grey-steel: #6B6B6B;
            --grey-concrete: #8C8C8C;

            /* Semantic */
            --text-primary: var(--black);
            --text-inverted: var(--white);
            --text-muted: var(--grey-steel);
            --bg-primary: var(--cream);
            --bg-dark: var(--black);
            --accent: var(--red);

            /* Typography */
            --font-display: 'Bebas Neue', Impact, sans-serif;
            --font-heading: 'Oswald', 'Arial Narrow', sans-serif;
            --font-body: 'Roboto Condensed', 'Arial Narrow', sans-serif;
            --font-mono: 'Share Tech Mono', monospace;

            /* Spacing (8px base) */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 16px;
            --space-4: 24px;
            --space-5: 32px;
            --space-6: 48px;
            --space-7: 64px;
            --space-8: 96px;

            /* Angles */
            --angle-sharp: -15deg;
            --angle-medium: -8deg;
            --angle-subtle: -3deg;

            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-base: 0.3s ease;

            /* Layout */
            --container-max: 1100px;
            --nav-height: 52px;
        }

        /* ============================================
           RESET & BASE
           ============================================ */

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            scroll-padding-top: 60px;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: var(--font-body);
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
            overflow-x: hidden;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--red);
            border: 2px solid var(--black);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--red-dark);
        }

        /* ============================================
           CONTAINER
           ============================================ */

        .container {
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 var(--space-5);
        }

        /* ============================================
           BACK LINK
           ============================================ */

        .back-link {
            display: inline-block;
            font-family: var(--font-heading);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--grey-steel);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: var(--space-3) 0;
            transition: color var(--transition-fast);
        }

        .back-link:hover {
            color: var(--red);
        }

        /* ============================================
           HEADER
           ============================================ */

        .page-header {
            background: var(--black);
            color: var(--white);
            padding: var(--space-7) 0 var(--space-6);
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: -80px;
            width: 350px;
            height: 100%;
            background: var(--red);
            transform: skewX(-15deg);
        }

        .page-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--red);
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-label {
            display: inline-block;
            background: var(--red);
            color: var(--white);
            padding: var(--space-1) var(--space-3);
            font-family: var(--font-heading);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            transform: skewX(-5deg);
            margin-bottom: var(--space-4);
        }

        .header-label span {
            display: inline-block;
            transform: skewX(5deg);
        }

        .page-title {
            font-family: var(--font-display);
            font-size: clamp(4rem, 12vw, 8rem);
            letter-spacing: 0.05em;
            line-height: 0.9;
            margin-bottom: var(--space-3);
        }

        .page-tagline {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.8;
            max-width: 500px;
        }

        .header-wedge {
            position: absolute;
            top: 50%;
            right: 12%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 60px solid transparent;
            border-bottom: 60px solid transparent;
            border-left: 100px solid rgba(255,255,255,0.1);
            z-index: 1;
        }

        .header-circle {
            position: absolute;
            top: 15%;
            right: 28%;
            width: 100px;
            height: 100px;
            border: 6px solid var(--white);
            border-radius: 50%;
            opacity: 0.15;
            z-index: 1;
        }

        /* ============================================
           JUMP NAVIGATION
           ============================================ */

        .jump-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 0;
            padding: 0;
            background: var(--black);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            white-space: nowrap;
            border-bottom: 3px solid var(--red);
            scrollbar-width: none;
        }
        .jump-nav::-webkit-scrollbar { display: none; }

        .jump-nav a {
            display: inline-block;
            padding: var(--space-3) var(--space-3);
            font-family: var(--font-heading);
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--grey-concrete);
            text-decoration: none;
            transition: color var(--transition-fast), background var(--transition-fast);
            flex-shrink: 0;
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
        }

        .jump-nav a:hover {
            color: var(--white);
            background: rgba(204, 0, 0, 0.2);
            border-bottom-color: var(--red);
        }

        /* ============================================
           SECTIONS
           ============================================ */

        .section {
            padding: var(--space-7) 0;
            position: relative;
        }

        .section + .section {
            border-top: 3px solid var(--black);
        }

        .section-dark {
            background: var(--black);
            color: var(--white);
            margin-left: calc(-50vw + 50%);
            margin-right: calc(-50vw + 50%);
            padding-left: calc(50vw - 50%);
            padding-right: calc(50vw - 50%);
        }

        .section-dark + .section {
            border-top: none;
        }

        .section + .section-dark {
            border-top: none;
        }

        .section-header {
            margin-bottom: var(--space-6);
            position: relative;
        }

        .section-number {
            font-family: var(--font-display);
            font-size: 8rem;
            color: var(--red);
            opacity: 0.15;
            position: absolute;
            top: -40px;
            left: -20px;
            line-height: 1;
            z-index: 0;
            pointer-events: none;
        }

        .section-dark .section-number {
            color: var(--red);
            opacity: 0.25;
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            line-height: 1;
            position: relative;
            z-index: 1;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 5px;
            background: var(--red);
            margin-top: var(--space-2);
            transform: skewX(-15deg);
        }

        .section-dark .section-title::after {
            background: var(--white);
        }

        .section-description {
            font-size: 1.1rem;
            color: var(--grey-steel);
            max-width: 60ch;
            margin-top: var(--space-3);
            position: relative;
            z-index: 1;
        }

        .section-dark .section-description {
            color: var(--grey-concrete);
        }

        /* ============================================
           SUBSECTIONS
           ============================================ */

        .subsection {
            margin-bottom: var(--space-6);
        }

        .subsection:last-child {
            margin-bottom: 0;
        }

        .subsection-title {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-primary);
            margin-bottom: var(--space-4);
            padding-left: var(--space-3);
            border-left: 4px solid var(--red);
        }

        .section-dark .subsection-title {
            color: var(--white);
            border-left-color: var(--ochre);
        }

        /* ============================================
           CODE BLOCKS
           ============================================ */

        pre {
            background: var(--black);
            border: none;
            border-left: 4px solid var(--red);
            border-radius: 0;
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            overflow-x: auto;
            position: relative;
        }

        .section-dark pre {
            background: #151515;
            border-left-color: var(--ochre);
        }

        pre code {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            line-height: 1.6;
            color: var(--white);
            display: block;
        }

        /* Inline code */
        code {
            font-family: var(--font-mono);
            font-size: 0.875em;
            background: rgba(10, 10, 10, 0.08);
            color: var(--red-dark);
            padding: 2px 6px;
        }

        .section-dark code {
            background: rgba(245, 245, 240, 0.1);
            color: var(--ochre);
        }

        pre code {
            background: none;
            color: var(--white);
            padding: 0;
        }

        /* Syntax-style coloring for comments in code blocks */
        .code-comment {
            color: var(--grey-concrete);
        }

        .code-keyword {
            color: var(--red);
        }

        .code-string {
            color: var(--ochre);
        }

        .code-value {
            color: #7EC8E3;
        }

        /* ============================================
           TABLES
           ============================================ */

        .table-wrapper {
            border: 3px solid var(--black);
            overflow-x: auto;
            position: relative;
            margin-bottom: var(--space-4);
        }

        .table-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--red);
            z-index: 1;
        }

        .section-dark .table-wrapper {
            border-color: var(--grey-industrial);
        }

        .section-dark .table-wrapper::before {
            background: var(--ochre);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid rgba(10, 10, 10, 0.1);
        }

        th {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            background: var(--black);
            color: var(--white);
            border-bottom: none;
        }

        .section-dark th {
            background: #1a1a1a;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:nth-child(even) {
            background: rgba(10, 10, 10, 0.03);
        }

        .section-dark tbody tr:nth-child(even) {
            background: rgba(245, 245, 240, 0.03);
        }

        .section-dark td {
            border-bottom-color: rgba(245, 245, 240, 0.08);
        }

        tbody tr:hover td {
            background: rgba(204, 0, 0, 0.04);
        }

        .section-dark tbody tr:hover td {
            background: rgba(204, 0, 0, 0.08);
        }

        td code {
            font-size: 0.8rem;
        }

        /* ============================================
           COMMAND GRID
           ============================================ */

        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .command-card {
            background: var(--white);
            border: 3px solid var(--black);
            padding: var(--space-4);
            position: relative;
            overflow: hidden;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .command-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--red);
        }

        .command-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 var(--black);
        }

        .section-dark .command-card {
            background: #1a1a1a;
            border-color: var(--grey-industrial);
        }

        .section-dark .command-card::before {
            background: var(--ochre);
        }

        .command-card h4 {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--red);
            margin-bottom: var(--space-2);
        }

        .section-dark .command-card h4 {
            color: var(--ochre);
        }

        .command-card code {
            display: block;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--black);
            background: rgba(10, 10, 10, 0.06);
            padding: var(--space-2) var(--space-3);
            margin-bottom: var(--space-2);
        }

        .section-dark .command-card code {
            color: var(--white);
            background: rgba(245, 245, 240, 0.06);
        }

        .command-card p {
            font-size: 0.85rem;
            color: var(--grey-steel);
            margin: 0;
            line-height: 1.4;
        }

        .section-dark .command-card p {
            color: var(--grey-concrete);
        }

        /* ============================================
           ALERT BOXES
           ============================================ */

        .alert {
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            position: relative;
            border: 3px solid var(--black);
            border-left: none;
            overflow: hidden;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            transform: skewX(-3deg);
        }

        .alert::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 100%;
            opacity: 0.06;
            transform: skewX(-15deg) translateX(20px);
        }

        .alert-title {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: var(--space-2);
        }

        .alert p {
            font-size: 0.9rem;
            margin: 0;
            position: relative;
            z-index: 1;
        }

        .alert code {
            font-size: 0.8rem;
        }

        /* Info - ochre */
        .alert-info {
            background: rgba(196, 163, 90, 0.08);
        }

        .alert-info::before {
            background: var(--ochre);
        }

        .alert-info::after {
            background: var(--ochre);
        }

        .alert-info .alert-title {
            color: var(--ochre);
        }

        /* Warning - red */
        .alert-warning {
            background: rgba(204, 0, 0, 0.05);
        }

        .alert-warning::before {
            background: var(--red);
        }

        .alert-warning::after {
            background: var(--red);
        }

        .alert-warning .alert-title {
            color: var(--red);
        }

        /* Tip - industrial grey */
        .alert-tip {
            background: rgba(74, 74, 74, 0.06);
        }

        .alert-tip::before {
            background: var(--grey-industrial);
        }

        .alert-tip::after {
            background: var(--grey-industrial);
        }

        .alert-tip .alert-title {
            color: var(--grey-industrial);
        }

        /* Dark section alert variants */
        .section-dark .alert {
            border-color: var(--grey-industrial);
        }

        .section-dark .alert-info {
            background: rgba(196, 163, 90, 0.1);
        }

        .section-dark .alert-warning {
            background: rgba(204, 0, 0, 0.1);
        }

        .section-dark .alert-tip {
            background: rgba(140, 140, 140, 0.1);
        }

        /* ============================================
           BADGES
           ============================================ */

        .badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-3);
            font-family: var(--font-heading);
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transform: skewX(-10deg);
        }

        .badge span {
            display: inline-block;
            transform: skewX(10deg);
        }

        .badge-red {
            background: var(--red);
            color: var(--white);
        }

        .badge-black {
            background: var(--black);
            color: var(--white);
        }

        .badge-ochre {
            background: var(--ochre);
            color: var(--black);
        }

        .badge-outline {
            background: transparent;
            border: 2px solid var(--black);
            color: var(--black);
        }

        .section-dark .badge-outline {
            border-color: var(--white);
            color: var(--white);
        }

        /* ============================================
           PARAGRAPH & TEXT HELPERS
           ============================================ */

        p {
            margin-bottom: var(--space-3);
            max-width: 72ch;
        }

        p:last-child {
            margin-bottom: 0;
        }

        strong {
            font-weight: 700;
        }

        .text-muted {
            color: var(--grey-steel);
        }

        .section-dark .text-muted {
            color: var(--grey-concrete);
        }

        /* ============================================
           DIAGONAL STRIPE DECORATION
           ============================================ */

        .diagonal-stripe {
            height: 8px;
            background: repeating-linear-gradient(
                -45deg,
                var(--red),
                var(--red) 6px,
                var(--black) 6px,
                var(--black) 12px
            );
            margin: var(--space-6) 0;
        }

        /* ============================================
           FOOTER
           ============================================ */

        .site-footer {
            background: var(--black);
            color: var(--white);
            padding: var(--space-6) 0;
            position: relative;
            overflow: hidden;
        }

        .site-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--red);
        }

        .site-footer::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: -80px;
            width: 250px;
            height: 100%;
            background: var(--red);
            opacity: 0.15;
            transform: skewX(-15deg);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .footer-content a {
            font-family: var(--font-heading);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--grey-concrete);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: color var(--transition-fast);
        }

        .footer-content a:hover {
            color: var(--red);
        }

        .footer-title {
            font-family: var(--font-display);
            font-size: 2rem;
            letter-spacing: 0.1em;
        }

        .footer-subtitle {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0.5;
        }

        /* ============================================
           RESPONSIVE
           ============================================ */

        @media (max-width: 768px) {
            .jump-nav { justify-content: flex-start; }

            .container {
                padding: 0 var(--space-3);
            }

            .page-header::before {
                width: 200px;
                right: -100px;
            }

            .header-wedge,
            .header-circle {
                display: none;
            }

            .page-title {
                font-size: clamp(1.75rem, 15vw, 5rem);
            }

            .section {
                padding: var(--space-6) 0;
            }

            .section-number {
                font-size: 5rem;
                top: -25px;
                left: -10px;
            }

            .section-title {
                font-size: 1.75rem;
            }

            .command-grid {
                grid-template-columns: 1fr;
            }

            .jump-nav a {
                padding: var(--space-2) var(--space-3);
                font-size: 0.65rem;
            }

            pre {
                padding: var(--space-3);
                font-size: 0.8rem;
            }

            pre code {
                font-size: 0.8rem;
            }

            .table-wrapper {
                border-width: 2px;
            }

            th, td {
                padding: var(--space-2) var(--space-3);
                font-size: 0.85rem;
            }

            .footer-content {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .command-grid {
                grid-template-columns: 1fr;
            }

            pre code {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>

    <!-- Back Link -->
    <div class="container">
        <a href="index.html" class="back-link">&larr; Tech Guides</a>
    </div>

    <!-- Header -->
    <header class="page-header">
        <div class="header-wedge"></div>
        <div class="header-circle"></div>
        <div class="container">
            <div class="header-content">
                <div class="header-label"><span>Infrastructure as Code</span></div>
                <h1 class="page-title">TERRAFORM</h1>
                <p class="page-tagline">Declarative infrastructure. Immutable deployments.<br>Plan, apply, destroy.</p>
            </div>
        </div>
    </header>

    <!-- Jump Navigation -->
    <nav class="jump-nav">
        <a href="#cheatsheet">Cheat Sheet</a>
        <a href="#installation">Installation</a>
        <a href="#hcl">HCL</a>
        <a href="#resources">Resources</a>
        <a href="#state">State</a>
        <a href="#modules">Modules</a>
        <a href="#providers">Providers</a>
        <a href="#workspaces">Workspaces</a>
        <a href="#advanced">Advanced</a>
        <a href="#testing">Testing</a>
        <a href="#troubleshooting">Troubleshoot</a>
        <a href="#tips">Tips</a>
    </nav>

    <div class="container">

        <!-- ============================================
             SECTION 01: QUICK REFERENCE
             ============================================ -->
        <section id="cheatsheet" class="section">
            <div class="section-header">
                <span class="section-number">01</span>
                <h2 class="section-title">Quick Reference</h2>
                <p class="section-description">Essential Terraform commands at a glance. The core workflow and every tool you need for day-to-day infrastructure management.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Core Workflow</h3>
                <div class="command-grid">
                    <div class="command-card">
                        <h4>Initialize</h4>
                        <code>terraform init</code>
                        <p>Download providers, initialize backend, install modules. Run first in any new configuration directory.</p>
                    </div>
                    <div class="command-card">
                        <h4>Init &mdash; Upgrade</h4>
                        <code>terraform init -upgrade</code>
                        <p>Re-initialize and upgrade all providers and modules to the latest allowed versions.</p>
                    </div>
                    <div class="command-card">
                        <h4>Plan</h4>
                        <code>terraform plan</code>
                        <p>Preview changes Terraform will make. Shows additions, modifications, and destructions without applying.</p>
                    </div>
                    <div class="command-card">
                        <h4>Plan &mdash; Save</h4>
                        <code>terraform plan -out=tfplan</code>
                        <p>Save the plan to a binary file. Guarantees that <code>apply</code> executes exactly what was reviewed.</p>
                    </div>
                    <div class="command-card">
                        <h4>Apply</h4>
                        <code>terraform apply</code>
                        <p>Execute the planned changes. Prompts for confirmation unless <code>-auto-approve</code> is passed.</p>
                    </div>
                    <div class="command-card">
                        <h4>Apply &mdash; Saved Plan</h4>
                        <code>terraform apply tfplan</code>
                        <p>Apply a previously saved plan file. No confirmation prompt needed since the plan was already reviewed.</p>
                    </div>
                    <div class="command-card">
                        <h4>Apply &mdash; Target</h4>
                        <code>terraform apply -target=aws_instance.web</code>
                        <p>Apply changes to a specific resource only. Useful for debugging but not recommended for production.</p>
                    </div>
                    <div class="command-card">
                        <h4>Destroy</h4>
                        <code>terraform destroy</code>
                        <p>Tear down all managed infrastructure. Prompts for confirmation. Use <code>-target</code> for selective destruction.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Code Quality</h3>
                <div class="command-grid">
                    <div class="command-card">
                        <h4>Format</h4>
                        <code>terraform fmt</code>
                        <p>Rewrite configuration files to canonical HCL style. Add <code>-recursive</code> for all subdirectories.</p>
                    </div>
                    <div class="command-card">
                        <h4>Format &mdash; Check</h4>
                        <code>terraform fmt -check</code>
                        <p>Check if files are formatted without modifying them. Returns non-zero exit code if changes needed. Ideal for CI.</p>
                    </div>
                    <div class="command-card">
                        <h4>Validate</h4>
                        <code>terraform validate</code>
                        <p>Check configuration for syntax errors and internal consistency. Does not access remote state or providers.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">State Commands</h3>
                <div class="command-grid">
                    <div class="command-card">
                        <h4>List Resources</h4>
                        <code>terraform state list</code>
                        <p>Show all resources tracked in the current state file. Filter with address patterns.</p>
                    </div>
                    <div class="command-card">
                        <h4>Show Resource</h4>
                        <code>terraform state show aws_instance.web</code>
                        <p>Display detailed attributes of a single resource in state. Includes all computed values.</p>
                    </div>
                    <div class="command-card">
                        <h4>Move Resource</h4>
                        <code>terraform state mv old_name new_name</code>
                        <p>Rename a resource in state without destroying and recreating. Works across modules too.</p>
                    </div>
                    <div class="command-card">
                        <h4>Remove from State</h4>
                        <code>terraform state rm aws_instance.web</code>
                        <p>Remove a resource from state without destroying the real infrastructure. Use to stop managing a resource.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Import &amp; Output</h3>
                <div class="command-grid">
                    <div class="command-card">
                        <h4>Import</h4>
                        <code>terraform import aws_instance.web i-abc123</code>
                        <p>Bring existing infrastructure under Terraform management. You must write the corresponding resource block first.</p>
                    </div>
                    <div class="command-card">
                        <h4>Generate Import Block</h4>
                        <code>terraform plan -generate-config-out=gen.tf</code>
                        <p>Generate HCL configuration for import blocks. Requires Terraform 1.5+ with <code>import {}</code> blocks defined.</p>
                    </div>
                    <div class="command-card">
                        <h4>Show Outputs</h4>
                        <code>terraform output</code>
                        <p>Display all output values. Add <code>-json</code> for machine-readable format or <code>-raw</code> for unquoted strings.</p>
                    </div>
                    <div class="command-card">
                        <h4>Specific Output</h4>
                        <code>terraform output db_endpoint</code>
                        <p>Retrieve a single output value. Combine with <code>-raw</code> for use in shell scripts.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Workspace Commands</h3>
                <div class="command-grid">
                    <div class="command-card">
                        <h4>List Workspaces</h4>
                        <code>terraform workspace list</code>
                        <p>Show all workspaces. Current workspace is marked with an asterisk.</p>
                    </div>
                    <div class="command-card">
                        <h4>New Workspace</h4>
                        <code>terraform workspace new staging</code>
                        <p>Create and switch to a new workspace. Each workspace has its own state file.</p>
                    </div>
                    <div class="command-card">
                        <h4>Select Workspace</h4>
                        <code>terraform workspace select production</code>
                        <p>Switch to an existing workspace. Subsequent commands operate against that workspace's state.</p>
                    </div>
                    <div class="command-card">
                        <h4>Show Current</h4>
                        <code>terraform workspace show</code>
                        <p>Print the name of the current workspace. Useful in scripts and CI pipelines.</p>
                    </div>
                </div>
            </div>

            <div class="alert alert-info">
                <div class="alert-title">Modern Replacements</div>
                <p>As of Terraform 1.x, <code>terraform taint</code> is replaced by <code>terraform apply -replace=RESOURCE_ADDRESS</code>. The <code>terraform refresh</code> command is replaced by <code>terraform apply -refresh-only</code>. Both legacy commands still work but are deprecated.</p>
            </div>

        </section>

        <!-- ============================================
             SECTION 02: INSTALLATION & SETUP
             ============================================ -->
        <section id="installation" class="section section-dark">
            <div class="section-header">
                <span class="section-number">02</span>
                <h2 class="section-title">Installation &amp; Setup</h2>
                <p class="section-description">Getting Terraform installed, configuring providers, and setting up remote backends for team collaboration.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Installation Methods</h3>

                <p>Terraform ships as a single binary. Download it for your platform or use a package manager.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Platform</th>
                                <th>Method</th>
                                <th>Command</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>macOS</td>
                                <td>Homebrew</td>
                                <td><code>brew install hashicorp/tap/terraform</code></td>
                            </tr>
                            <tr>
                                <td>Ubuntu / Debian</td>
                                <td>APT</td>
                                <td><code>sudo apt-get install terraform</code></td>
                            </tr>
                            <tr>
                                <td>Windows</td>
                                <td>Chocolatey</td>
                                <td><code>choco install terraform</code></td>
                            </tr>
                            <tr>
                                <td>Any</td>
                                <td>Manual</td>
                                <td>Download from releases.hashicorp.com, unzip, add to PATH</td>
                            </tr>
                            <tr>
                                <td>Any</td>
                                <td>tfenv</td>
                                <td><code>tfenv install 1.9.0 &amp;&amp; tfenv use 1.9.0</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p>For the APT method, you must first add the HashiCorp GPG key and repository:</p>

<pre><code><span class="code-comment"># Add HashiCorp GPG key</span>
wget -O- https://apt.releases.hashicorp.com/gpg | \
  sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg

<span class="code-comment"># Add the repository</span>
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] \
  https://apt.releases.hashicorp.com $(lsb_release -cs) main" | \
  sudo tee /etc/apt/sources.list.d/hashicorp.list

<span class="code-comment"># Update and install</span>
sudo apt-get update &amp;&amp; sudo apt-get install terraform

<span class="code-comment"># Verify</span>
terraform version</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Version Management</div>
                    <p>Use <code>tfenv</code> to manage multiple Terraform versions. Add a <code>.terraform-version</code> file to your project root to pin the version per project: <code>echo "1.9.0" > .terraform-version</code></p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Provider Configuration</h3>

                <p>Every Terraform project declares the providers it requires in a <code>required_providers</code> block. This tells Terraform where to download the provider plugin and which versions are acceptable.</p>

<pre><code><span class="code-comment"># terraform.tf or versions.tf</span>
terraform {
  required_version = <span class="code-string">">= 1.5.0"</span>

  required_providers {
    aws = {
      source  = <span class="code-string">"hashicorp/aws"</span>
      version = <span class="code-string">"~> 5.0"</span>
    }
    random = {
      source  = <span class="code-string">"hashicorp/random"</span>
      version = <span class="code-string">"~> 3.6"</span>
    }
  }
}

<span class="code-comment"># Provider configuration with region and default tags</span>
provider <span class="code-string">"aws"</span> {
  region = <span class="code-string">"us-east-1"</span>

  default_tags {
    tags = {
      Environment = <span class="code-string">"production"</span>
      ManagedBy   = <span class="code-string">"terraform"</span>
    }
  }
}</code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Version Constraints</div>
                    <p><code>~> 5.0</code> means any version <code>>= 5.0</code> and <code>&lt; 6.0</code> (pessimistic constraint). Use <code>= 5.31.0</code> for an exact pin, or <code>>= 5.0, &lt; 5.50</code> for a custom range. The <code>~></code> operator is the most common choice for production.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Backend Configuration</h3>

                <p>Remote backends store state outside your local filesystem, enabling team collaboration and state locking. The most common setups:</p>

<pre><code><span class="code-comment"># AWS S3 backend with DynamoDB locking</span>
terraform {
  backend <span class="code-string">"s3"</span> {
    bucket         = <span class="code-string">"my-terraform-state"</span>
    key            = <span class="code-string">"prod/network/terraform.tfstate"</span>
    region         = <span class="code-string">"us-east-1"</span>
    dynamodb_table = <span class="code-string">"terraform-locks"</span>
    encrypt        = <span class="code-value">true</span>
  }
}</code></pre>

<pre><code><span class="code-comment"># Azure Blob Storage backend</span>
terraform {
  backend <span class="code-string">"azurerm"</span> {
    resource_group_name  = <span class="code-string">"tfstate-rg"</span>
    storage_account_name = <span class="code-string">"tfstateaccount"</span>
    container_name       = <span class="code-string">"tfstate"</span>
    key                  = <span class="code-string">"prod.terraform.tfstate"</span>
  }
}</code></pre>

<pre><code><span class="code-comment"># Google Cloud Storage backend</span>
terraform {
  backend <span class="code-string">"gcs"</span> {
    bucket = <span class="code-string">"my-terraform-state"</span>
    prefix = <span class="code-string">"terraform/state"</span>
  }
}</code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">Critical</div>
                    <p>Never store state files in version control. They may contain sensitive values like passwords and API keys in plaintext. Always use a remote backend with encryption enabled for anything beyond local experimentation.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Init Workflow</h3>

                <p>The <code>terraform init</code> command is the first command you run in any Terraform configuration directory. It performs three main tasks:</p>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>1. Backend Init</h4>
                        <code>terraform init</code>
                        <p>Configures the backend for state storage. Creates the <code>.terraform/</code> directory. Prompts if migrating between backends.</p>
                    </div>
                    <div class="command-card">
                        <h4>2. Provider Install</h4>
                        <code>terraform init</code>
                        <p>Downloads provider plugins matching version constraints. Stored in <code>.terraform/providers/</code>.</p>
                    </div>
                    <div class="command-card">
                        <h4>3. Module Install</h4>
                        <code>terraform init</code>
                        <p>Downloads referenced modules from registries or Git. Stored in <code>.terraform/modules/</code>.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Version Pinning</h3>

                <p>After <code>terraform init</code>, Terraform creates a <code>.terraform.lock.hcl</code> file that records the exact provider versions and checksums selected. Commit this file to version control.</p>

<pre><code><span class="code-comment"># .terraform.lock.hcl (auto-generated, commit to VCS)</span>
provider <span class="code-string">"registry.terraform.io/hashicorp/aws"</span> {
  version     = <span class="code-string">"5.31.0"</span>
  constraints = <span class="code-string">"~> 5.0"</span>
  hashes = [
    <span class="code-string">"h1:abc123..."</span>,
    <span class="code-string">"zh:def456..."</span>,
  ]
}

<span class="code-comment"># .gitignore for Terraform projects</span>
.terraform/
*.tfstate
*.tfstate.*
*.tfplan
crash.log
override.tf
override.tf.json
*_override.tf
*_override.tf.json</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Lock File Maintenance</div>
                    <p>Run <code>terraform init -upgrade</code> to update the lock file to the latest allowed versions. Always review the diff in the lock file before committing &mdash; it shows exactly which versions changed.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 03: HCL FUNDAMENTALS
             ============================================ -->
        <section id="hcl" class="section">
            <div class="section-header">
                <span class="section-number">03</span>
                <h2 class="section-title">HCL Fundamentals</h2>
                <p class="section-description">HashiCorp Configuration Language &mdash; the declarative syntax at the heart of every Terraform configuration. Types, variables, locals, outputs, functions, and expressions.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Syntax Basics</h3>

                <p>HCL uses a block-based syntax. Every configuration element is either an <strong>argument</strong> (key-value assignment) or a <strong>block</strong> (a labeled container for other arguments and blocks).</p>

<pre><code><span class="code-comment"># Arguments: key = value</span>
ami           = <span class="code-string">"ami-0c55b159cbfafe1f0"</span>
instance_type = <span class="code-string">"t3.micro"</span>
count         = <span class="code-value">3</span>
enabled       = <span class="code-value">true</span>

<span class="code-comment"># Blocks: type "label" "label" { ... }</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  ami           = <span class="code-string">"ami-0c55b159cbfafe1f0"</span>
  instance_type = <span class="code-string">"t3.micro"</span>

  tags = {
    Name = <span class="code-string">"web-server"</span>
  }
}

<span class="code-comment"># Comments</span>
<span class="code-comment"># Single-line comment (hash)</span>
<span class="code-comment">// Single-line comment (double-slash)</span>
<span class="code-comment">/* Multi-line
   comment block */</span></code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Variable Types</h3>

                <p>Terraform supports primitive types and complex collection types. Every variable should declare its type for validation and documentation.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>string</code></td>
                                <td>Unicode text</td>
                                <td><code>"hello"</code></td>
                            </tr>
                            <tr>
                                <td><code>number</code></td>
                                <td>Numeric value (int or float)</td>
                                <td><code>42</code>, <code>3.14</code></td>
                            </tr>
                            <tr>
                                <td><code>bool</code></td>
                                <td>Boolean</td>
                                <td><code>true</code>, <code>false</code></td>
                            </tr>
                            <tr>
                                <td><code>list(type)</code></td>
                                <td>Ordered sequence</td>
                                <td><code>["a", "b", "c"]</code></td>
                            </tr>
                            <tr>
                                <td><code>set(type)</code></td>
                                <td>Unordered unique values</td>
                                <td><code>toset(["a", "b"])</code></td>
                            </tr>
                            <tr>
                                <td><code>map(type)</code></td>
                                <td>Key-value pairs (string keys)</td>
                                <td><code>{ key = "val" }</code></td>
                            </tr>
                            <tr>
                                <td><code>object({...})</code></td>
                                <td>Structured type with named attributes</td>
                                <td><code>{ name = string, port = number }</code></td>
                            </tr>
                            <tr>
                                <td><code>tuple([...])</code></td>
                                <td>Fixed-length sequence with per-element types</td>
                                <td><code>[string, number, bool]</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Variable Blocks</h3>

                <p>Input variables parameterize your configuration. Declare them with type constraints, defaults, descriptions, and validation rules.</p>

<pre><code><span class="code-comment"># Basic variable with default</span>
variable <span class="code-string">"region"</span> {
  description = <span class="code-string">"AWS region for all resources"</span>
  type        = string
  default     = <span class="code-string">"us-east-1"</span>
}

<span class="code-comment"># Required variable (no default)</span>
variable <span class="code-string">"environment"</span> {
  description = <span class="code-string">"Deployment environment name"</span>
  type        = string
}

<span class="code-comment"># Complex type with validation</span>
variable <span class="code-string">"instance_config"</span> {
  description = <span class="code-string">"EC2 instance configuration"</span>
  type = object({
    instance_type = string
    ami_id        = string
    volume_size   = number
    public        = bool
  })

  default = {
    instance_type = <span class="code-string">"t3.micro"</span>
    ami_id        = <span class="code-string">"ami-0c55b159cbfafe1f0"</span>
    volume_size   = <span class="code-value">20</span>
    public        = <span class="code-value">false</span>
  }

  validation {
    condition     = contains([<span class="code-string">"t3.micro"</span>, <span class="code-string">"t3.small"</span>, <span class="code-string">"t3.medium"</span>], var.instance_config.instance_type)
    error_message = <span class="code-string">"Instance type must be t3.micro, t3.small, or t3.medium."</span>
  }
}

<span class="code-comment"># List variable</span>
variable <span class="code-string">"availability_zones"</span> {
  description = <span class="code-string">"AZs to deploy across"</span>
  type        = list(string)
  default     = [<span class="code-string">"us-east-1a"</span>, <span class="code-string">"us-east-1b"</span>, <span class="code-string">"us-east-1c"</span>]
}

<span class="code-comment"># Map variable</span>
variable <span class="code-string">"instance_sizes"</span> {
  description = <span class="code-string">"Instance type per environment"</span>
  type        = map(string)
  default = {
    dev     = <span class="code-string">"t3.micro"</span>
    staging = <span class="code-string">"t3.small"</span>
    prod    = <span class="code-string">"t3.medium"</span>
  }
}

<span class="code-comment"># Sensitive variable</span>
variable <span class="code-string">"db_password"</span> {
  description = <span class="code-string">"Database master password"</span>
  type        = string
  sensitive   = <span class="code-value">true</span>
}</code></pre>

                <p>Set variable values via files, environment variables, or command-line flags:</p>

<pre><code><span class="code-comment"># terraform.tfvars (auto-loaded)</span>
region      = <span class="code-string">"us-west-2"</span>
environment = <span class="code-string">"production"</span>

<span class="code-comment"># Named .tfvars file (loaded with -var-file)</span>
<span class="code-comment"># terraform apply -var-file="prod.tfvars"</span>

<span class="code-comment"># Environment variable (prefix with TF_VAR_)</span>
<span class="code-comment"># export TF_VAR_region="us-west-2"</span>

<span class="code-comment"># Command-line flag</span>
<span class="code-comment"># terraform apply -var="environment=staging"</span></code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Variable Precedence (lowest to highest)</div>
                    <p>Default value &rarr; <code>terraform.tfvars</code> &rarr; <code>*.auto.tfvars</code> (alphabetical) &rarr; <code>-var-file</code> &rarr; <code>-var</code> flag &rarr; <code>TF_VAR_*</code> environment variables. The last value set wins.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Locals</h3>

                <p>Local values are named expressions computed within the module. Use them to reduce repetition and clarify intent. Unlike variables, locals are not configurable by the caller.</p>

<pre><code>locals {
  <span class="code-comment"># Computed name prefix</span>
  name_prefix = <span class="code-string">"${var.project}-${var.environment}"</span>

  <span class="code-comment"># Merged tags</span>
  common_tags = {
    Project     = var.project
    Environment = var.environment
    ManagedBy   = <span class="code-string">"terraform"</span>
    UpdatedAt   = timestamp()
  }

  <span class="code-comment"># Conditional logic</span>
  is_production = var.environment == <span class="code-string">"production"</span>
  instance_type = local.is_production ? <span class="code-string">"t3.large"</span> : <span class="code-string">"t3.micro"</span>

  <span class="code-comment"># Complex computation</span>
  subnet_cidrs = [
    <span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(<span class="code-value">3</span>) : cidrsubnet(var.vpc_cidr, <span class="code-value">8</span>, i)
  ]
}

<span class="code-comment"># Reference locals with local.name</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  instance_type = local.instance_type
  tags          = local.common_tags
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Outputs</h3>

                <p>Output values expose data from your module, making it available to parent modules, the CLI, and remote state data sources.</p>

<pre><code><span class="code-comment"># Simple output</span>
output <span class="code-string">"instance_id"</span> {
  description = <span class="code-string">"EC2 instance ID"</span>
  value       = aws_instance.web.id
}

<span class="code-comment"># Output with a complex value</span>
output <span class="code-string">"instance_info"</span> {
  description = <span class="code-string">"Instance details"</span>
  value = {
    id         = aws_instance.web.id
    public_ip  = aws_instance.web.public_ip
    private_ip = aws_instance.web.private_ip
    az         = aws_instance.web.availability_zone
  }
}

<span class="code-comment"># Sensitive output (hidden in CLI, still in state)</span>
output <span class="code-string">"db_connection_string"</span> {
  description = <span class="code-string">"Database connection URL"</span>
  value       = <span class="code-string">"postgresql://${var.db_user}:${var.db_password}@${aws_db_instance.main.endpoint}/app"</span>
  sensitive   = <span class="code-value">true</span>
}

<span class="code-comment"># Output that depends on a condition</span>
output <span class="code-string">"lb_dns"</span> {
  description = <span class="code-string">"Load balancer DNS name"</span>
  value       = var.create_lb ? aws_lb.main[<span class="code-value">0</span>].dns_name : <span class="code-value">null</span>
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">String Interpolation &amp; Heredocs</h3>

                <p>HCL supports string interpolation with <code>${...}</code> and multiline strings with heredoc syntax.</p>

<pre><code><span class="code-comment"># String interpolation</span>
name = <span class="code-string">"${var.project}-${var.environment}-instance"</span>

<span class="code-comment"># Directive interpolation (conditionals and loops in strings)</span>
greeting = <span class="code-string">"Hello, %{ if var.name != "" }${var.name}%{ else }stranger%{ endif }!"</span>

<span class="code-comment"># Heredoc (indented)</span>
user_data = <span class="code-string">&lt;&lt;-EOF
  #!/bin/bash
  apt-get update
  apt-get install -y nginx
  systemctl start nginx
  echo "Hello from ${var.environment}" > /var/www/html/index.html
EOF</span>

<span class="code-comment"># Heredoc without interpolation (single quotes)</span>
policy = <span class="code-string">&lt;&lt;-'EOF'
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": "s3:GetObject",
        "Resource": "*"
      }
    ]
  }
EOF</span></code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Built-in Functions</h3>

                <p>Terraform includes a rich library of built-in functions. Here are the most essential ones, grouped by category.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Function</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>file(path)</code></td>
                                <td>Filesystem</td>
                                <td>Read file contents as string</td>
                                <td><code>file("scripts/init.sh")</code></td>
                            </tr>
                            <tr>
                                <td><code>templatefile(path, vars)</code></td>
                                <td>Filesystem</td>
                                <td>Render a template with variables</td>
                                <td><code>templatefile("tpl.sh", { port = 8080 })</code></td>
                            </tr>
                            <tr>
                                <td><code>lookup(map, key, default)</code></td>
                                <td>Collection</td>
                                <td>Map lookup with fallback</td>
                                <td><code>lookup(var.sizes, "dev", "t3.micro")</code></td>
                            </tr>
                            <tr>
                                <td><code>merge(maps...)</code></td>
                                <td>Collection</td>
                                <td>Merge multiple maps</td>
                                <td><code>merge(local.tags, { Name = "web" })</code></td>
                            </tr>
                            <tr>
                                <td><code>concat(lists...)</code></td>
                                <td>Collection</td>
                                <td>Combine multiple lists</td>
                                <td><code>concat(var.public, var.private)</code></td>
                            </tr>
                            <tr>
                                <td><code>element(list, idx)</code></td>
                                <td>Collection</td>
                                <td>Get element by index (wraps)</td>
                                <td><code>element(var.azs, count.index)</code></td>
                            </tr>
                            <tr>
                                <td><code>length(val)</code></td>
                                <td>Collection</td>
                                <td>Length of list, map, or string</td>
                                <td><code>length(var.subnets)</code></td>
                            </tr>
                            <tr>
                                <td><code>format(spec, vals...)</code></td>
                                <td>String</td>
                                <td>Printf-style formatting</td>
                                <td><code>format("ip-%s", var.name)</code></td>
                            </tr>
                            <tr>
                                <td><code>join(sep, list)</code></td>
                                <td>String</td>
                                <td>Join list elements</td>
                                <td><code>join(",", var.cidrs)</code></td>
                            </tr>
                            <tr>
                                <td><code>split(sep, string)</code></td>
                                <td>String</td>
                                <td>Split string into list</td>
                                <td><code>split(",", "a,b,c")</code></td>
                            </tr>
                            <tr>
                                <td><code>try(exprs...)</code></td>
                                <td>Error</td>
                                <td>Return first non-error result</td>
                                <td><code>try(var.config.port, 8080)</code></td>
                            </tr>
                            <tr>
                                <td><code>can(expr)</code></td>
                                <td>Error</td>
                                <td>Test if expression is valid</td>
                                <td><code>can(regex("^ami-", var.ami))</code></td>
                            </tr>
                            <tr>
                                <td><code>tostring(val)</code></td>
                                <td>Conversion</td>
                                <td>Convert to string</td>
                                <td><code>tostring(42)</code> &rarr; <code>"42"</code></td>
                            </tr>
                            <tr>
                                <td><code>tonumber(val)</code></td>
                                <td>Conversion</td>
                                <td>Convert to number</td>
                                <td><code>tonumber("42")</code> &rarr; <code>42</code></td>
                            </tr>
                            <tr>
                                <td><code>tolist(val)</code></td>
                                <td>Conversion</td>
                                <td>Convert set to list</td>
                                <td><code>tolist(toset(["b","a"]))</code></td>
                            </tr>
                            <tr>
                                <td><code>tomap(val)</code></td>
                                <td>Conversion</td>
                                <td>Convert to map</td>
                                <td><code>tomap({ a = 1 })</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p>Additional commonly used functions:</p>

<pre><code><span class="code-comment"># Numeric</span>
min(<span class="code-value">5</span>, <span class="code-value">3</span>, <span class="code-value">9</span>)           <span class="code-comment"># 3</span>
max(<span class="code-value">5</span>, <span class="code-value">3</span>, <span class="code-value">9</span>)           <span class="code-comment"># 9</span>
ceil(<span class="code-value">4.3</span>)              <span class="code-comment"># 5</span>
floor(<span class="code-value">4.9</span>)             <span class="code-comment"># 4</span>

<span class="code-comment"># String manipulation</span>
lower(<span class="code-string">"HELLO"</span>)         <span class="code-comment"># "hello"</span>
upper(<span class="code-string">"hello"</span>)         <span class="code-comment"># "HELLO"</span>
replace(<span class="code-string">"hi-there"</span>, <span class="code-string">"-"</span>, <span class="code-string">"_"</span>)  <span class="code-comment"># "hi_there"</span>
trimspace(<span class="code-string">"  hi  "</span>)    <span class="code-comment"># "hi"</span>
substr(<span class="code-string">"hello"</span>, <span class="code-value">0</span>, <span class="code-value">3</span>)  <span class="code-comment"># "hel"</span>
regex(<span class="code-string">"^ami-(.*)"</span>, <span class="code-string">"ami-abc123"</span>)  <span class="code-comment"># ["abc123"]</span>

<span class="code-comment"># Collection operations</span>
flatten([[<span class="code-string">"a"</span>], [<span class="code-string">"b"</span>, <span class="code-string">"c"</span>]])    <span class="code-comment"># ["a", "b", "c"]</span>
zipmap([<span class="code-string">"a"</span>,<span class="code-string">"b"</span>], [<span class="code-value">1</span>,<span class="code-value">2</span>])       <span class="code-comment"># { a=1, b=2 }</span>
keys({ a = <span class="code-value">1</span>, b = <span class="code-value">2</span> })        <span class="code-comment"># ["a", "b"]</span>
values({ a = <span class="code-value">1</span>, b = <span class="code-value">2</span> })      <span class="code-comment"># [1, 2]</span>
contains([<span class="code-string">"a"</span>,<span class="code-string">"b"</span>], <span class="code-string">"a"</span>)       <span class="code-comment"># true</span>
distinct([<span class="code-string">"a"</span>,<span class="code-string">"b"</span>,<span class="code-string">"a"</span>])        <span class="code-comment"># ["a", "b"]</span>
sort([<span class="code-string">"c"</span>,<span class="code-string">"a"</span>,<span class="code-string">"b"</span>])             <span class="code-comment"># ["a", "b", "c"]</span>

<span class="code-comment"># Encoding</span>
jsonencode({ name = <span class="code-string">"app"</span> })    <span class="code-comment"># '{"name":"app"}'</span>
jsondecode(<span class="code-string">"{\"name\":\"app\"}"</span>) <span class="code-comment"># { name = "app" }</span>
base64encode(<span class="code-string">"hello"</span>)           <span class="code-comment"># "aGVsbG8="</span>
base64decode(<span class="code-string">"aGVsbG8="</span>)        <span class="code-comment"># "hello"</span>

<span class="code-comment"># Cryptographic</span>
sha256(<span class="code-string">"content"</span>)               <span class="code-comment"># hex-encoded SHA-256 hash</span>
md5(<span class="code-string">"content"</span>)                  <span class="code-comment"># hex-encoded MD5 hash</span>

<span class="code-comment"># Date/Time</span>
timestamp()                      <span class="code-comment"># "2025-01-15T10:30:00Z"</span>
formatdate(<span class="code-string">"YYYY-MM-DD"</span>, timestamp())</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Terraform Console</h3>

                <p>Use <code>terraform console</code> to interactively test expressions, functions, and variable references against the current state and configuration.</p>

<pre><code><span class="code-comment"># Launch the console</span>
$ terraform console

<span class="code-comment"># Test functions</span>
> length([<span class="code-string">"a"</span>, <span class="code-string">"b"</span>, <span class="code-string">"c"</span>])
<span class="code-value">3</span>

> upper(<span class="code-string">"terraform"</span>)
<span class="code-string">"TERRAFORM"</span>

> cidrsubnet(<span class="code-string">"10.0.0.0/16"</span>, <span class="code-value">8</span>, <span class="code-value">1</span>)
<span class="code-string">"10.0.1.0/24"</span>

<span class="code-comment"># Reference variables</span>
> var.region
<span class="code-string">"us-east-1"</span>

<span class="code-comment"># Reference resources (if state exists)</span>
> aws_instance.web.public_ip
<span class="code-string">"54.123.45.67"</span>

<span class="code-comment"># Test complex expressions</span>
> { <span class="code-keyword">for</span> k, v <span class="code-keyword">in</span> var.instance_sizes : k => upper(v) }
{
  <span class="code-string">"dev"</span>     = <span class="code-string">"T3.MICRO"</span>
  <span class="code-string">"prod"</span>    = <span class="code-string">"T3.MEDIUM"</span>
  <span class="code-string">"staging"</span> = <span class="code-string">"T3.SMALL"</span>
}

<span class="code-comment"># Test try/can</span>
> try(var.missing_var, <span class="code-string">"fallback"</span>)
<span class="code-string">"fallback"</span>

> can(tonumber(<span class="code-string">"hello"</span>))
<span class="code-value">false</span>

<span class="code-comment"># Exit</span>
> exit</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">One-liner Console</div>
                    <p>Pipe expressions directly: <code>echo 'cidrsubnet("10.0.0.0/16", 8, 3)' | terraform console</code>. This is particularly useful in CI scripts or when you need a quick calculation without entering interactive mode.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 04: RESOURCES & DATA SOURCES
             ============================================ -->
        <section id="resources" class="section section-dark">
            <div class="section-header">
                <span class="section-number">04</span>
                <h2 class="section-title">Resources &amp; Data Sources</h2>
                <p class="section-description">The building blocks of every Terraform configuration. Resources create, update, and destroy infrastructure. Data sources query what already exists.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Resource Blocks</h3>

                <p>A resource block declares a piece of infrastructure. Terraform manages the full lifecycle: creation, in-place updates, replacement, and destruction. Each resource has a type (determined by the provider) and a local name used for references within the configuration.</p>

<pre><code><span class="code-comment"># Syntax: resource "TYPE" "LOCAL_NAME" { ... }</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  ami           = <span class="code-string">"ami-0c55b159cbfafe1f0"</span>
  instance_type = <span class="code-string">"t3.micro"</span>
  subnet_id     = aws_subnet.public[<span class="code-value">0</span>].id

  root_block_device {
    volume_size = <span class="code-value">20</span>
    volume_type = <span class="code-string">"gp3"</span>
    encrypted   = <span class="code-value">true</span>
  }

  tags = {
    Name = <span class="code-string">"${local.name_prefix}-web"</span>
  }
}

<span class="code-comment"># Reference attributes: RESOURCE_TYPE.LOCAL_NAME.ATTRIBUTE</span>
output <span class="code-string">"web_ip"</span> {
  value = aws_instance.web.public_ip
}</code></pre>

                <p>When you run <code>terraform apply</code>, Terraform compares the desired state (your HCL) against the current state (the state file). It then calculates the minimum set of API calls needed to reconcile the two. Resources are created if new, updated in-place when possible, or destroyed and recreated when a change forces replacement.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Data Sources</h3>

                <p>Data sources are <strong>read-only</strong> queries to existing infrastructure or external systems. They do not create or modify anything. Use them to look up AMIs, fetch existing VPC IDs, read secrets, or reference resources managed outside your configuration.</p>

<pre><code><span class="code-comment"># Look up the latest Ubuntu AMI</span>
data <span class="code-string">"aws_ami"</span> <span class="code-string">"ubuntu"</span> {
  most_recent = <span class="code-value">true</span>
  owners      = [<span class="code-string">"099720109477"</span>] <span class="code-comment"># Canonical</span>

  filter {
    name   = <span class="code-string">"name"</span>
    values = [<span class="code-string">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span>]
  }

  filter {
    name   = <span class="code-string">"virtualization-type"</span>
    values = [<span class="code-string">"hvm"</span>]
  }
}

<span class="code-comment"># Use the data source result in a resource</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  ami           = data.aws_ami.ubuntu.id
  instance_type = <span class="code-string">"t3.micro"</span>
}

<span class="code-comment"># Fetch an existing VPC by tag</span>
data <span class="code-string">"aws_vpc"</span> <span class="code-string">"main"</span> {
  filter {
    name   = <span class="code-string">"tag:Name"</span>
    values = [<span class="code-string">"production-vpc"</span>]
  }
}

<span class="code-comment"># Read remote state from another project</span>
data <span class="code-string">"terraform_remote_state"</span> <span class="code-string">"network"</span> {
  backend = <span class="code-string">"s3"</span>

  config = {
    bucket = <span class="code-string">"my-terraform-state"</span>
    key    = <span class="code-string">"network/terraform.tfstate"</span>
    region = <span class="code-string">"us-east-1"</span>
  }
}

<span class="code-comment"># Reference: data.terraform_remote_state.network.outputs.vpc_id</span></code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Resources vs Data Sources</div>
                    <p>Resources use <code>resource "type" "name"</code> and are referenced as <code>type.name</code>. Data sources use <code>data "type" "name"</code> and are referenced as <code>data.type.name</code>. Resources manage lifecycle; data sources only read.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Meta-Arguments</h3>

                <p>Meta-arguments are special arguments available on every resource block, regardless of provider. They control how Terraform manages the resource rather than configuring its attributes.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th><code>count</code></th>
                                <th><code>for_each</code></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Input type</td>
                                <td>Integer</td>
                                <td>Map or set of strings</td>
                            </tr>
                            <tr>
                                <td>Access index/key</td>
                                <td><code>count.index</code></td>
                                <td><code>each.key</code> / <code>each.value</code></td>
                            </tr>
                            <tr>
                                <td>Resource address</td>
                                <td><code>type.name[0]</code>, <code>type.name[1]</code></td>
                                <td><code>type.name["key"]</code></td>
                            </tr>
                            <tr>
                                <td>Reordering behavior</td>
                                <td>Removing item 0 shifts all indexes, causing replacement</td>
                                <td>Removing a key only affects that key</td>
                            </tr>
                            <tr>
                                <td>Best for</td>
                                <td>Identical copies, simple conditionals</td>
                                <td>Unique resources from a collection</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

<pre><code><span class="code-comment"># count â€” create multiple identical instances</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"worker"</span> {
  count         = <span class="code-value">3</span>
  ami           = data.aws_ami.ubuntu.id
  instance_type = <span class="code-string">"t3.micro"</span>
  subnet_id     = element(var.subnet_ids, count.index)

  tags = {
    Name = <span class="code-string">"worker-${count.index}"</span>
  }
}

<span class="code-comment"># count as a conditional (0 or 1)</span>
resource <span class="code-string">"aws_lb"</span> <span class="code-string">"main"</span> {
  count = var.create_lb ? <span class="code-value">1</span> : <span class="code-value">0</span>
  name  = <span class="code-string">"${local.name_prefix}-lb"</span>
  <span class="code-comment"># ...</span>
}

<span class="code-comment"># Reference: aws_lb.main[0].dns_name (must check length)</span></code></pre>

<pre><code><span class="code-comment"># for_each with a map â€” create subnets per AZ</span>
resource <span class="code-string">"aws_subnet"</span> <span class="code-string">"private"</span> {
  for_each = {
    <span class="code-string">"us-east-1a"</span> = <span class="code-string">"10.0.1.0/24"</span>
    <span class="code-string">"us-east-1b"</span> = <span class="code-string">"10.0.2.0/24"</span>
    <span class="code-string">"us-east-1c"</span> = <span class="code-string">"10.0.3.0/24"</span>
  }

  vpc_id            = aws_vpc.main.id
  availability_zone = each.key
  cidr_block        = each.value

  tags = {
    Name = <span class="code-string">"private-${each.key}"</span>
  }
}

<span class="code-comment"># for_each with a set of strings</span>
resource <span class="code-string">"aws_iam_user"</span> <span class="code-string">"devs"</span> {
  for_each = toset([<span class="code-string">"alice"</span>, <span class="code-string">"bob"</span>, <span class="code-string">"carol"</span>])
  name     = each.value
}

<span class="code-comment"># Reference: aws_subnet.private["us-east-1a"].id</span></code></pre>

<pre><code><span class="code-comment"># depends_on â€” explicit dependency when Terraform can't infer it</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"app"</span> {
  ami           = data.aws_ami.ubuntu.id
  instance_type = <span class="code-string">"t3.micro"</span>

  <span class="code-comment"># Wait for the IAM role policy to be attached before launching</span>
  depends_on = [aws_iam_role_policy_attachment.app_policy]
}

<span class="code-comment"># provider â€” select a specific provider configuration</span>
provider <span class="code-string">"aws"</span> {
  alias  = <span class="code-string">"west"</span>
  region = <span class="code-string">"us-west-2"</span>
}

resource <span class="code-string">"aws_instance"</span> <span class="code-string">"west_server"</span> {
  provider      = aws.west
  ami           = <span class="code-string">"ami-0abcdef1234567890"</span>
  instance_type = <span class="code-string">"t3.micro"</span>
}</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Prefer for_each Over count</div>
                    <p>Use <code>for_each</code> when each instance is logically distinct. With <code>count</code>, removing an item in the middle shifts all subsequent indexes and forces replacement of those resources. With <code>for_each</code>, each resource is keyed by name, so removals are surgical.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Lifecycle Rules</h3>

                <p>The <code>lifecycle</code> block customizes how Terraform handles resource creation, update, and destruction. Every rule is declared inside a <code>lifecycle { }</code> block within the resource.</p>

<pre><code><span class="code-comment"># create_before_destroy â€” zero-downtime replacements</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  ami           = var.ami_id
  instance_type = <span class="code-string">"t3.micro"</span>

  lifecycle {
    create_before_destroy = <span class="code-value">true</span>
  }
}

<span class="code-comment"># prevent_destroy â€” protect critical resources</span>
resource <span class="code-string">"aws_db_instance"</span> <span class="code-string">"primary"</span> {
  identifier     = <span class="code-string">"production-db"</span>
  engine         = <span class="code-string">"postgres"</span>
  instance_class = <span class="code-string">"db.r6g.xlarge"</span>

  lifecycle {
    prevent_destroy = <span class="code-value">true</span>
  }
}

<span class="code-comment"># ignore_changes â€” ignore external modifications</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"managed"</span> {
  ami           = <span class="code-string">"ami-0c55b159cbfafe1f0"</span>
  instance_type = <span class="code-string">"t3.micro"</span>

  lifecycle {
    <span class="code-comment"># ASG or external process may update these tags</span>
    ignore_changes = [tags, instance_type]
  }
}

<span class="code-comment"># replace_triggered_by â€” force replacement when another resource changes</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"app"</span> {
  ami           = var.ami_id
  instance_type = <span class="code-string">"t3.micro"</span>

  lifecycle {
    replace_triggered_by = [
      null_resource.config_hash.id
    ]
  }
}

<span class="code-comment"># Combining multiple lifecycle rules</span>
resource <span class="code-string">"aws_launch_template"</span> <span class="code-string">"web"</span> {
  name_prefix   = <span class="code-string">"web-"</span>
  image_id      = var.ami_id
  instance_type = <span class="code-string">"t3.micro"</span>

  lifecycle {
    create_before_destroy = <span class="code-value">true</span>
    ignore_changes        = [description]
  }
}</code></pre>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>create_before_destroy</h4>
                        <code>lifecycle { create_before_destroy = true }</code>
                        <p>Create the replacement resource before destroying the old one. Essential for zero-downtime deployments.</p>
                    </div>
                    <div class="command-card">
                        <h4>prevent_destroy</h4>
                        <code>lifecycle { prevent_destroy = true }</code>
                        <p>Terraform will error if a plan would destroy this resource. Protects databases, S3 buckets, and other critical infrastructure.</p>
                    </div>
                    <div class="command-card">
                        <h4>ignore_changes</h4>
                        <code>lifecycle { ignore_changes = [tags] }</code>
                        <p>Ignore specific attribute changes made outside Terraform. Use <code>all</code> to ignore every attribute after initial creation.</p>
                    </div>
                    <div class="command-card">
                        <h4>replace_triggered_by</h4>
                        <code>lifecycle { replace_triggered_by = [res.id] }</code>
                        <p>Force resource replacement when a referenced resource or attribute changes. Added in Terraform 1.2.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Provisioners</h3>

                <p>Provisioners execute scripts on a local or remote machine as part of resource creation or destruction. They are a last resort for bootstrapping that cannot be done through provider-native features.</p>

<pre><code><span class="code-comment"># local-exec â€” run a command on the machine running Terraform</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  ami           = data.aws_ami.ubuntu.id
  instance_type = <span class="code-string">"t3.micro"</span>

  provisioner <span class="code-string">"local-exec"</span> {
    command = <span class="code-string">"echo ${self.private_ip} >> inventory.txt"</span>
  }
}

<span class="code-comment"># remote-exec â€” run commands on the created resource via SSH</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"app"</span> {
  ami           = data.aws_ami.ubuntu.id
  instance_type = <span class="code-string">"t3.micro"</span>
  key_name      = aws_key_pair.deploy.key_name

  connection {
    type        = <span class="code-string">"ssh"</span>
    user        = <span class="code-string">"ubuntu"</span>
    private_key = file(<span class="code-string">"~/.ssh/deploy.pem"</span>)
    host        = self.public_ip
  }

  provisioner <span class="code-string">"remote-exec"</span> {
    inline = [
      <span class="code-string">"sudo apt-get update"</span>,
      <span class="code-string">"sudo apt-get install -y nginx"</span>,
      <span class="code-string">"sudo systemctl start nginx"</span>,
    ]
  }
}</code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">HashiCorp Recommends Avoiding Provisioners</div>
                    <p>Provisioners break the declarative model: they are not reflected in state, cannot be planned, and run only on create (not update). Prefer <code>user_data</code> for EC2 bootstrapping, configuration management tools (Ansible, Chef), or Packer for pre-baked AMIs. Use provisioners only when no provider-native alternative exists.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">terraform_data vs null_resource</h3>

                <p>The <code>terraform_data</code> resource (Terraform 1.4+) is the modern replacement for <code>null_resource</code>. Both serve as generic containers for provisioners and triggers, but <code>terraform_data</code> is built into Terraform core and does not require the <code>hashicorp/null</code> provider.</p>

<pre><code><span class="code-comment"># Legacy approach â€” null_resource (requires null provider)</span>
resource <span class="code-string">"null_resource"</span> <span class="code-string">"config_update"</span> {
  triggers = {
    config_hash = sha256(file(<span class="code-string">"config.yaml"</span>))
  }

  provisioner <span class="code-string">"local-exec"</span> {
    command = <span class="code-string">"./deploy-config.sh"</span>
  }
}

<span class="code-comment"># Modern approach â€” terraform_data (TF 1.4+, no extra provider)</span>
resource <span class="code-string">"terraform_data"</span> <span class="code-string">"config_update"</span> {
  input = sha256(file(<span class="code-string">"config.yaml"</span>))

  provisioner <span class="code-string">"local-exec"</span> {
    command = <span class="code-string">"./deploy-config.sh"</span>
  }
}

<span class="code-comment"># terraform_data with replacement triggers</span>
resource <span class="code-string">"terraform_data"</span> <span class="code-string">"bootstrap"</span> {
  triggers_replace = [
    aws_instance.web.id,
    var.app_version,
  ]

  provisioner <span class="code-string">"local-exec"</span> {
    command = <span class="code-string">"ansible-playbook -i '${aws_instance.web.public_ip},' deploy.yml"</span>
  }
}</code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Migration Path</div>
                    <p>To migrate from <code>null_resource</code> to <code>terraform_data</code>, replace <code>triggers</code> with <code>triggers_replace</code> (which forces recreation) or <code>input</code> (whose value is stored in state and available as <code>output</code>). Then use <code>terraform state mv null_resource.name terraform_data.name</code> to avoid recreation.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 05: STATE MANAGEMENT
             ============================================ -->
        <section id="state" class="section">
            <div class="section-header">
                <span class="section-number">05</span>
                <h2 class="section-title">State Management</h2>
                <p class="section-description">Terraform state is the source of truth that maps your configuration to real-world resources. Understanding state is essential for safe, collaborative infrastructure management.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">What Is State</h3>

                <p>Terraform records every resource it manages in a <strong>state file</strong> (<code>terraform.tfstate</code>). This JSON file maps resource addresses in your configuration to real infrastructure IDs in the cloud. Without state, Terraform would have no way to know which resources it created or what their current attributes are.</p>

                <p>The state file contains:</p>

<pre><code><span class="code-comment"># Simplified structure of terraform.tfstate</span>
{
  <span class="code-string">"version"</span>: <span class="code-value">4</span>,
  <span class="code-string">"terraform_version"</span>: <span class="code-string">"1.9.0"</span>,
  <span class="code-string">"serial"</span>: <span class="code-value">42</span>,
  <span class="code-string">"lineage"</span>: <span class="code-string">"abc-123-def"</span>,
  <span class="code-string">"outputs"</span>: {
    <span class="code-string">"vpc_id"</span>: {
      <span class="code-string">"value"</span>: <span class="code-string">"vpc-0abc123"</span>,
      <span class="code-string">"type"</span>: <span class="code-string">"string"</span>
    }
  },
  <span class="code-string">"resources"</span>: [
    {
      <span class="code-string">"mode"</span>: <span class="code-string">"managed"</span>,
      <span class="code-string">"type"</span>: <span class="code-string">"aws_instance"</span>,
      <span class="code-string">"name"</span>: <span class="code-string">"web"</span>,
      <span class="code-string">"instances"</span>: [{
        <span class="code-string">"attributes"</span>: {
          <span class="code-string">"id"</span>: <span class="code-string">"i-0abc123def456"</span>,
          <span class="code-string">"ami"</span>: <span class="code-string">"ami-0c55b159cbfafe1f0"</span>,
          <span class="code-string">"public_ip"</span>: <span class="code-string">"54.123.45.67"</span>
        }
      }]
    }
  ]
}</code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">State File Security</div>
                    <p>The state file contains <strong>every attribute</strong> of every managed resource, including sensitive values like database passwords, API keys, and TLS private keys &mdash; all in plaintext. Never commit <code>terraform.tfstate</code> to version control. Always use a remote backend with encryption enabled. Restrict access to the state storage bucket/container using IAM policies.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Remote Backends</h3>

                <p>Remote backends store state in a shared, encrypted location. This enables team collaboration and prevents state file conflicts.</p>

<pre><code><span class="code-comment"># AWS S3 + DynamoDB (most common)</span>
terraform {
  backend <span class="code-string">"s3"</span> {
    bucket         = <span class="code-string">"company-terraform-state"</span>
    key            = <span class="code-string">"projects/webapp/terraform.tfstate"</span>
    region         = <span class="code-string">"us-east-1"</span>
    dynamodb_table = <span class="code-string">"terraform-state-locks"</span>
    encrypt        = <span class="code-value">true</span>
  }
}</code></pre>

<pre><code><span class="code-comment"># Azure Blob Storage</span>
terraform {
  backend <span class="code-string">"azurerm"</span> {
    resource_group_name  = <span class="code-string">"terraform-state-rg"</span>
    storage_account_name = <span class="code-string">"tfstatesa"</span>
    container_name       = <span class="code-string">"tfstate"</span>
    key                  = <span class="code-string">"webapp.terraform.tfstate"</span>
  }
}</code></pre>

<pre><code><span class="code-comment"># Google Cloud Storage</span>
terraform {
  backend <span class="code-string">"gcs"</span> {
    bucket = <span class="code-string">"company-terraform-state"</span>
    prefix = <span class="code-string">"webapp"</span>
  }
}</code></pre>

<pre><code><span class="code-comment"># Terraform Cloud / HCP Terraform</span>
terraform {
  cloud {
    organization = <span class="code-string">"my-company"</span>

    workspaces {
      name = <span class="code-string">"webapp-production"</span>
    }
  }
}</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Bootstrap Problem</div>
                    <p>The S3 bucket and DynamoDB table must exist before you can use them as a backend. Bootstrap them with a separate Terraform project that uses a local backend, or create them manually. Some teams use a <code>bootstrap/</code> directory for this purpose.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">State Locking</h3>

                <p>State locking prevents concurrent operations from corrupting the state file. When one user runs <code>terraform apply</code>, the backend acquires a lock. Any other operations against the same state will wait or fail until the lock is released.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Backend</th>
                                <th>Locking Mechanism</th>
                                <th>Automatic</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>S3</td>
                                <td>DynamoDB table (required separately)</td>
                                <td>Yes, if <code>dynamodb_table</code> is set</td>
                            </tr>
                            <tr>
                                <td>Azure Blob</td>
                                <td>Native blob lease</td>
                                <td>Yes</td>
                            </tr>
                            <tr>
                                <td>GCS</td>
                                <td>Native object locking</td>
                                <td>Yes</td>
                            </tr>
                            <tr>
                                <td>Terraform Cloud</td>
                                <td>Built-in run queue</td>
                                <td>Yes</td>
                            </tr>
                            <tr>
                                <td>Consul</td>
                                <td>KV lock sessions</td>
                                <td>Yes</td>
                            </tr>
                            <tr>
                                <td>Local</td>
                                <td>File system lock</td>
                                <td>Yes (single machine only)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

<pre><code><span class="code-comment"># Force-unlock a stuck lock (use with extreme caution)</span>
terraform force-unlock <span class="code-string">LOCK_ID</span>

<span class="code-comment"># The lock ID is shown in the error message when a lock conflict occurs</span>
<span class="code-comment"># Example error:</span>
<span class="code-comment"># Error: Error locking state: Error acquiring the state lock</span>
<span class="code-comment"># Lock Info:</span>
<span class="code-comment">#   ID:        a1b2c3d4-e5f6-7890-abcd-ef1234567890</span>
<span class="code-comment">#   Path:      s3://my-bucket/terraform.tfstate</span>
<span class="code-comment">#   Operation: OperationTypeApply</span>
<span class="code-comment">#   Who:       user@hostname</span>
<span class="code-comment">#   Created:   2025-01-15 10:30:00.000000 +0000 UTC</span></code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">State Commands</h3>

                <p>Terraform provides CLI commands for inspecting and manipulating state directly. These are essential for refactoring, debugging, and disaster recovery.</p>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>List All Resources</h4>
                        <code>terraform state list</code>
                        <p>Show every resource address tracked in the state file. Accepts an optional address filter.</p>
                    </div>
                    <div class="command-card">
                        <h4>Filter by Module</h4>
                        <code>terraform state list module.network</code>
                        <p>List only resources within a specific module. Useful for large configurations.</p>
                    </div>
                    <div class="command-card">
                        <h4>Show Resource Detail</h4>
                        <code>terraform state show aws_instance.web</code>
                        <p>Display all attributes for a single resource as stored in state, including computed values.</p>
                    </div>
                    <div class="command-card">
                        <h4>Move / Rename</h4>
                        <code>terraform state mv aws_instance.old aws_instance.new</code>
                        <p>Rename a resource in state without destroying and recreating it. Also moves between modules.</p>
                    </div>
                    <div class="command-card">
                        <h4>Remove from State</h4>
                        <code>terraform state rm aws_instance.web</code>
                        <p>Stop managing a resource without destroying the real infrastructure. Terraform "forgets" it.</p>
                    </div>
                    <div class="command-card">
                        <h4>Pull Remote State</h4>
                        <code>terraform state pull</code>
                        <p>Download the current remote state and print it to stdout as JSON. Useful for inspection and backup.</p>
                    </div>
                    <div class="command-card">
                        <h4>Push State</h4>
                        <code>terraform state push terraform.tfstate</code>
                        <p>Upload a local state file to the remote backend. Dangerous &mdash; use only for disaster recovery.</p>
                    </div>
                    <div class="command-card">
                        <h4>Replace Provider</h4>
                        <code>terraform state replace-provider old new</code>
                        <p>Update provider references in state. Used when providers are forked or change their registry address.</p>
                    </div>
                </div>

<pre><code><span class="code-comment"># Move a resource into a module</span>
terraform state mv \
  aws_security_group.web \
  module.network.aws_security_group.web

<span class="code-comment"># Move a resource between for_each keys</span>
terraform state mv \
  <span class="code-string">'aws_subnet.private["us-east-1a"]'</span> \
  <span class="code-string">'aws_subnet.private["use1-az1"]'</span>

<span class="code-comment"># Backup state before risky operations</span>
terraform state pull > state-backup-$(date +%Y%m%d).json</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Terraform Import</h3>

                <p>Import brings existing infrastructure under Terraform management. There are two approaches: the legacy CLI import and the modern import block (Terraform 1.5+).</p>

<pre><code><span class="code-comment"># Legacy CLI import (still supported)</span>
<span class="code-comment"># Step 1: Write the resource block in your configuration</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"legacy_server"</span> {
  <span class="code-comment"># Configuration will be filled in after import</span>
}

<span class="code-comment"># Step 2: Run the import command</span>
terraform import aws_instance.legacy_server i-0abc123def456789

<span class="code-comment"># Step 3: Run terraform plan and fill in attributes until plan is clean</span></code></pre>

<pre><code><span class="code-comment"># Modern import blocks (TF 1.5+) â€” declarative and plannable</span>
import {
  to = aws_instance.legacy_server
  id = <span class="code-string">"i-0abc123def456789"</span>
}

import {
  to = aws_s3_bucket.assets
  id = <span class="code-string">"my-company-assets-bucket"</span>
}

<span class="code-comment"># Generate HCL configuration automatically</span>
<span class="code-comment"># (run this after writing the import blocks above)</span>
terraform plan -generate-config-out=generated.tf

<span class="code-comment"># Review generated.tf, clean it up, then:</span>
terraform plan   <span class="code-comment"># should show no changes</span>
terraform apply  <span class="code-comment"># imports into state</span></code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Import Block Advantages</div>
                    <p>Import blocks are declarative: they can be code-reviewed, they appear in <code>terraform plan</code> output, and they can auto-generate configuration with <code>-generate-config-out</code>. The legacy <code>terraform import</code> command is imperative and requires you to manually write the resource configuration.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">State Migration</h3>

                <p>When switching between backends (for example, from local to S3, or from S3 to Terraform Cloud), use the <code>-migrate-state</code> flag during init.</p>

<pre><code><span class="code-comment"># Step 1: Update the backend block in your configuration</span>
terraform {
  backend <span class="code-string">"s3"</span> {
    bucket         = <span class="code-string">"new-state-bucket"</span>
    key            = <span class="code-string">"app/terraform.tfstate"</span>
    region         = <span class="code-string">"us-east-1"</span>
    dynamodb_table = <span class="code-string">"terraform-locks"</span>
    encrypt        = <span class="code-value">true</span>
  }
}

<span class="code-comment"># Step 2: Reinitialize with migration</span>
terraform init -migrate-state

<span class="code-comment"># Terraform will prompt:</span>
<span class="code-comment">#   Do you want to copy existing state to the new backend?</span>
<span class="code-comment">#   Enter "yes" to copy, "no" to start fresh.</span>

<span class="code-comment"># Step 3: Verify state was migrated</span>
terraform state list
terraform plan   <span class="code-comment"># should show no changes</span></code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">Sensitive Data Reminder</div>
                    <p>Always enable encryption on your remote backend. For S3, set <code>encrypt = true</code> and consider using a KMS key (<code>kms_key_id</code>). For Azure, the storage account should have encryption at rest. Mark sensitive outputs with <code>sensitive = true</code> to prevent them from appearing in CLI output, though they are still stored in the state file in plaintext.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 06: MODULES
             ============================================ -->
        <section id="modules" class="section section-dark">
            <div class="section-header">
                <span class="section-number">06</span>
                <h2 class="section-title">Modules</h2>
                <p class="section-description">Reusable, composable packages of Terraform configuration. Modules are the primary mechanism for organizing, encapsulating, and sharing infrastructure code.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Module Structure</h3>

                <p>A well-structured module follows a standard directory layout. Every Terraform directory is implicitly a module &mdash; the root directory is the <strong>root module</strong>, and any module called via a <code>module</code> block is a <strong>child module</strong>.</p>

<pre><code><span class="code-comment"># Standard module directory layout</span>
modules/
  vpc/
    main.tf           <span class="code-comment"># Primary resource definitions</span>
    variables.tf      <span class="code-comment"># Input variable declarations</span>
    outputs.tf        <span class="code-comment"># Output value declarations</span>
    versions.tf       <span class="code-comment"># Required providers and Terraform version</span>
    README.md         <span class="code-comment"># Documentation (used by registry)</span>
    locals.tf         <span class="code-comment"># Local value computations (optional)</span>
    data.tf           <span class="code-comment"># Data source lookups (optional)</span></code></pre>

<pre><code><span class="code-comment"># versions.tf â€” pin provider requirements in child modules</span>
terraform {
  required_version = <span class="code-string">">= 1.5.0"</span>

  required_providers {
    aws = {
      source  = <span class="code-string">"hashicorp/aws"</span>
      version = <span class="code-string">">= 5.0"</span>
    }
  }
}

<span class="code-comment"># variables.tf â€” define the module's inputs</span>
variable <span class="code-string">"vpc_cidr"</span> {
  description = <span class="code-string">"CIDR block for the VPC"</span>
  type        = string
  default     = <span class="code-string">"10.0.0.0/16"</span>
}

variable <span class="code-string">"environment"</span> {
  description = <span class="code-string">"Environment name (dev, staging, prod)"</span>
  type        = string
}

<span class="code-comment"># outputs.tf â€” expose values to the caller</span>
output <span class="code-string">"vpc_id"</span> {
  description = <span class="code-string">"ID of the created VPC"</span>
  value       = aws_vpc.main.id
}

output <span class="code-string">"private_subnet_ids"</span> {
  description = <span class="code-string">"List of private subnet IDs"</span>
  value       = aws_subnet.private[*].id
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Module Sources</h3>

                <p>The <code>source</code> argument in a <code>module</code> block tells Terraform where to find the module code. Terraform supports many source types.</p>

<pre><code><span class="code-comment"># Local path â€” relative to the calling module</span>
module <span class="code-string">"vpc"</span> {
  source      = <span class="code-string">"./modules/vpc"</span>
  vpc_cidr    = <span class="code-string">"10.0.0.0/16"</span>
  environment = <span class="code-string">"production"</span>
}

<span class="code-comment"># Terraform Registry (public)</span>
module <span class="code-string">"vpc"</span> {
  source  = <span class="code-string">"terraform-aws-modules/vpc/aws"</span>
  version = <span class="code-string">"~> 5.0"</span>

  name = <span class="code-string">"production-vpc"</span>
  cidr = <span class="code-string">"10.0.0.0/16"</span>

  azs             = [<span class="code-string">"us-east-1a"</span>, <span class="code-string">"us-east-1b"</span>, <span class="code-string">"us-east-1c"</span>]
  private_subnets = [<span class="code-string">"10.0.1.0/24"</span>, <span class="code-string">"10.0.2.0/24"</span>, <span class="code-string">"10.0.3.0/24"</span>]
  public_subnets  = [<span class="code-string">"10.0.101.0/24"</span>, <span class="code-string">"10.0.102.0/24"</span>, <span class="code-string">"10.0.103.0/24"</span>]

  enable_nat_gateway = <span class="code-value">true</span>
  single_nat_gateway = <span class="code-value">true</span>
}

<span class="code-comment"># GitHub (HTTPS)</span>
module <span class="code-string">"app"</span> {
  source = <span class="code-string">"github.com/my-org/terraform-modules//modules/app?ref=v2.1.0"</span>
}

<span class="code-comment"># GitHub (SSH)</span>
module <span class="code-string">"app"</span> {
  source = <span class="code-string">"git@github.com:my-org/terraform-modules.git//modules/app?ref=v2.1.0"</span>
}

<span class="code-comment"># Generic Git repository</span>
module <span class="code-string">"networking"</span> {
  source = <span class="code-string">"git::https://git.example.com/infra/modules.git//networking?ref=main"</span>
}

<span class="code-comment"># S3 bucket (versioned zip archive)</span>
module <span class="code-string">"legacy"</span> {
  source = <span class="code-string">"s3::https://s3-us-east-1.amazonaws.com/my-modules/vpc/v1.2.0.zip"</span>
}</code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Double-Slash Syntax</div>
                    <p>The <code>//</code> in Git and GitHub URLs separates the repository root from the subdirectory path. Everything after <code>//</code> is a path within the repo. The <code>?ref=</code> parameter specifies a Git tag, branch, or commit SHA.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Module Versioning</h3>

                <p>Version constraints control which versions of a module are acceptable. Versioning is supported for Terraform Registry modules and can be simulated for Git sources using <code>ref</code>.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Constraint</th>
                                <th>Meaning</th>
                                <th>Example Matches</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>= 3.2.0</code></td>
                                <td>Exact version only</td>
                                <td>3.2.0</td>
                            </tr>
                            <tr>
                                <td><code>~> 3.2</code></td>
                                <td>>= 3.2.0 and &lt; 4.0.0</td>
                                <td>3.2.0, 3.9.5</td>
                            </tr>
                            <tr>
                                <td><code>~> 3.2.0</code></td>
                                <td>>= 3.2.0 and &lt; 3.3.0</td>
                                <td>3.2.0, 3.2.7</td>
                            </tr>
                            <tr>
                                <td><code>>= 3.0, &lt; 4.0</code></td>
                                <td>Custom range</td>
                                <td>3.0.0, 3.5.2</td>
                            </tr>
                            <tr>
                                <td><code>>= 3.0</code></td>
                                <td>Minimum version, no upper bound</td>
                                <td>3.0.0, 5.0.0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

<pre><code><span class="code-comment"># Registry module with pessimistic version constraint</span>
module <span class="code-string">"eks"</span> {
  source  = <span class="code-string">"terraform-aws-modules/eks/aws"</span>
  version = <span class="code-string">"~> 20.0"</span>  <span class="code-comment"># any 20.x.x</span>
  <span class="code-comment"># ...</span>
}

<span class="code-comment"># Git source with tag</span>
module <span class="code-string">"network"</span> {
  source = <span class="code-string">"git@github.com:my-org/modules.git//network?ref=v3.2.0"</span>
}

<span class="code-comment"># Git source with branch</span>
module <span class="code-string">"network"</span> {
  source = <span class="code-string">"git@github.com:my-org/modules.git//network?ref=main"</span>
}

<span class="code-comment"># Git source with commit SHA (most reproducible)</span>
module <span class="code-string">"network"</span> {
  source = <span class="code-string">"git@github.com:my-org/modules.git//network?ref=a1b2c3d"</span>
}</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Version Pinning Strategy</div>
                    <p>For production, use <code>~> MAJOR.MINOR</code> (e.g., <code>~> 5.0</code>) to allow patch updates while preventing breaking changes. For maximum stability, pin to an exact version. Always run <code>terraform init -upgrade</code> and review changes before updating module versions.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Module Composition</h3>

                <p>Large infrastructure configurations should be composed from small, focused modules rather than written as a single monolith. Two common patterns emerge: the <strong>composition pattern</strong> and the <strong>facade pattern</strong>.</p>

<pre><code><span class="code-comment"># Composition pattern â€” assembling small modules in the root</span>
<span class="code-comment"># Each module handles one concern</span>

module <span class="code-string">"network"</span> {
  source      = <span class="code-string">"./modules/network"</span>
  vpc_cidr    = <span class="code-string">"10.0.0.0/16"</span>
  environment = var.environment
}

module <span class="code-string">"database"</span> {
  source     = <span class="code-string">"./modules/database"</span>
  subnet_ids = module.network.private_subnet_ids
  vpc_id     = module.network.vpc_id
}

module <span class="code-string">"application"</span> {
  source          = <span class="code-string">"./modules/application"</span>
  subnet_ids      = module.network.public_subnet_ids
  db_endpoint     = module.database.endpoint
  db_port         = module.database.port
  security_groups = [module.network.app_sg_id]
}</code></pre>

<pre><code><span class="code-comment"># Facade pattern â€” a high-level module that wraps lower-level modules</span>
<span class="code-comment"># modules/platform/main.tf</span>

module <span class="code-string">"network"</span> {
  source      = <span class="code-string">"../network"</span>
  vpc_cidr    = var.vpc_cidr
  environment = var.environment
}

module <span class="code-string">"database"</span> {
  source     = <span class="code-string">"../database"</span>
  subnet_ids = module.network.private_subnet_ids
  vpc_id     = module.network.vpc_id
}

module <span class="code-string">"application"</span> {
  source      = <span class="code-string">"../application"</span>
  subnet_ids  = module.network.public_subnet_ids
  db_endpoint = module.database.endpoint
}

<span class="code-comment"># Caller uses the facade with minimal configuration</span>
<span class="code-comment"># root main.tf</span>
module <span class="code-string">"platform"</span> {
  source      = <span class="code-string">"./modules/platform"</span>
  environment = <span class="code-string">"production"</span>
  vpc_cidr    = <span class="code-string">"10.0.0.0/16"</span>
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Root vs Child Modules</h3>

                <p>Every Terraform run operates on a <strong>root module</strong> &mdash; the directory where you invoke <code>terraform plan/apply</code>. Any module called from the root (or from other child modules) is a <strong>child module</strong>. Understanding their different responsibilities is important.</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>Root Module</th>
                                <th>Child Module</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Purpose</td>
                                <td>Orchestrates the deployment</td>
                                <td>Encapsulates a reusable component</td>
                            </tr>
                            <tr>
                                <td>Provider config</td>
                                <td>Declares and configures providers</td>
                                <td>Inherits providers from parent (should not configure)</td>
                            </tr>
                            <tr>
                                <td>Backend config</td>
                                <td>Declares the backend</td>
                                <td>Cannot declare a backend</td>
                            </tr>
                            <tr>
                                <td>Variables</td>
                                <td>Set via .tfvars, CLI, or env vars</td>
                                <td>Set via <code>module</code> block arguments</td>
                            </tr>
                            <tr>
                                <td>Outputs</td>
                                <td>Displayed to the CLI user</td>
                                <td>Available to the calling module via <code>module.name.output</code></td>
                            </tr>
                            <tr>
                                <td>State</td>
                                <td>Owns the state file</td>
                                <td>Resources stored in the same state as root</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Passing Data Between Modules</h3>

                <p>Modules communicate through inputs (variables) and outputs. The output of one module becomes the input to another. This creates an explicit dependency graph that Terraform uses for ordering.</p>

<pre><code><span class="code-comment"># Module A (network) â€” outputs.tf</span>
output <span class="code-string">"vpc_id"</span> {
  description = <span class="code-string">"The VPC ID"</span>
  value       = aws_vpc.main.id
}

output <span class="code-string">"private_subnet_ids"</span> {
  description = <span class="code-string">"Private subnet IDs"</span>
  value       = aws_subnet.private[*].id
}

<span class="code-comment"># Module B (compute) â€” variables.tf</span>
variable <span class="code-string">"vpc_id"</span> {
  description = <span class="code-string">"VPC to deploy into"</span>
  type        = string
}

variable <span class="code-string">"subnet_ids"</span> {
  description = <span class="code-string">"Subnets for the instances"</span>
  type        = list(string)
}

<span class="code-comment"># Root module â€” wiring modules together</span>
module <span class="code-string">"network"</span> {
  source      = <span class="code-string">"./modules/network"</span>
  environment = var.environment
}

module <span class="code-string">"compute"</span> {
  source     = <span class="code-string">"./modules/compute"</span>
  vpc_id     = module.network.vpc_id            <span class="code-comment"># output -> input</span>
  subnet_ids = module.network.private_subnet_ids <span class="code-comment"># output -> input</span>
}

<span class="code-comment"># Terraform automatically knows to create network before compute</span></code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Terraform Registry</h3>

                <p>The <a href="https://registry.terraform.io" style="color: var(--ochre);">Terraform Registry</a> hosts public modules and providers. Public modules follow a strict naming convention and are versioned with semantic versioning.</p>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>Naming Convention</h4>
                        <code>terraform-&lt;PROVIDER&gt;-&lt;NAME&gt;</code>
                        <p>Registry modules must follow this naming pattern. Example: <code>terraform-aws-vpc</code>, <code>terraform-google-kubernetes-engine</code>.</p>
                    </div>
                    <div class="command-card">
                        <h4>Source Format</h4>
                        <code>&lt;NAMESPACE&gt;/&lt;NAME&gt;/&lt;PROVIDER&gt;</code>
                        <p>Registry modules are referenced as <code>"terraform-aws-modules/vpc/aws"</code> in the <code>source</code> argument.</p>
                    </div>
                    <div class="command-card">
                        <h4>Private Registry</h4>
                        <code>app.terraform.io/&lt;ORG&gt;/&lt;NAME&gt;/&lt;PROVIDER&gt;</code>
                        <p>Terraform Cloud and Enterprise support private module registries for internal modules.</p>
                    </div>
                    <div class="command-card">
                        <h4>Submodules</h4>
                        <code>source = "terraform-aws-modules/vpc/aws//modules/vpc-endpoints"</code>
                        <p>Registry modules may expose submodules via the <code>//</code> path separator.</p>
                    </div>
                </div>

<pre><code><span class="code-comment"># Using popular registry modules</span>

<span class="code-comment"># AWS VPC module (most downloaded Terraform module)</span>
module <span class="code-string">"vpc"</span> {
  source  = <span class="code-string">"terraform-aws-modules/vpc/aws"</span>
  version = <span class="code-string">"~> 5.0"</span>

  name = <span class="code-string">"my-vpc"</span>
  cidr = <span class="code-string">"10.0.0.0/16"</span>

  azs             = [<span class="code-string">"us-east-1a"</span>, <span class="code-string">"us-east-1b"</span>, <span class="code-string">"us-east-1c"</span>]
  private_subnets = [<span class="code-string">"10.0.1.0/24"</span>, <span class="code-string">"10.0.2.0/24"</span>, <span class="code-string">"10.0.3.0/24"</span>]
  public_subnets  = [<span class="code-string">"10.0.101.0/24"</span>, <span class="code-string">"10.0.102.0/24"</span>, <span class="code-string">"10.0.103.0/24"</span>]

  enable_nat_gateway   = <span class="code-value">true</span>
  single_nat_gateway   = <span class="code-value">true</span>
  enable_dns_hostnames = <span class="code-value">true</span>

  tags = local.common_tags
}

<span class="code-comment"># AWS EKS module</span>
module <span class="code-string">"eks"</span> {
  source  = <span class="code-string">"terraform-aws-modules/eks/aws"</span>
  version = <span class="code-string">"~> 20.0"</span>

  cluster_name    = <span class="code-string">"production"</span>
  cluster_version = <span class="code-string">"1.30"</span>

  vpc_id     = module.vpc.vpc_id
  subnet_ids = module.vpc.private_subnets

  eks_managed_node_groups = {
    default = {
      min_size     = <span class="code-value">2</span>
      max_size     = <span class="code-value">10</span>
      desired_size = <span class="code-value">3</span>

      instance_types = [<span class="code-string">"t3.medium"</span>]
    }
  }
}

<span class="code-comment"># Using a private registry module</span>
module <span class="code-string">"internal_app"</span> {
  source  = <span class="code-string">"app.terraform.io/my-company/app-template/aws"</span>
  version = <span class="code-string">"~> 2.0"</span>

  app_name    = <span class="code-string">"billing-service"</span>
  environment = <span class="code-string">"production"</span>
}</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Module Best Practices</div>
                    <p>Keep modules focused on a single concern. Expose only what callers need through outputs. Always declare <code>required_providers</code> in child modules but do not configure providers there &mdash; let the root module handle provider configuration. Document every variable and output with <code>description</code> attributes.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 07: PROVIDER ECOSYSTEM
             ============================================ -->
        <section id="providers" class="section">
            <div class="section-header">
                <span class="section-number">07</span>
                <h2 class="section-title">Provider Ecosystem</h2>
                <p class="section-description">Providers are the bridge between Terraform and the outside world. Each provider is a plugin that translates HCL into API calls for a specific platform or service.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">How Providers Work</h3>

                <p>Providers are standalone Go binaries distributed as plugins. When you run <code>terraform init</code>, Terraform downloads the provider binaries matching your version constraints and stores them in <code>.terraform/providers/</code>. Each provider manages a set of resource types and data sources for its target API.</p>

                <p>Providers are identified by a three-part source address: <code>namespace/type</code> within a given registry. The default registry is <code>registry.terraform.io</code>. For example, <code>hashicorp/aws</code> resolves to <code>registry.terraform.io/hashicorp/aws</code>.</p>

                <div class="alert alert-info">
                    <div class="alert-title">Provider Cache</div>
                    <p>Set <code>TF_PLUGIN_CACHE_DIR</code> to a shared directory (e.g., <code>~/.terraform.d/plugin-cache</code>) to avoid re-downloading providers across projects. Terraform creates symlinks instead of copies, saving both time and disk space.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">required_providers Block</h3>

                <p>Declare every provider your configuration depends on in the <code>required_providers</code> block inside a <code>terraform</code> block. This is the single source of truth for provider versions.</p>

<pre><code>terraform {
  <span class="code-comment"># Pin the Terraform CLI version</span>
  required_version = <span class="code-string">"&gt;= 1.5.0, &lt; 2.0.0"</span>

  required_providers {
    aws = {
      source  = <span class="code-string">"hashicorp/aws"</span>
      version = <span class="code-string">"~&gt; 5.0"</span>       <span class="code-comment"># &gt;= 5.0, &lt; 6.0</span>
    }
    azurerm = {
      source  = <span class="code-string">"hashicorp/azurerm"</span>
      version = <span class="code-string">"~&gt; 3.80"</span>     <span class="code-comment"># &gt;= 3.80, &lt; 4.0</span>
    }
    kubernetes = {
      source  = <span class="code-string">"hashicorp/kubernetes"</span>
      version = <span class="code-string">"&gt;= 2.24, &lt; 3.0"</span>
    }
    datadog = {
      source  = <span class="code-string">"DataDog/datadog"</span>
      version = <span class="code-string">"~&gt; 3.30"</span>
    }
  }
}</code></pre>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Constraint</th>
                                <th>Meaning</th>
                                <th>Example Range</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>= 5.31.0</code></td>
                                <td>Exact version only</td>
                                <td>5.31.0</td>
                            </tr>
                            <tr>
                                <td><code>~&gt; 5.0</code></td>
                                <td>Pessimistic (rightmost increment)</td>
                                <td>&gt;= 5.0, &lt; 6.0</td>
                            </tr>
                            <tr>
                                <td><code>~&gt; 5.31</code></td>
                                <td>Pessimistic (patch level)</td>
                                <td>&gt;= 5.31.0, &lt; 5.32.0</td>
                            </tr>
                            <tr>
                                <td><code>&gt;= 5.0, &lt; 5.50</code></td>
                                <td>Custom range</td>
                                <td>5.0.0 through 5.49.x</td>
                            </tr>
                            <tr>
                                <td><code>!= 5.25.0</code></td>
                                <td>Exclude a specific version</td>
                                <td>Any version except 5.25.0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Provider Configuration</h3>

                <p>The <code>provider</code> block configures a specific provider instance. Provider configuration typically includes the region, authentication method, and default behaviors.</p>

<pre><code><span class="code-comment"># Basic AWS provider configuration</span>
provider <span class="code-string">"aws"</span> {
  region = <span class="code-string">"us-east-1"</span>

  default_tags {
    tags = {
      Environment = var.environment
      ManagedBy   = <span class="code-string">"terraform"</span>
      Team        = <span class="code-string">"platform"</span>
      CostCenter  = <span class="code-string">"eng-12345"</span>
    }
  }
}

<span class="code-comment"># Azure provider</span>
provider <span class="code-string">"azurerm"</span> {
  features {}
  subscription_id = var.subscription_id
}

<span class="code-comment"># GCP provider</span>
provider <span class="code-string">"google"</span> {
  project = var.project_id
  region  = <span class="code-string">"us-central1"</span>
}</code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">Never Hardcode Credentials</div>
                    <p>Do not put access keys, secrets, or tokens in provider blocks or <code>.tf</code> files. Use environment variables (<code>AWS_ACCESS_KEY_ID</code>, <code>ARM_CLIENT_ID</code>), OIDC federation, IAM roles for service accounts, or a credentials helper. In CI/CD, use <code>GOOGLE_CREDENTIALS</code> with a service account JSON or workload identity federation.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Provider Aliases</h3>

                <p>Aliases let you configure multiple instances of the same provider &mdash; for multi-region deployments, cross-account access, or different authentication contexts.</p>

<pre><code><span class="code-comment"># Default AWS provider (us-east-1)</span>
provider <span class="code-string">"aws"</span> {
  region = <span class="code-string">"us-east-1"</span>
}

<span class="code-comment"># Aliased provider for us-west-2</span>
provider <span class="code-string">"aws"</span> {
  alias  = <span class="code-string">"west"</span>
  region = <span class="code-string">"us-west-2"</span>
}

<span class="code-comment"># Aliased provider for a different AWS account</span>
provider <span class="code-string">"aws"</span> {
  alias  = <span class="code-string">"shared_services"</span>
  region = <span class="code-string">"us-east-1"</span>

  assume_role {
    role_arn = <span class="code-string">"arn:aws:iam::123456789012:role/TerraformRole"</span>
  }
}

<span class="code-comment"># Use aliased provider in a resource</span>
resource <span class="code-string">"aws_s3_bucket"</span> <span class="code-string">"replica"</span> {
  provider = aws.west
  bucket   = <span class="code-string">"my-replica-bucket"</span>
}

<span class="code-comment"># Pass aliased provider to a module</span>
module <span class="code-string">"west_vpc"</span> {
  source = <span class="code-string">"./modules/vpc"</span>

  providers = {
    aws = aws.west
  }

  cidr_block = <span class="code-string">"10.1.0.0/16"</span>
}</code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Multi-Region Pattern</div>
                    <p>For multi-region deployments, define one default provider and one aliased provider per additional region. Resources default to the un-aliased provider unless you explicitly set <code>provider = aws.alias_name</code>. Modules must receive aliased providers through their <code>providers</code> argument.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Major Providers</h3>

                <p>The Terraform Registry hosts thousands of providers. The average enterprise uses 8&ndash;12 providers. Here are the most widely adopted:</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Provider</th>
                                <th>Source</th>
                                <th>Description</th>
                                <th>Typical Use Cases</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>AWS</strong> <span class="badge badge-red"><span>4B+ DL</span></span></td>
                                <td><code>hashicorp/aws</code></td>
                                <td>Amazon Web Services &mdash; the most downloaded Terraform provider</td>
                                <td>EC2, S3, RDS, Lambda, VPC, IAM</td>
                            </tr>
                            <tr>
                                <td><strong>Azure</strong></td>
                                <td><code>hashicorp/azurerm</code></td>
                                <td>Microsoft Azure Resource Manager</td>
                                <td>VMs, AKS, Storage, SQL, Networking</td>
                            </tr>
                            <tr>
                                <td><strong>GCP</strong></td>
                                <td><code>hashicorp/google</code></td>
                                <td>Google Cloud Platform</td>
                                <td>GKE, Cloud Run, BigQuery, VPC</td>
                            </tr>
                            <tr>
                                <td><strong>Kubernetes</strong></td>
                                <td><code>hashicorp/kubernetes</code></td>
                                <td>Manage K8s resources declaratively</td>
                                <td>Deployments, Services, ConfigMaps</td>
                            </tr>
                            <tr>
                                <td><strong>Docker</strong></td>
                                <td><code>kreuzwerker/docker</code></td>
                                <td>Manage Docker containers and images</td>
                                <td>Local dev environments, container orchestration</td>
                            </tr>
                            <tr>
                                <td><strong>GitHub</strong></td>
                                <td><code>integrations/github</code></td>
                                <td>Manage GitHub repos, teams, and settings</td>
                                <td>Repo creation, branch protection, team membership</td>
                            </tr>
                            <tr>
                                <td><strong>Cloudflare</strong></td>
                                <td><code>cloudflare/cloudflare</code></td>
                                <td>DNS, WAF, Workers, and edge services</td>
                                <td>DNS records, page rules, access policies</td>
                            </tr>
                            <tr>
                                <td><strong>Datadog</strong></td>
                                <td><code>DataDog/datadog</code></td>
                                <td>Monitoring, dashboards, and alerting</td>
                                <td>Monitors, dashboards, SLOs, downtime</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Community &amp; Custom Providers</h3>

                <p>Beyond official HashiCorp providers, the Terraform Registry hosts thousands of community-maintained providers for services ranging from PagerDuty and Snowflake to 1Password and Spotify. Custom in-house providers can be distributed via a private registry or local filesystem mirrors.</p>

<pre><code><span class="code-comment"># Community provider example</span>
terraform {
  required_providers {
    snowflake = {
      source  = <span class="code-string">"Snowflake-Labs/snowflake"</span>
      version = <span class="code-string">"~&gt; 0.76"</span>
    }
    pagerduty = {
      source  = <span class="code-string">"PagerDuty/pagerduty"</span>
      version = <span class="code-string">"~&gt; 3.6"</span>
    }
  }
}

<span class="code-comment"># Filesystem mirror for air-gapped environments</span>
provider_installation {
  filesystem_mirror {
    path    = <span class="code-string">"/opt/terraform/providers"</span>
    include = [<span class="code-string">"registry.terraform.io/hashicorp/*"</span>]
  }
  direct {
    exclude = [<span class="code-string">"registry.terraform.io/hashicorp/*"</span>]
  }
}</code></pre>
            </div>

        </section>

        <!-- ============================================
             SECTION 08: WORKSPACES & ENVIRONMENTS
             ============================================ -->
        <section id="workspaces" class="section section-dark">
            <div class="section-header">
                <span class="section-number">08</span>
                <h2 class="section-title">Workspaces &amp; Environments</h2>
                <p class="section-description">Strategies for managing multiple environments &mdash; dev, staging, production &mdash; with the same Terraform configuration. CLI workspaces, directory structures, and when to use each.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">CLI Workspaces</h3>

                <p>Terraform CLI workspaces let you maintain separate state instances from a single configuration directory. Each workspace has its own <code>terraform.tfstate</code> file, but all share the same code and backend configuration.</p>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>Create Workspace</h4>
                        <code>terraform workspace new staging</code>
                        <p>Create a new workspace and switch to it. The state file is created in the backend under a workspace-specific path.</p>
                    </div>
                    <div class="command-card">
                        <h4>List Workspaces</h4>
                        <code>terraform workspace list</code>
                        <p>Show all available workspaces. Current workspace is marked with an asterisk (<code>*</code>).</p>
                    </div>
                    <div class="command-card">
                        <h4>Select Workspace</h4>
                        <code>terraform workspace select production</code>
                        <p>Switch to an existing workspace. All subsequent commands use that workspace's state.</p>
                    </div>
                    <div class="command-card">
                        <h4>Show Current</h4>
                        <code>terraform workspace show</code>
                        <p>Print the name of the currently selected workspace. Useful in scripts and CI/CD pipelines.</p>
                    </div>
                    <div class="command-card">
                        <h4>Delete Workspace</h4>
                        <code>terraform workspace delete staging</code>
                        <p>Remove a workspace and its state. The workspace must have an empty state (all resources destroyed) first.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Workspace-Based Environments</h3>

                <p>Use <code>terraform.workspace</code> to vary configuration based on the active workspace. A common pattern uses a locals map to define environment-specific settings:</p>

<pre><code><span class="code-comment"># locals.tf &mdash; environment-specific configuration via workspace</span>
locals {
  env_config = {
    dev = {
      instance_type = <span class="code-string">"t3.micro"</span>
      instance_count = <span class="code-value">1</span>
      db_class       = <span class="code-string">"db.t3.micro"</span>
      multi_az       = <span class="code-value">false</span>
    }
    staging = {
      instance_type  = <span class="code-string">"t3.small"</span>
      instance_count = <span class="code-value">2</span>
      db_class       = <span class="code-string">"db.t3.small"</span>
      multi_az       = <span class="code-value">false</span>
    }
    production = {
      instance_type  = <span class="code-string">"t3.large"</span>
      instance_count = <span class="code-value">3</span>
      db_class       = <span class="code-string">"db.r6g.large"</span>
      multi_az       = <span class="code-value">true</span>
    }
  }

  <span class="code-comment"># Select config for the active workspace</span>
  config = local.env_config[terraform.workspace]
}

<span class="code-comment"># main.tf &mdash; use workspace-driven values</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"app"</span> {
  count         = local.config.instance_count
  instance_type = local.config.instance_type
  ami           = data.aws_ami.ubuntu.id

  tags = {
    Name        = <span class="code-string">"app-${terraform.workspace}-${count.index}"</span>
    Environment = terraform.workspace
  }
}

resource <span class="code-string">"aws_db_instance"</span> <span class="code-string">"main"</span> {
  instance_class = local.config.db_class
  multi_az       = local.config.multi_az
  identifier     = <span class="code-string">"app-db-${terraform.workspace}"</span>
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Directory-Based Structure</h3>

                <p>The recommended approach for production environments is a directory-based layout. Each environment gets its own directory with its own backend configuration and state file, providing full isolation.</p>

<pre><code><span class="code-comment"># Recommended directory layout</span>
infrastructure/
  modules/
    vpc/
      main.tf
      variables.tf
      outputs.tf
    app/
      main.tf
      variables.tf
      outputs.tf
  environments/
    dev/
      main.tf           <span class="code-comment"># Calls modules with dev values</span>
      backend.tf        <span class="code-comment"># Dev-specific state backend</span>
      terraform.tfvars  <span class="code-comment"># Dev variable values</span>
    staging/
      main.tf
      backend.tf
      terraform.tfvars
    production/
      main.tf
      backend.tf
      terraform.tfvars</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Best Practice</div>
                    <p>Use directory-based structure for production workloads where blast radius and access control matter. Reserve CLI workspaces for local development and testing where simplicity outweighs isolation. HCP Terraform workspaces offer a managed middle ground with RBAC, policy enforcement, and run history.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Approach Comparison</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Criteria</th>
                                <th>CLI Workspaces</th>
                                <th>Directory-Based</th>
                                <th>Terragrunt</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>State Isolation</strong></td>
                                <td>Shared backend, separate state files</td>
                                <td>Fully separate backends</td>
                                <td>Fully separate backends</td>
                            </tr>
                            <tr>
                                <td><strong>Code Duplication</strong></td>
                                <td>None &mdash; single config directory</td>
                                <td>Some &mdash; root modules per env</td>
                                <td>Minimal &mdash; DRY via <code>terragrunt.hcl</code></td>
                            </tr>
                            <tr>
                                <td><strong>Access Control</strong></td>
                                <td>Limited (same backend IAM)</td>
                                <td>Full (per-env IAM policies)</td>
                                <td>Full (per-env IAM policies)</td>
                            </tr>
                            <tr>
                                <td><strong>Blast Radius</strong></td>
                                <td>Risk of wrong workspace</td>
                                <td>Isolated by design</td>
                                <td>Isolated by design</td>
                            </tr>
                            <tr>
                                <td><strong>Complexity</strong></td>
                                <td>Low &mdash; built-in to Terraform</td>
                                <td>Medium &mdash; more files to manage</td>
                                <td>Medium &mdash; extra tool dependency</td>
                            </tr>
                            <tr>
                                <td><strong>CI/CD Integration</strong></td>
                                <td>Select workspace before plan/apply</td>
                                <td>Target directory per pipeline</td>
                                <td><code>terragrunt run-all</code> for orchestration</td>
                            </tr>
                            <tr>
                                <td><strong>Best For</strong></td>
                                <td>Dev/testing, small teams</td>
                                <td>Production, regulated environments</td>
                                <td>Large-scale multi-account setups</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Pros &amp; Cons of CLI Workspaces</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Benefits</th>
                                <th>Drawbacks</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Simple &mdash; built into Terraform, no extra tools</td>
                                <td>Shared backend &mdash; same IAM for all environments</td>
                            </tr>
                            <tr>
                                <td>Zero code duplication across environments</td>
                                <td>Risk of applying to the wrong workspace</td>
                            </tr>
                            <tr>
                                <td>Quick to set up for prototyping</td>
                                <td>Limited isolation &mdash; a misconfigured backend affects all envs</td>
                            </tr>
                            <tr>
                                <td>Workspace name available in config via <code>terraform.workspace</code></td>
                                <td>No per-workspace variable files by default</td>
                            </tr>
                            <tr>
                                <td>Single codebase to maintain and review</td>
                                <td>Cannot use different Terraform or provider versions per env</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 09: ADVANCED PATTERNS
             ============================================ -->
        <section id="advanced" class="section">
            <div class="section-header">
                <span class="section-number">09</span>
                <h2 class="section-title">Advanced Patterns</h2>
                <p class="section-description">Power-user techniques for writing expressive, maintainable Terraform configurations. Dynamic blocks, conditional resources, validation, refactoring, and cross-configuration data sharing.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Dynamic Blocks</h3>

                <p>Dynamic blocks generate repeated nested blocks within a resource. Instead of copying and pasting <code>ingress</code> or <code>setting</code> blocks, use <code>dynamic</code> with <code>for_each</code> to iterate over a collection.</p>

<pre><code>variable <span class="code-string">"ingress_rules"</span> {
  type = list(object({
    port        = number
    protocol    = string
    cidr_blocks = list(string)
    description = string
  }))
  default = [
    { port = <span class="code-value">80</span>,  protocol = <span class="code-string">"tcp"</span>, cidr_blocks = [<span class="code-string">"0.0.0.0/0"</span>], description = <span class="code-string">"HTTP"</span> },
    { port = <span class="code-value">443</span>, protocol = <span class="code-string">"tcp"</span>, cidr_blocks = [<span class="code-string">"0.0.0.0/0"</span>], description = <span class="code-string">"HTTPS"</span> },
    { port = <span class="code-value">22</span>,  protocol = <span class="code-string">"tcp"</span>, cidr_blocks = [<span class="code-string">"10.0.0.0/8"</span>], description = <span class="code-string">"SSH internal"</span> },
  ]
}

resource <span class="code-string">"aws_security_group"</span> <span class="code-string">"app"</span> {
  name        = <span class="code-string">"app-sg"</span>
  description = <span class="code-string">"Application security group"</span>
  vpc_id      = var.vpc_id

  <span class="code-comment"># Dynamic block generates one ingress block per rule</span>
  dynamic <span class="code-string">"ingress"</span> {
    for_each = var.ingress_rules
    content {
      from_port   = ingress.value.port
      to_port     = ingress.value.port
      protocol    = ingress.value.protocol
      cidr_blocks = ingress.value.cidr_blocks
      description = ingress.value.description
    }
  }

  egress {
    from_port   = <span class="code-value">0</span>
    to_port     = <span class="code-value">0</span>
    protocol    = <span class="code-string">"-1"</span>
    cidr_blocks = [<span class="code-string">"0.0.0.0/0"</span>]
  }
}</code></pre>

                <p><strong>Conditional dynamic blocks</strong> &mdash; use an empty list to suppress the block entirely:</p>

<pre><code><span class="code-comment"># Only create the logging block if logging is enabled</span>
resource <span class="code-string">"aws_s3_bucket"</span> <span class="code-string">"data"</span> {
  bucket = <span class="code-string">"my-data-bucket"</span>

  dynamic <span class="code-string">"logging"</span> {
    for_each = var.enable_logging ? [<span class="code-value">1</span>] : []
    content {
      target_bucket = var.log_bucket_id
      target_prefix = <span class="code-string">"logs/"</span>
    }
  }
}

<span class="code-comment"># Nested dynamic blocks</span>
resource <span class="code-string">"aws_lb_listener"</span> <span class="code-string">"https"</span> {
  load_balancer_arn = aws_lb.main.arn
  port              = <span class="code-value">443</span>
  protocol          = <span class="code-string">"HTTPS"</span>

  dynamic <span class="code-string">"default_action"</span> {
    for_each = var.listener_rules
    content {
      type             = default_action.value.type
      target_group_arn = default_action.value.target_group_arn

      dynamic <span class="code-string">"redirect"</span> {
        for_each = default_action.value.type == <span class="code-string">"redirect"</span> ? [<span class="code-value">1</span>] : []
        content {
          status_code = <span class="code-string">"HTTP_301"</span>
          protocol    = <span class="code-string">"HTTPS"</span>
        }
      }
    }
  }
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">for_each with Maps</h3>

                <p>Using <code>for_each</code> with a map produces resources keyed by the map keys, giving stable resource addresses that survive reordering. This is strongly preferred over <code>count</code> with lists.</p>

<pre><code>variable <span class="code-string">"buckets"</span> {
  type = map(object({
    versioning = bool
    acl        = string
  }))
  default = {
    logs = { versioning = <span class="code-value">true</span>,  acl = <span class="code-string">"log-delivery-write"</span> }
    data = { versioning = <span class="code-value">true</span>,  acl = <span class="code-string">"private"</span> }
    tmp  = { versioning = <span class="code-value">false</span>, acl = <span class="code-string">"private"</span> }
  }
}

resource <span class="code-string">"aws_s3_bucket"</span> <span class="code-string">"this"</span> {
  for_each = var.buckets

  bucket = <span class="code-string">"${var.project}-${each.key}"</span>
  <span class="code-comment"># each.key   = "logs", "data", "tmp"</span>
  <span class="code-comment"># each.value = { versioning = true, acl = "..." }</span>

  tags = {
    Name = each.key
  }
}

<span class="code-comment"># Resources are addressed by key, not index:</span>
<span class="code-comment"># aws_s3_bucket.this["logs"]</span>
<span class="code-comment"># aws_s3_bucket.this["data"]</span>
<span class="code-comment"># aws_s3_bucket.this["tmp"]</span></code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Why Maps Over Lists</div>
                    <p>With <code>count</code>, resources are addressed by index (<code>[0]</code>, <code>[1]</code>). Removing an item from the middle shifts all subsequent indices, causing unnecessary destroy/recreate operations. With <code>for_each</code> on a map, each resource has a stable string key. Removing <code>"tmp"</code> from the map only destroys that one bucket &mdash; <code>"logs"</code> and <code>"data"</code> are untouched.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Conditional Resources</h3>

                <p>The <code>count = var.enabled ? 1 : 0</code> pattern is the standard way to conditionally create a resource. When the condition is false, the resource is not created at all.</p>

<pre><code>variable <span class="code-string">"create_cloudwatch_alarm"</span> {
  type    = bool
  default = <span class="code-value">true</span>
}

resource <span class="code-string">"aws_cloudwatch_metric_alarm"</span> <span class="code-string">"cpu"</span> {
  count = var.create_cloudwatch_alarm ? <span class="code-value">1</span> : <span class="code-value">0</span>

  alarm_name          = <span class="code-string">"high-cpu"</span>
  comparison_operator = <span class="code-string">"GreaterThanThreshold"</span>
  evaluation_periods  = <span class="code-value">2</span>
  metric_name         = <span class="code-string">"CPUUtilization"</span>
  namespace           = <span class="code-string">"AWS/EC2"</span>
  period              = <span class="code-value">300</span>
  statistic           = <span class="code-string">"Average"</span>
  threshold           = <span class="code-value">80</span>
}

<span class="code-comment"># Reference a conditional resource with [0] index</span>
output <span class="code-string">"alarm_arn"</span> {
  value = var.create_cloudwatch_alarm ? aws_cloudwatch_metric_alarm.cpu[<span class="code-value">0</span>].arn : <span class="code-string">""</span>
}

<span class="code-comment"># Or use one() to get the single element or null</span>
output <span class="code-string">"alarm_arn_v2"</span> {
  value = one(aws_cloudwatch_metric_alarm.cpu[*].arn)
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Moved Blocks <span class="badge badge-ochre"><span>TF 1.1+</span></span></h3>

                <p>The <code>moved</code> block tells Terraform that a resource has been renamed or refactored, preventing a destroy/recreate cycle. This is essential when reorganizing code.</p>

<pre><code><span class="code-comment"># Rename a resource</span>
moved {
  from = aws_instance.web_server
  to   = aws_instance.app
}

<span class="code-comment"># Move a resource into a module</span>
moved {
  from = aws_s3_bucket.logs
  to   = module.logging.aws_s3_bucket.main
}

<span class="code-comment"># Migrate from count to for_each</span>
moved {
  from = aws_subnet.private[<span class="code-value">0</span>]
  to   = aws_subnet.private[<span class="code-string">"us-east-1a"</span>]
}
moved {
  from = aws_subnet.private[<span class="code-value">1</span>]
  to   = aws_subnet.private[<span class="code-string">"us-east-1b"</span>]
}
moved {
  from = aws_subnet.private[<span class="code-value">2</span>]
  to   = aws_subnet.private[<span class="code-string">"us-east-1c"</span>]
}

<span class="code-comment"># Rename a module</span>
moved {
  from = module.web
  to   = module.frontend
}</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Moved Block Lifecycle</div>
                    <p>Keep <code>moved</code> blocks in your configuration long enough for all state files (across all workspaces and environments) to have been updated. After that, you can safely remove them. A common practice is to keep them for one or two release cycles.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Preconditions &amp; Postconditions <span class="badge badge-ochre"><span>TF 1.2+</span></span></h3>

                <p>Lifecycle conditions let you assert invariants that Terraform checks during plan and apply. Preconditions are checked <em>before</em> a resource action; postconditions are checked <em>after</em>.</p>

<pre><code>resource <span class="code-string">"aws_instance"</span> <span class="code-string">"app"</span> {
  ami           = var.ami_id
  instance_type = var.instance_type
  subnet_id     = var.subnet_id

  lifecycle {
    <span class="code-comment"># Precondition: checked BEFORE create/update</span>
    precondition {
      condition     = data.aws_ami.selected.architecture == <span class="code-string">"x86_64"</span>
      error_message = <span class="code-string">"AMI must be x86_64 architecture for this instance type."</span>
    }

    <span class="code-comment"># Postcondition: checked AFTER create/update</span>
    postcondition {
      condition     = self.public_ip != <span class="code-string">""</span>
      error_message = <span class="code-string">"Instance must receive a public IP address."</span>
    }
  }
}

<span class="code-comment"># Output-level postcondition</span>
output <span class="code-string">"api_url"</span> {
  value = <span class="code-string">"https://${aws_lb.main.dns_name}/api"</span>

  precondition {
    condition     = aws_lb.main.dns_name != <span class="code-string">""</span>
    error_message = <span class="code-string">"Load balancer DNS name must not be empty."</span>
  }
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Custom Validation Rules</h3>

                <p>Variable-level <code>validation</code> blocks run during <code>terraform plan</code> before any resource is created. Use them to catch invalid input early with clear error messages.</p>

<pre><code><span class="code-comment"># CIDR validation</span>
variable <span class="code-string">"vpc_cidr"</span> {
  type = string

  validation {
    condition     = can(cidrhost(var.vpc_cidr, <span class="code-value">0</span>))
    error_message = <span class="code-string">"vpc_cidr must be a valid CIDR block (e.g., 10.0.0.0/16)."</span>
  }

  validation {
    condition     = tonumber(split(<span class="code-string">"/"</span>, var.vpc_cidr)[<span class="code-value">1</span>]) &lt;= <span class="code-value">24</span>
    error_message = <span class="code-string">"VPC CIDR prefix must be /24 or larger."</span>
  }
}

<span class="code-comment"># Environment constraint</span>
variable <span class="code-string">"environment"</span> {
  type = string

  validation {
    condition     = contains([<span class="code-string">"dev"</span>, <span class="code-string">"staging"</span>, <span class="code-string">"production"</span>], var.environment)
    error_message = <span class="code-string">"Environment must be dev, staging, or production."</span>
  }
}

<span class="code-comment"># Tag requirements</span>
variable <span class="code-string">"tags"</span> {
  type = map(string)

  validation {
    condition     = contains(keys(var.tags), <span class="code-string">"CostCenter"</span>)
    error_message = <span class="code-string">"Tags must include a CostCenter key for billing."</span>
  }

  validation {
    condition     = contains(keys(var.tags), <span class="code-string">"Owner"</span>)
    error_message = <span class="code-string">"Tags must include an Owner key for accountability."</span>
  }
}

<span class="code-comment"># Regex-based validation</span>
variable <span class="code-string">"project_name"</span> {
  type = string

  validation {
    condition     = can(regex(<span class="code-string">"^[a-z][a-z0-9-]{2,28}[a-z0-9]$"</span>, var.project_name))
    error_message = <span class="code-string">"Project name must be 4-30 chars, lowercase alphanumeric with hyphens, starting with a letter."</span>
  }
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Optional Attributes <span class="badge badge-ochre"><span>TF 1.3+</span></span></h3>

                <p>Object type constraints can declare attributes as optional, with an optional default value. This simplifies module interfaces by reducing the number of required fields callers must specify.</p>

<pre><code>variable <span class="code-string">"database"</span> {
  type = object({
    engine         = string
    engine_version = string
    instance_class = string
    <span class="code-comment"># Optional with defaults</span>
    storage_gb     = optional(number, <span class="code-value">20</span>)
    multi_az       = optional(bool, <span class="code-value">false</span>)
    backup_days    = optional(number, <span class="code-value">7</span>)
    port           = optional(number)  <span class="code-comment"># Defaults to null</span>
  })
}

<span class="code-comment"># Callers only need to specify required fields</span>
<span class="code-comment"># database = {</span>
<span class="code-comment">#   engine         = "postgres"</span>
<span class="code-comment">#   engine_version = "15.4"</span>
<span class="code-comment">#   instance_class = "db.t3.medium"</span>
<span class="code-comment"># }</span></code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Splat Expressions</h3>

                <p>The splat operator <code>[*]</code> extracts a single attribute from a list of objects. It works with <code>count</code>-based resources but not with <code>for_each</code>, which requires a <code>for</code> expression instead.</p>

<pre><code><span class="code-comment"># count-based resources: use splat</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  count         = <span class="code-value">3</span>
  ami           = data.aws_ami.ubuntu.id
  instance_type = <span class="code-string">"t3.micro"</span>
}

output <span class="code-string">"instance_ids"</span> {
  value = aws_instance.web[*].id
  <span class="code-comment"># Returns: ["i-abc", "i-def", "i-ghi"]</span>
}

output <span class="code-string">"private_ips"</span> {
  value = aws_instance.web[*].private_ip
}

<span class="code-comment"># for_each-based resources: use for expression</span>
resource <span class="code-string">"aws_s3_bucket"</span> <span class="code-string">"this"</span> {
  for_each = var.bucket_names
  bucket   = each.value
}

output <span class="code-string">"bucket_arns"</span> {
  value = [for b in aws_s3_bucket.this : b.arn]
}

output <span class="code-string">"bucket_map"</span> {
  value = { for k, b in aws_s3_bucket.this : k =&gt; b.arn }
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">terraform_remote_state</h3>

                <p>The <code>terraform_remote_state</code> data source reads output values from another Terraform configuration's state. This enables cross-configuration data sharing without hardcoding values.</p>

<pre><code><span class="code-comment"># In the networking configuration, expose the VPC ID</span>
<span class="code-comment"># (networking/outputs.tf)</span>
output <span class="code-string">"vpc_id"</span> {
  value = aws_vpc.main.id
}

output <span class="code-string">"private_subnet_ids"</span> {
  value = aws_subnet.private[*].id
}

<span class="code-comment"># In the application configuration, read networking outputs</span>
<span class="code-comment"># (application/data.tf)</span>
data <span class="code-string">"terraform_remote_state"</span> <span class="code-string">"network"</span> {
  backend = <span class="code-string">"s3"</span>

  config = {
    bucket = <span class="code-string">"my-terraform-state"</span>
    key    = <span class="code-string">"prod/network/terraform.tfstate"</span>
    region = <span class="code-string">"us-east-1"</span>
  }
}

<span class="code-comment"># Use the remote state outputs</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"app"</span> {
  subnet_id = data.terraform_remote_state.network.outputs.private_subnet_ids[<span class="code-value">0</span>]
  vpc_security_group_ids = [aws_security_group.app.id]
}

resource <span class="code-string">"aws_security_group"</span> <span class="code-string">"app"</span> {
  vpc_id = data.terraform_remote_state.network.outputs.vpc_id
}</code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">Security Consideration</div>
                    <p>Any configuration that reads another state via <code>terraform_remote_state</code> gains access to <em>all</em> outputs from that state, including any marked <code>sensitive</code>. Consider using purpose-built data sharing mechanisms (SSM Parameter Store, Consul KV, or a dedicated outputs module) if you need finer-grained access control.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 10: TESTING & VALIDATION
             ============================================ -->
        <section id="testing" class="section section-dark">
            <div class="section-header">
                <span class="section-number">10</span>
                <h2 class="section-title">Testing &amp; Validation</h2>
                <p class="section-description">From quick syntax checks to full integration tests. Terraform's native testing framework, provider mocking, and the ecosystem of third-party validation tools.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">terraform validate</h3>

                <p>The fastest feedback loop. <code>terraform validate</code> checks configuration syntax and internal consistency without accessing any remote services or state. It catches typos, missing required arguments, and invalid references &mdash; no credentials needed.</p>

<pre><code><span class="code-comment"># Basic validation (requires terraform init first)</span>
terraform validate

<span class="code-comment"># JSON output for CI/CD pipelines</span>
terraform validate -json

<span class="code-comment"># Example JSON output</span>
{
  <span class="code-string">"valid"</span>: <span class="code-value">false</span>,
  <span class="code-string">"error_count"</span>: <span class="code-value">1</span>,
  <span class="code-string">"warning_count"</span>: <span class="code-value">0</span>,
  <span class="code-string">"diagnostics"</span>: [
    {
      <span class="code-string">"severity"</span>: <span class="code-string">"error"</span>,
      <span class="code-string">"summary"</span>: <span class="code-string">"Missing required argument"</span>,
      <span class="code-string">"detail"</span>: <span class="code-string">"The argument \"region\" is required."</span>
    }
  ]
}</code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">CI Quick Check</div>
                    <p>Run <code>terraform init -backend=false</code> followed by <code>terraform validate -json</code> in your CI pipeline for sub-second syntax validation without configuring any backend or credentials.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Native Testing Framework</h3>

                <p>Terraform 1.6 introduced a built-in testing framework using <code>.tftest.hcl</code> files. Tests live alongside your configuration and use <code>run</code> blocks with assertions to verify plan and apply behavior. No external tools or languages required.</p>

<pre><code><span class="code-comment"># tests/basic.tftest.hcl</span>

<span class="code-comment"># Global variables for all run blocks</span>
variables {
  project_name = <span class="code-string">"test-project"</span>
  environment  = <span class="code-string">"test"</span>
}

<span class="code-comment"># Plan-only test &mdash; fast, no real infrastructure</span>
run <span class="code-string">"validates_instance_type"</span> {
  command = plan

  assert {
    condition     = aws_instance.web.instance_type == <span class="code-string">"t3.micro"</span>
    error_message = <span class="code-string">"Instance type must be t3.micro"</span>
  }
}

<span class="code-comment"># Apply test &mdash; creates real resources, then destroys</span>
run <span class="code-string">"creates_s3_bucket"</span> {
  command = apply

  assert {
    condition     = aws_s3_bucket.data.bucket_regional_domain_name != <span class="code-string">""</span>
    error_message = <span class="code-string">"Bucket should have a regional domain name after creation"</span>
  }

  assert {
    condition     = aws_s3_bucket.data.tags[<span class="code-string">"Environment"</span>] == <span class="code-string">"test"</span>
    error_message = <span class="code-string">"Bucket must be tagged with the correct environment"</span>
  }
}

<span class="code-comment"># Override variables in a specific run block</span>
run <span class="code-string">"validates_production_sizing"</span> {
  command = plan

  variables {
    environment  = <span class="code-string">"production"</span>
    instance_type = <span class="code-string">"m5.xlarge"</span>
  }

  assert {
    condition     = aws_instance.web.instance_type == <span class="code-string">"m5.xlarge"</span>
    error_message = <span class="code-string">"Production should use m5.xlarge"</span>
  }
}</code></pre>

<pre><code><span class="code-comment"># Run all tests</span>
terraform test

<span class="code-comment"># Run tests with verbose output</span>
terraform test -verbose

<span class="code-comment"># Run a specific test file</span>
terraform test -filter=tests/basic.tftest.hcl

<span class="code-comment"># JSON output for CI</span>
terraform test -json</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Provider Mocking</h3>

                <p>Terraform 1.7 added mock providers for fast unit tests that never touch real infrastructure. Mock providers simulate provider behavior, returning placeholder values so you can test module logic, variable validation, and output expressions without any API calls.</p>

<pre><code><span class="code-comment"># tests/unit.tftest.hcl &mdash; mock provider tests</span>

<span class="code-comment"># Mock the AWS provider entirely</span>
mock_provider <span class="code-string">"aws"</span> {}

<span class="code-comment"># All resources get synthetic values; no real API calls</span>
run <span class="code-string">"test_naming_convention"</span> {
  command = plan

  variables {
    project_name = <span class="code-string">"payments"</span>
    environment  = <span class="code-string">"staging"</span>
  }

  assert {
    condition     = aws_s3_bucket.data.bucket == <span class="code-string">"payments-staging-data"</span>
    error_message = <span class="code-string">"Bucket name should follow {project}-{env}-data pattern"</span>
  }
}

<span class="code-comment"># Mock with overridden data for specific resources</span>
mock_provider <span class="code-string">"aws"</span> {
  alias = <span class="code-string">"with_data"</span>

  mock_data <span class="code-string">"aws_caller_identity"</span> {
    defaults = {
      account_id = <span class="code-string">"123456789012"</span>
      arn        = <span class="code-string">"arn:aws:iam::123456789012:root"</span>
    }
  }
}

run <span class="code-string">"test_account_id_usage"</span> {
  command = plan

  providers = {
    aws = aws.with_data
  }

  assert {
    condition     = contains(aws_iam_policy.deploy.policy, <span class="code-string">"123456789012"</span>)
    error_message = <span class="code-string">"Policy should reference the correct account ID"</span>
  }
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Third-Party Testing Tools</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Tool</th>
                                <th>Type</th>
                                <th>Language</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>terraform test</code></td>
                                <td><span class="badge badge-ochre"><span>Native</span></span></td>
                                <td>HCL</td>
                                <td>Built-in testing framework with plan/apply assertions and mock providers</td>
                            </tr>
                            <tr>
                                <td><code>Terratest</code></td>
                                <td><span class="badge badge-red"><span>E2E</span></span></td>
                                <td>Go</td>
                                <td>Full integration testing &mdash; deploys real infrastructure, validates, destroys</td>
                            </tr>
                            <tr>
                                <td><code>tflint</code></td>
                                <td><span class="badge badge-outline"><span>Linter</span></span></td>
                                <td>Config</td>
                                <td>Pluggable linter that catches provider-specific errors (e.g., invalid instance types)</td>
                            </tr>
                            <tr>
                                <td><code>tfsec</code></td>
                                <td><span class="badge badge-red"><span>Security</span></span></td>
                                <td>Config</td>
                                <td>Static analysis for security misconfigurations (now part of Trivy)</td>
                            </tr>
                            <tr>
                                <td><code>checkov</code></td>
                                <td><span class="badge badge-red"><span>Compliance</span></span></td>
                                <td>Python</td>
                                <td>Policy-as-code scanner with 1000+ built-in checks for cloud security best practices</td>
                            </tr>
                            <tr>
                                <td><code>Sentinel</code></td>
                                <td><span class="badge badge-outline"><span>Policy</span></span></td>
                                <td>Sentinel</td>
                                <td>HashiCorp's enterprise policy framework &mdash; enforced in Terraform Cloud/Enterprise</td>
                            </tr>
                            <tr>
                                <td><code>OPA / Conftest</code></td>
                                <td><span class="badge badge-outline"><span>Policy</span></span></td>
                                <td>Rego</td>
                                <td>Open-source policy engine. Evaluate <code>terraform plan -out</code> JSON against Rego rules</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">CI/CD Integration</h3>

                <p>Integrate testing into your pipeline with a layered approach: fast checks first, then progressively more expensive validations.</p>

<pre><code><span class="code-comment"># Example: GitHub Actions workflow for Terraform CI</span>
name: Terraform CI
on: [pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: hashicorp/setup-terraform@v3

      <span class="code-comment"># Layer 1: Format check (instant)</span>
      - name: Check formatting
        run: terraform fmt -check -recursive

      <span class="code-comment"># Layer 2: Validate syntax (fast, no creds)</span>
      - name: Init &amp; validate
        run: |
          terraform init -backend=false
          terraform validate -json

      <span class="code-comment"># Layer 3: Lint (seconds)</span>
      - name: TFLint
        uses: terraform-linters/setup-tflint@v4
        run: tflint --recursive

      <span class="code-comment"># Layer 4: Security scan (seconds)</span>
      - name: Trivy / tfsec
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: config

      <span class="code-comment"># Layer 5: Native tests (seconds for mocked, minutes for apply)</span>
      - name: Terraform test
        run: terraform test

      <span class="code-comment"># Layer 6: Plan (requires credentials)</span>
      - name: Plan
        run: terraform plan -out=tfplan -no-color
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Plan as a Test</div>
                    <p>Even without a formal testing framework, <code>terraform plan -detailed-exitcode</code> is a powerful test: exit code <code>0</code> means no changes, <code>1</code> means error, and <code>2</code> means changes detected. Use this in CI to catch drift or unexpected modifications.</p>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 11: TROUBLESHOOTING
             ============================================ -->
        <section id="troubleshooting" class="section">
            <div class="section-header">
                <span class="section-number">11</span>
                <h2 class="section-title">Troubleshooting</h2>
                <p class="section-description">Diagnosing and resolving common Terraform errors. Debug logging, state recovery, drift detection, and systematic approaches to the issues you will inevitably encounter.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Error Categories</h3>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>Language Errors</h4>
                        <code>terraform validate</code>
                        <p>Syntax errors, invalid references, type mismatches, missing required arguments. Caught before any API calls.</p>
                    </div>
                    <div class="command-card">
                        <h4>State Errors</h4>
                        <code>terraform state list</code>
                        <p>State lock conflicts, corrupt state files, state/reality drift, missing resources in state.</p>
                    </div>
                    <div class="command-card">
                        <h4>Provider Errors</h4>
                        <code>terraform providers</code>
                        <p>Authentication failures, API rate limits, permission denied, version incompatibilities.</p>
                    </div>
                    <div class="command-card">
                        <h4>Core Errors</h4>
                        <code>terraform version</code>
                        <p>Dependency cycles, provider crashes, memory issues, Terraform version incompatibilities.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Common Errors &amp; Solutions</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Error</th>
                                <th>Cause</th>
                                <th>Solution</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>Resource already exists</code></td>
                                <td>Resource exists in the cloud but not in state</td>
                                <td>Import with <code>terraform import</code> or rename the resource</td>
                            </tr>
                            <tr>
                                <td><code>Error acquiring the state lock</code></td>
                                <td>Another process holds the lock, or a previous run crashed</td>
                                <td><code>terraform force-unlock &lt;LOCK_ID&gt;</code></td>
                            </tr>
                            <tr>
                                <td><code>Provider version constraints</code></td>
                                <td>Lock file conflicts with version constraints in config</td>
                                <td>Align constraints in <code>required_providers</code>, run <code>terraform init -upgrade</code></td>
                            </tr>
                            <tr>
                                <td><code>Cycle detected</code></td>
                                <td>Two or more resources reference each other</td>
                                <td>Refactor to break the cycle; use <code>depends_on</code> sparingly or introduce an intermediate resource</td>
                            </tr>
                            <tr>
                                <td><code>(known after apply)</code></td>
                                <td>Value depends on a resource that hasn't been created yet</td>
                                <td>Normal behavior &mdash; not an error. The value will be resolved during <code>apply</code></td>
                            </tr>
                            <tr>
                                <td><code>Error: No valid credential sources</code></td>
                                <td>Provider cannot find authentication credentials</td>
                                <td>Check env vars, shared credentials file, IAM role, or SSO configuration</td>
                            </tr>
                            <tr>
                                <td><code>AccessDeniedException</code></td>
                                <td>Authenticated but lacking required IAM permissions</td>
                                <td>Review and expand the IAM policy attached to the Terraform execution role</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-warning">
                    <div class="alert-title">Force-Unlock Safety</div>
                    <p><code>terraform force-unlock</code> is a dangerous operation. Only use it when you are certain no other process is running Terraform against this state. If a colleague's <code>apply</code> is genuinely in progress, force-unlocking can corrupt your state. Always verify that the lock holder process has actually terminated before unlocking.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Debug Logging</h3>

                <p>Terraform uses the <code>TF_LOG</code> environment variable to control log verbosity. Logs go to stderr by default. Set <code>TF_LOG_PATH</code> to write logs to a file for easier analysis.</p>

<pre><code><span class="code-comment"># Set log level (most verbose to least)</span>
export TF_LOG=TRACE   <span class="code-comment"># Everything &mdash; extremely verbose</span>
export TF_LOG=DEBUG   <span class="code-comment"># Detailed internal operations</span>
export TF_LOG=INFO    <span class="code-comment"># General operational messages</span>
export TF_LOG=WARN    <span class="code-comment"># Warnings only</span>
export TF_LOG=ERROR   <span class="code-comment"># Errors only</span>

<span class="code-comment"># Write logs to a file instead of stderr</span>
export TF_LOG_PATH=<span class="code-string">"./terraform-debug.log"</span>

<span class="code-comment"># Provider-specific logging</span>
export TF_LOG_CORE=WARN       <span class="code-comment"># Core Terraform at WARN level</span>
export TF_LOG_PROVIDER=TRACE  <span class="code-comment"># Provider plugins at TRACE level</span>

<span class="code-comment"># Run with debug logging for a single command</span>
TF_LOG=DEBUG terraform plan

<span class="code-comment"># Disable logging</span>
unset TF_LOG
unset TF_LOG_PATH</code></pre>

                <div class="alert alert-tip">
                    <div class="alert-title">Provider Debug Tip</div>
                    <p>When troubleshooting API issues, set <code>TF_LOG_PROVIDER=TRACE</code> while keeping <code>TF_LOG_CORE=WARN</code>. This shows the raw HTTP requests and responses from the provider without flooding your logs with Terraform's internal graph operations.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">State Recovery</h3>

                <p>If your state file becomes corrupted or lost, you have several recovery options depending on your backend configuration.</p>

<pre><code><span class="code-comment"># Pull the current state from the backend to a local file</span>
terraform state pull &gt; terraform.tfstate.backup

<span class="code-comment"># Push a local state file to the backend (use with extreme caution)</span>
terraform state push terraform.tfstate.backup

<span class="code-comment"># S3 backend: enable versioning for automatic state backups</span>
resource <span class="code-string">"aws_s3_bucket_versioning"</span> <span class="code-string">"state"</span> {
  bucket = aws_s3_bucket.terraform_state.id
  versioning_configuration {
    status = <span class="code-string">"Enabled"</span>
  }
}

<span class="code-comment"># Recover a previous state version from S3</span>
aws s3api list-object-versions \
  --bucket my-terraform-state \
  --prefix prod/terraform.tfstate

aws s3api get-object \
  --bucket my-terraform-state \
  --key prod/terraform.tfstate \
  --version-id <span class="code-string">"VERSION_ID"</span> \
  recovered.tfstate</code></pre>

                <div class="alert alert-info">
                    <div class="alert-title">Local State Backups</div>
                    <p>Terraform automatically creates a <code>terraform.tfstate.backup</code> file before writing a new state locally. With remote backends like S3, enable bucket versioning to maintain a full history of state changes that you can restore from.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Handling Drift</h3>

                <p>Drift occurs when real infrastructure diverges from the Terraform state &mdash; caused by manual changes, other tools, or external processes. Terraform detects drift during the refresh phase of every <code>plan</code> and <code>apply</code>.</p>

<pre><code><span class="code-comment"># Detect drift: plan compares state with reality</span>
terraform plan

<span class="code-comment"># Sync state with reality without changing infrastructure</span>
<span class="code-comment"># (updates state to match what actually exists)</span>
terraform apply -refresh-only

<span class="code-comment"># Import an unmanaged resource into state</span>
terraform import aws_instance.web i-0abc123def456789

<span class="code-comment"># Import block (TF 1.5+) &mdash; declarative import</span>
import {
  to = aws_instance.web
  id = <span class="code-string">"i-0abc123def456789"</span>
}

<span class="code-comment"># Generate configuration for imported resources (TF 1.5+)</span>
terraform plan -generate-config-out=generated.tf</code></pre>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>Detect Drift</h4>
                        <code>terraform plan</code>
                        <p>Shows differences between desired configuration, state, and actual infrastructure. Any drift appears as planned changes.</p>
                    </div>
                    <div class="command-card">
                        <h4>Sync State Only</h4>
                        <code>terraform apply -refresh-only</code>
                        <p>Updates state to match reality without applying config changes. Use when you accept the manual change.</p>
                    </div>
                    <div class="command-card">
                        <h4>Import Resource</h4>
                        <code>terraform import TYPE.NAME ID</code>
                        <p>Bring an existing resource under Terraform management. You must also write the corresponding resource block.</p>
                    </div>
                    <div class="command-card">
                        <h4>Force Replace</h4>
                        <code>terraform apply -replace=TYPE.NAME</code>
                        <p>Destroy and recreate a specific resource. Useful when a resource is in a bad state that in-place updates cannot fix.</p>
                    </div>
                </div>
            </div>

        </section>

        <!-- ============================================
             SECTION 12: TIPS & BEST PRACTICES
             ============================================ -->
        <section id="tips" class="section section-dark">
            <div class="section-header">
                <span class="section-number">12</span>
                <h2 class="section-title">Tips &amp; Best Practices</h2>
                <p class="section-description">Battle-tested conventions for organizing, securing, documenting, and scaling Terraform projects. The patterns that separate quick experiments from production-grade infrastructure code.</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Project Structure</h3>

                <p><strong>Simple layout</strong> &mdash; for small projects or single environments:</p>

<pre><code>project/
  main.tf           <span class="code-comment"># Resources</span>
  variables.tf      <span class="code-comment"># Input variable declarations</span>
  outputs.tf        <span class="code-comment"># Output declarations</span>
  terraform.tf      <span class="code-comment"># Provider &amp; backend config</span>
  terraform.tfvars  <span class="code-comment"># Variable values (not committed)</span></code></pre>

                <p><strong>Modular layout</strong> &mdash; for reusable components:</p>

<pre><code>project/
  modules/
    networking/
      main.tf
      variables.tf
      outputs.tf
    compute/
      main.tf
      variables.tf
      outputs.tf
  environments/
    dev/
      main.tf       <span class="code-comment"># Calls modules with dev settings</span>
      terraform.tf
      dev.tfvars
    staging/
      main.tf
      terraform.tf
      staging.tfvars
    production/
      main.tf
      terraform.tf
      prod.tfvars</code></pre>

                <p><strong>Component-based layout</strong> &mdash; for large organizations with independent teams:</p>

<pre><code>infrastructure/
  components/
    networking/       <span class="code-comment"># Separate state per component</span>
      main.tf
      backend.tf
    database/
      main.tf
      backend.tf
    application/
      main.tf
      backend.tf      <span class="code-comment"># References networking/database via remote state</span>
  modules/            <span class="code-comment"># Shared modules used by components</span>
    vpc/
    rds/
    ecs/</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Naming Conventions</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Element</th>
                                <th>Convention</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Resources</td>
                                <td>Use underscores, descriptive nouns</td>
                                <td><code>aws_instance.web_server</code></td>
                            </tr>
                            <tr>
                                <td>Variables</td>
                                <td>Descriptive, snake_case</td>
                                <td><code>var.instance_count</code></td>
                            </tr>
                            <tr>
                                <td>Outputs</td>
                                <td>Describe the value being exported</td>
                                <td><code>output "vpc_id"</code></td>
                            </tr>
                            <tr>
                                <td>Modules</td>
                                <td>Short, noun-based names</td>
                                <td><code>module "networking"</code></td>
                            </tr>
                            <tr>
                                <td>Locals</td>
                                <td>Computed names, prefixed composites</td>
                                <td><code>local.name_prefix</code></td>
                            </tr>
                            <tr>
                                <td>Data sources</td>
                                <td>Describe what you're looking up</td>
                                <td><code>data.aws_ami.ubuntu_latest</code></td>
                            </tr>
                            <tr>
                                <td>Files</td>
                                <td>Functional grouping</td>
                                <td><code>networking.tf</code>, <code>iam.tf</code>, <code>outputs.tf</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-info">
                    <div class="alert-title">Single-Resource Naming</div>
                    <p>When a module has only one resource of a given type, name it <code>"this"</code> or <code>"main"</code> rather than repeating the type name. For example: <code>aws_vpc.this</code> instead of <code>aws_vpc.vpc</code>. This is the convention used by the official Terraform AWS modules.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Tagging Strategy</h3>

                <p>Consistent tagging is essential for cost tracking, access control, and operational management. Define standard tags in the provider's <code>default_tags</code> block and supplement per-resource.</p>

<pre><code><span class="code-comment"># Provider-level default tags (applied to all resources)</span>
provider <span class="code-string">"aws"</span> {
  region = var.region

  default_tags {
    tags = {
      Environment = var.environment
      Project     = var.project_name
      ManagedBy   = <span class="code-string">"terraform"</span>
      Owner       = var.team_name
      CostCenter  = var.cost_center
    }
  }
}

<span class="code-comment"># Per-resource tags (merged with default_tags)</span>
resource <span class="code-string">"aws_instance"</span> <span class="code-string">"web"</span> {
  ami           = data.aws_ami.ubuntu.id
  instance_type = var.instance_type

  tags = {
    Name = <span class="code-string">"${var.project_name}-web-${var.environment}"</span>
    Role = <span class="code-string">"webserver"</span>
  }
}</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">.gitignore for Terraform</h3>

<pre><code><span class="code-comment"># Terraform .gitignore</span>

<span class="code-comment"># Local .terraform directories</span>
**/.terraform/*

<span class="code-comment"># .tfstate files (state should live in remote backend)</span>
*.tfstate
*.tfstate.*

<span class="code-comment"># Crash log files</span>
crash.log
crash.*.log

<span class="code-comment"># Variable files that may contain secrets</span>
*.tfvars
*.tfvars.json

<span class="code-comment"># Override files (used for local dev overrides)</span>
override.tf
override.tf.json
*_override.tf
*_override.tf.json

<span class="code-comment"># CLI configuration files</span>
.terraformrc
terraform.rc

<span class="code-comment"># KEEP the lock file committed</span>
<span class="code-comment"># !.terraform.lock.hcl</span></code></pre>

                <div class="alert alert-warning">
                    <div class="alert-title">Always Commit the Lock File</div>
                    <p>The <code>.terraform.lock.hcl</code> file records the exact provider versions and hashes used. Always commit this file to version control. It ensures every team member and CI pipeline uses identical provider binaries, preventing subtle inconsistencies.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Formatting &amp; Linting</h3>

<pre><code><span class="code-comment"># Format all files in current directory (recursive)</span>
terraform fmt -recursive

<span class="code-comment"># Check formatting without modifying (for CI)</span>
terraform fmt -check -recursive -diff

<span class="code-comment"># Pre-commit hook configuration (.pre-commit-config.yaml)</span>
repos:
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.96.1
    hooks:
      - id: terraform_fmt
      - id: terraform_validate
      - id: terraform_tflint
      - id: terraform_docs
      - id: terraform_trivy</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Security</h3>

                <div class="command-grid">
                    <div class="command-card">
                        <h4>Never Hardcode Secrets</h4>
                        <code>variable "db_password" { sensitive = true }</code>
                        <p>Use Vault, AWS SSM Parameter Store, environment variables, or <code>.tfvars</code> files excluded from version control. Never put secrets in <code>.tf</code> files.</p>
                    </div>
                    <div class="command-card">
                        <h4>Mark Sensitive Outputs</h4>
                        <code>output "password" { sensitive = true }</code>
                        <p>Prevents values from appearing in CLI output or logs. Downstream modules still receive the value but it is redacted in plan output.</p>
                    </div>
                    <div class="command-card">
                        <h4>Encrypt State</h4>
                        <code>encrypt = true  # in backend config</code>
                        <p>State files contain sensitive data (passwords, keys). Use encrypted backends (S3 with SSE, GCS with CMEK) and restrict access with IAM.</p>
                    </div>
                    <div class="command-card">
                        <h4>Least Privilege</h4>
                        <code>iam_role_arn = "arn:aws:iam::..."</code>
                        <p>Give Terraform only the permissions it needs. Use separate roles for plan (read-only) and apply (write). Audit with CloudTrail.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Cost Estimation &amp; Documentation</h3>

<pre><code><span class="code-comment"># Infracost &mdash; cost breakdown from plan</span>
infracost breakdown --path=.

<span class="code-comment"># Infracost in CI &mdash; comment on PR with cost diff</span>
infracost diff --path=. \
  --compare-to=infracost-base.json \
  --format=json &gt; infracost-diff.json

infracost comment github \
  --path=infracost-diff.json \
  --repo=myorg/myrepo \
  --pull-request=$PR_NUMBER

<span class="code-comment"># terraform-docs &mdash; auto-generate module README</span>
terraform-docs markdown table --output-file README.md .

<span class="code-comment"># terraform-docs in pre-commit</span>
repos:
  - repo: https://github.com/terraform-docs/terraform-docs
    rev: v0.19.0
    hooks:
      - id: terraform-docs-go
        args: [<span class="code-string">"markdown"</span>, <span class="code-string">"table"</span>, <span class="code-string">"--output-file"</span>, <span class="code-string">"README.md"</span>]</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Version Pinning</h3>

<pre><code>terraform {
  <span class="code-comment"># Pin Terraform itself to a minor version range</span>
  required_version = <span class="code-string">"&gt;= 1.7.0, &lt; 2.0.0"</span>

  required_providers {
    aws = {
      source  = <span class="code-string">"hashicorp/aws"</span>
      <span class="code-comment"># Pin provider to a minor version range</span>
      version = <span class="code-string">"~&gt; 5.40"</span>  <span class="code-comment"># Allows 5.40.x, 5.41.x, etc.</span>
    }
    random = {
      source  = <span class="code-string">"hashicorp/random"</span>
      version = <span class="code-string">"~&gt; 3.6"</span>
    }
  }
}

<span class="code-comment"># Version constraint operators:</span>
<span class="code-comment"># =  1.0.0    Exact version</span>
<span class="code-comment"># != 1.0.0    Exclude version</span>
<span class="code-comment"># &gt;  1.0.0    Greater than</span>
<span class="code-comment"># &gt;= 1.0.0    Greater than or equal</span>
<span class="code-comment"># &lt;  2.0.0    Less than</span>
<span class="code-comment"># ~&gt; 1.0      Pessimistic (allows 1.x, not 2.0)</span>
<span class="code-comment"># ~&gt; 1.0.0    Pessimistic (allows 1.0.x, not 1.1.0)</span></code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Top 10 Best Practices</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Practice</th>
                                <th>Why</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1</strong></td>
                                <td>Use remote state with locking</td>
                                <td>Prevents concurrent modifications and state corruption in teams</td>
                            </tr>
                            <tr>
                                <td><strong>2</strong></td>
                                <td>Pin provider and Terraform versions</td>
                                <td>Ensures reproducible builds; prevents surprise breaking changes</td>
                            </tr>
                            <tr>
                                <td><strong>3</strong></td>
                                <td>Commit the <code>.terraform.lock.hcl</code> file</td>
                                <td>Guarantees identical provider binaries across all environments</td>
                            </tr>
                            <tr>
                                <td><strong>4</strong></td>
                                <td>Use modules for reusable components</td>
                                <td>DRY principle; consistent infrastructure patterns across projects</td>
                            </tr>
                            <tr>
                                <td><strong>5</strong></td>
                                <td>Never hardcode secrets</td>
                                <td>Secrets in code end up in state files, logs, and version control</td>
                            </tr>
                            <tr>
                                <td><strong>6</strong></td>
                                <td>Use <code>for_each</code> over <code>count</code></td>
                                <td>Map-keyed resources survive reordering; count causes index-shift cascades</td>
                            </tr>
                            <tr>
                                <td><strong>7</strong></td>
                                <td>Always review the plan before apply</td>
                                <td>The plan is your safety net &mdash; never skip it, especially in production</td>
                            </tr>
                            <tr>
                                <td><strong>8</strong></td>
                                <td>Tag everything</td>
                                <td>Essential for cost allocation, ownership tracking, and automated operations</td>
                            </tr>
                            <tr>
                                <td><strong>9</strong></td>
                                <td>Keep state blast radius small</td>
                                <td>Split large monoliths into components; one bad apply shouldn't risk everything</td>
                            </tr>
                            <tr>
                                <td><strong>10</strong></td>
                                <td>Automate formatting and validation in CI</td>
                                <td>Catch issues early; enforce consistency without manual review burden</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-tip">
                    <div class="alert-title">Start Simple, Scale Gradually</div>
                    <p>Don't over-engineer your Terraform setup from day one. Start with a flat file structure, add modules when you see duplication, split state when the blast radius grows too large, and adopt policy tools when your team and compliance requirements demand it. Every layer of abstraction has a cost.</p>
                </div>
            </div>

        </section>

    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <a href="index.html">&larr; Back to Tech Guides</a>
                <div style="text-align: right;">
                    <div class="footer-title">TERRAFORM</div>
                    <div class="footer-subtitle">Infrastructure as Code</div>
                </div>
            </div>
        </div>
    </footer>

</body>
</html>
