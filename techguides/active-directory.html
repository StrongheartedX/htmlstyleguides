<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Directory & IAM — Tech Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Uncial+Antiqua&family=Cormorant+Garamond:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           ACTIVE DIRECTORY & IAM
           Byzantine Mosaic Design System — Tech Guide
           ============================================
           Tesserae patterns. Gold leaf borders.
           Imperial purple and lapis accents.
           Sacred geometry dividers.
           ============================================ */

        /* --- CSS VARIABLES / DESIGN TOKENS --- */
        :root {
            /* Typography */
            --font-display: 'Uncial Antiqua', cursive;
            --font-heading: 'Cinzel', serif;
            --font-body: 'Cormorant Garamond', serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, monospace;

            /* Spacing Scale (4px base) */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --space-7: 48px;
            --space-8: 64px;
            --space-9: 96px;
            --space-10: 128px;

            /* Byzantine Color Palette */
            --gold: #d4a012;
            --gold-light: #f0c848;
            --gold-dark: #a67c00;
            --gold-shimmer: linear-gradient(135deg, #f0c848 0%, #d4a012 25%, #a67c00 50%, #d4a012 75%, #f0c848 100%);
            --imperial-purple: #4a0e4e;
            --purple-light: #6b2d6e;
            --purple-dark: #2d0a30;
            --deep-crimson: #8b1538;
            --crimson-light: #b22222;
            --crimson-dark: #5c0f24;
            --lapis-blue: #1e3a5f;
            --lapis-light: #2e5a8f;
            --lapis-dark: #0f1e33;
            --emerald: #1a5c3a;
            --emerald-light: #2d8c5a;
            --emerald-dark: #0d3320;
            --ivory: #f5f0e1;
            --cream: #e8dcc4;
            --dark-bg: #1a1410;
            --mosaic-grout: #2a2218;

            /* Semantic Colors */
            --text-primary: var(--ivory);
            --text-secondary: rgba(245, 240, 225, 0.75);
            --text-gold: var(--gold-light);
            --bg-primary: var(--dark-bg);
            --bg-secondary: var(--mosaic-grout);
            --accent-primary: var(--gold);
            --accent-secondary: var(--imperial-purple);
            --accent-tertiary: var(--deep-crimson);

            /* Shadows & Effects */
            --shadow-gold: 0 0 30px rgba(212, 160, 18, 0.4);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.5);
            --shadow-inset: inset 0 2px 8px rgba(0, 0, 0, 0.3);
            --shimmer-animation: shimmer 3s ease-in-out infinite;

            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;

            /* Layout */
            --container-max: 1100px;
            --nav-height: 56px;

            /* Code Block */
            --code-bg: #110e0a;
            --code-text: #f0ead8;
            --code-comment: #7a7060;
            --code-keyword: #f0c848;
            --code-string: #2d8c5a;
            --code-param: #b22222;
        }

        /* --- ANIMATIONS --- */
        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes tesserae-shimmer {
            0%, 100% { opacity: 0.03; }
            50% { opacity: 0.06; }
        }

        /* --- BASE RESET --- */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            scroll-padding-top: 60px;
        }

        body {
            font-family: var(--font-body);
            font-size: 1.125rem;
            font-weight: 400;
            line-height: 1.7;
            color: var(--text-primary);
            background: var(--bg-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        ::selection {
            background: var(--gold);
            color: var(--dark-bg);
        }

        /* ============================================
           TESSERAE MOSAIC BACKGROUND PATTERN
           ============================================ */
        .tesserae-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background-color: var(--dark-bg);
            animation: tesserae-shimmer 4s ease-in-out infinite;
        }

        .tesserae-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                /* Tesserae grid pattern */
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 8px,
                    rgba(212, 160, 18, 0.03) 8px,
                    rgba(212, 160, 18, 0.03) 9px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 8px,
                    rgba(212, 160, 18, 0.03) 8px,
                    rgba(212, 160, 18, 0.03) 9px
                );
        }

        .tesserae-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(ellipse at 20% 30%, rgba(212, 160, 18, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(212, 160, 18, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(74, 14, 78, 0.05) 0%, transparent 60%);
        }

        /* Gold shimmer overlay */
        .gold-shimmer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.02;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(240, 200, 72, 0.3) 45%,
                rgba(240, 200, 72, 0.5) 50%,
                rgba(240, 200, 72, 0.3) 55%,
                transparent 70%
            );
            background-size: 400% 400%;
            animation: var(--shimmer-animation);
        }

        /* ============================================
           CONTAINER
           ============================================ */
        .container {
            position: relative;
            z-index: 1;
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 var(--space-6);
        }

        /* ============================================
           BACK LINK
           ============================================ */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--text-secondary);
            text-decoration: none;
            padding: var(--space-5) 0 var(--space-4);
            transition: color var(--transition-fast);
        }

        .back-link:hover {
            color: var(--gold-light);
        }

        /* ============================================
           HEADER WITH MANDORLA
           ============================================ */
        .header {
            text-align: center;
            padding: var(--space-9) var(--space-6);
            margin-bottom: var(--space-6);
            position: relative;
        }

        /* Mandorla (almond halo) shape */
        .header-mandorla {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: min(500px, 85%);
            height: 120%;
            pointer-events: none;
        }

        .header-mandorla::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid var(--gold);
            border-radius: 50% / 30%;
            opacity: 0.4;
        }

        .header-mandorla::after {
            content: '';
            position: absolute;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            border: 1px solid var(--gold);
            border-radius: 50% / 30%;
            opacity: 0.2;
        }

        .header-ornament {
            position: relative;
            margin-bottom: var(--space-6);
        }

        .header-ornament svg {
            width: 180px;
            height: 80px;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: clamp(2.25rem, 7vw, 4.5rem);
            font-weight: 400;
            letter-spacing: 0.1em;
            color: var(--gold-light);
            text-shadow:
                0 0 40px rgba(212, 160, 18, 0.6),
                0 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: var(--space-4);
            position: relative;
        }

        .header-subtitle {
            font-family: var(--font-heading);
            font-size: 1.125rem;
            color: var(--text-secondary);
            letter-spacing: 0.25em;
            text-transform: uppercase;
        }

        /* Chi-Rho style cross ornament */
        .header-cross {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            margin-top: var(--space-6);
        }

        .header-cross span {
            width: 12px;
            height: 12px;
            background: var(--gold);
            clip-path: polygon(
                50% 0%, 61% 35%, 98% 35%, 68% 57%,
                79% 91%, 50% 70%, 21% 91%, 32% 57%,
                2% 35%, 39% 35%
            );
        }

        .header-cross span:nth-child(2) {
            width: 20px;
            height: 20px;
            background: var(--deep-crimson);
        }

        /* ============================================
           STICKY JUMP NAV
           ============================================ */
        .jump-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-3) var(--space-5);
            background: linear-gradient(180deg, rgba(26, 20, 16, 0.98) 0%, rgba(42, 34, 24, 0.96) 100%);
            border-top: 2px solid var(--gold);
            border-bottom: 1px solid rgba(212, 160, 18, 0.3);
            margin-bottom: var(--space-8);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            white-space: nowrap;
            scrollbar-width: thin;
            scrollbar-color: var(--gold-dark) transparent;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .jump-nav::-webkit-scrollbar {
            height: 3px;
        }

        .jump-nav::-webkit-scrollbar-track {
            background: transparent;
        }

        .jump-nav::-webkit-scrollbar-thumb {
            background: var(--gold-dark);
            border-radius: 2px;
        }

        .jump-nav a {
            font-family: var(--font-heading);
            font-size: 0.625rem;
            font-weight: 500;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-secondary);
            text-decoration: none;
            padding: var(--space-2) var(--space-3);
            border-radius: 2px;
            transition: all var(--transition-fast);
            flex-shrink: 0;
            position: relative;
        }

        .jump-nav a:hover {
            color: var(--gold-light);
            background: rgba(212, 160, 18, 0.1);
        }

        .jump-nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 1px;
            background: var(--gold);
            transition: width var(--transition-fast);
        }

        .jump-nav a:hover::after {
            width: 70%;
        }

        .jump-nav-separator {
            color: rgba(212, 160, 18, 0.3);
            font-size: 0.5rem;
            flex-shrink: 0;
            user-select: none;
        }

        /* ============================================
           SECTION STRUCTURE
           ============================================ */
        .section {
            margin-bottom: var(--space-9);
        }

        .section-header {
            text-align: center;
            margin-bottom: var(--space-7);
        }

        .section-number {
            display: block;
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--gold);
            opacity: 0.3;
            margin-bottom: var(--space-2);
            line-height: 1;
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 600;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold-light);
            text-shadow: 0 0 20px rgba(212, 160, 18, 0.3);
            margin-bottom: var(--space-4);
        }

        /* Interlocking circles divider */
        .section-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .section-divider::before,
        .section-divider::after {
            content: '';
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .section-divider svg {
            width: 50px;
            height: 50px;
        }

        .section-desc {
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-secondary);
            max-width: 60ch;
            margin: var(--space-4) auto 0;
            text-align: center;
            line-height: 1.8;
        }

        /* ============================================
           SUBSECTION
           ============================================ */
        .subsection {
            margin-bottom: var(--space-7);
        }

        .subsection-title {
            font-family: var(--font-heading);
            font-size: 1.375rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gold-light);
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid rgba(212, 160, 18, 0.2);
        }

        .subsection p {
            font-size: 1.0625rem;
            font-weight: 400;
            color: var(--text-secondary);
            line-height: 1.85;
            margin-bottom: var(--space-4);
            max-width: 68ch;
        }

        .subsection ul, .subsection ol {
            margin-bottom: var(--space-4);
            padding-left: var(--space-5);
        }

        .subsection li {
            font-size: 1.0625rem;
            font-weight: 400;
            color: var(--text-secondary);
            line-height: 1.75;
            margin-bottom: var(--space-2);
        }

        .subsection li strong {
            color: var(--ivory);
            font-weight: 700;
        }

        /* ============================================
           CODE BLOCKS
           ============================================ */
        pre {
            background: var(--code-bg);
            border: 1px solid rgba(212, 160, 18, 0.25);
            border-left: 3px solid var(--gold);
            border-radius: 0;
            padding: var(--space-5);
            margin-bottom: var(--space-5);
            overflow-x: auto;
            position: relative;
            box-shadow: var(--shadow-inset);
        }

        pre::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 6px,
                    rgba(0, 0, 0, 0.08) 6px,
                    rgba(0, 0, 0, 0.08) 7px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 6px,
                    rgba(0, 0, 0, 0.08) 6px,
                    rgba(0, 0, 0, 0.08) 7px
                );
            pointer-events: none;
            opacity: 0.3;
        }

        pre code {
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            font-weight: 400;
            line-height: 1.7;
            color: var(--code-text);
            background: transparent;
            position: relative;
            z-index: 1;
        }

        /* Inline code */
        code {
            font-family: var(--font-mono);
            font-size: 0.85em;
            font-weight: 500;
            color: var(--gold-light);
            background: rgba(212, 160, 18, 0.1);
            padding: 2px 6px;
            border: 1px solid rgba(212, 160, 18, 0.15);
        }

        pre code {
            padding: 0;
            border: none;
            background: transparent;
        }

        /* Code block scrollbars */
        pre {
            scrollbar-width: thin;
            scrollbar-color: var(--gold-dark) rgba(0, 0, 0, 0.3);
        }

        pre::-webkit-scrollbar {
            height: 6px;
        }

        pre::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        pre::-webkit-scrollbar-thumb {
            background: var(--gold-dark);
            border-radius: 3px;
        }

        pre::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        .code-label {
            font-family: var(--font-heading);
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: var(--space-2);
            display: block;
        }

        /* ============================================
           TABLES
           ============================================ */
        .table-wrapper {
            overflow-x: auto;
            margin-bottom: var(--space-5);
            border: 1px solid rgba(212, 160, 18, 0.25);
            scrollbar-width: thin;
            scrollbar-color: var(--gold-dark) rgba(0, 0, 0, 0.3);
        }

        .table-wrapper::-webkit-scrollbar {
            height: 6px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: var(--gold-dark);
            border-radius: 3px;
        }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9375rem;
        }

        thead {
            background: linear-gradient(135deg, rgba(42, 34, 24, 0.95) 0%, rgba(26, 20, 16, 0.98) 100%);
        }

        th {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold-light);
            padding: var(--space-4) var(--space-5);
            text-align: left;
            border-bottom: 2px solid var(--gold);
        }

        td {
            font-family: var(--font-body);
            font-size: 1rem;
            color: var(--text-secondary);
            padding: var(--space-3) var(--space-5);
            border-bottom: 1px solid rgba(212, 160, 18, 0.1);
            vertical-align: top;
        }

        tr:hover td {
            background: rgba(212, 160, 18, 0.04);
        }

        td code {
            font-size: 0.8em;
        }

        /* ============================================
           COMMAND GRID
           ============================================ */
        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-5);
        }

        .command-card {
            background: rgba(42, 34, 24, 0.6);
            border: 1px solid rgba(212, 160, 18, 0.2);
            padding: var(--space-4) var(--space-5);
            position: relative;
            transition: all var(--transition-base);
        }

        .command-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 5px,
                    rgba(0, 0, 0, 0.04) 5px,
                    rgba(0, 0, 0, 0.04) 6px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 5px,
                    rgba(0, 0, 0, 0.04) 5px,
                    rgba(0, 0, 0, 0.04) 6px
                );
            pointer-events: none;
            opacity: 0.5;
        }

        .command-card:hover {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 160, 18, 0.15);
            transform: translateY(-2px);
        }

        .command-card h4 {
            font-family: var(--font-heading);
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: var(--space-2);
            position: relative;
            z-index: 1;
        }

        .command-card pre {
            margin-bottom: var(--space-2);
            border: none;
            border-left: 2px solid rgba(212, 160, 18, 0.3);
            padding: var(--space-3) var(--space-4);
            box-shadow: none;
        }

        .command-card pre::before {
            display: none;
        }

        .command-card .cmd-desc {
            font-family: var(--font-body);
            font-size: 0.875rem;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
        }

        /* ============================================
           ALERT / CALLOUT BOXES
           ============================================ */
        .alert {
            padding: var(--space-5);
            margin-bottom: var(--space-5);
            border: 1px solid;
            position: relative;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 5px,
                    rgba(0, 0, 0, 0.03) 5px,
                    rgba(0, 0, 0, 0.03) 6px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 5px,
                    rgba(0, 0, 0, 0.03) 5px,
                    rgba(0, 0, 0, 0.03) 6px
                );
            pointer-events: none;
        }

        .alert-title {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: var(--space-2);
            position: relative;
            z-index: 1;
        }

        .alert p {
            font-size: 1rem;
            line-height: 1.7;
            position: relative;
            z-index: 1;
        }

        .alert-info {
            background: rgba(30, 58, 95, 0.2);
            border-color: var(--lapis-blue);
            border-left: 3px solid var(--lapis-light);
            color: var(--text-secondary);
        }

        .alert-info .alert-title {
            color: var(--lapis-light);
        }

        .alert-warning {
            background: rgba(212, 160, 18, 0.1);
            border-color: var(--gold-dark);
            border-left: 3px solid var(--gold);
            color: var(--text-secondary);
        }

        .alert-warning .alert-title {
            color: var(--gold-light);
        }

        .alert-danger {
            background: rgba(139, 21, 56, 0.15);
            border-color: var(--deep-crimson);
            border-left: 3px solid var(--crimson-light);
            color: var(--text-secondary);
        }

        .alert-danger .alert-title {
            color: var(--crimson-light);
        }

        /* ============================================
           BADGE STYLING
           ============================================ */
        .badge {
            display: inline-block;
            font-family: var(--font-heading);
            font-size: 0.625rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 3px 10px;
            border: 1px solid;
            line-height: 1.4;
            vertical-align: middle;
        }

        .badge-gold {
            color: var(--gold-light);
            border-color: var(--gold);
            background: rgba(212, 160, 18, 0.15);
        }

        .badge-purple {
            color: var(--purple-light);
            border-color: var(--imperial-purple);
            background: rgba(74, 14, 78, 0.2);
        }

        .badge-lapis {
            color: var(--lapis-light);
            border-color: var(--lapis-blue);
            background: rgba(30, 58, 95, 0.2);
        }

        .badge-crimson {
            color: var(--crimson-light);
            border-color: var(--deep-crimson);
            background: rgba(139, 21, 56, 0.2);
        }

        .badge-emerald {
            color: var(--emerald-light);
            border-color: var(--emerald);
            background: rgba(26, 92, 58, 0.2);
        }

        /* ============================================
           GREEK KEY BORDER
           ============================================ */
        .greek-key-border {
            position: relative;
            padding: 4px;
            background: linear-gradient(90deg, var(--gold-dark), var(--gold), var(--gold-dark));
        }

        .greek-key-border::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='8' viewBox='0 0 40 8'%3E%3Cpath d='M0 0h8v4H4v4H0V0zm12 0h8v8h-4V4h-4V0zm12 0h8v4h-4v4h-4V0zm12 0h8v8h-4V4h-4V0z' fill='%231a1410'/%3E%3C/svg%3E");
            background-repeat: repeat-x;
            background-position: center;
        }

        /* ============================================
           FOOTER
           ============================================ */
        .site-footer {
            text-align: center;
            padding: var(--space-8) var(--space-6);
            margin-top: var(--space-9);
            border-top: 2px solid var(--gold);
            position: relative;
        }

        .site-footer::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .site-footer a {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--text-secondary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        .site-footer a:hover {
            color: var(--gold-light);
        }

        .footer-ornament {
            display: flex;
            justify-content: center;
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .footer-ornament span {
            width: 8px;
            height: 8px;
            background: var(--gold);
            opacity: 0.3;
            clip-path: polygon(
                50% 0%, 61% 35%, 98% 35%, 68% 57%,
                79% 91%, 50% 70%, 21% 91%, 32% 57%,
                2% 35%, 39% 35%
            );
        }

        /* ============================================
           RESPONSIVE BREAKPOINTS
           ============================================ */
        @media (max-width: 768px) {
            html {
                scroll-padding-top: 50px;
            }

            .container {
                padding: 0 var(--space-4);
            }

            .header {
                padding: var(--space-7) var(--space-4);
            }

            .header h1 {
                font-size: clamp(1.75rem, 8vw, 2.75rem);
                letter-spacing: 0.05em;
            }

            .header-subtitle {
                font-size: 0.875rem;
                letter-spacing: 0.15em;
            }

            .header-mandorla {
                width: 95%;
            }

            .jump-nav {
                padding: var(--space-2) var(--space-3);
                gap: 0;
            }

            .jump-nav a {
                font-size: 0.5625rem;
                padding: var(--space-2);
            }

            .section-number {
                font-size: 2.25rem;
            }

            .section-title {
                font-size: 1.5rem;
                letter-spacing: 0.12em;
            }

            .subsection-title {
                font-size: 1.125rem;
            }

            .command-grid {
                grid-template-columns: 1fr;
            }

            pre {
                padding: var(--space-4);
            }

            pre code {
                font-size: 0.75rem;
            }

            th, td {
                padding: var(--space-2) var(--space-3);
                font-size: 0.8125rem;
            }

            .alert {
                padding: var(--space-4);
            }

            .section-divider::before,
            .section-divider::after {
                width: 60px;
            }
        }
    </style>
</head>
<body>

    <!-- Tesserae background pattern -->
    <div class="tesserae-bg"></div>

    <!-- Gold shimmer overlay -->
    <div class="gold-shimmer-overlay"></div>

    <div class="container">

        <!-- Back Link -->
        <a href="index.html" class="back-link">&larr; Tech Guides</a>

        <!-- Header with Mandorla -->
        <header class="header">
            <div class="header-mandorla"></div>
            <div class="header-ornament">
                <svg viewBox="0 0 180 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Central cross ornament -->
                    <line x1="90" y1="5" x2="90" y2="75" stroke="#d4a012" stroke-width="1.5" opacity="0.5"/>
                    <line x1="50" y1="40" x2="130" y2="40" stroke="#d4a012" stroke-width="1.5" opacity="0.5"/>
                    <!-- Corner diamonds -->
                    <rect x="86" y="1" width="8" height="8" fill="#d4a012" transform="rotate(45 90 5)" opacity="0.6"/>
                    <rect x="86" y="71" width="8" height="8" fill="#d4a012" transform="rotate(45 90 75)" opacity="0.6"/>
                    <!-- Interlocking circles -->
                    <circle cx="90" cy="40" r="25" stroke="#d4a012" stroke-width="1" opacity="0.3"/>
                    <circle cx="90" cy="40" r="18" stroke="#d4a012" stroke-width="1" opacity="0.4"/>
                    <circle cx="90" cy="40" r="10" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                    <circle cx="90" cy="40" r="4" fill="#d4a012" opacity="0.5"/>
                </svg>
            </div>
            <h1>Active Directory<br>&amp; IAM</h1>
            <p class="header-subtitle">Identity Governance for the Imperial Domain</p>
            <div class="header-cross">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </header>

        <!-- Sticky Jump Nav -->
        <nav class="jump-nav">
            <a href="#quick-reference">01 Quick Reference</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#core-concepts">02 Core Concepts</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#ad-architecture">03 AD Architecture</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#ldap">04 LDAP</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#authentication">05 Authentication</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#rbac">06 RBAC</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#sso-federation">07 SSO &amp; Federation</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#azure-ad">08 Azure AD</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#group-policy">09 Group Policy</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#identity-governance">10 Governance</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#security">11 Security</a>
            <span class="jump-nav-separator">&bull;</span>
            <a href="#troubleshooting">12 Troubleshooting</a>
        </nav>

        <!-- ============================================
             SECTION 01: QUICK REFERENCE
             ============================================ -->
        <section id="quick-reference" class="section">
            <div class="section-header">
                <div class="section-number">I</div>
                <h2 class="section-title">Quick Reference</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#d4a012" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#d4a012"/>
                    </svg>
                </div>
                <p class="section-desc">Essential AD and IAM commands at your fingertips. Copy, paste, conquer.</p>
            </div>

            <div class="section-content">

                <!-- PowerShell AD Module -->
                <div class="subsection">
                    <h3 class="subsection-title">PowerShell AD Module</h3>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>Find a User</h4>
                            <pre><code class="language-powershell">Get-ADUser -Identity jsmith -Properties *</code></pre>
                            <p class="cmd-desc">Retrieve all properties for a specific user by sAMAccountName.</p>
                        </div>

                        <div class="command-card">
                            <h4>Search Users by Filter</h4>
                            <pre><code class="language-powershell">Get-ADUser -Filter {Department -eq "Engineering"} `
  -Properties Department, Title, Mail</code></pre>
                            <p class="cmd-desc">Query users matching a department filter with select properties.</p>
                        </div>

                        <div class="command-card">
                            <h4>List Group Members</h4>
                            <pre><code class="language-powershell">Get-ADGroupMember -Identity "Domain Admins" `
  -Recursive | Select Name, SamAccountName</code></pre>
                            <p class="cmd-desc">Recursively enumerate all members of a security group.</p>
                        </div>

                        <div class="command-card">
                            <h4>Find a Computer</h4>
                            <pre><code class="language-powershell">Get-ADComputer -Identity "WS-PC042" `
  -Properties OperatingSystem, LastLogonDate</code></pre>
                            <p class="cmd-desc">Look up a computer object with OS and last-logon metadata.</p>
                        </div>

                        <div class="command-card">
                            <h4>Create a New User</h4>
                            <pre><code class="language-powershell">New-ADUser -Name "Jane Doe" `
  -SamAccountName jdoe `
  -UserPrincipalName jdoe@corp.contoso.com `
  -Path "OU=Users,DC=corp,DC=contoso,DC=com" `
  -AccountPassword (Read-Host -AsSecureString) `
  -Enabled $true</code></pre>
                            <p class="cmd-desc">Provision a new user account in a specific OU with an interactive password prompt.</p>
                        </div>

                        <div class="command-card">
                            <h4>Modify User Attributes</h4>
                            <pre><code class="language-powershell">Set-ADUser -Identity jdoe `
  -Title "Senior Engineer" `
  -Department "Platform" `
  -Manager "CN=John Smith,OU=Users,DC=corp,DC=contoso,DC=com"</code></pre>
                            <p class="cmd-desc">Update title, department, and manager for an existing user.</p>
                        </div>

                        <div class="command-card">
                            <h4>Remove Group Member</h4>
                            <pre><code class="language-powershell">Remove-ADGroupMember -Identity "VPN-Users" `
  -Members jdoe -Confirm:$false</code></pre>
                            <p class="cmd-desc">Silently remove a user from a security group.</p>
                        </div>

                        <div class="command-card">
                            <h4>Domain &amp; Forest Info</h4>
                            <pre><code class="language-powershell"># Domain details
Get-ADDomain | Select DNSRoot, DomainMode, PDCEmulator

# Forest details
Get-ADForest | Select Name, ForestMode, RootDomain</code></pre>
                            <p class="cmd-desc">Quick overview of domain and forest functional levels.</p>
                        </div>
                    </div>
                </div>

                <!-- LDAP Queries -->
                <div class="subsection">
                    <h3 class="subsection-title">LDAP Queries</h3>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>User Lookup</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -b "DC=corp,DC=contoso,DC=com" \
  -D "CN=svc-ldap,OU=Service,DC=corp,DC=contoso,DC=com" \
  -W "(sAMAccountName=jsmith)" \
  cn mail memberOf</code></pre>
                            <p class="cmd-desc">Search for a user by sAMAccountName and return name, email, and group memberships.</p>
                        </div>

                        <div class="command-card">
                            <h4>Group Membership</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -b "DC=corp,DC=contoso,DC=com" \
  -W "(&amp;(objectClass=group)(cn=Domain Admins))" \
  member</code></pre>
                            <p class="cmd-desc">List all members of a specific group using an LDAP filter.</p>
                        </div>

                        <div class="command-card">
                            <h4>Computer Objects</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -b "OU=Workstations,DC=corp,DC=contoso,DC=com" \
  "(objectClass=computer)" \
  cn operatingSystem lastLogonTimestamp</code></pre>
                            <p class="cmd-desc">Enumerate computer objects within a specific OU with OS details.</p>
                        </div>

                        <div class="command-card">
                            <h4>Disabled Accounts</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -b "DC=corp,DC=contoso,DC=com" \
  "(&amp;(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=2))" \
  cn sAMAccountName</code></pre>
                            <p class="cmd-desc">Find all disabled user accounts using the UAC bitmask filter.</p>
                        </div>
                    </div>
                </div>

                <!-- Diagnostic Commands -->
                <div class="subsection">
                    <h3 class="subsection-title">Diagnostic Commands</h3>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>DC Health Check</h4>
                            <pre><code class="language-powershell">dcdiag /v /c /d /e /s:DC01</code></pre>
                            <p class="cmd-desc">Run a comprehensive diagnostic against DC01 with verbose output across all tests.</p>
                        </div>

                        <div class="command-card">
                            <h4>Replication Status</h4>
                            <pre><code class="language-powershell">repadmin /showrepl DC01
repadmin /replsummary</code></pre>
                            <p class="cmd-desc">Show inbound replication partners and a site-wide summary of replication health.</p>
                        </div>

                        <div class="command-card">
                            <h4>DC Locator</h4>
                            <pre><code class="language-powershell">nltest /dsgetdc:corp.contoso.com /force
nltest /sc_verify:corp.contoso.com</code></pre>
                            <p class="cmd-desc">Force-locate a domain controller and verify the secure channel trust.</p>
                        </div>

                        <div class="command-card">
                            <h4>Group Policy Results</h4>
                            <pre><code class="language-powershell"># Current user/computer policy
gpresult /r

# Force policy refresh
gpupdate /force /boot /logoff</code></pre>
                            <p class="cmd-desc">Display applied GPOs and force an immediate policy update cycle.</p>
                        </div>
                    </div>
                </div>

                <!-- Azure CLI -->
                <div class="subsection">
                    <h3 class="subsection-title">Azure CLI (Entra ID)</h3>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>List Users</h4>
                            <pre><code class="language-bash">az ad user list \
  --query "[].{Name:displayName, UPN:userPrincipalName, ID:id}" \
  --output table</code></pre>
                            <p class="cmd-desc">Retrieve all Entra ID users in a formatted table with name, UPN, and object ID.</p>
                        </div>

                        <div class="command-card">
                            <h4>Create a Group</h4>
                            <pre><code class="language-bash">az ad group create \
  --display-name "SG-Platform-Engineers" \
  --mail-nickname "sg-platform-eng" \
  --description "Platform engineering team"</code></pre>
                            <p class="cmd-desc">Create a new security group in Entra ID with a display name and description.</p>
                        </div>

                        <div class="command-card">
                            <h4>List Service Principals</h4>
                            <pre><code class="language-bash">az ad sp list \
  --filter "displayName eq 'MyApp'" \
  --query "[].{Name:displayName, AppId:appId}" \
  --output table</code></pre>
                            <p class="cmd-desc">Find service principals (app registrations) by display name.</p>
                        </div>

                        <div class="command-card">
                            <h4>Assign Role</h4>
                            <pre><code class="language-bash">az role assignment create \
  --assignee jdoe@contoso.com \
  --role "Reader" \
  --scope "/subscriptions/{sub-id}"</code></pre>
                            <p class="cmd-desc">Grant the Reader role to a user at the subscription scope.</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 02: CORE CONCEPTS
             ============================================ -->
        <section id="core-concepts" class="section">
            <div class="section-header">
                <div class="section-number">II</div>
                <h2 class="section-title">Core Concepts</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#8b1538" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#8b1538" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#8b1538" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#8b1538"/>
                    </svg>
                </div>
                <p class="section-desc">The foundational pillars of identity and access management, from authentication primitives to the claims that bind them.</p>
            </div>

            <div class="section-content">

                <!-- Identity vs Authentication vs Authorization -->
                <div class="subsection">
                    <h3 class="subsection-title">Identity vs Authentication vs Authorization</h3>
                    <p>These three concepts form the <strong>AAA model</strong> (Authentication, Authorization, and Accounting) that underpins every identity system. While often conflated, each serves a distinct purpose in the security lifecycle.</p>

                    <ul>
                        <li><strong>Identity</strong> &mdash; A claim about <em>who</em> you are. An identity is a set of attributes (username, email, employee ID) that uniquely describe an entity within a system. Identities exist before any verification occurs.</li>
                        <li><strong>Authentication (AuthN)</strong> &mdash; The process of <em>proving</em> that identity claim is valid. This is where credentials enter the picture: passwords, certificates, biometrics, or hardware tokens. Multi-factor authentication (MFA) layers multiple proof types for stronger assurance.</li>
                        <li><strong>Authorization (AuthZ)</strong> &mdash; Determining <em>what</em> an authenticated identity is allowed to do. Authorization is evaluated after authentication and relies on policies, roles, group memberships, or attribute-based rules.</li>
                    </ul>

                    <div class="alert alert-info">
                        <div class="alert-title">The AAA Triad</div>
                        <p>The third "A" is <strong>Accounting</strong> (also called Auditing). It answers the question: <em>what did this identity actually do?</em> Audit logs, sign-in records, and access reviews all fall under accounting. Without it, authentication and authorization are unverifiable.</p>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Concept</th>
                                    <th>Question Answered</th>
                                    <th>AD Example</th>
                                    <th>Token Field</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Identity</strong></td>
                                    <td>Who are you?</td>
                                    <td>sAMAccountName: <code>jsmith</code></td>
                                    <td><code>sub</code> (subject)</td>
                                </tr>
                                <tr>
                                    <td><strong>Authentication</strong></td>
                                    <td>Can you prove it?</td>
                                    <td>Kerberos TGT via password/smartcard</td>
                                    <td><code>auth_time</code>, <code>amr</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Authorization</strong></td>
                                    <td>What can you do?</td>
                                    <td>Member of <code>Domain Admins</code></td>
                                    <td><code>roles</code>, <code>groups</code>, <code>scp</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Accounting</strong></td>
                                    <td>What did you do?</td>
                                    <td>Security Event ID 4624 (logon)</td>
                                    <td>Audit log correlation ID</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Directory Services -->
                <div class="subsection">
                    <h3 class="subsection-title">Directory Services</h3>
                    <p>A <strong>directory service</strong> is a specialized database optimized for read-heavy lookups of identity data. Unlike relational databases designed for transactions, directories are hierarchical, schema-driven, and tuned for queries like "find all users in the Engineering department" or "what groups does this computer belong to?"</p>

                    <p>Active Directory Domain Services (AD DS) is Microsoft's implementation, first shipped with Windows 2000. It stores objects (users, groups, computers, printers) in a hierarchical namespace modeled on the X.500 standard and queried via <strong>LDAP</strong> (Lightweight Directory Access Protocol).</p>

                    <p>Why centralized identity matters:</p>
                    <ul>
                        <li><strong>Single source of truth</strong> &mdash; One authoritative store for all identity data eliminates credential sprawl and orphaned accounts.</li>
                        <li><strong>Consistent policy enforcement</strong> &mdash; Group Policy, conditional access, and security baselines propagate from one place.</li>
                        <li><strong>Reduced attack surface</strong> &mdash; Centralized credential stores are easier to monitor, rotate, and harden than scattered local accounts.</li>
                        <li><strong>Scalable delegation</strong> &mdash; OU-based administration lets you grant scoped control without sharing domain-wide privileges.</li>
                    </ul>
                </div>

                <!-- Security Principals -->
                <div class="subsection">
                    <h3 class="subsection-title">Security Principals</h3>
                    <p>A <strong>security principal</strong> is any entity that can be authenticated by the operating system and assigned permissions to resources. In Active Directory, every security principal has a unique <strong>Security Identifier (SID)</strong> that the system uses internally (never the display name).</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Principal Type</th>
                                    <th>Description</th>
                                    <th>SID Prefix</th>
                                    <th>Common Use</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>User</strong></td>
                                    <td>Human or interactive identity</td>
                                    <td><code>S-1-5-21-...-RID</code></td>
                                    <td>Employee login, resource access</td>
                                </tr>
                                <tr>
                                    <td><strong>Computer</strong></td>
                                    <td>Machine account joined to domain</td>
                                    <td><code>S-1-5-21-...-RID</code></td>
                                    <td>GPO application, Kerberos auth</td>
                                </tr>
                                <tr>
                                    <td><strong>Security Group</strong></td>
                                    <td>Collection of principals for ACL assignment</td>
                                    <td><code>S-1-5-21-...-RID</code></td>
                                    <td>File share permissions, app roles</td>
                                </tr>
                                <tr>
                                    <td><strong>Service Account</strong></td>
                                    <td>Identity for background services</td>
                                    <td><code>S-1-5-21-...-RID</code></td>
                                    <td>SQL Server, IIS app pools</td>
                                </tr>
                                <tr>
                                    <td><strong>gMSA</strong></td>
                                    <td>Group Managed Service Account (auto-password rotation)</td>
                                    <td><code>S-1-5-21-...-RID</code></td>
                                    <td>Scheduled tasks, service farm identity</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-warning">
                        <div class="alert-title">Well-Known SIDs</div>
                        <p>Some SIDs are universal across every Windows installation. <code>S-1-5-18</code> is always the Local System account. <code>S-1-5-32-544</code> is always the local Administrators group. Attackers who compromise these principals gain the highest level of control on that machine.</p>
                    </div>
                </div>

                <!-- Claims-Based Identity -->
                <div class="subsection">
                    <h3 class="subsection-title">Claims-Based Identity</h3>
                    <p>Modern identity systems have moved beyond simple username/password verification toward a <strong>claims-based</strong> model. Instead of each application querying AD directly, an <strong>Identity Provider (IdP)</strong> issues a cryptographically signed token containing <strong>claims</strong> &mdash; key-value assertions about the subject.</p>

                    <ul>
                        <li><strong>Token</strong> &mdash; A signed data structure (SAML assertion, JWT, Kerberos ticket) that carries claims. The signature proves the IdP vouches for the contents.</li>
                        <li><strong>Claim</strong> &mdash; A single assertion: <code>email=jdoe@contoso.com</code>, <code>role=admin</code>, <code>department=Engineering</code>. Claims can describe identity, entitlements, or context.</li>
                        <li><strong>Assertion</strong> &mdash; A collection of claims packaged in a token, along with metadata about when and how the subject was authenticated.</li>
                    </ul>

                    <pre><code class="language-bash"># Decoded JWT claims (simplified)
{
  "sub": "jdoe@contoso.com",
  "name": "Jane Doe",
  "groups": ["Domain Admins", "VPN-Users"],
  "roles": ["GlobalAdmin"],
  "iss": "https://login.microsoftonline.com/{tenant-id}",
  "aud": "https://graph.microsoft.com",
  "iat": 1700000000,
  "exp": 1700003600,
  "amr": ["pwd", "mfa"]
}</code></pre>

                    <p>The shift to claims-based identity enables <strong>federation</strong>: an application in one organization can trust tokens issued by another organization's IdP, provided there is a trust relationship. This is the foundation of SSO, SAML, and OpenID Connect.</p>
                </div>

                <!-- The CIA Triad in IAM -->
                <div class="subsection">
                    <h3 class="subsection-title">The CIA Triad in IAM</h3>
                    <p>The CIA triad (Confidentiality, Integrity, Availability) applies directly to identity infrastructure. A breach in any pillar can cascade into full domain compromise.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Pillar</th>
                                    <th>IAM Application</th>
                                    <th>Threat Example</th>
                                    <th>Control</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Confidentiality</strong></td>
                                    <td>Credentials and tokens must remain secret</td>
                                    <td>NTLM hash extraction (Mimikatz)</td>
                                    <td>Credential Guard, LAPS, MFA</td>
                                </tr>
                                <tr>
                                    <td><strong>Integrity</strong></td>
                                    <td>Identity data and policies must be tamper-proof</td>
                                    <td>AD object modification (DCShadow)</td>
                                    <td>AdminSDHolder, signed LDAP, audit logging</td>
                                </tr>
                                <tr>
                                    <td><strong>Availability</strong></td>
                                    <td>Authentication services must remain operational</td>
                                    <td>DC denial-of-service, replication failure</td>
                                    <td>Multi-DC topology, site redundancy</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">Identity Is the New Perimeter</div>
                        <p>In zero-trust architectures, the network boundary is no longer the primary trust boundary. Identity <em>is</em> the perimeter. Every access decision must verify who is requesting, from what device, under what conditions &mdash; regardless of network location.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 03: AD ARCHITECTURE
             ============================================ -->
        <section id="ad-architecture" class="section">
            <div class="section-header">
                <div class="section-number">III</div>
                <h2 class="section-title">AD Architecture</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#4a0e4e" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#4a0e4e" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#4a0e4e" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#4a0e4e"/>
                    </svg>
                </div>
                <p class="section-desc">The logical and physical topology of Active Directory &mdash; forests, domains, replication, and the FSMO roles that hold it all together.</p>
            </div>

            <div class="section-content">

                <!-- Forests, Domains, Trees -->
                <div class="subsection">
                    <h3 class="subsection-title">Forests, Domains, and Trees</h3>
                    <p>Active Directory's logical structure is a hierarchy of <strong>forests</strong>, <strong>trees</strong>, and <strong>domains</strong>. Understanding this hierarchy is essential because it defines the boundaries of trust, replication, and administration.</p>

                    <ul>
                        <li><strong>Forest</strong> &mdash; The outermost security boundary in AD. All domains within a forest share a common schema, configuration partition, and Global Catalog. A forest is named after its first (root) domain. Trust does <em>not</em> automatically extend beyond the forest boundary.</li>
                        <li><strong>Tree</strong> &mdash; A collection of domains that share a contiguous DNS namespace. For example, <code>corp.contoso.com</code> and <code>us.corp.contoso.com</code> form a tree because one is a child of the other.</li>
                        <li><strong>Domain</strong> &mdash; The core unit of administration and replication. Each domain has its own set of domain controllers, its own security policy, and its own trust relationships. A domain represents a partition of the directory database.</li>
                    </ul>

                    <pre><code class="language-powershell"># View forest topology
Get-ADForest | Select-Object Name, RootDomain, Domains, ForestMode

# Example output:
# Name       : contoso.com
# RootDomain : contoso.com
# Domains    : {contoso.com, corp.contoso.com, eu.contoso.com}
# ForestMode : Windows2016Forest

# View current domain details
Get-ADDomain | Select-Object DNSRoot, NetBIOSName, DomainMode, ParentDomain

# Example output:
# DNSRoot      : corp.contoso.com
# NetBIOSName  : CORP
# DomainMode   : Windows2016Domain
# ParentDomain : contoso.com</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">Trust Relationships</div>
                        <p>Within a forest, all domains trust each other via automatic <strong>transitive, two-way trusts</strong>. Cross-forest trusts must be created manually and can be one-way or two-way. The forest is the ultimate trust boundary &mdash; schema changes in one forest never propagate to another.</p>
                    </div>
                </div>

                <!-- Organizational Units -->
                <div class="subsection">
                    <h3 class="subsection-title">Organizational Units (OUs)</h3>
                    <p><strong>Organizational Units</strong> are containers within a domain that let you organize objects (users, computers, groups) into logical hierarchies. Unlike domains, OUs do not create security boundaries &mdash; they exist for administrative delegation and Group Policy scoping.</p>

                    <p>Key design principles for OU structure:</p>
                    <ul>
                        <li><strong>Delegation</strong> &mdash; Assign granular permissions at the OU level so helpdesk staff can reset passwords in <code>OU=Users</code> without touching <code>OU=Servers</code>.</li>
                        <li><strong>Group Policy linkage</strong> &mdash; GPOs can be linked to OUs, applying specific configurations only to the objects within. Nest OUs to create inherited policy chains.</li>
                        <li><strong>Flat over deep</strong> &mdash; Avoid nesting beyond 3-4 levels. Deep OU trees complicate GPO inheritance, delegation audits, and LDAP query performance.</li>
                        <li><strong>Separate users and computers</strong> &mdash; User and computer policies differ fundamentally. Keeping them in parallel OU branches makes policy targeting cleaner.</li>
                    </ul>

                    <pre><code class="language-powershell"># List top-level OUs in the current domain
Get-ADOrganizationalUnit -Filter * -SearchScope OneLevel |
  Select-Object Name, DistinguishedName

# Create a new OU with accidental-deletion protection
New-ADOrganizationalUnit -Name "Service Accounts" `
  -Path "DC=corp,DC=contoso,DC=com" `
  -ProtectedFromAccidentalDeletion $true

# Delegate password-reset rights on an OU
dsacls "OU=Users,DC=corp,DC=contoso,DC=com" /G "CORP\Helpdesk:CA;Reset Password;user"</code></pre>
                </div>

                <!-- Domain Controllers -->
                <div class="subsection">
                    <h3 class="subsection-title">Domain Controllers</h3>
                    <p>A <strong>Domain Controller (DC)</strong> is a server that hosts a writable (or read-only) copy of the AD database (<code>ntds.dit</code>), responds to authentication requests, and replicates changes with its peers. Active Directory uses a <strong>multi-master replication</strong> model: any DC can accept writes, and changes propagate to all other DCs in the domain.</p>

                    <ul>
                        <li><strong>Multi-master replication</strong> &mdash; Unlike single-master databases, every DC can process writes simultaneously. Conflict resolution uses update sequence numbers (USNs) and timestamps. The "last writer wins" for attribute-level conflicts.</li>
                        <li><strong>RODC</strong> &mdash; A <strong>Read-Only Domain Controller</strong> stores a non-writable copy of the database. Used in branch offices where physical security is weaker. RODCs never replicate outbound and cache only specifically allowed credentials.</li>
                        <li><strong>Placement strategy</strong> &mdash; Deploy at least two DCs per domain for redundancy. Place DCs geographically close to users and application servers to minimize authentication latency.</li>
                    </ul>

                    <div class="alert alert-danger">
                        <div class="alert-title">Protect Your DCs</div>
                        <p>Domain Controllers are Tier 0 assets. Compromise of a single DC means compromise of the entire domain. DCs should run on dedicated hardware (or isolated VMs), have restricted admin access, and never run non-AD workloads. Treat them like crown jewels.</p>
                    </div>
                </div>

                <!-- FSMO Roles -->
                <div class="subsection">
                    <h3 class="subsection-title">FSMO Roles</h3>
                    <p>While AD is multi-master, five operations require a single authoritative DC to avoid conflicts. These are the <strong>Flexible Single Master Operations (FSMO)</strong> roles. Two are forest-wide; three exist per domain.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Role</th>
                                    <th>Scope</th>
                                    <th>Purpose</th>
                                    <th>Recovery Priority</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Schema Master</strong></td>
                                    <td><span class="badge badge-gold">Forest</span></td>
                                    <td>Controls all schema modifications (adding attributes, classes). Only one DC in the entire forest can write to the schema partition.</td>
                                    <td><span class="badge badge-emerald">Low</span> &mdash; Schema changes are rare</td>
                                </tr>
                                <tr>
                                    <td><strong>Domain Naming Master</strong></td>
                                    <td><span class="badge badge-gold">Forest</span></td>
                                    <td>Authorizes adding or removing domains from the forest. Ensures domain name uniqueness across the forest.</td>
                                    <td><span class="badge badge-emerald">Low</span> &mdash; Domain additions are rare</td>
                                </tr>
                                <tr>
                                    <td><strong>RID Master</strong></td>
                                    <td><span class="badge badge-lapis">Domain</span></td>
                                    <td>Allocates pools of Relative IDs (RIDs) to each DC. RIDs are combined with the domain SID to create unique SIDs for new objects.</td>
                                    <td><span class="badge badge-gold">Medium</span> &mdash; DC runs out of RIDs if pool exhausted</td>
                                </tr>
                                <tr>
                                    <td><strong>PDC Emulator</strong></td>
                                    <td><span class="badge badge-lapis">Domain</span></td>
                                    <td>Processes password changes, account lockouts, time sync (NTP root), and is the default target for Group Policy edits.</td>
                                    <td><span class="badge badge-crimson">Critical</span> &mdash; Immediate user impact</td>
                                </tr>
                                <tr>
                                    <td><strong>Infrastructure Master</strong></td>
                                    <td><span class="badge badge-lapis">Domain</span></td>
                                    <td>Updates cross-domain object references (e.g., when a group in Domain A references a user in Domain B). Not needed if all DCs are Global Catalogs.</td>
                                    <td><span class="badge badge-emerald">Low</span> &mdash; Impact only in multi-domain forests</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-powershell"># Find all FSMO role holders
netdom query fsmo

# PowerShell equivalent
Get-ADForest | Select SchemaMaster, DomainNamingMaster
Get-ADDomain | Select RIDMaster, PDCEmulator, InfrastructureMaster

# Transfer a role (graceful move to another DC)
Move-ADDirectoryServerOperationMasterRole `
  -Identity "DC02" `
  -OperationMasterRole PDCEmulator</code></pre>

                    <div class="alert alert-warning">
                        <div class="alert-title">Seize vs Transfer</div>
                        <p>Always <strong>transfer</strong> FSMO roles when the current holder is online and reachable. Only <strong>seize</strong> a role (using <code>ntdsutil</code>) when the current holder is permanently offline. A seized role holder must <em>never</em> be brought back online &mdash; doing so creates duplicate role holders and potential data corruption.</p>
                    </div>
                </div>

                <!-- Sites & Replication -->
                <div class="subsection">
                    <h3 class="subsection-title">Sites and Replication</h3>
                    <p>AD <strong>sites</strong> represent the physical network topology. They control how clients locate nearby DCs and how replication traffic flows between locations. A site is essentially a collection of IP subnets with well-connected (high-bandwidth, low-latency) network links.</p>

                    <ul>
                        <li><strong>Intrasite replication</strong> &mdash; Between DCs in the same site. Uses change notification (near-instant, within ~15 seconds). Uncompressed for speed.</li>
                        <li><strong>Intersite replication</strong> &mdash; Between DCs in different sites. Scheduled (default: every 180 minutes). Compressed to conserve WAN bandwidth. Managed via site link objects.</li>
                        <li><strong>KCC (Knowledge Consistency Checker)</strong> &mdash; An automatic process running on every DC that calculates the optimal replication topology. It creates connection objects to ensure every DC can reach every other DC within a maximum of three hops.</li>
                    </ul>

                    <pre><code class="language-powershell"># List all AD sites
Get-ADReplicationSite -Filter *

# List site links and their replication schedules
Get-ADReplicationSiteLink -Filter * |
  Select Name, Cost, ReplicationFrequencyInMinutes, SitesIncluded

# Check replication status across all DCs
repadmin /replsummary

# Force replication between two DCs
repadmin /syncall DC01 /d /e /P</code></pre>
                </div>

                <!-- Global Catalog -->
                <div class="subsection">
                    <h3 class="subsection-title">Global Catalog</h3>
                    <p>The <strong>Global Catalog (GC)</strong> is a distributed data repository that contains a searchable, partial representation of every object in every domain within the forest. While a regular DC holds the full attribute set for objects in its own domain, a GC server additionally holds a subset of attributes for objects in <em>all</em> domains.</p>

                    <ul>
                        <li><strong>Ports</strong> &mdash; GC queries use LDAP port <code>3268</code> (unencrypted) or <code>3269</code> (LDAPS/TLS). Standard LDAP uses ports <code>389</code>/<code>636</code>.</li>
                        <li><strong>Universal Group Membership</strong> &mdash; During logon, the DC contacts a GC to enumerate the user's universal group memberships. Without a reachable GC, logon can fail (unless universal group caching is enabled).</li>
                        <li><strong>Cross-domain searches</strong> &mdash; Applications like Exchange and SharePoint rely on the GC to search for recipients and users across the entire forest without querying each domain individually.</li>
                        <li><strong>Recommendation</strong> &mdash; Make every DC a Global Catalog server unless you have a specific reason not to (such as the Infrastructure Master placement constraint in multi-domain forests).</li>
                    </ul>

                    <pre><code class="language-powershell"># Check which DCs are Global Catalog servers
Get-ADDomainController -Filter {IsGlobalCatalog -eq $true} |
  Select Name, Site, IPv4Address

# Query the Global Catalog for a user across all domains
Get-ADUser -Filter {mail -eq "jdoe@contoso.com"} `
  -Server "corp.contoso.com:3268" `
  -Properties DisplayName, mail, Company</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">GC Partial Attribute Set</div>
                        <p>The Global Catalog does not store every attribute. Only attributes marked for GC replication in the schema (the <code>isMemberOfPartialAttributeSet</code> flag) are replicated. You can add custom attributes to the GC via the Active Directory Schema snap-in, but be conservative &mdash; every addition increases replication traffic forest-wide.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 04: LDAP & DIRECTORY SERVICES
             ============================================ -->
        <section id="ldap" class="section">
            <div class="section-header">
                <div class="section-number">IV</div>
                <h2 class="section-title">LDAP &amp; Directory Services</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#1e3a5f" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#1e3a5f" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#1e3a5f" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#1e3a5f"/>
                    </svg>
                </div>
                <p class="section-desc">The protocol that speaks to Active Directory &mdash; LDAP queries, distinguished names, search filters, and the schema that defines every object.</p>
            </div>

            <div class="section-content">

                <!-- LDAP Protocol Basics -->
                <div class="subsection">
                    <h3 class="subsection-title">LDAP Protocol Basics</h3>
                    <p>The <strong>Lightweight Directory Access Protocol (LDAP)</strong> is the standard protocol for querying and modifying directory services. Active Directory is, at its core, an LDAP-compliant directory. Every object you create, every group membership you check, and every user you authenticate traverses LDAP (or its Kerberos-augmented variants).</p>

                    <p>LDAP operates over TCP and uses a hierarchical data model. Clients bind (authenticate), then perform operations: search, add, modify, delete, compare. Each operation targets a specific location in the directory tree.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Port</th>
                                    <th>Protocol</th>
                                    <th>Encryption</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>389</code></td>
                                    <td>LDAP</td>
                                    <td>None (or STARTTLS)</td>
                                    <td>Standard directory queries within a single domain</td>
                                </tr>
                                <tr>
                                    <td><code>636</code></td>
                                    <td>LDAPS</td>
                                    <td>TLS/SSL</td>
                                    <td>Encrypted directory queries (certificate required on DC)</td>
                                </tr>
                                <tr>
                                    <td><code>3268</code></td>
                                    <td>GC</td>
                                    <td>None (or STARTTLS)</td>
                                    <td>Global Catalog queries across all forest domains</td>
                                </tr>
                                <tr>
                                    <td><code>3269</code></td>
                                    <td>GC-SSL</td>
                                    <td>TLS/SSL</td>
                                    <td>Encrypted Global Catalog queries</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-warning">
                        <div class="alert-title">Plaintext LDAP Is a Credential Risk</div>
                        <p>LDAP on port 389 transmits bind credentials (including passwords for simple binds) in cleartext unless STARTTLS is negotiated. Microsoft has been progressively enforcing <strong>LDAP channel binding</strong> and <strong>LDAP signing</strong> requirements. Always prefer LDAPS (port 636) or enforce STARTTLS. Unsigned, unencrypted LDAP binds are a prime target for man-in-the-middle credential theft.</p>
                    </div>
                </div>

                <!-- Distinguished Names -->
                <div class="subsection">
                    <h3 class="subsection-title">Distinguished Names</h3>
                    <p>Every object in LDAP has a globally unique <strong>Distinguished Name (DN)</strong> that describes its exact position in the directory tree. A DN is constructed by chaining <strong>Relative Distinguished Names (RDNs)</strong> from the object up to the root of the directory.</p>

                    <pre><code class="language-bash"># A typical Distinguished Name
CN=John Doe,OU=Sales,OU=Users,DC=corp,DC=contoso,DC=com

# Reading right-to-left:
#   DC=corp,DC=contoso,DC=com  → Domain: corp.contoso.com
#   OU=Users                   → Organizational Unit: Users
#   OU=Sales                   → Nested OU: Sales
#   CN=John Doe                → Common Name: the object itself</code></pre>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Abbreviation</th>
                                    <th>Attribute</th>
                                    <th>Used For</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>DC</code></td>
                                    <td>Domain Component</td>
                                    <td>Domain name segments</td>
                                    <td><code>DC=corp,DC=contoso,DC=com</code></td>
                                </tr>
                                <tr>
                                    <td><code>OU</code></td>
                                    <td>Organizational Unit</td>
                                    <td>Container for organizing objects</td>
                                    <td><code>OU=Engineering</code></td>
                                </tr>
                                <tr>
                                    <td><code>CN</code></td>
                                    <td>Common Name</td>
                                    <td>Leaf objects (users, groups, computers)</td>
                                    <td><code>CN=Jane Smith</code></td>
                                </tr>
                                <tr>
                                    <td><code>O</code></td>
                                    <td>Organization</td>
                                    <td>X.500 organization (rarely used in AD)</td>
                                    <td><code>O=Contoso Ltd</code></td>
                                </tr>
                                <tr>
                                    <td><code>L</code></td>
                                    <td>Locality</td>
                                    <td>Geographic location</td>
                                    <td><code>L=Seattle</code></td>
                                </tr>
                                <tr>
                                    <td><code>C</code></td>
                                    <td>Country</td>
                                    <td>Two-letter country code</td>
                                    <td><code>C=US</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- LDAP Search Filters -->
                <div class="subsection">
                    <h3 class="subsection-title">LDAP Search Filters</h3>
                    <p>LDAP filters use a prefix-notation syntax wrapped in parentheses. Filters can be simple attribute matches or complex boolean expressions combining multiple conditions. Mastering filter syntax is essential for efficient directory queries.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Operator</th>
                                    <th>Syntax</th>
                                    <th>Description</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Equality</strong></td>
                                    <td><code>=</code></td>
                                    <td>Exact match</td>
                                    <td><code>(sAMAccountName=jdoe)</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Approximate</strong></td>
                                    <td><code>~=</code></td>
                                    <td>Phonetic/fuzzy match</td>
                                    <td><code>(cn~=Jon)</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Greater/Equal</strong></td>
                                    <td><code>&gt;=</code></td>
                                    <td>Lexicographic comparison</td>
                                    <td><code>(whenCreated&gt;=20240101000000.0Z)</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Less/Equal</strong></td>
                                    <td><code>&lt;=</code></td>
                                    <td>Lexicographic comparison</td>
                                    <td><code>(pwdLastSet&lt;=132500000000000000)</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Presence</strong></td>
                                    <td><code>=*</code></td>
                                    <td>Attribute exists</td>
                                    <td><code>(mail=*)</code></td>
                                </tr>
                                <tr>
                                    <td><strong>AND</strong></td>
                                    <td><code>&amp;</code></td>
                                    <td>All conditions must match</td>
                                    <td><code>(&amp;(objectClass=user)(department=Sales))</code></td>
                                </tr>
                                <tr>
                                    <td><strong>OR</strong></td>
                                    <td><code>|</code></td>
                                    <td>Any condition may match</td>
                                    <td><code>(|(cn=John*)(cn=Jane*))</code></td>
                                </tr>
                                <tr>
                                    <td><strong>NOT</strong></td>
                                    <td><code>!</code></td>
                                    <td>Negate a condition</td>
                                    <td><code>(!(userAccountControl:1.2.840.113556.1.4.803:=2))</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-bash"># Find all enabled users in the Sales department
(&amp;(objectClass=user)(objectCategory=person)(department=Sales)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))

# Find users whose name starts with "A" or "B"
(&amp;(objectClass=user)(|(cn=A*)(cn=B*)))

# Find computers running Windows Server
(&amp;(objectClass=computer)(operatingSystem=Windows Server*))</code></pre>
                </div>

                <!-- ldapsearch Command -->
                <div class="subsection">
                    <h3 class="subsection-title">ldapsearch Command</h3>
                    <p>The <code>ldapsearch</code> utility is the standard CLI tool for querying LDAP directories from Linux and macOS. It supports simple binds, SASL authentication, TLS, and full filter syntax.</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>Search for a User</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -D "CN=admin,CN=Users,DC=corp,DC=contoso,DC=com" \
  -W -b "DC=corp,DC=contoso,DC=com" \
  "(sAMAccountName=jdoe)" \
  cn mail memberOf</code></pre>
                            <p class="cmd-desc">Bind as admin, search the entire domain for user jdoe, return name, email, and groups.</p>
                        </div>

                        <div class="command-card">
                            <h4>Find Group Members</h4>
                            <pre><code class="language-bash">ldapsearch -H ldaps://dc01.corp.contoso.com \
  -D "CN=svc-ldap,OU=Service,DC=corp,DC=contoso,DC=com" \
  -W -b "DC=corp,DC=contoso,DC=com" \
  "(&amp;(objectClass=group)(cn=VPN-Users))" \
  member</code></pre>
                            <p class="cmd-desc">List all members of the VPN-Users group over an encrypted LDAPS connection.</p>
                        </div>

                        <div class="command-card">
                            <h4>List All Computers</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -D "CN=svc-ldap,OU=Service,DC=corp,DC=contoso,DC=com" \
  -W -b "OU=Workstations,DC=corp,DC=contoso,DC=com" \
  "(objectClass=computer)" \
  cn operatingSystem lastLogonTimestamp</code></pre>
                            <p class="cmd-desc">Enumerate computers in the Workstations OU with OS and last-logon details.</p>
                        </div>

                        <div class="command-card">
                            <h4>Search by Attribute</h4>
                            <pre><code class="language-bash">ldapsearch -H ldap://dc01.corp.contoso.com \
  -D "CN=svc-ldap,OU=Service,DC=corp,DC=contoso,DC=com" \
  -W -b "DC=corp,DC=contoso,DC=com" \
  "(&amp;(objectClass=user)(title=*Engineer*))" \
  cn title department mail</code></pre>
                            <p class="cmd-desc">Find all users with "Engineer" in their title across the domain.</p>
                        </div>
                    </div>
                </div>

                <!-- LDAP Schema -->
                <div class="subsection">
                    <h3 class="subsection-title">LDAP Schema</h3>
                    <p>The AD schema defines every object class and attribute that can exist in the directory. Object classes form an inheritance hierarchy rooted at the <code>top</code> class. Understanding this hierarchy helps you write accurate LDAP filters and predict which attributes are available on a given object.</p>

                    <pre><code class="language-bash"># objectClass inheritance for a user object:
top
  └── person
        └── organizationalPerson
              └── user

# A user object inherits attributes from every class above it:
#   top             → objectClass, cn
#   person          → sn, telephoneNumber, userPassword
#   orgPerson       → title, department, company, manager
#   user            → sAMAccountName, userPrincipalName, memberOf</code></pre>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Attribute</th>
                                    <th>Description</th>
                                    <th>Example Value</th>
                                    <th>Indexed</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>sAMAccountName</code></td>
                                    <td>Pre-Windows 2000 logon name (NetBIOS)</td>
                                    <td><code>jdoe</code></td>
                                    <td><span class="badge badge-emerald">Yes</span></td>
                                </tr>
                                <tr>
                                    <td><code>userPrincipalName</code></td>
                                    <td>UPN logon format (email-style)</td>
                                    <td><code>jdoe@corp.contoso.com</code></td>
                                    <td><span class="badge badge-emerald">Yes</span></td>
                                </tr>
                                <tr>
                                    <td><code>distinguishedName</code></td>
                                    <td>Full DN path in the directory</td>
                                    <td><code>CN=Jane Doe,OU=Users,DC=corp...</code></td>
                                    <td><span class="badge badge-emerald">Yes</span></td>
                                </tr>
                                <tr>
                                    <td><code>memberOf</code></td>
                                    <td>Groups the object belongs to</td>
                                    <td><code>CN=VPN-Users,OU=Groups,DC=...</code></td>
                                    <td><span class="badge badge-emerald">Yes</span></td>
                                </tr>
                                <tr>
                                    <td><code>objectSid</code></td>
                                    <td>Security Identifier (binary)</td>
                                    <td><code>S-1-5-21-...-1234</code></td>
                                    <td><span class="badge badge-emerald">Yes</span></td>
                                </tr>
                                <tr>
                                    <td><code>userAccountControl</code></td>
                                    <td>Bitmask of account flags</td>
                                    <td><code>512</code> (normal enabled account)</td>
                                    <td><span class="badge badge-lapis">No</span></td>
                                </tr>
                                <tr>
                                    <td><code>pwdLastSet</code></td>
                                    <td>Timestamp of last password change</td>
                                    <td><code>133500000000000000</code></td>
                                    <td><span class="badge badge-lapis">No</span></td>
                                </tr>
                                <tr>
                                    <td><code>whenCreated</code></td>
                                    <td>Object creation timestamp</td>
                                    <td><code>20240115143022.0Z</code></td>
                                    <td><span class="badge badge-lapis">No</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Securing LDAP -->
                <div class="subsection">
                    <h3 class="subsection-title">Securing LDAP</h3>
                    <p>Hardening LDAP communications is a critical part of AD security. Microsoft has been tightening default LDAP security with each Windows Server release, progressively requiring encryption and signing.</p>

                    <ul>
                        <li><strong>LDAPS (port 636)</strong> &mdash; Wraps the entire LDAP session in TLS. Requires a valid server certificate on every DC. The simplest path to encrypted LDAP.</li>
                        <li><strong>LDAP Channel Binding</strong> &mdash; Ties the LDAP session to the underlying TLS channel, preventing token relay attacks. Set via the <code>LdapEnforceChannelBinding</code> registry value.</li>
                        <li><strong>LDAP Signing</strong> &mdash; Requires that all LDAP traffic is cryptographically signed (integrity protection). Configure via Group Policy: <em>Domain controller: LDAP server signing requirements</em>.</li>
                        <li><strong>STARTTLS</strong> &mdash; Upgrades an existing plaintext LDAP connection on port 389 to TLS. An alternative to LDAPS when you cannot use a dedicated TLS port.</li>
                    </ul>

                    <pre><code class="language-powershell"># Enforce LDAP signing via Group Policy (on DCs)
# Policy: Computer Configuration → Policies → Windows Settings →
#         Security Settings → Local Policies → Security Options
#         → Domain controller: LDAP server signing requirements = Require signing

# Check current LDAP signing enforcement
Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters" `
  -Name "LDAPServerIntegrity"

# Enforce LDAP channel binding (registry)
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters" `
  -Name "LdapEnforceChannelBinding" -Value 2 -Type DWord
# Value 0 = Never, 1 = When supported, 2 = Always</code></pre>

                    <div class="alert alert-danger">
                        <div class="alert-title">Audit Before Enforcing</div>
                        <p>Before setting LDAP signing or channel binding to "Required," enable <strong>diagnostic logging</strong> (Event ID 2889 for unsigned binds, 3039 for channel binding failures) and audit your environment for legacy applications that still use unsigned simple binds. Enforcing without auditing first will break those applications.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 05: AUTHENTICATION PROTOCOLS
             ============================================ -->
        <section id="authentication" class="section">
            <div class="section-header">
                <div class="section-number">V</div>
                <h2 class="section-title">Authentication Protocols</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#d4a012" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#d4a012"/>
                    </svg>
                </div>
                <p class="section-desc">From Kerberos tickets to OAuth tokens &mdash; the protocols that prove identity and grant access across on-premises and cloud environments.</p>
            </div>

            <div class="section-content">

                <!-- Kerberos -->
                <div class="subsection">
                    <h3 class="subsection-title">Kerberos</h3>
                    <p><strong>Kerberos</strong> is the primary authentication protocol in Active Directory. It uses symmetric-key cryptography and a trusted third party (the <strong>Key Distribution Center</strong>, running on every DC) to authenticate users and services without transmitting passwords over the network.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Component</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>KDC</strong> (Key Distribution Center)</td>
                                    <td>Runs on every DC. Contains the AS (Authentication Service) and TGS (Ticket-Granting Service).</td>
                                </tr>
                                <tr>
                                    <td><strong>TGT</strong> (Ticket-Granting Ticket)</td>
                                    <td>Issued by the AS after initial authentication. Acts as proof of identity for requesting service tickets. Default lifetime: 10 hours.</td>
                                </tr>
                                <tr>
                                    <td><strong>Service Ticket</strong></td>
                                    <td>Issued by the TGS for access to a specific service. Contains session key encrypted with the service's secret key.</td>
                                </tr>
                                <tr>
                                    <td><strong>AS-REQ / AS-REP</strong></td>
                                    <td>Authentication Service exchange. Client sends credentials; KDC returns a TGT.</td>
                                </tr>
                                <tr>
                                    <td><strong>TGS-REQ / TGS-REP</strong></td>
                                    <td>Ticket-Granting Service exchange. Client presents TGT; KDC returns a service ticket for the target resource.</td>
                                </tr>
                                <tr>
                                    <td><strong>AP-REQ / AP-REP</strong></td>
                                    <td>Application exchange. Client presents service ticket to the target service for access.</td>
                                </tr>
                                <tr>
                                    <td><strong>KRBTGT</strong></td>
                                    <td>The service account whose password encrypts all TGTs in the domain. Compromising this account means forging any ticket (Golden Ticket attack).</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-bash"># View current Kerberos tickets (Windows)
klist

# View tickets with full details
klist -e

# Purge all cached tickets
klist purge

# Linux: obtain a TGT
kinit jdoe@CORP.CONTOSO.COM

# Linux: list cached tickets
klist -l

# Linux: destroy all cached tickets
kdestroy -A</code></pre>

                    <span class="code-label">krb5.conf (Linux Kerberos Configuration)</span>
                    <pre><code class="language-bash">[libdefaults]
    default_realm = CORP.CONTOSO.COM
    dns_lookup_realm = false
    dns_lookup_kdc = true
    ticket_lifetime = 10h
    renew_lifetime = 7d
    forwardable = true

[realms]
    CORP.CONTOSO.COM = {
        kdc = dc01.corp.contoso.com
        kdc = dc02.corp.contoso.com
        admin_server = dc01.corp.contoso.com
    }

[domain_realm]
    .corp.contoso.com = CORP.CONTOSO.COM
    corp.contoso.com = CORP.CONTOSO.COM</code></pre>
                </div>

                <!-- NTLM -->
                <div class="subsection">
                    <h3 class="subsection-title">NTLM</h3>
                    <p><strong>NTLM</strong> (NT LAN Manager) is the legacy challenge-response authentication protocol that predates Kerberos in Windows environments. While still supported for backward compatibility, NTLM has fundamental security weaknesses and should be eliminated wherever possible.</p>

                    <p>The NTLM authentication flow works as follows:</p>
                    <ol>
                        <li>Client sends a <strong>NEGOTIATE</strong> message to the server declaring NTLM support.</li>
                        <li>Server responds with a <strong>CHALLENGE</strong> &mdash; a random 8-byte nonce.</li>
                        <li>Client computes a <strong>RESPONSE</strong> by hashing the user's password with the challenge and sends it back.</li>
                        <li>Server forwards the challenge-response pair to a DC for verification (or validates locally).</li>
                    </ol>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Version</th>
                                    <th>Hash Algorithm</th>
                                    <th>Security Level</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>NTLMv1</strong></td>
                                    <td>DES-based, 56-bit key</td>
                                    <td><span class="badge badge-crimson">Broken</span></td>
                                    <td>Trivially crackable; disable immediately</td>
                                </tr>
                                <tr>
                                    <td><strong>NTLMv2</strong></td>
                                    <td>HMAC-MD5 with timestamp</td>
                                    <td><span class="badge badge-gold">Weak</span></td>
                                    <td>Better than v1 but still vulnerable to relay attacks</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">NTLM Relay Attacks</div>
                        <p>NTLM is vulnerable to <strong>relay attacks</strong>: an attacker intercepts an NTLM authentication exchange and forwards it to a different server, impersonating the victim. Tools like <code>ntlmrelayx</code> and <code>Responder</code> automate this. Mitigations include <strong>EPA (Extended Protection for Authentication)</strong>, <strong>SMB signing</strong>, disabling NTLM via Group Policy, and enforcing Kerberos everywhere. Audit NTLM usage with Event IDs 4624 (logon type) and 8004 (NTLM authentication in the domain).</p>
                    </div>
                </div>

                <!-- SAML 2.0 -->
                <div class="subsection">
                    <h3 class="subsection-title">SAML 2.0</h3>
                    <p><strong>Security Assertion Markup Language (SAML) 2.0</strong> is an XML-based framework for exchanging authentication and authorization data between an <strong>Identity Provider (IdP)</strong> and a <strong>Service Provider (SP)</strong>. It is the dominant protocol for enterprise SSO to web applications.</p>

                    <ul>
                        <li><strong>Assertion</strong> &mdash; An XML document containing statements about the subject (authentication, attributes, authorization decisions).</li>
                        <li><strong>IdP</strong> (Identity Provider) &mdash; The authority that authenticates users and issues assertions (e.g., AD FS, Entra ID, Okta).</li>
                        <li><strong>SP</strong> (Service Provider) &mdash; The application that consumes assertions and grants access (e.g., Salesforce, AWS Console).</li>
                        <li><strong>Bindings</strong> &mdash; How SAML messages are transported: <strong>HTTP POST</strong> (assertion in form body), <strong>HTTP Redirect</strong> (assertion in URL query string), or <strong>Artifact</strong> (reference resolved server-to-server).</li>
                    </ul>

                    <span class="code-label">SAML Assertion Structure (Simplified)</span>
                    <pre><code class="language-bash">&lt;saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
    ID="_abc123" IssueInstant="2024-01-15T14:30:00Z" Version="2.0"&gt;
  &lt;saml:Issuer&gt;https://idp.contoso.com&lt;/saml:Issuer&gt;
  &lt;ds:Signature&gt;...XML digital signature...&lt;/ds:Signature&gt;
  &lt;saml:Subject&gt;
    &lt;saml:NameID Format="emailAddress"&gt;jdoe@contoso.com&lt;/saml:NameID&gt;
    &lt;saml:SubjectConfirmation Method="bearer"&gt;
      &lt;saml:SubjectConfirmationData
        NotOnOrAfter="2024-01-15T14:35:00Z"
        Recipient="https://app.example.com/saml/acs"/&gt;
    &lt;/saml:SubjectConfirmation&gt;
  &lt;/saml:Subject&gt;
  &lt;saml:Conditions NotBefore="2024-01-15T14:29:00Z"
                   NotOnOrAfter="2024-01-15T14:35:00Z"&gt;
    &lt;saml:AudienceRestriction&gt;
      &lt;saml:Audience&gt;https://app.example.com&lt;/saml:Audience&gt;
    &lt;/saml:AudienceRestriction&gt;
  &lt;/saml:Conditions&gt;
  &lt;saml:AttributeStatement&gt;
    &lt;saml:Attribute Name="groups"&gt;
      &lt;saml:AttributeValue&gt;Domain Admins&lt;/saml:AttributeValue&gt;
    &lt;/saml:Attribute&gt;
  &lt;/saml:AttributeStatement&gt;
&lt;/saml:Assertion&gt;</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">SAML Validation Checklist</div>
                        <p>When consuming SAML assertions, always validate: (1) <strong>Signature</strong> &mdash; verify the XML signature against the IdP's public certificate; (2) <strong>Issuer</strong> &mdash; must match the expected IdP entity ID; (3) <strong>Audience</strong> &mdash; must match your SP entity ID; (4) <strong>NotBefore / NotOnOrAfter</strong> &mdash; assertion must be within the valid time window (account for clock skew); (5) <strong>InResponseTo</strong> &mdash; must match the original AuthnRequest ID to prevent replay attacks.</p>
                    </div>
                </div>

                <!-- OAuth 2.0 -->
                <div class="subsection">
                    <h3 class="subsection-title">OAuth 2.0</h3>
                    <p><strong>OAuth 2.0</strong> is an authorization framework (not an authentication protocol) that allows applications to obtain limited access to user resources without exposing credentials. It works by issuing <strong>access tokens</strong> with specific scopes.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Grant Type</th>
                                    <th>Use Case</th>
                                    <th>Flow</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Authorization Code + PKCE</strong></td>
                                    <td>Web apps, SPAs, mobile apps</td>
                                    <td>User redirected to IdP, receives code, exchanges for token. PKCE prevents code interception.</td>
                                </tr>
                                <tr>
                                    <td><strong>Client Credentials</strong></td>
                                    <td>Service-to-service (daemon apps)</td>
                                    <td>App authenticates with its own credentials (client ID + secret or certificate). No user interaction.</td>
                                </tr>
                                <tr>
                                    <td><strong>Device Code</strong></td>
                                    <td>Input-constrained devices (CLI tools, TVs)</td>
                                    <td>Device displays a code; user authenticates on a separate device. App polls for the token.</td>
                                </tr>
                                <tr>
                                    <td><strong>Refresh Token</strong></td>
                                    <td>Long-lived sessions without re-authentication</td>
                                    <td>Exchange an expired access token for a new one using a refresh token. Scoped to original grant.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <span class="code-label">Token Request (Client Credentials Grant)</span>
                    <pre><code class="language-bash"># Request an access token using client credentials
curl -X POST "https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id={app-id}" \
  -d "client_secret={secret}" \
  -d "scope=https://graph.microsoft.com/.default" \
  -d "grant_type=client_credentials"

# Response:
# {
#   "token_type": "Bearer",
#   "expires_in": 3599,
#   "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIs..."
# }</code></pre>
                </div>

                <!-- OpenID Connect -->
                <div class="subsection">
                    <h3 class="subsection-title">OpenID Connect</h3>
                    <p><strong>OpenID Connect (OIDC)</strong> is an identity layer built on top of OAuth 2.0. While OAuth 2.0 handles authorization (access tokens), OIDC adds authentication by introducing the <strong>ID token</strong> &mdash; a JWT that contains claims about the authenticated user.</p>

                    <ul>
                        <li><strong>ID Token</strong> &mdash; A signed JWT issued alongside the access token. Contains standard claims like <code>sub</code>, <code>name</code>, <code>email</code>, <code>iss</code>, <code>aud</code>, and <code>exp</code>.</li>
                        <li><strong>UserInfo Endpoint</strong> &mdash; An API endpoint that returns claims about the authenticated user when presented with a valid access token. Useful for fetching additional profile data.</li>
                        <li><strong>Discovery</strong> &mdash; OIDC providers publish their configuration at <code>/.well-known/openid-configuration</code>, including supported grant types, token endpoints, signing keys (JWKS), and supported scopes.</li>
                    </ul>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Claim</th>
                                    <th>Description</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>sub</code></td>
                                    <td>Subject identifier (unique per user per client)</td>
                                    <td><code>AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4</code></td>
                                </tr>
                                <tr>
                                    <td><code>iss</code></td>
                                    <td>Issuer identifier (the IdP URL)</td>
                                    <td><code>https://login.microsoftonline.com/{tenant}/v2.0</code></td>
                                </tr>
                                <tr>
                                    <td><code>aud</code></td>
                                    <td>Audience (the client application)</td>
                                    <td><code>6cb04018-a3f5-46a7-b995-940c78f5aef3</code></td>
                                </tr>
                                <tr>
                                    <td><code>name</code></td>
                                    <td>Full display name</td>
                                    <td><code>Jane Doe</code></td>
                                </tr>
                                <tr>
                                    <td><code>email</code></td>
                                    <td>Email address</td>
                                    <td><code>jdoe@contoso.com</code></td>
                                </tr>
                                <tr>
                                    <td><code>preferred_username</code></td>
                                    <td>Human-readable identifier</td>
                                    <td><code>jdoe@contoso.com</code></td>
                                </tr>
                                <tr>
                                    <td><code>groups</code></td>
                                    <td>Security group memberships</td>
                                    <td><code>["sg-engineers", "sg-vpn"]</code></td>
                                </tr>
                                <tr>
                                    <td><code>tid</code></td>
                                    <td>Tenant ID (Entra ID specific)</td>
                                    <td><code>72f988bf-86f1-41af-91ab-2d7cd011db47</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-bash"># Fetch the OIDC discovery document
curl -s "https://login.microsoftonline.com/{tenant-id}/v2.0/.well-known/openid-configuration" | jq .

# Key fields returned:
# - authorization_endpoint
# - token_endpoint
# - userinfo_endpoint
# - jwks_uri (public signing keys)
# - scopes_supported: ["openid", "profile", "email", "offline_access"]
# - response_types_supported: ["code", "id_token", "code id_token"]</code></pre>
                </div>

                <!-- Protocol Comparison -->
                <div class="subsection">
                    <h3 class="subsection-title">Protocol Comparison</h3>
                    <p>Choosing the right authentication protocol depends on the environment, transport, and trust model. The following table compares the five major protocols used in Active Directory and cloud IAM.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Protocol</th>
                                    <th>Use Case</th>
                                    <th>Token Type</th>
                                    <th>Transport</th>
                                    <th>Best For</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Kerberos</strong></td>
                                    <td>On-premises domain auth</td>
                                    <td>Encrypted tickets</td>
                                    <td>TCP/UDP 88</td>
                                    <td>LAN services, file shares, SQL</td>
                                </tr>
                                <tr>
                                    <td><strong>NTLM</strong></td>
                                    <td>Legacy fallback</td>
                                    <td>Challenge-response hash</td>
                                    <td>Embedded in SMB/HTTP</td>
                                    <td>Nothing (deprecate aggressively)</td>
                                </tr>
                                <tr>
                                    <td><strong>SAML 2.0</strong></td>
                                    <td>Enterprise SSO to web apps</td>
                                    <td>XML assertion</td>
                                    <td>HTTP POST / Redirect</td>
                                    <td>SaaS apps (Salesforce, AWS, ServiceNow)</td>
                                </tr>
                                <tr>
                                    <td><strong>OAuth 2.0</strong></td>
                                    <td>API authorization</td>
                                    <td>Bearer access token (JWT)</td>
                                    <td>HTTPS</td>
                                    <td>API access, mobile apps, SPAs</td>
                                </tr>
                                <tr>
                                    <td><strong>OIDC</strong></td>
                                    <td>Modern authentication + identity</td>
                                    <td>ID token (JWT) + access token</td>
                                    <td>HTTPS</td>
                                    <td>Cloud-native apps, user sign-in</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-info">
                        <div class="alert-title">Choosing a Protocol</div>
                        <p>For new applications: use <strong>OIDC</strong> (authentication) and <strong>OAuth 2.0</strong> (API authorization). For enterprise SaaS integrations: <strong>SAML 2.0</strong> remains dominant. For on-premises Active Directory resources: <strong>Kerberos</strong> is mandatory and automatic. <strong>NTLM</strong> should never be the target protocol for new deployments.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 06: ROLE-BASED ACCESS CONTROL
             ============================================ -->
        <section id="rbac" class="section">
            <div class="section-header">
                <div class="section-number">VI</div>
                <h2 class="section-title">Role-Based Access Control</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#8b1538" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#8b1538" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#8b1538" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#8b1538"/>
                    </svg>
                </div>
                <p class="section-desc">Structuring permissions through roles and groups &mdash; from AD group nesting strategies to Azure RBAC scope hierarchies.</p>
            </div>

            <div class="section-content">

                <!-- RBAC Fundamentals -->
                <div class="subsection">
                    <h3 class="subsection-title">RBAC Fundamentals</h3>
                    <p>Role-Based Access Control assigns permissions to <strong>roles</strong> rather than individual users. Users are then assigned to roles, inheriting all associated permissions. This indirection simplifies large-scale permission management and makes access auditable.</p>

                    <ul>
                        <li><strong>Users</strong> &mdash; The identities (human or service) that need access to resources.</li>
                        <li><strong>Roles</strong> &mdash; Named collections of permissions that reflect job functions (e.g., "Help Desk Operator", "Database Admin", "Reader").</li>
                        <li><strong>Permissions</strong> &mdash; Granular actions on specific resources (e.g., "reset password on OU=Users", "read blob in storage account").</li>
                        <li><strong>Principle of Least Privilege</strong> &mdash; Grant only the minimum permissions required for a role. Overprivileged accounts are the most common path to lateral movement in breaches.</li>
                        <li><strong>Separation of Duties</strong> &mdash; No single role should have end-to-end control over a critical process. The person who creates an account should not be the same person who approves its elevated access.</li>
                    </ul>

                    <div class="alert alert-warning">
                        <div class="alert-title">Role Explosion</div>
                        <p>A common RBAC pitfall is <strong>role explosion</strong> &mdash; creating so many fine-grained roles that the model becomes unmanageable. Aim for a balance between granularity and simplicity. If you have more roles than users, your model needs consolidation. Use attribute-based conditions (ABAC) to handle edge cases instead of creating one-off roles.</p>
                    </div>
                </div>

                <!-- AD Group Types -->
                <div class="subsection">
                    <h3 class="subsection-title">AD Group Types</h3>
                    <p>Active Directory supports two group types and three group scopes. Choosing the right combination is critical for both security modeling and replication efficiency.</p>

                    <p><strong>Group Types:</strong></p>
                    <ul>
                        <li><strong>Security Groups</strong> &mdash; Used to assign permissions to resources (ACLs, GPO filtering, application roles). Security groups have a SID and appear in Kerberos tickets.</li>
                        <li><strong>Distribution Groups</strong> &mdash; Used only for email distribution lists (Exchange). Cannot be used for access control. Have no SID.</li>
                    </ul>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Scope</th>
                                    <th>Can Contain</th>
                                    <th>Can Access Resources In</th>
                                    <th>Replicated To</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Domain Local</strong> <span class="badge badge-lapis">DL</span></td>
                                    <td>Users, global groups, universal groups from any domain in the forest; domain local groups from the same domain</td>
                                    <td>Same domain only</td>
                                    <td>DCs in the same domain</td>
                                </tr>
                                <tr>
                                    <td><strong>Global</strong> <span class="badge badge-gold">G</span></td>
                                    <td>Users and global groups from the same domain only</td>
                                    <td>Any domain in the forest (and trusted forests)</td>
                                    <td>All DCs in the same domain; GC stores membership</td>
                                </tr>
                                <tr>
                                    <td><strong>Universal</strong> <span class="badge badge-purple">U</span></td>
                                    <td>Users, global groups, and universal groups from any domain in the forest</td>
                                    <td>Any domain in the forest</td>
                                    <td>All Global Catalog servers (forest-wide)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- AGDLP Strategy -->
                <div class="subsection">
                    <h3 class="subsection-title">AGDLP / IGDLP Strategy</h3>
                    <p>The <strong>AGDLP</strong> (Account &rarr; Global &rarr; Domain Local &rarr; Permission) pattern is Microsoft's recommended group nesting strategy. In multi-forest environments, this extends to <strong>IGDLP</strong> (Identity &rarr; Global &rarr; Domain Local &rarr; Permission).</p>

                    <pre><code class="language-powershell"># AGDLP Example:
# 1. ACCOUNT: jdoe (user in corp.contoso.com)
#    ↓ member of
# 2. GLOBAL GROUP: GG-Sales-Staff (scope: Global, same domain)
#    ↓ member of
# 3. DOMAIN LOCAL GROUP: DL-FileShare-Sales-Read (scope: Domain Local)
#    ↓ assigned to
# 4. PERMISSION: Read access on \\fs01\Sales$

# Create the Global Group (organize by role)
New-ADGroup -Name "GG-Sales-Staff" `
  -GroupScope Global -GroupCategory Security `
  -Path "OU=Groups,DC=corp,DC=contoso,DC=com"

# Create the Domain Local Group (organize by resource)
New-ADGroup -Name "DL-FileShare-Sales-Read" `
  -GroupScope DomainLocal -GroupCategory Security `
  -Path "OU=Groups,DC=corp,DC=contoso,DC=com"

# Nest Global into Domain Local
Add-ADGroupMember -Identity "DL-FileShare-Sales-Read" `
  -Members "GG-Sales-Staff"

# Add user to the Global Group
Add-ADGroupMember -Identity "GG-Sales-Staff" -Members "jdoe"</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">Why AGDLP Matters</div>
                        <p>AGDLP decouples <em>who people are</em> (Global groups organized by role/department) from <em>what they can access</em> (Domain Local groups tied to specific resources). When a new file share is created, you add the appropriate Global groups to a new Domain Local group. When someone changes departments, you move them between Global groups. Neither change affects the other layer.</p>
                    </div>
                </div>

                <!-- Delegation of Control -->
                <div class="subsection">
                    <h3 class="subsection-title">Delegation of Control</h3>
                    <p>Delegation allows you to grant specific administrative permissions on an OU or container without making someone a Domain Admin. This is the cornerstone of least-privilege administration in Active Directory.</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>Delegate Password Resets</h4>
                            <pre><code class="language-powershell">dsacls "OU=Users,DC=corp,DC=contoso,DC=com" `
  /G "CORP\Helpdesk:CA;Reset Password;user"</code></pre>
                            <p class="cmd-desc">Allow the Helpdesk group to reset passwords for all users in the Users OU.</p>
                        </div>

                        <div class="command-card">
                            <h4>Delegate Account Unlock</h4>
                            <pre><code class="language-powershell">dsacls "OU=Users,DC=corp,DC=contoso,DC=com" `
  /G "CORP\Helpdesk:WP;lockoutTime;user"</code></pre>
                            <p class="cmd-desc">Allow the Helpdesk group to write the lockoutTime attribute (effectively unlocking accounts).</p>
                        </div>

                        <div class="command-card">
                            <h4>Delegate Group Management</h4>
                            <pre><code class="language-powershell">dsacls "OU=Groups,DC=corp,DC=contoso,DC=com" `
  /G "CORP\GroupAdmins:WP;member;group"</code></pre>
                            <p class="cmd-desc">Allow GroupAdmins to modify group membership for all groups in the Groups OU.</p>
                        </div>

                        <div class="command-card">
                            <h4>Audit Current Delegations</h4>
                            <pre><code class="language-powershell"># List all explicit permissions on an OU
dsacls "OU=Users,DC=corp,DC=contoso,DC=com"

# PowerShell equivalent with AD module
(Get-Acl "AD:\OU=Users,DC=corp,DC=contoso,DC=com").Access |
  Where-Object {$_.IsInherited -eq $false} |
  Select IdentityReference, ActiveDirectoryRights,
    ObjectType, InheritanceType</code></pre>
                            <p class="cmd-desc">Review all non-inherited (explicit) permissions set on the Users OU.</p>
                        </div>
                    </div>
                </div>

                <!-- Fine-Grained Password Policies -->
                <div class="subsection">
                    <h3 class="subsection-title">Fine-Grained Password Policies</h3>
                    <p>By default, a domain has a single password policy applied to all users (set in the Default Domain Policy GPO). <strong>Fine-Grained Password Policies (FGPPs)</strong> allow you to define different password requirements for different groups &mdash; for example, stricter policies for administrators and service accounts.</p>

                    <p>FGPPs are implemented using <strong>Password Settings Objects (PSOs)</strong>, stored in the <code>CN=Password Settings Container,CN=System,DC=...</code> container. Each PSO has a precedence value; lower numbers take priority when multiple PSOs apply to the same user.</p>

                    <pre><code class="language-powershell"># Create a strict PSO for admin accounts
New-ADFineGrainedPasswordPolicy -Name "PSO-AdminAccounts" `
  -Precedence 10 `
  -MinPasswordLength 16 `
  -PasswordHistoryCount 24 `
  -ComplexityEnabled $true `
  -ReversibleEncryptionEnabled $false `
  -MaxPasswordAge "30.00:00:00" `
  -MinPasswordAge "1.00:00:00" `
  -LockoutThreshold 3 `
  -LockoutDuration "00:30:00" `
  -LockoutObservationWindow "00:30:00"

# Apply the PSO to the Domain Admins group
Add-ADFineGrainedPasswordPolicySubject -Identity "PSO-AdminAccounts" `
  -Subjects "Domain Admins"

# View which PSO applies to a specific user
Get-ADUserResultantPasswordPolicy -Identity jdoe

# List all PSOs and their precedence
Get-ADFineGrainedPasswordPolicy -Filter * |
  Select Name, Precedence, MinPasswordLength, MaxPasswordAge |
  Sort-Object Precedence</code></pre>
                </div>

                <!-- Azure RBAC -->
                <div class="subsection">
                    <h3 class="subsection-title">Azure RBAC</h3>
                    <p><strong>Azure Role-Based Access Control</strong> governs access to Azure resources through a scope hierarchy. Every role assignment consists of three elements: a <strong>security principal</strong> (who), a <strong>role definition</strong> (what permissions), and a <strong>scope</strong> (where).</p>

                    <p>The Azure scope hierarchy, from broadest to most specific:</p>
                    <ul>
                        <li><strong>Management Group</strong> &rarr; <strong>Subscription</strong> &rarr; <strong>Resource Group</strong> &rarr; <strong>Resource</strong></li>
                    </ul>
                    <p>Permissions assigned at a higher scope are <strong>inherited</strong> by all child scopes. A Contributor role at the subscription level grants Contributor access to every resource group and resource within that subscription.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Built-In Role</th>
                                    <th>Scope</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Owner</strong></td>
                                    <td>Any</td>
                                    <td>Full access to all resources including the right to delegate access to others</td>
                                </tr>
                                <tr>
                                    <td><strong>Contributor</strong></td>
                                    <td>Any</td>
                                    <td>Create and manage all resources but cannot grant access to others</td>
                                </tr>
                                <tr>
                                    <td><strong>Reader</strong></td>
                                    <td>Any</td>
                                    <td>View all resources but cannot make any changes</td>
                                </tr>
                                <tr>
                                    <td><strong>User Access Admin</strong></td>
                                    <td>Any</td>
                                    <td>Manage user access to Azure resources (role assignments only)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-bash"># Assign Reader role at subscription scope
az role assignment create \
  --assignee "jdoe@contoso.com" \
  --role "Reader" \
  --scope "/subscriptions/{subscription-id}"

# Assign a custom role at resource group scope
az role assignment create \
  --assignee "sg-platform-eng" \
  --role "Custom-VM-Operator" \
  --scope "/subscriptions/{sub-id}/resourceGroups/rg-production"

# List all role assignments for a user
az role assignment list \
  --assignee "jdoe@contoso.com" \
  --output table

# Create a custom role definition
az role definition create --role-definition '{
  "Name": "Custom-VM-Operator",
  "Description": "Start, stop, and restart virtual machines",
  "Actions": [
    "Microsoft.Compute/virtualMachines/start/action",
    "Microsoft.Compute/virtualMachines/restart/action",
    "Microsoft.Compute/virtualMachines/deallocate/action",
    "Microsoft.Compute/virtualMachines/read"
  ],
  "NotActions": [],
  "AssignableScopes": ["/subscriptions/{subscription-id}"]
}'</code></pre>

                    <div class="alert alert-warning">
                        <div class="alert-title">Azure RBAC vs Entra ID Roles</div>
                        <p><strong>Azure RBAC</strong> controls access to Azure <em>resources</em> (VMs, storage, networks). <strong>Entra ID roles</strong> (formerly Azure AD roles) control access to Entra ID <em>features</em> (user management, app registrations, conditional access policies). These are separate role systems. A Global Administrator in Entra ID does not automatically have Owner access to Azure subscriptions unless the "Access management for Azure resources" setting is elevated.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 07: SINGLE SIGN-ON & FEDERATION
             ============================================ -->
        <section id="sso-federation" class="section">
            <div class="section-header">
                <div class="section-number">VII</div>
                <h2 class="section-title">Single Sign-On &amp; Federation</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#4a0e4e" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#4a0e4e" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#4a0e4e" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#4a0e4e"/>
                    </svg>
                </div>
                <p class="section-desc">Crossing trust boundaries with tokens and assertions &mdash; from SAML and WS-Federation to SCIM provisioning and enterprise SSO architectures.</p>
            </div>

            <div class="section-content">

                <!-- SSO Architectures -->
                <div class="subsection">
                    <h3 class="subsection-title">SSO Architectures</h3>
                    <p><strong>Single Sign-On (SSO)</strong> allows users to authenticate once and gain access to multiple applications without re-entering credentials. The implementation varies depending on where the authentication intercept occurs and how tokens are propagated.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Architecture</th>
                                    <th>How It Works</th>
                                    <th>Strengths</th>
                                    <th>Best For</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Agent-Based</strong></td>
                                    <td>A software agent installed on each application server intercepts requests and validates the user's session against a central policy server</td>
                                    <td>Deep integration; per-app policy enforcement</td>
                                    <td>Legacy web apps (SiteMinder, Oracle Access Manager)</td>
                                </tr>
                                <tr>
                                    <td><strong>Reverse Proxy</strong></td>
                                    <td>A proxy gateway sits in front of all applications, authenticating users before forwarding requests with injected identity headers</td>
                                    <td>No app modification; centralized enforcement point</td>
                                    <td>Internal apps behind a gateway (Azure AD App Proxy, F5 APM)</td>
                                </tr>
                                <tr>
                                    <td><strong>Token-Based</strong></td>
                                    <td>The IdP issues a signed token (SAML assertion, JWT, or OIDC id_token) that the application validates independently</td>
                                    <td>Stateless; works across network boundaries; cloud-native</td>
                                    <td>SaaS apps, modern web/mobile apps, microservices</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-info">
                        <div class="alert-title">Kerberos SSO in Active Directory</div>
                        <p>On-premises Active Directory provides SSO natively via <strong>Kerberos</strong>. Once a user obtains a Ticket Granting Ticket (TGT) at logon, the OS transparently requests service tickets for each resource accessed. This is why domain-joined users can open file shares and internal web apps without being prompted for credentials &mdash; it is SSO through Kerberos delegation.</p>
                    </div>
                </div>

                <!-- SAML Federation -->
                <div class="subsection">
                    <h3 class="subsection-title">SAML Federation</h3>
                    <p>The <strong>Security Assertion Markup Language (SAML 2.0)</strong> is the most widely deployed federation protocol in enterprise environments. It enables cross-domain SSO by establishing trust between an <strong>Identity Provider (IdP)</strong> and a <strong>Service Provider (SP)</strong> through signed XML assertions.</p>

                    <p>Two primary flows exist:</p>
                    <ul>
                        <li><strong>SP-Initiated SSO</strong> &mdash; User visits the SP, gets redirected to the IdP for authentication, then is redirected back with a SAML assertion. This is the most common flow.</li>
                        <li><strong>IdP-Initiated SSO</strong> &mdash; User logs into the IdP portal first, then clicks an app tile. The IdP sends an unsolicited SAML assertion to the SP. Common in enterprise portals but less secure (susceptible to assertion replay).</li>
                    </ul>

                    <p>Trust is established by exchanging <strong>metadata XML</strong> files that contain entity IDs, endpoints, and X.509 signing certificates:</p>

                    <pre><code class="language-xml">&lt;!-- IdP Metadata (simplified) --&gt;
&lt;EntityDescriptor entityID="https://idp.contoso.com/adfs"
  xmlns="urn:oasis:names:tc:SAML:2.0:metadata"&gt;
  &lt;IDPSSODescriptor
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
    &lt;KeyDescriptor use="signing"&gt;
      &lt;KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"&gt;
        &lt;X509Data&gt;
          &lt;X509Certificate&gt;MIIC8jCC...base64cert...&lt;/X509Certificate&gt;
        &lt;/X509Data&gt;
      &lt;/KeyInfo&gt;
    &lt;/KeyDescriptor&gt;
    &lt;SingleSignOnService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
      Location="https://idp.contoso.com/adfs/ls/" /&gt;
    &lt;SingleSignOnService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
      Location="https://idp.contoso.com/adfs/ls/" /&gt;
  &lt;/IDPSSODescriptor&gt;
&lt;/EntityDescriptor&gt;</code></pre>

                    <div class="alert alert-warning">
                        <div class="alert-title">SAML Certificate Rotation</div>
                        <p>SAML trust breaks when signing certificates expire. Always configure <strong>secondary certificates</strong> on both IdP and SP before the primary expires. Set calendar reminders for certificate expiry dates. In ADFS, use <code>Update-AdfsCertificate -CertificateType Token-Signing</code> to roll certificates with a grace period.</p>
                    </div>
                </div>

                <!-- WS-Federation -->
                <div class="subsection">
                    <h3 class="subsection-title">WS-Federation</h3>
                    <p><strong>WS-Federation</strong> is a federation protocol from the WS-* family of specifications. While SAML dominates cross-vendor federation, WS-Federation remains the default protocol for Microsoft-stack applications including SharePoint, Dynamics, and older Office 365 integrations.</p>

                    <ul>
                        <li><strong>WS-Trust</strong> &mdash; The underlying token issuance protocol. Clients request Security Token Service (STS) tokens using SOAP messages. Supports both <em>active</em> (SOAP client) and <em>passive</em> (browser redirect) requestors.</li>
                        <li><strong>Passive Federation</strong> &mdash; Browser-based SSO using HTTP redirects, similar to SAML. The user is redirected to the IdP's WS-Federation endpoint, authenticates, and is redirected back with a signed token.</li>
                        <li><strong>Active Federation</strong> &mdash; Application code directly calls the STS endpoint via SOAP/WS-Trust to obtain a token programmatically. Used by rich clients and services, not browsers.</li>
                    </ul>

                    <pre><code class="language-powershell"># Test WS-Federation metadata endpoint
Invoke-WebRequest `
  "https://adfs.contoso.com/FederationMetadata/2007-06/FederationMetadata.xml" |
  Select-Object StatusCode, ContentType

# Typical WS-Federation sign-in URL structure:
# https://adfs.contoso.com/adfs/ls/
#   ?wa=wsignin1.0
#   &amp;wtrealm=https://app.contoso.com
#   &amp;wctx=rm=0&amp;id=passive&amp;ru=%2f</code></pre>
                </div>

                <!-- AD FS -->
                <div class="subsection">
                    <h3 class="subsection-title">AD FS (Active Directory Federation Services)</h3>
                    <p><strong>AD FS</strong> is Microsoft's on-premises federation server. It acts as an Identity Provider (IdP) that authenticates users against Active Directory and issues SAML tokens, WS-Federation tokens, or OAuth/OIDC tokens to relying party applications.</p>

                    <p>Key AD FS concepts:</p>
                    <ul>
                        <li><strong>Claims Provider Trust</strong> &mdash; The source of identity (typically Active Directory). AD FS extracts attributes (UPN, email, groups) and converts them into claims.</li>
                        <li><strong>Relying Party Trust (RPT)</strong> &mdash; Represents an application or service that consumes tokens from AD FS. Each RPT defines the claims rules, token format, and endpoints for that application.</li>
                        <li><strong>Claims Rules</strong> &mdash; Transform, filter, and pass-through identity attributes. Written in the AD FS claims rule language or configured via the GUI.</li>
                    </ul>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>List Relying Party Trusts</h4>
                            <pre><code class="language-powershell">Get-AdfsRelyingPartyTrust |
  Select Name, Identifier, IssuanceAuthorizationRules |
  Format-List</code></pre>
                            <p class="cmd-desc">Show all configured relying parties and their authorization rules.</p>
                        </div>

                        <div class="command-card">
                            <h4>Add a Relying Party Trust</h4>
                            <pre><code class="language-powershell">Add-AdfsRelyingPartyTrust `
  -Name "Contoso Helpdesk" `
  -MetadataUrl "https://helpdesk.contoso.com/saml/metadata" `
  -IssuanceTransformRules '@RuleTemplate = "LdapClaims"
    @RuleName = "Send AD Attributes"
    c:[Type ==
      "http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname",
       Issuer == "AD AUTHORITY"]
    => issue(store = "Active Directory",
       types = (
         "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn",
         "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"),
       query = ";userPrincipalName,mail;{0}", param = c.Value);'</code></pre>
                            <p class="cmd-desc">Register a new SP using its SAML metadata URL, with claims rules to emit UPN and email.</p>
                        </div>

                        <div class="command-card">
                            <h4>Test AD FS Health</h4>
                            <pre><code class="language-powershell"># Check AD FS service status
Get-AdfsProperties | Select HostName, HttpsPort, CurrentFarmBehavior

# Verify the SSL certificate
Get-AdfsSslCertificate

# Test the federation metadata endpoint
Test-AdfsServerHealth</code></pre>
                            <p class="cmd-desc">Verify AD FS is running, its certificate is valid, and health checks pass.</p>
                        </div>

                        <div class="command-card">
                            <h4>Export/Import Claims Rules</h4>
                            <pre><code class="language-powershell"># Export rules from an existing RPT
(Get-AdfsRelyingPartyTrust -Name "Contoso App").IssuanceTransformRules |
  Out-File .\claims-rules.txt

# Import rules to another RPT
$rules = Get-Content .\claims-rules.txt -Raw
Set-AdfsRelyingPartyTrust -TargetName "New App" `
  -IssuanceTransformRules $rules</code></pre>
                            <p class="cmd-desc">Back up and replicate claims rule configurations across relying party trusts.</p>
                        </div>
                    </div>
                </div>

                <!-- Trust Relationships -->
                <div class="subsection">
                    <h3 class="subsection-title">Trust Relationships</h3>
                    <p>Active Directory supports multiple trust types that allow authentication across domain and forest boundaries. Trusts define the direction and transitivity of authentication flow between security domains.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Trust Type</th>
                                    <th>Direction</th>
                                    <th>Transitivity</th>
                                    <th>Use Case</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Parent-Child</strong></td>
                                    <td>Two-way</td>
                                    <td>Transitive</td>
                                    <td>Automatically created between parent and child domains in a tree</td>
                                </tr>
                                <tr>
                                    <td><strong>Tree-Root</strong></td>
                                    <td>Two-way</td>
                                    <td>Transitive</td>
                                    <td>Automatically created between tree roots in the same forest</td>
                                </tr>
                                <tr>
                                    <td><strong>Forest Trust</strong></td>
                                    <td>One-way or Two-way</td>
                                    <td>Transitive</td>
                                    <td>Cross-forest resource sharing (requires Forest Functional Level 2003+)</td>
                                </tr>
                                <tr>
                                    <td><strong>External Trust</strong></td>
                                    <td>One-way or Two-way</td>
                                    <td>Non-transitive</td>
                                    <td>Connecting to a specific domain in another forest without full forest trust</td>
                                </tr>
                                <tr>
                                    <td><strong>Realm Trust</strong></td>
                                    <td>One-way or Two-way</td>
                                    <td>Transitive or Non-transitive</td>
                                    <td>Connecting AD to a non-Windows Kerberos realm (MIT KDC, Linux)</td>
                                </tr>
                                <tr>
                                    <td><strong>Shortcut Trust</strong></td>
                                    <td>One-way or Two-way</td>
                                    <td>Transitive</td>
                                    <td>Optimizing authentication between two domains in different trees within the same forest</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-powershell"># Verify an existing trust
netdom trust corp.contoso.com /domain:partner.fabrikam.com /verify

# List all trusts for the current domain
Get-ADTrust -Filter *

# Create a new forest trust (run on both sides)
netdom trust corp.contoso.com /domain:partner.fabrikam.com `
  /add /twoway /transitive

# Validate trust with specific credentials
Test-ComputerSecureChannel -Server "dc01.partner.fabrikam.com" -Verbose

# View trust details including SID filtering status
Get-ADTrust -Identity "partner.fabrikam.com" |
  Select Name, Direction, ForestTransitive, SIDFilteringQuarantined,
    SIDFilteringForestAware</code></pre>

                    <div class="alert alert-danger">
                        <div class="alert-title">SID Filtering &amp; Trust Security</div>
                        <p><strong>SID Filtering</strong> (quarantine) is enabled by default on external trusts and blocks SIDs from the trusted domain that do not belong to that domain's SID authority. Disabling SID filtering (e.g., for SID history migration) creates a serious privilege escalation vector &mdash; a compromised admin in the trusted domain could inject a Domain Admins SID into their token. Only disable it temporarily during migrations and re-enable immediately afterward.</p>
                    </div>
                </div>

                <!-- SCIM Provisioning -->
                <div class="subsection">
                    <h3 class="subsection-title">SCIM Provisioning</h3>
                    <p><strong>System for Cross-domain Identity Management (SCIM 2.0)</strong> is a REST API standard for automating user provisioning and deprovisioning across identity domains. While SAML and OIDC handle <em>authentication</em>, SCIM handles the <em>lifecycle</em>: creating accounts in downstream apps when a user joins, updating attributes when they transfer, and disabling accounts when they leave.</p>

                    <p>The user lifecycle follows three phases:</p>
                    <ul>
                        <li><span class="badge badge-emerald">Join</span> New employee starts &rarr; HR system creates identity &rarr; SCIM provisions accounts in all connected apps</li>
                        <li><span class="badge badge-gold">Change</span> Employee transfers departments &rarr; HR updates attributes &rarr; SCIM patches group memberships and permissions</li>
                        <li><span class="badge badge-crimson">Leave</span> Employee departs &rarr; HR marks inactive &rarr; SCIM deactivates or deletes accounts across all apps</li>
                    </ul>

                    <pre><code class="language-bash"># SCIM 2.0 Core Endpoints

# Create a user (Joiner)
POST /scim/v2/Users
Content-Type: application/scim+json
{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "userName": "jdoe@contoso.com",
  "name": { "givenName": "Jane", "familyName": "Doe" },
  "emails": [{ "value": "jdoe@contoso.com", "primary": true }],
  "active": true,
  "groups": []
}

# Update a user (Mover) — change department
PATCH /scim/v2/Users/a1b2c3d4
Content-Type: application/scim+json
{
  "schemas": ["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{
    "op": "replace",
    "path": "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User:department",
    "value": "Engineering"
  }]
}

# Deactivate a user (Leaver)
PATCH /scim/v2/Users/a1b2c3d4
Content-Type: application/scim+json
{
  "schemas": ["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{ "op": "replace", "path": "active", "value": false }]
}

# Delete a user (hard delete — use sparingly)
DELETE /scim/v2/Users/a1b2c3d4</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">Azure AD SCIM Provisioning</div>
                        <p>Azure AD (Entra ID) includes a built-in SCIM client for provisioning to SaaS apps. Configure it under <strong>Enterprise Applications &rarr; Provisioning</strong>. You provide the SCIM endpoint URL and a bearer token. Azure AD then syncs users and groups on a 40-minute cycle (or on-demand). Attribute mappings let you transform AD attributes to the target app's schema.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 08: AZURE AD / ENTRA ID
             ============================================ -->
        <section id="azure-ad" class="section">
            <div class="section-header">
                <div class="section-number">VIII</div>
                <h2 class="section-title">Azure AD / Entra ID</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#1e3a5f" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#1e3a5f" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#1e3a5f" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#1e3a5f"/>
                    </svg>
                </div>
                <p class="section-desc">Microsoft's cloud identity platform &mdash; from tenant fundamentals and hybrid sync to Conditional Access, managed identities, and the Graph API.</p>
            </div>

            <div class="section-content">

                <!-- Cloud Identity Fundamentals -->
                <div class="subsection">
                    <h3 class="subsection-title">Cloud Identity Fundamentals</h3>
                    <p>Azure Active Directory (now <strong>Microsoft Entra ID</strong>) is Microsoft's cloud-based identity and access management service. Unlike on-premises AD, which uses LDAP and Kerberos, Entra ID is built on REST APIs and modern authentication protocols (OAuth 2.0, OIDC, SAML).</p>

                    <p>The core hierarchy:</p>
                    <ul>
                        <li><strong>Tenant</strong> &mdash; A dedicated instance of Entra ID. Each organization gets one tenant, identified by a unique tenant ID and a <code>*.onmicrosoft.com</code> domain.</li>
                        <li><strong>Directory</strong> &mdash; The identity store within the tenant containing users, groups, applications, and devices.</li>
                        <li><strong>Subscription</strong> &mdash; A billing and resource boundary for Azure services. Subscriptions trust a single tenant for authentication.</li>
                    </ul>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aspect</th>
                                    <th>On-Premises AD (AD DS)</th>
                                    <th>Azure AD / Entra ID</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Protocol</strong></td>
                                    <td>LDAP, Kerberos, NTLM</td>
                                    <td>OAuth 2.0, OpenID Connect, SAML</td>
                                </tr>
                                <tr>
                                    <td><strong>Auth Method</strong></td>
                                    <td>Domain-join, GPO, service tickets</td>
                                    <td>Token-based, Conditional Access, MFA</td>
                                </tr>
                                <tr>
                                    <td><strong>Device Management</strong></td>
                                    <td>Group Policy, SCCM</td>
                                    <td>Intune, Azure AD Join, compliance policies</td>
                                </tr>
                                <tr>
                                    <td><strong>Structure</strong></td>
                                    <td>Forests, Domains, OUs</td>
                                    <td>Flat tenant, no OU hierarchy (use Administrative Units)</td>
                                </tr>
                                <tr>
                                    <td><strong>Admin Portal</strong></td>
                                    <td>ADUC, ADSI Edit, PowerShell</td>
                                    <td>Entra admin center, Azure CLI, Graph API, PowerShell</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Azure AD Connect -->
                <div class="subsection">
                    <h3 class="subsection-title">Azure AD Connect</h3>
                    <p><strong>Azure AD Connect</strong> (and its successor, <strong>Azure AD Connect Cloud Sync</strong>) bridges on-premises Active Directory with Entra ID, creating a <strong>hybrid identity</strong>. Users authenticate with the same credentials across on-prem and cloud resources.</p>

                    <p>Three authentication methods for hybrid identity:</p>
                    <ul>
                        <li><strong>Password Hash Sync (PHS)</strong> &mdash; A hash of the on-prem password hash is synced to Entra ID. Users authenticate directly against the cloud. Simplest to deploy; enables leaked credential detection.</li>
                        <li><strong>Pass-Through Authentication (PTA)</strong> &mdash; Authentication requests are forwarded to on-prem agents that validate against AD DS. Passwords never leave the on-prem boundary. Requires agents on domain-joined servers.</li>
                        <li><strong>Federation (AD FS)</strong> &mdash; All authentication is redirected to on-prem AD FS servers. Maximum control over sign-in experience, but highest complexity and maintenance burden.</li>
                    </ul>

                    <pre><code class="language-powershell"># Trigger a delta sync cycle (sync recent changes)
Start-ADSyncSyncCycle -PolicyType Delta

# Trigger a full sync cycle (re-sync everything)
Start-ADSyncSyncCycle -PolicyType Initial

# Check current sync status
Get-ADSyncScheduler

# View sync errors
Get-ADSyncCSObject -ConnectorName "contoso.com" |
  Where-Object {$_.HasSyncError -eq $true} |
  Select DistinguishedName, SyncError

# Review sync rules and their precedence
Get-ADSyncRule | Select Name, Direction, Precedence,
  SourceObjectType, TargetObjectType |
  Sort Precedence | Format-Table</code></pre>

                    <div class="alert alert-warning">
                        <div class="alert-title">Source of Authority</div>
                        <p>When Azure AD Connect is active, on-premises AD is the <strong>source of authority</strong> for synced objects. Changes to synced attributes (displayName, department, manager) must be made on-premises &mdash; edits made in the Entra portal will be overwritten on the next sync cycle. Cloud-only attributes (like Conditional Access assignments) are managed exclusively in Entra ID.</p>
                    </div>
                </div>

                <!-- Conditional Access -->
                <div class="subsection">
                    <h3 class="subsection-title">Conditional Access</h3>
                    <p><strong>Conditional Access</strong> policies are the central policy engine of Entra ID. They evaluate signals (who, where, what device, what app, risk level) and enforce access decisions (allow, block, require MFA, require compliant device) in real time during sign-in.</p>

                    <p>Every policy has two parts:</p>
                    <ul>
                        <li><strong>Assignments</strong> &mdash; <em>When</em> does this policy apply? Define users/groups, target apps, and conditions (location, device platform, sign-in risk, client app type).</li>
                        <li><strong>Access Controls</strong> &mdash; <em>What</em> happens when the conditions are met? Grant access (with requirements like MFA, compliant device, hybrid Azure AD join) or block access entirely. Session controls can limit download/upload, enforce app restrictions, or set sign-in frequency.</li>
                    </ul>

                    <p>Common policy patterns:</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>Require MFA from Untrusted Networks</h4>
                            <pre><code class="language-text">Assignments:
  Users: All users
  Apps: All cloud apps
  Conditions:
    Locations: Exclude — Named: "Corporate Network"

Access Controls:
  Grant: Require multi-factor authentication</code></pre>
                            <p class="cmd-desc">Users on corporate IPs skip MFA; all others must complete a second factor.</p>
                        </div>

                        <div class="command-card">
                            <h4>Block Legacy Authentication</h4>
                            <pre><code class="language-text">Assignments:
  Users: All users
  Apps: All cloud apps
  Conditions:
    Client apps: Exchange ActiveSync, Other clients

Access Controls:
  Block access</code></pre>
                            <p class="cmd-desc">Prevent IMAP, POP3, SMTP AUTH, and older Office clients that cannot support MFA.</p>
                        </div>

                        <div class="command-card">
                            <h4>Require Compliant Devices</h4>
                            <pre><code class="language-text">Assignments:
  Users: All users (exclude break-glass accounts)
  Apps: Office 365
  Conditions:
    Device platforms: Windows, iOS, Android

Access Controls:
  Grant: Require device to be marked as compliant</code></pre>
                            <p class="cmd-desc">Only Intune-enrolled devices meeting compliance policies can access Office 365.</p>
                        </div>

                        <div class="command-card">
                            <h4>Risk-Based MFA</h4>
                            <pre><code class="language-text">Assignments:
  Users: All users
  Apps: All cloud apps
  Conditions:
    Sign-in risk: Medium and above

Access Controls:
  Grant: Require multi-factor authentication</code></pre>
                            <p class="cmd-desc">Entra ID Identity Protection triggers MFA when anomalous sign-in behavior is detected.</p>
                        </div>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">Break-Glass Accounts</div>
                        <p>Always exclude at least two <strong>emergency access (break-glass) accounts</strong> from all Conditional Access policies. These are cloud-only accounts with Global Administrator role, long random passwords, and no MFA requirement. Store credentials in a physical safe. Without them, a misconfigured Conditional Access policy can lock every admin out of the tenant permanently.</p>
                    </div>
                </div>

                <!-- App Registrations & Service Principals -->
                <div class="subsection">
                    <h3 class="subsection-title">App Registrations &amp; Service Principals</h3>
                    <p>In Entra ID, applications have a two-object model that separates the <em>definition</em> of an app from its <em>instantiation</em> in a tenant:</p>

                    <ul>
                        <li><strong>App Registration</strong> &mdash; The global definition of the application (client ID, redirect URIs, API permissions, certificates/secrets). Lives in the home tenant. Think of it as the "class definition."</li>
                        <li><strong>Service Principal</strong> &mdash; The local instance of an app within a specific tenant. Created automatically when an app is consented to or provisioned. Think of it as the "object instance." Enterprise applications in the Entra portal are service principals.</li>
                        <li><strong>Managed Identity</strong> &mdash; A special type of service principal whose credentials are managed entirely by Azure. No secrets to rotate.</li>
                    </ul>

                    <pre><code class="language-bash"># Create an app registration
az ad app create --display-name "Contoso Automation" \
  --sign-in-audience "AzureADMyOrg"

# Create a service principal with RBAC role assignment
az ad sp create-for-rbac \
  --name "sp-contoso-automation" \
  --role "Contributor" \
  --scopes "/subscriptions/{subscription-id}/resourceGroups/rg-production"

# List app registrations
az ad app list --display-name "Contoso" --output table

# Add a client secret (rotate before expiry!)
az ad app credential reset \
  --id {app-id} \
  --append \
  --display-name "automation-secret-2025" \
  --years 1</code></pre>
                </div>

                <!-- Managed Identities -->
                <div class="subsection">
                    <h3 class="subsection-title">Managed Identities</h3>
                    <p><strong>Managed Identities</strong> eliminate the need for developers to manage credentials. Azure automatically provisions and rotates the identity's certificates behind the scenes.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Lifecycle</th>
                                    <th>Sharing</th>
                                    <th>Best For</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>System-Assigned</strong></td>
                                    <td>Tied to the resource; deleted when the resource is deleted</td>
                                    <td>One-to-one (cannot be shared)</td>
                                    <td>Single-resource workloads (a VM accessing Key Vault, an App Service calling SQL)</td>
                                </tr>
                                <tr>
                                    <td><strong>User-Assigned</strong></td>
                                    <td>Independent resource; persists until explicitly deleted</td>
                                    <td>One-to-many (assigned to multiple resources)</td>
                                    <td>Shared identity across VMs, Functions, and containers in the same workload</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-bash"># Enable system-assigned managed identity on a VM
az vm identity assign --name vm-web01 --resource-group rg-production

# Create a user-assigned managed identity
az identity create --name mi-shared-workload --resource-group rg-production

# Assign the user-assigned identity to a VM
az vm identity assign --name vm-web01 --resource-group rg-production \
  --identities mi-shared-workload

# Grant the managed identity access to Key Vault
az keyvault set-policy --name kv-production \
  --object-id $(az vm identity show --name vm-web01 -g rg-production \
    --query principalId -o tsv) \
  --secret-permissions get list</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">No Secrets to Rotate</div>
                        <p>Managed identities obtain tokens from the Azure Instance Metadata Service (IMDS) at <code>http://169.254.169.254/metadata/identity/oauth2/token</code>. The credentials never appear in code, config files, or environment variables. This eliminates an entire class of credential-leak vulnerabilities.</p>
                    </div>
                </div>

                <!-- Microsoft Graph API -->
                <div class="subsection">
                    <h3 class="subsection-title">Microsoft Graph API</h3>
                    <p>The <strong>Microsoft Graph API</strong> is the unified REST endpoint for interacting with all Microsoft cloud services, including Entra ID. All identity operations &mdash; managing users, groups, applications, and policies &mdash; flow through Graph.</p>

                    <pre><code class="language-bash"># List users in the Engineering department
GET https://graph.microsoft.com/v1.0/users?$filter=department eq 'Engineering'
  &amp;$select=displayName,userPrincipalName,jobTitle
  &amp;$orderby=displayName

# Get a specific user's group memberships
GET https://graph.microsoft.com/v1.0/users/{user-id}/memberOf
  ?$select=displayName,groupTypes

# List all enterprise applications (service principals)
GET https://graph.microsoft.com/v1.0/servicePrincipals
  ?$filter=tags/any(t:t eq 'WindowsAzureActiveDirectoryIntegratedApp')
  &amp;$select=displayName,appId,servicePrincipalType</code></pre>

                    <pre><code class="language-powershell"># Microsoft Graph PowerShell SDK
Install-Module Microsoft.Graph -Scope CurrentUser
Connect-MgGraph -Scopes "User.Read.All", "Group.ReadWrite.All"

# Get all users
Get-MgUser -All -Property DisplayName, UserPrincipalName, Department |
  Format-Table

# Create a new security group
New-MgGroup -DisplayName "SG-Engineering-Leads" `
  -MailEnabled:$false -MailNickname "sg-eng-leads" `
  -SecurityEnabled:$true `
  -Description "Engineering leadership team"

# Add a member to a group
New-MgGroupMember -GroupId {group-id} `
  -DirectoryObjectId {user-id}

# List app registrations with expiring credentials
Get-MgApplication -All | ForEach-Object {
  $app = $_
  $_.PasswordCredentials | Where-Object {
    $_.EndDateTime -lt (Get-Date).AddDays(30)
  } | Select @{N='App';E={$app.DisplayName}},
    @{N='SecretName';E={$_.DisplayName}},
    @{N='Expires';E={$_.EndDateTime}}
} | Where-Object {$_} | Format-Table</code></pre>
                </div>

                <!-- B2B & B2C -->
                <div class="subsection">
                    <h3 class="subsection-title">B2B &amp; B2C</h3>
                    <p>Entra ID supports two models for external identity scenarios, each designed for a fundamentally different audience:</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aspect</th>
                                    <th>B2B (Business-to-Business)</th>
                                    <th>B2C (Business-to-Consumer)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Audience</strong></td>
                                    <td>Partners, vendors, contractors with their own organizational identity</td>
                                    <td>Customers and end users (public-facing)</td>
                                </tr>
                                <tr>
                                    <td><strong>Identity Source</strong></td>
                                    <td>Guest user's home tenant, Google, Microsoft accounts</td>
                                    <td>Local accounts, social IdPs (Google, Facebook, Apple), custom OIDC</td>
                                </tr>
                                <tr>
                                    <td><strong>Tenant</strong></td>
                                    <td>Guests appear in your tenant's directory as external users</td>
                                    <td>Separate B2C tenant with its own user directory</td>
                                </tr>
                                <tr>
                                    <td><strong>Customization</strong></td>
                                    <td>Limited &mdash; uses standard Entra sign-in experience</td>
                                    <td>Fully customizable sign-up/sign-in flows and UI branding</td>
                                </tr>
                                <tr>
                                    <td><strong>Scale</strong></td>
                                    <td>Hundreds to thousands of external collaborators</td>
                                    <td>Millions of consumer accounts</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-powershell"># Invite a B2B guest user
New-MgInvitation -InvitedUserEmailAddress "partner@fabrikam.com" `
  -InviteRedirectUrl "https://myapp.contoso.com" `
  -SendInvitationMessage:$true

# List all guest users in the tenant
Get-MgUser -Filter "userType eq 'Guest'" -All |
  Select DisplayName, Mail, CreatedDateTime |
  Sort CreatedDateTime -Descending

# Remove stale guest accounts (no sign-in for 90 days)
Get-MgUser -Filter "userType eq 'Guest'" -All `
  -Property DisplayName, SignInActivity |
  Where-Object {
    $_.SignInActivity.LastSignInDateTime -lt (Get-Date).AddDays(-90)
  } | Select DisplayName, @{
    N='LastSignIn'; E={$_.SignInActivity.LastSignInDateTime}
  }</code></pre>

                    <div class="alert alert-warning">
                        <div class="alert-title">Guest Account Governance</div>
                        <p>B2B guest users accumulate over time and often retain access long after a collaboration ends. Use <strong>Entra ID Access Reviews</strong> to periodically require guest sponsors to re-confirm that access is still needed. Configure automatic removal of guests who are denied or not reviewed. Without governance, guest accounts become a significant attack surface.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 09: GROUP POLICY MANAGEMENT
             ============================================ -->
        <section id="group-policy" class="section">
            <div class="section-header">
                <div class="section-number">IX</div>
                <h2 class="section-title">Group Policy Management</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#d4a012" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#d4a012"/>
                    </svg>
                </div>
                <p class="section-desc">Centralized configuration at scale &mdash; GPO processing order, precedence rules, administrative templates, and the commands that make policy visible.</p>
            </div>

            <div class="section-content">

                <!-- GPO Fundamentals -->
                <div class="subsection">
                    <h3 class="subsection-title">GPO Fundamentals</h3>
                    <p>A <strong>Group Policy Object (GPO)</strong> is a collection of settings that define what a computer or user environment looks like. GPOs are linked to Active Directory containers &mdash; Sites, Domains, and OUs &mdash; and are processed by clients during startup (computer policies) and logon (user policies).</p>

                    <p>Every GPO contains two top-level nodes:</p>
                    <ul>
                        <li><strong>Computer Configuration</strong> &mdash; Settings applied to the machine regardless of who logs in. Processed at startup before the logon screen appears. Examples: audit policies, firewall rules, service configurations, BitLocker settings.</li>
                        <li><strong>User Configuration</strong> &mdash; Settings applied to the user session regardless of which machine they log into. Processed at logon. Examples: folder redirection, drive mappings, Start menu restrictions, proxy settings.</li>
                    </ul>

                    <p>The <strong>LSDOU</strong> processing order determines which GPOs apply and in what sequence:</p>
                    <ol>
                        <li><strong>L</strong>ocal Group Policy &mdash; Settings in <code>gpedit.msc</code> on the local machine. Lowest precedence; overridden by everything above.</li>
                        <li><strong>S</strong>ite-linked GPOs &mdash; Applied based on the AD site the computer belongs to. Rarely used in modern environments.</li>
                        <li><strong>D</strong>omain-linked GPOs &mdash; Applied to all objects in the domain. The Default Domain Policy lives here (and should contain only password, Kerberos, and account lockout settings).</li>
                        <li><strong>O</strong>U-linked GPOs &mdash; Applied to the OU (and child OUs) where the object resides. Highest precedence in normal processing. Most specific wins.</li>
                    </ol>

                    <div class="alert alert-info">
                        <div class="alert-title">Last Writer Wins</div>
                        <p>When multiple GPOs configure the same setting, the <strong>last GPO processed wins</strong>. Since LSDOU processes from broadest to most specific, an OU-level setting overrides a domain-level setting for the same policy. Within a single container, GPOs with a lower <strong>link order number</strong> are processed last and therefore take precedence.</p>
                    </div>
                </div>

                <!-- GPO Precedence & Inheritance -->
                <div class="subsection">
                    <h3 class="subsection-title">GPO Precedence &amp; Inheritance</h3>
                    <p>Beyond LSDOU, several mechanisms modify which GPOs actually apply to a given object:</p>

                    <ul>
                        <li><strong>Block Inheritance</strong> &mdash; Set on an OU to prevent GPOs linked at higher levels (domain, parent OUs) from applying to objects in this OU. Use sparingly &mdash; it creates exceptions that are hard to troubleshoot.</li>
                        <li><strong>Enforced (No Override)</strong> &mdash; Set on a GPO link to force its settings to apply even when child OUs block inheritance. Enforced GPOs always win, regardless of LSDOU position.</li>
                        <li><strong>Security Filtering</strong> &mdash; By default, GPOs apply to "Authenticated Users." You can restrict a GPO to specific security groups by removing Authenticated Users and adding targeted groups to the security filter.</li>
                        <li><strong>WMI Filtering</strong> &mdash; Evaluate a WMI query on the client before applying the GPO. If the query returns true, the GPO applies. Example: apply a GPO only to laptops, or only to machines with more than 8 GB RAM.</li>
                        <li><strong>Loopback Processing</strong> &mdash; Normally, user policies come from the OU where the <em>user</em> object resides. Loopback mode (Replace or Merge) applies user policies based on the OU where the <em>computer</em> object resides. Essential for kiosks, terminal servers, and conference room PCs.</li>
                    </ul>

                    <p>Effective precedence from <strong>lowest</strong> to <strong>highest</strong>:</p>
                    <ol>
                        <li>Local GPO</li>
                        <li>Site-linked GPOs</li>
                        <li>Domain-linked GPOs</li>
                        <li>Parent OU GPOs</li>
                        <li>Child OU GPOs (most specific, highest normal precedence)</li>
                        <li>Enforced GPOs (reverse order &mdash; domain-level enforced beats OU-level enforced)</li>
                    </ol>

                    <div class="alert alert-warning">
                        <div class="alert-title">Enforced + Block Inheritance</div>
                        <p>When an OU has <strong>Block Inheritance</strong> enabled and a parent GPO is <strong>Enforced</strong>, Enforced wins. This is by design &mdash; Enforced exists specifically to override Block Inheritance. The only way to prevent an Enforced GPO from applying is security filtering or WMI filtering.</p>
                    </div>
                </div>

                <!-- Common GPO Settings -->
                <div class="subsection">
                    <h3 class="subsection-title">Common GPO Settings</h3>
                    <p>These are the GPO settings most frequently configured in enterprise environments:</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Setting Category</th>
                                    <th>Policy Path</th>
                                    <th>Recommended Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Minimum Password Length</strong></td>
                                    <td>Computer &rarr; Windows Settings &rarr; Security &rarr; Account Policies &rarr; Password Policy</td>
                                    <td>14+ characters</td>
                                </tr>
                                <tr>
                                    <td><strong>Password Complexity</strong></td>
                                    <td>Same path as above</td>
                                    <td>Enabled (3 of 4 character categories)</td>
                                </tr>
                                <tr>
                                    <td><strong>Account Lockout Threshold</strong></td>
                                    <td>Computer &rarr; Windows Settings &rarr; Security &rarr; Account Policies &rarr; Account Lockout</td>
                                    <td>5-10 failed attempts</td>
                                </tr>
                                <tr>
                                    <td><strong>Lockout Duration</strong></td>
                                    <td>Same path as above</td>
                                    <td>15-30 minutes</td>
                                </tr>
                                <tr>
                                    <td><strong>Audit Logon Events</strong></td>
                                    <td>Computer &rarr; Windows Settings &rarr; Security &rarr; Advanced Audit &rarr; Logon/Logoff</td>
                                    <td>Success and Failure</td>
                                </tr>
                                <tr>
                                    <td><strong>Audit Account Management</strong></td>
                                    <td>Computer &rarr; Windows Settings &rarr; Security &rarr; Advanced Audit &rarr; Account Management</td>
                                    <td>Success and Failure</td>
                                </tr>
                                <tr>
                                    <td><strong>Software Restriction</strong></td>
                                    <td>Computer &rarr; Windows Settings &rarr; Security &rarr; Software Restriction Policies</td>
                                    <td>Default deny with path/hash rules for approved software</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Administrative Templates -->
                <div class="subsection">
                    <h3 class="subsection-title">Administrative Templates</h3>
                    <p><strong>Administrative Templates</strong> are registry-based policy definitions stored as ADMX (XML) and ADML (language-specific XML) files. They define the settings you see under Computer Configuration &rarr; Administrative Templates and User Configuration &rarr; Administrative Templates in the Group Policy editor.</p>

                    <p>By default, each machine has its own copy of ADMX files. In a domain environment, you should create a <strong>Central Store</strong> so all administrators see the same template definitions:</p>

                    <pre><code class="language-powershell"># Central Store path (create this folder on a DC, it replicates via SYSVOL)
\\corp.contoso.com\SYSVOL\corp.contoso.com\Policies\PolicyDefinitions\

# Copy ADMX files from a Windows machine to the Central Store
Copy-Item "C:\Windows\PolicyDefinitions\*.admx" `
  "\\corp.contoso.com\SYSVOL\corp.contoso.com\Policies\PolicyDefinitions\"

# Copy language-specific ADML files
Copy-Item "C:\Windows\PolicyDefinitions\en-US\*.adml" `
  "\\corp.contoso.com\SYSVOL\corp.contoso.com\Policies\PolicyDefinitions\en-US\"

# For third-party templates (Chrome, Office, Adobe, etc.):
# Download the vendor's ADMX/ADML files and copy to the Central Store
# Chrome example:
#   chrome.admx → PolicyDefinitions\
#   chrome.adml → PolicyDefinitions\en-US\</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">Custom ADMX Templates</div>
                        <p>You can create custom ADMX templates to manage application-specific registry settings through Group Policy. Microsoft provides the <strong>ADMX Migrator</strong> tool to convert legacy ADM files, and the ADMX schema is well-documented for writing templates from scratch. Custom templates appear in the Group Policy editor alongside built-in settings once placed in the Central Store.</p>
                    </div>
                </div>

                <!-- GP Preferences vs Policies -->
                <div class="subsection">
                    <h3 class="subsection-title">Group Policy Preferences vs Policies</h3>
                    <p>Group Policy contains two fundamentally different mechanisms for configuring settings: <strong>Policies</strong> (the traditional settings under Administrative Templates) and <strong>Preferences</strong> (added in Windows Server 2008). They look similar in the editor but behave very differently.</p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aspect</th>
                                    <th>Group Policy (Policies)</th>
                                    <th>Group Policy Preferences</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Enforcement</strong></td>
                                    <td>Strictly enforced &mdash; user cannot change the setting</td>
                                    <td>Applied as defaults &mdash; user can modify afterward</td>
                                </tr>
                                <tr>
                                    <td><strong>Registry Location</strong></td>
                                    <td>Written to <code>HKLM\Software\Policies</code> or <code>HKCU\Software\Policies</code></td>
                                    <td>Written to the application's normal registry location</td>
                                </tr>
                                <tr>
                                    <td><strong>Removal Behavior</strong></td>
                                    <td>Setting is removed ("tattooing" does not occur) when GPO no longer applies</td>
                                    <td>Setting persists ("tattoos" the registry) even after GPO is unlinked</td>
                                </tr>
                                <tr>
                                    <td><strong>User Override</strong></td>
                                    <td>The UI element is grayed out; user cannot change it</td>
                                    <td>Setting appears normal; user can change it (until next refresh cycle)</td>
                                </tr>
                                <tr>
                                    <td><strong>Use Case</strong></td>
                                    <td>Security policies, mandatory configurations that must be enforced</td>
                                    <td>Default drive mappings, printer installations, environment variables, scheduled tasks</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">Preferences and Stored Credentials</div>
                        <p>Group Policy Preferences historically allowed storing credentials (e.g., for scheduled tasks or drive mappings running as a specific user). These credentials were encrypted with a <strong>publicly known AES key</strong> (published by Microsoft in MS14-025). Never use the "Run as" feature in GP Preferences. The vulnerability was patched to prevent creating new entries, but existing entries with stored passwords may still exist in your SYSVOL. Audit with: <code>findstr /S /I "cpassword" \\corp.contoso.com\SYSVOL\*.xml</code></p>
                    </div>
                </div>

                <!-- GPO Commands -->
                <div class="subsection">
                    <h3 class="subsection-title">GPO Commands</h3>
                    <p>Essential commands for managing, diagnosing, and reporting on Group Policy:</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>View Resultant Set of Policy</h4>
                            <pre><code class="language-powershell"># Console summary of applied GPOs
gpresult /r

# Detailed HTML report (save and open in browser)
gpresult /h C:\Temp\gpo-report.html /f

# Remote machine report
gpresult /s SERVER01 /r /user CORP\jdoe</code></pre>
                            <p class="cmd-desc">See which GPOs are applied to the current user and computer, with precedence details.</p>
                        </div>

                        <div class="command-card">
                            <h4>Force Policy Refresh</h4>
                            <pre><code class="language-powershell"># Refresh all policies immediately
gpupdate /force

# Refresh only computer policies
gpupdate /target:computer /force

# Refresh with logoff (for policies requiring it)
gpupdate /force /logoff

# Remote refresh via PowerShell
Invoke-GPUpdate -Computer "SERVER01" -Force -RandomDelayInMinutes 0</code></pre>
                            <p class="cmd-desc">Force an immediate policy refresh rather than waiting for the default 90-minute cycle.</p>
                        </div>

                        <div class="command-card">
                            <h4>Manage GPOs with PowerShell</h4>
                            <pre><code class="language-powershell"># List all GPOs in the domain
Get-GPO -All | Select DisplayName, GpoStatus, CreationTime |
  Sort DisplayName

# Create a new GPO
New-GPO -Name "Security-Baseline-Workstations" `
  -Comment "Baseline security settings for domain workstations"

# Link a GPO to an OU
New-GPLink -Name "Security-Baseline-Workstations" `
  -Target "OU=Workstations,DC=corp,DC=contoso,DC=com" `
  -LinkEnabled Yes

# Set GPO link enforcement
Set-GPLink -Name "Security-Baseline-Workstations" `
  -Target "OU=Workstations,DC=corp,DC=contoso,DC=com" `
  -Enforced Yes</code></pre>
                            <p class="cmd-desc">Create, link, and enforce GPOs programmatically.</p>
                        </div>

                        <div class="command-card">
                            <h4>Reporting &amp; Simulation</h4>
                            <pre><code class="language-powershell"># Generate HTML report for a specific GPO
Get-GPOReport -Name "Security-Baseline-Workstations" `
  -ReportType HTML -Path C:\Temp\baseline-report.html

# RSoP simulation: what would apply if a user logged
# into a specific computer?
Get-GPResultantSetOfPolicy -ReportType HTML `
  -Path C:\Temp\rsop-simulation.html `
  -User "CORP\jdoe" -Computer "CORP\WS-JDOE01"

# GUI tools for GPO management
# gpmc.msc  — Group Policy Management Console
# rsop.msc  — Resultant Set of Policy snap-in</code></pre>
                            <p class="cmd-desc">Generate detailed reports and simulate policy application before deploying changes.</p>
                        </div>

                        <div class="command-card">
                            <h4>Backup &amp; Restore GPOs</h4>
                            <pre><code class="language-powershell"># Backup all GPOs
Backup-GPO -All -Path "C:\GPO-Backups\$(Get-Date -Format yyyy-MM-dd)"

# Backup a specific GPO
Backup-GPO -Name "Security-Baseline-Workstations" `
  -Path "C:\GPO-Backups"

# Restore a GPO from backup
Restore-GPO -Name "Security-Baseline-Workstations" `
  -Path "C:\GPO-Backups\2025-01-15"

# Import settings from one GPO to another
Import-GPO -BackupGpoName "Template-Security" `
  -TargetName "Production-Security" `
  -Path "C:\GPO-Backups"</code></pre>
                            <p class="cmd-desc">Always back up GPOs before changes. Backup captures settings, links, and WMI filters.</p>
                        </div>

                        <div class="command-card">
                            <h4>Troubleshoot GPO Application</h4>
                            <pre><code class="language-powershell"># Check Group Policy event log
Get-WinEvent -LogName "Microsoft-Windows-GroupPolicy/Operational" `
  -MaxEvents 50 | Select TimeCreated, Id, Message |
  Format-Table -Wrap

# Verbose GP processing log (enable for debugging)
# Registry: HKLM\Software\Policies\Microsoft\Windows\
#   Group Policy\{35378EAC-683F-11D2-A89A-00C04FBBCFA2}
# Set: LogLevel = DWORD:3, TraceLevel = DWORD:2

# Check SYSVOL replication health
dcdiag /test:sysvolcheck /test:frsevent /test:frssysvol</code></pre>
                            <p class="cmd-desc">When GPOs are not applying, check the operational log and SYSVOL replication status.</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 10: IDENTITY GOVERNANCE
             ============================================ -->
        <section id="identity-governance" class="section">
            <div class="section-header">
                <div class="section-number">X</div>
                <h2 class="section-title">Identity Governance</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#8b1538" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#8b1538" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#8b1538" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#8b1538"/>
                    </svg>
                </div>
                <p class="section-desc">The lifecycle of identity from creation to deprovisioning &mdash; access reviews, entitlement management, just-in-time privileges, and the compliance frameworks that govern them all.</p>
            </div>

            <div class="section-content">

                <!-- Identity Lifecycle -->
                <div class="subsection">
                    <h3 class="subsection-title">Identity Lifecycle</h3>
                    <p>Every identity follows the <strong>Joiner &rarr; Mover &rarr; Leaver</strong> lifecycle. Each transition carries specific provisioning and deprovisioning actions. Failures at any stage create orphaned accounts, privilege accumulation, or security gaps.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Stage</th>
                                    <th>Actions</th>
                                    <th>Systems Involved</th>
                                    <th>Risk if Missed</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge badge-emerald">Joiner</span></td>
                                    <td>Create AD account, assign to groups based on role, provision mailbox, license cloud apps, issue hardware token or enroll MFA, set initial password with forced change</td>
                                    <td>AD DS, Entra ID, Exchange, HR system (Workday, SAP), ITSM (ServiceNow)</td>
                                    <td>Employee cannot work on day one; shadow IT usage begins as they find workarounds</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-gold">Mover</span></td>
                                    <td>Update department/title attributes, recalculate group memberships, revoke old project access, grant new role entitlements, update manager field</td>
                                    <td>AD DS, Entra ID, HR system, application-specific RBAC systems</td>
                                    <td><strong>Privilege accumulation</strong> &mdash; user retains old access while gaining new, violating least privilege</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-crimson">Leaver</span></td>
                                    <td>Disable account (do not delete immediately), remove from all groups, revoke OAuth tokens, convert mailbox to shared, transfer OneDrive ownership, archive after retention period, then delete</td>
                                    <td>AD DS, Entra ID, Exchange, OneDrive, all SaaS apps, VPN/certificate authorities</td>
                                    <td><strong>Orphaned account</strong> &mdash; active credentials for a departed employee; top vector for insider threat and compliance violations</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-warning">
                        <div class="alert-title">The Mover Problem</div>
                        <p>Most organizations handle Joiners and Leavers reasonably well but fail at <strong>Movers</strong>. When an employee transfers departments, they typically gain new access without losing old access. After several moves, a single user may hold more cumulative privilege than any single role was designed to grant. Automated access reviews and role-based reprovisioning are essential to combat this drift.</p>
                    </div>
                </div>

                <!-- Access Reviews -->
                <div class="subsection">
                    <h3 class="subsection-title">Access Reviews</h3>
                    <p>Access reviews (also called <strong>access certifications</strong> or <strong>attestations</strong>) are periodic audits where designated reviewers confirm that users still need their current access. Microsoft Entra ID Governance provides built-in access review capabilities.</p>

                    <p><strong>Key configuration decisions:</strong></p>
                    <ul>
                        <li><strong>Reviewer</strong> &mdash; Direct manager, group owner, application owner, or self-review (least secure)</li>
                        <li><strong>Frequency</strong> &mdash; Quarterly for standard access, monthly for privileged roles, weekly for Tier 0</li>
                        <li><strong>Scope</strong> &mdash; Group memberships, application role assignments, access package assignments, Entra directory roles</li>
                        <li><strong>On denial</strong> &mdash; Remove the user from the group/role, block sign-in, or flag for manual review</li>
                        <li><strong>On no response</strong> &mdash; Auto-approve (dangerous) or auto-deny (safer, forces engagement)</li>
                    </ul>

                    <pre><code class="language-powershell"># Create an access review for a security group using Microsoft Graph
$params = @{
    displayName = "Quarterly Engineering Access Review"
    descriptionForAdmins = "Review members of SG-Engineering-All"
    descriptionForReviewers = "Confirm each member still needs Engineering access"
    scope = @{
        query = "/groups/a1b2c3d4-e5f6-7890-abcd-ef1234567890/transitiveMembers"
        queryType = "MicrosoftGraph"
    }
    reviewers = @(
        @{ query = "/groups/a1b2c3d4-e5f6-7890-abcd-ef1234567890/owners"; queryType = "MicrosoftGraph" }
    )
    settings = @{
        mailNotificationsEnabled  = $true
        reminderNotificationsEnabled = $true
        justificationRequiredOnApproval = $true
        defaultDecisionEnabled    = $true
        defaultDecision           = "Deny"
        instanceDurationInDays    = 14
        recurrence = @{
            pattern = @{ type = "absoluteMonthly"; interval = 3 }
            range   = @{ type = "noEnd"; startDate = "2025-04-01" }
        }
    }
}
New-MgIdentityGovernanceAccessReviewDefinition -BodyParameter $params</code></pre>

                    <pre><code class="language-powershell"># List all active access reviews
Get-MgIdentityGovernanceAccessReviewDefinition |
  Where-Object { $_.Status -eq "InProgress" } |
  Select DisplayName, Status, @{N='Reviewers';E={$_.Reviewers.Count}}

# Get decisions from a completed review
Get-MgIdentityGovernanceAccessReviewDefinitionInstanceDecision `
  -AccessReviewScheduleDefinitionId $reviewId `
  -AccessReviewInstanceId $instanceId |
  Select Principal, Decision, Justification</code></pre>
                </div>

                <!-- Entitlement Management -->
                <div class="subsection">
                    <h3 class="subsection-title">Entitlement Management</h3>
                    <p><strong>Access packages</strong> in Microsoft Entra ID Governance bundle together the resources a user needs for a specific role or project. Instead of manually adding a user to five groups, three apps, and a SharePoint site, you assign them a single access package that grants all of those simultaneously.</p>

                    <p>Each access package defines:</p>
                    <ul>
                        <li><strong>Resources</strong> &mdash; Groups, applications, SharePoint sites, Entra roles</li>
                        <li><strong>Policies</strong> &mdash; Who can request, approval chain, expiration, access review schedule</li>
                        <li><strong>Catalog</strong> &mdash; Logical container grouping related packages (e.g., "Engineering", "Finance")</li>
                    </ul>

                    <pre><code class="language-powershell"># Create an access package catalog
$catalog = New-MgEntitlementManagementCatalog -DisplayName "Engineering" `
  -Description "Access packages for the Engineering department" `
  -IsExternallyVisible $false

# Create an access package
$package = New-MgEntitlementManagementAccessPackage `
  -DisplayName "Backend Developer Access" `
  -Description "Standard access for backend engineering roles" `
  -CatalogId $catalog.Id

# Add a group resource to the package
$group = Get-MgGroup -Filter "displayName eq 'SG-Backend-Developers'"
New-MgEntitlementManagementAccessPackageResourceRoleScope `
  -AccessPackageId $package.Id `
  -AccessPackageResourceRole @{
      OriginId   = "Member_$($group.Id)"
      OriginSystem = "AadGroup"
  } `
  -AccessPackageResourceScope @{
      OriginId     = $group.Id
      OriginSystem = "AadGroup"
  }

# Create a request policy (manager approval, 180-day expiration)
New-MgEntitlementManagementAssignmentPolicy `
  -AccessPackageId $package.Id `
  -DisplayName "Manager Approval Policy" `
  -AllowedTargetScope "allMemberUsers" `
  -ExpirationDuration "P180D" `
  -RequestApprovalSettings @{
      IsApprovalRequiredForAdd = $true
      Stages = @(
          @{
              ApprovalStageTimeOutInDays = 7
              PrimaryApprovers = @(@{
                  odataType = "#microsoft.graph.requestorManager"
                  ManagerLevel = 1
              })
          }
      )
  }</code></pre>
                </div>

                <!-- Just-In-Time (JIT) Access -->
                <div class="subsection">
                    <h3 class="subsection-title">Just-In-Time (JIT) Access</h3>
                    <p><strong>Privileged Identity Management (PIM)</strong> eliminates standing privileged access by making role assignments <em>eligible</em> rather than <em>active</em>. An eligible user must explicitly activate the role when needed, with a time limit and optional approval workflow.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Concept</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Eligible Assignment</strong></td>
                                    <td>User <em>can</em> activate the role but does not hold it by default. No privileges until activation.</td>
                                </tr>
                                <tr>
                                    <td><strong>Active Assignment</strong></td>
                                    <td>User holds the role permanently (traditional model). PIM aims to minimize these.</td>
                                </tr>
                                <tr>
                                    <td><strong>Activation</strong></td>
                                    <td>User requests to "turn on" an eligible role. May require MFA, justification text, or manager approval.</td>
                                </tr>
                                <tr>
                                    <td><strong>Duration</strong></td>
                                    <td>Activated roles expire automatically (default: 8 hours, configurable 0.5&ndash;24 hours).</td>
                                </tr>
                                <tr>
                                    <td><strong>Approval</strong></td>
                                    <td>Optional workflow where a designated approver must approve before activation completes.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-powershell"># Make a user eligible for Global Administrator (via PIM)
$roleDefinitionId = (Get-MgRoleManagementDirectoryRoleDefinition `
  -Filter "displayName eq 'Global Administrator'").Id
$userId = (Get-MgUser -UserId "admin@contoso.com").Id

New-MgRoleManagementDirectoryRoleEligibilityScheduleRequest `
  -Action "adminAssign" `
  -RoleDefinitionId $roleDefinitionId `
  -PrincipalId $userId `
  -DirectoryScopeId "/" `
  -ScheduleInfo @{
      StartDateTime = (Get-Date)
      Expiration    = @{
          Type     = "afterDuration"
          Duration = "P365D"  # Eligible for 1 year
      }
  } `
  -Justification "Annual eligible assignment for break-glass scenarios"

# Activate an eligible role (self-service)
New-MgRoleManagementDirectoryRoleAssignmentScheduleRequest `
  -Action "selfActivate" `
  -RoleDefinitionId $roleDefinitionId `
  -PrincipalId $userId `
  -DirectoryScopeId "/" `
  -ScheduleInfo @{
      StartDateTime = (Get-Date)
      Expiration    = @{
          Type     = "afterDuration"
          Duration = "PT4H"  # Active for 4 hours
      }
  } `
  -Justification "Investigating sign-in anomaly INC-4821"</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">PIM for Groups</div>
                        <p>PIM is not limited to Entra directory roles. You can also make <strong>group memberships</strong> eligible, including groups that grant access to Azure resources, applications, or on-premises systems via Entra Cloud Sync. This is the recommended approach for extending JIT access to non-directory resources.</p>
                    </div>
                </div>

                <!-- Compliance Frameworks -->
                <div class="subsection">
                    <h3 class="subsection-title">Compliance Frameworks</h3>
                    <p>Identity and access management controls map to requirements across every major compliance framework. The table below shows what each framework demands from your IAM implementation.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Framework</th>
                                    <th>Scope</th>
                                    <th>IAM Requirements</th>
                                    <th>Key Controls</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge badge-gold">SOX</span></td>
                                    <td>Financial reporting</td>
                                    <td>Segregation of duties, access reviews for financial systems, audit trails of access changes</td>
                                    <td>Quarterly access certifications, privileged access logging, change management for role modifications</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-emerald">HIPAA</span></td>
                                    <td>Protected health information</td>
                                    <td>Unique user IDs, emergency access procedures, automatic logoff, audit controls</td>
                                    <td>Break-glass accounts with alerts, session timeouts, access logs retained 6 years minimum</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-lapis">GDPR</span></td>
                                    <td>Personal data (EU residents)</td>
                                    <td>Data minimization in identity stores, right to erasure, consent-based access, breach notification within 72 hours</td>
                                    <td>Attribute-level access controls, automated data subject request workflows, DPO role assignment</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-crimson">PCI-DSS</span></td>
                                    <td>Payment card data</td>
                                    <td>Unique IDs for all users, MFA for remote and admin access, password complexity, 90-day review cycles</td>
                                    <td>No shared/generic accounts, immediate revocation on termination, service account inventory</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-purple">NIST 800-53</span></td>
                                    <td>Federal information systems</td>
                                    <td>AC (Access Control) and IA (Identification &amp; Authentication) control families, continuous monitoring, risk-based authentication</td>
                                    <td>AC-2 (Account Management), AC-6 (Least Privilege), IA-2 (Multi-Factor), IA-5 (Authenticator Management)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Audit & Reporting -->
                <div class="subsection">
                    <h3 class="subsection-title">Audit &amp; Reporting</h3>
                    <p>Comprehensive audit logging is the foundation of identity governance. Both on-premises AD and Entra ID generate events that must be collected, correlated, and reviewed.</p>

                    <p><strong>Critical Windows Security Event IDs:</strong></p>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Event ID</th>
                                    <th>Description</th>
                                    <th>Why It Matters</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>4624</code></td>
                                    <td>Successful logon</td>
                                    <td>Baseline for normal authentication patterns; anomalies indicate compromise</td>
                                </tr>
                                <tr>
                                    <td><code>4625</code></td>
                                    <td>Failed logon</td>
                                    <td>Brute force and password spray detection; correlate with account lockouts (4740)</td>
                                </tr>
                                <tr>
                                    <td><code>4720</code></td>
                                    <td>User account created</td>
                                    <td>Unauthorized account creation is a persistence technique</td>
                                </tr>
                                <tr>
                                    <td><code>4726</code></td>
                                    <td>User account deleted</td>
                                    <td>Audit trail for account lifecycle; deletion of evidence by attackers</td>
                                </tr>
                                <tr>
                                    <td><code>4728</code></td>
                                    <td>Member added to global security group</td>
                                    <td>Privilege escalation via group membership modification</td>
                                </tr>
                                <tr>
                                    <td><code>4732</code></td>
                                    <td>Member added to local security group</td>
                                    <td>Local admin group modifications on endpoints and servers</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-powershell"># Search Unified Audit Log (Exchange Online / Microsoft 365)
Search-UnifiedAuditLog -StartDate (Get-Date).AddDays(-7) `
  -EndDate (Get-Date) `
  -Operations "Add member to role.", "Remove member from role." `
  -ResultSize 500 |
  Select-Object CreationDate, UserIds, Operations, AuditData |
  Export-Csv -Path "C:\Audit\role-changes-7d.csv" -NoTypeInformation

# Query Entra ID sign-in logs via Microsoft Graph
Get-MgAuditLogSignIn -Filter "status/errorCode ne 0" `
  -Top 100 -OrderBy "createdDateTime desc" |
  Select UserDisplayName, AppDisplayName, IpAddress,
    @{N='Error';E={$_.Status.ErrorCode}},
    @{N='Reason';E={$_.Status.FailureReason}},
    ConditionalAccessStatus

# Query Entra ID audit logs for directory changes
Get-MgAuditLogDirectoryAudit -Filter "activityDisplayName eq 'Add member to group'" `
  -Top 50 |
  Select ActivityDisplayName, ActivityDateTime,
    @{N='Actor';E={$_.InitiatedBy.User.UserPrincipalName}},
    @{N='Target';E={$_.TargetResources[0].DisplayName}}</code></pre>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 11: SECURITY & HARDENING
             ============================================ -->
        <section id="security" class="section">
            <div class="section-header">
                <div class="section-number">XI</div>
                <h2 class="section-title">Security &amp; Hardening</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#4a0e4e" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#4a0e4e" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#4a0e4e" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#4a0e4e"/>
                    </svg>
                </div>
                <p class="section-desc">The adversarial reality of Active Directory &mdash; tiered administration, common attack techniques, mitigation strategies, and the tools that expose what defenders must see.</p>
            </div>

            <div class="section-content">

                <!-- Tiered Administration Model -->
                <div class="subsection">
                    <h3 class="subsection-title">Tiered Administration Model</h3>
                    <p>Microsoft's <strong>Enhanced Security Admin Environment (ESAE)</strong> defines three tiers that isolate administrative privileges by asset sensitivity. The cardinal rule: <em>credentials from a higher tier must never be exposed on a lower tier</em>. A Tier 0 admin account must never log into a Tier 2 workstation.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tier</th>
                                    <th>Assets</th>
                                    <th>Accounts</th>
                                    <th>Restrictions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge badge-crimson">Tier 0</span></td>
                                    <td>Domain Controllers, AD DS, PKI root CAs, ADFS, Entra Connect, Schema/Enterprise/Domain Admins</td>
                                    <td>Dedicated Tier 0 admin accounts (e.g., <code>t0-admin-jsmith</code>), break-glass accounts</td>
                                    <td>Logon restricted to Tier 0 PAWs only; no internet access; no email; smart card required; monitored 24/7</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-gold">Tier 1</span></td>
                                    <td>Member servers, databases, line-of-business applications, Exchange, SQL, file servers</td>
                                    <td>Dedicated Tier 1 admin accounts (e.g., <code>t1-admin-jsmith</code>), service accounts</td>
                                    <td>Cannot log into Tier 0 or Tier 2 systems; separate admin workstations; MFA required for all admin sessions</td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-lapis">Tier 2</span></td>
                                    <td>End-user workstations, laptops, printers, mobile devices</td>
                                    <td>Helpdesk accounts, desktop support accounts, standard user accounts</td>
                                    <td>No server or DC access; local admin via LAPS only; cannot manage Tier 0 or Tier 1 assets</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">Credential Theft Cascades</div>
                        <p>If a Tier 0 admin logs into a compromised Tier 2 workstation, their credential hash is cached in memory and extractable via tools like Mimikatz. An attacker who compromises one workstation can then pivot to <strong>full domain compromise</strong>. This is not theoretical &mdash; it is the single most common Active Directory attack path in real-world breaches. Enforce tier isolation with authentication policies and GPO logon restrictions.</p>
                    </div>
                </div>

                <!-- Common AD Attacks -->
                <div class="subsection">
                    <h3 class="subsection-title">Common AD Attacks</h3>
                    <p>Active Directory is the most targeted infrastructure component in enterprise environments. Understanding these attacks is essential for building effective defenses.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Attack</th>
                                    <th>How It Works</th>
                                    <th>Impact</th>
                                    <th>Detection</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Pass-the-Hash (PtH)</strong></td>
                                    <td>Attacker extracts NTLM password hashes from memory (e.g., via Mimikatz <code>sekurlsa::logonpasswords</code>) and uses them to authenticate without knowing the plaintext password</td>
                                    <td>Lateral movement across any system accepting NTLM authentication</td>
                                    <td>Event 4624 with Logon Type 3 (Network) from unusual sources; anomalous NTLM traffic patterns</td>
                                </tr>
                                <tr>
                                    <td><strong>Golden Ticket</strong></td>
                                    <td>Attacker compromises the <code>KRBTGT</code> account hash and forges Kerberos TGTs with arbitrary privileges and lifetimes (default: 10 years)</td>
                                    <td><span class="badge badge-crimson">Total domain compromise</span> &mdash; attacker can impersonate any user including Domain Admin</td>
                                    <td>TGTs with abnormally long lifetimes; TGT usage without corresponding AS-REQ; Event 4769 anomalies</td>
                                </tr>
                                <tr>
                                    <td><strong>Silver Ticket</strong></td>
                                    <td>Attacker compromises a service account hash and forges Kerberos service tickets (TGS) for that specific service</td>
                                    <td>Unauthorized access to the targeted service (SQL, HTTP, CIFS) without contacting the DC</td>
                                    <td>Service ticket usage without corresponding TGS-REQ at the DC; PAC validation failures</td>
                                </tr>
                                <tr>
                                    <td><strong>Kerberoasting</strong></td>
                                    <td>Any authenticated user requests TGS tickets for service accounts with SPNs, then cracks the tickets offline to recover plaintext passwords</td>
                                    <td>Service account compromise; often these accounts have elevated privileges</td>
                                    <td>Excessive Event 4769 requests for multiple SPNs from a single user; RC4 encryption type requests</td>
                                </tr>
                                <tr>
                                    <td><strong>DCSync</strong></td>
                                    <td>Attacker with Replicating Directory Changes permissions mimics a domain controller and requests password hash replication via MS-DRSR</td>
                                    <td><span class="badge badge-crimson">Full credential dump</span> &mdash; all user and computer hashes including KRBTGT</td>
                                    <td>Event 4662 with replication GUIDs from non-DC sources; DRS RPC traffic from workstations</td>
                                </tr>
                                <tr>
                                    <td><strong>AS-REP Roasting</strong></td>
                                    <td>Targets accounts with "Do not require Kerberos pre-authentication" enabled; attacker requests AS-REP without credentials and cracks the response offline</td>
                                    <td>Account compromise for any user with pre-auth disabled</td>
                                    <td>Event 4768 with pre-auth type 0; audit accounts with <code>DONT_REQ_PREAUTH</code> flag</td>
                                </tr>
                                <tr>
                                    <td><strong>Password Spraying</strong></td>
                                    <td>Attacker tries a small number of common passwords against a large number of accounts, staying below lockout thresholds</td>
                                    <td>Account compromise while evading lockout policies</td>
                                    <td>Distributed Event 4625 failures across many accounts with the same error code from few source IPs</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Attack Mitigation -->
                <div class="subsection">
                    <h3 class="subsection-title">Attack Mitigation</h3>
                    <p>Each attack vector has specific countermeasures. Layered defense is essential &mdash; no single control stops every technique.</p>

                    <div class="alert alert-danger">
                        <div class="alert-title">Pass-the-Hash Mitigations</div>
                        <p><strong>Disable NTLM where possible.</strong> Enforce Kerberos-only authentication via GPO (<code>Network security: Restrict NTLM</code>). Deploy Credential Guard on Windows 10/11 and Server 2016+ to isolate LSASS credentials in a virtualization-based security boundary. Implement LAPS (Local Administrator Password Solution) to prevent lateral movement via shared local admin passwords. Remove users from the local Administrators group on workstations.</p>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">Golden Ticket &amp; KRBTGT Mitigations</div>
                        <p><strong>Rotate the KRBTGT password twice in succession</strong> (with a 12-hour gap) to invalidate all existing TGTs. Implement a regular rotation schedule (every 180 days at minimum). Monitor for Tier 0 credential exposure. Deploy Microsoft Defender for Identity to detect forged ticket usage. Limit accounts with DCSync-equivalent permissions to Domain Controllers only.</p>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">Kerberoasting &amp; AS-REP Roasting Mitigations</div>
                        <p><strong>Use Group Managed Service Accounts (gMSA)</strong> which have 240-character randomly generated passwords that rotate automatically every 30 days. For legacy service accounts, enforce 25+ character passwords and AES-only encryption (disable RC4). Audit accounts with SPNs: <code>Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName</code>. For AS-REP Roasting, audit and remove the <code>DONT_REQ_PREAUTH</code> flag: <code>Get-ADUser -Filter {DoesNotRequirePreAuth -eq $true}</code>.</p>
                    </div>

                    <div class="alert alert-danger">
                        <div class="alert-title">DCSync Mitigations</div>
                        <p><strong>Audit and restrict Replicating Directory Changes permissions.</strong> By default, only Domain Controllers, Domain Admins, Enterprise Admins, and Administrators have this right. Run: <code>Get-ACL "AD:\DC=corp,DC=contoso,DC=com" | Select-Object -ExpandProperty Access | Where-Object { $_.ObjectType -match "1131f6a[d|c]-9c07-11d1-f79f-00c04fc2dcd2" }</code> to find all principals with replication rights. Alert on any non-DC principal. Deploy Microsoft Defender for Identity for real-time DCSync detection.</p>
                    </div>
                </div>

                <!-- Multi-Factor Authentication -->
                <div class="subsection">
                    <h3 class="subsection-title">Multi-Factor Authentication</h3>
                    <p>MFA is the single most effective control against credential-based attacks. Microsoft reports that MFA blocks <strong>99.9% of automated attacks</strong>. Modern MFA in the Microsoft ecosystem centers on three technologies:</p>

                    <ul>
                        <li><strong>Microsoft Authenticator</strong> &mdash; Push notifications with number matching (anti-MFA fatigue), TOTP codes, and passwordless phone sign-in</li>
                        <li><strong>Windows Hello for Business</strong> &mdash; Biometric or PIN-based authentication using asymmetric key pairs bound to the device TPM. The private key never leaves the device.</li>
                        <li><strong>FIDO2 Security Keys</strong> &mdash; Hardware authenticators (YubiKey, Feitian) using the WebAuthn standard. Phishing-resistant because the authenticator verifies the origin URL.</li>
                    </ul>

                    <pre><code class="language-powershell"># Conditional Access policy: require MFA for all admin roles
$params = @{
    displayName = "Require MFA for Admins"
    state       = "enabled"
    conditions  = @{
        users = @{
            includeRoles = @(
                "62e90394-69f5-4237-9190-012177145e10"  # Global Admin
                "f28a1f94-e132-4e03-8882-49d36ef22f89"  # SharePoint Admin
                "29232cdf-9323-42fd-ade2-1d097af3e4de"  # Exchange Admin
                "fe930be7-5e62-47db-91af-98c3a49a38b1"  # User Admin
            )
        }
        applications = @{ includeApplications = @("All") }
    }
    grantControls = @{
        operator        = "OR"
        builtInControls = @("mfa")
    }
}
New-MgIdentityConditionalAccessPolicy -BodyParameter $params</code></pre>

                    <div class="alert alert-warning">
                        <div class="alert-title">MFA Fatigue Attacks</div>
                        <p>Attackers with stolen passwords can bombard users with repeated MFA push notifications until the user approves one out of frustration. <strong>Always enable number matching</strong> (the user must type a number shown on the login screen into the Authenticator app) and <strong>additional context</strong> (shows the app name and location). These features are now default in Microsoft Authenticator.</p>
                    </div>
                </div>

                <!-- KRBTGT Account -->
                <div class="subsection">
                    <h3 class="subsection-title">KRBTGT Account</h3>
                    <p>The <code>KRBTGT</code> account is the most critical account in Active Directory. Its password hash is used to encrypt and sign every Kerberos Ticket Granting Ticket (TGT) in the domain. If an attacker obtains this hash, they can forge Golden Tickets and impersonate any user indefinitely.</p>

                    <p><strong>Double-reset procedure:</strong> KRBTGT maintains the <em>current</em> and <em>previous</em> password hashes (to allow in-flight tickets to remain valid). To fully invalidate all existing TGTs:</p>
                    <ol>
                        <li><strong>First reset</strong> &mdash; Changes the current hash. Tickets encrypted with the old "current" hash still work because it becomes the "previous" hash.</li>
                        <li><strong>Wait 12&ndash;24 hours</strong> &mdash; Allow all legitimate TGTs to expire and be renewed with the new hash. The maximum TGT lifetime (default 10 hours) plus clock skew must elapse.</li>
                        <li><strong>Second reset</strong> &mdash; Now both the "current" and "previous" hashes are new. All old TGTs (including Golden Tickets) are invalidated.</li>
                    </ol>

                    <pre><code class="language-powershell"># Check KRBTGT password last set date
Get-ADUser -Identity krbtgt -Properties PasswordLastSet |
  Select-Object Name, PasswordLastSet,
    @{N='DaysSinceReset';E={((Get-Date) - $_.PasswordLastSet).Days}}

# Reset KRBTGT password (run on DC with PDC emulator role)
# WARNING: Plan a maintenance window. Schedule the second reset
# 12-24 hours later.
Set-ADAccountPassword -Identity krbtgt -Reset `
  -NewPassword (ConvertTo-SecureString (
    [System.Web.Security.Membership]::GeneratePassword(64, 16)
  ) -AsPlainText -Force)

# Verify the reset took effect
Get-ADUser -Identity krbtgt -Properties PasswordLastSet |
  Select-Object PasswordLastSet

# Monitor for Kerberos errors after reset
Get-WinEvent -LogName Security -FilterXPath `
  "*[System[(EventID=4769)]]" -MaxEvents 100 |
  Where-Object { $_.Properties[5].Value -eq '0x1f' } |
  Select TimeCreated, @{N='User';E={$_.Properties[0].Value}}</code></pre>

                    <div class="alert alert-info">
                        <div class="alert-title">Rotation Schedule</div>
                        <p>Microsoft recommends resetting the KRBTGT password <strong>every 180 days</strong> as a minimum. High-security environments should rotate every 90 days. Always test in a lab first, and schedule resets during low-activity windows. Monitor for Kerberos failures (Event 4769 with failure code 0x1f) immediately after each reset.</p>
                    </div>
                </div>

                <!-- Security Assessment Tools -->
                <div class="subsection">
                    <h3 class="subsection-title">Security Assessment Tools</h3>
                    <p>These tools provide visibility into AD security posture, attack paths, and configuration weaknesses that manual audits often miss.</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>BloodHound</h4>
                            <pre><code class="language-powershell"># Collect AD data with SharpHound
# (Run from a domain-joined machine as a domain user)
.\SharpHound.exe -c All -d corp.contoso.com --zipfilename ad_audit.zip

# Alternative: BloodHound.py for Linux
bloodhound-python -u jsmith -p 'P@ssw0rd' \
  -d corp.contoso.com -dc dc01.corp.contoso.com \
  -c all --zip</code></pre>
                            <p class="cmd-desc">Attack path visualization. Maps relationships between users, groups, computers, and ACLs to find paths to Domain Admin. The single most important offensive/defensive AD tool.</p>
                        </div>

                        <div class="command-card">
                            <h4>PingCastle</h4>
                            <pre><code class="language-powershell"># Run a health check (generates HTML report with risk score)
.\PingCastle.exe --healthcheck --server dc01.corp.contoso.com

# Run specific checks
.\PingCastle.exe --healthcheck --level Full
.\PingCastle.exe --scanner aclcheck
.\PingCastle.exe --scanner antivirus</code></pre>
                            <p class="cmd-desc">AD security health scorer. Assigns a risk rating (0&ndash;100) across Stale Objects, Privileged Accounts, Trust Relationships, and Anomalies. Ideal for executive-level reporting.</p>
                        </div>

                        <div class="command-card">
                            <h4>Purple Knight</h4>
                            <pre><code class="language-powershell"># Run Purple Knight (interactive GUI)
# Downloads from purple-knight.com (free, no install)
.\PurpleKnight.exe

# Checks include:
# - Account security (KRBTGT age, AdminSDHolder, etc.)
# - AD delegation risks
# - Group Policy security
# - Kerberos configuration
# - OS-level security</code></pre>
                            <p class="cmd-desc">Community-driven AD security assessment by Semperis. Tests over 130 indicators of exposure (IOEs) and indicators of compromise (IOCs) against MITRE ATT&amp;CK framework mappings.</p>
                        </div>

                        <div class="command-card">
                            <h4>ADRecon</h4>
                            <pre><code class="language-powershell"># Run full AD reconnaissance (generates Excel report)
.\ADRecon.ps1 -OutputType EXCEL

# Specific modules
.\ADRecon.ps1 -Collect Users,Groups,GPO,DNS
.\ADRecon.ps1 -Collect ACLs -DomainController dc01

# Output includes: Users, Groups, Computers, OUs,
# GPOs, SPNs, LAPS, ACLs, Trusts, DNS records</code></pre>
                            <p class="cmd-desc">Comprehensive AD enumeration and reporting. Extracts and correlates data into structured reports covering every major AD object type. Excellent for inventory and baseline audits.</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================
             SECTION 12: TROUBLESHOOTING & TOOLS
             ============================================ -->
        <section id="troubleshooting" class="section">
            <div class="section-header">
                <div class="section-number">XII</div>
                <h2 class="section-title">Troubleshooting &amp; Tools</h2>
                <div class="section-divider">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="#1e3a5f" stroke-width="2"/>
                        <circle cx="15" cy="25" r="12" fill="none" stroke="#1e3a5f" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="35" cy="25" r="12" fill="none" stroke="#1e3a5f" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="25" cy="25" r="6" fill="#1e3a5f"/>
                    </svg>
                </div>
                <p class="section-desc">When the domain breaks at 3 AM &mdash; diagnostic commands, event log analysis, common failures, and the health check scripts that keep the empire running.</p>
            </div>

            <div class="section-content">

                <!-- Diagnostic Commands -->
                <div class="subsection">
                    <h3 class="subsection-title">Diagnostic Commands</h3>
                    <p>The essential toolkit for diagnosing Active Directory issues. These commands should be committed to muscle memory for every AD administrator.</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>Domain Controller Diagnostics</h4>
                            <pre><code class="language-powershell"># Comprehensive DC health check (verbose, all tests)
dcdiag /v /c /d /e

# Key individual tests
dcdiag /test:DNS /v           # DNS health
dcdiag /test:Replications     # Replication status
dcdiag /test:FSMOCheck        # FSMO role holder health
dcdiag /test:Services          # Critical AD services
dcdiag /test:KnowsOfRoleHolders  # FSMO awareness
dcdiag /test:Advertising      # DC advertising (SRV records)

# Test a remote DC specifically
dcdiag /s:DC02 /v /c</code></pre>
                            <p class="cmd-desc">The single most important AD diagnostic tool. The <code>/e</code> flag tests all DCs in the enterprise; <code>/c</code> runs all tests; <code>/d</code> adds debug output.</p>
                        </div>

                        <div class="command-card">
                            <h4>Replication Status</h4>
                            <pre><code class="language-powershell"># Show replication partners and status for all DCs
repadmin /showrepl * /csv | ConvertFrom-Csv |
  Where-Object { $_.'Number of Failures' -gt 0 }

# Summary of replication across the enterprise
repadmin /replsummary

# Force sync all partitions on all DCs
repadmin /syncall /A /d /e /P

# Show replication queue
repadmin /queue

# Check USN (Update Sequence Number) for changes
repadmin /showutdvec DC01 "DC=corp,DC=contoso,DC=com"</code></pre>
                            <p class="cmd-desc">Replication is the lifeblood of multi-DC environments. A failure here causes stale objects, authentication errors, and split-brain scenarios.</p>
                        </div>

                        <div class="command-card">
                            <h4>DC Locator &amp; Secure Channel</h4>
                            <pre><code class="language-powershell"># Find the DC a client is using
nltest /dsgetdc:corp.contoso.com

# Verify secure channel to domain
nltest /sc_verify:corp.contoso.com

# Reset the secure channel (fixes trust issues)
nltest /sc_reset:corp.contoso.com

# List all DCs in the domain
nltest /dclist:corp.contoso.com

# Check trust relationships
nltest /domain_trusts /all_trusts /v</code></pre>
                            <p class="cmd-desc">When clients authenticate against the wrong DC or secure channel breaks, these commands diagnose and repair the connection.</p>
                        </div>

                        <div class="command-card">
                            <h4>Time Synchronization</h4>
                            <pre><code class="language-powershell"># Check time source and offset
w32tm /query /status
w32tm /query /source
w32tm /query /peers

# Monitor time offset across DCs
w32tm /monitor /domain:corp.contoso.com

# Force resync with authoritative source
w32tm /resync /rediscover

# Check PDC emulator time config (should be external NTP)
w32tm /query /computer:DC01 /configuration

# Kerberos allows max 5-minute skew by default
# Verify: Default Domain Policy > Kerberos Policy
# > Maximum tolerance for computer clock synchronization</code></pre>
                            <p class="cmd-desc">Kerberos requires clocks synchronized within 5 minutes. Time drift is a silent killer &mdash; authentication failures appear random until you check <code>w32tm</code>.</p>
                        </div>
                    </div>
                </div>

                <!-- Event Log Analysis -->
                <div class="subsection">
                    <h3 class="subsection-title">Event Log Analysis</h3>
                    <p>Windows Security and Directory Services event logs are the definitive record of what happens in Active Directory. These are the events you must monitor.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Event ID</th>
                                    <th>Log</th>
                                    <th>Description</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>4624</code></td>
                                    <td>Security</td>
                                    <td>Successful logon (check Logon Type: 2=Interactive, 3=Network, 7=Unlock, 10=RDP)</td>
                                    <td><span class="badge badge-emerald">Info</span></td>
                                </tr>
                                <tr>
                                    <td><code>4625</code></td>
                                    <td>Security</td>
                                    <td>Failed logon (Sub Status reveals cause: 0xC000006A=bad password, 0xC0000234=locked out)</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4720</code></td>
                                    <td>Security</td>
                                    <td>User account created</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4722</code></td>
                                    <td>Security</td>
                                    <td>User account enabled</td>
                                    <td><span class="badge badge-emerald">Info</span></td>
                                </tr>
                                <tr>
                                    <td><code>4726</code></td>
                                    <td>Security</td>
                                    <td>User account deleted</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4728</code></td>
                                    <td>Security</td>
                                    <td>Member added to a global security group</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4732</code></td>
                                    <td>Security</td>
                                    <td>Member added to a local security group</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4756</code></td>
                                    <td>Security</td>
                                    <td>Member added to a universal security group</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4768</code></td>
                                    <td>Security</td>
                                    <td>Kerberos TGT requested (AS-REQ) &mdash; initial authentication</td>
                                    <td><span class="badge badge-emerald">Info</span></td>
                                </tr>
                                <tr>
                                    <td><code>4769</code></td>
                                    <td>Security</td>
                                    <td>Kerberos service ticket requested (TGS-REQ) &mdash; monitor for Kerberoasting (many requests from one source)</td>
                                    <td><span class="badge badge-emerald">Info</span></td>
                                </tr>
                                <tr>
                                    <td><code>4771</code></td>
                                    <td>Security</td>
                                    <td>Kerberos pre-authentication failed &mdash; often indicates password issues or clock skew</td>
                                    <td><span class="badge badge-gold">Warning</span></td>
                                </tr>
                                <tr>
                                    <td><code>4662</code></td>
                                    <td>Security</td>
                                    <td>Directory service object accessed &mdash; watch for replication permission usage (DCSync detection)</td>
                                    <td><span class="badge badge-crimson">Critical</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <pre><code class="language-powershell"># Find recent failed logon attempts (last 24 hours)
Get-WinEvent -FilterHashtable @{
    LogName   = 'Security'
    Id        = 4625
    StartTime = (Get-Date).AddHours(-24)
} | Select-Object TimeCreated,
    @{N='User';    E={$_.Properties[5].Value}},
    @{N='Source';  E={$_.Properties[19].Value}},
    @{N='Status';  E={'0x{0:X}' -f $_.Properties[7].Value}},
    @{N='SubStatus';E={'0x{0:X}' -f $_.Properties[9].Value}} |
  Group-Object User | Sort-Object Count -Descending

# Detect potential Kerberoasting (many TGS requests)
Get-WinEvent -FilterHashtable @{
    LogName   = 'Security'
    Id        = 4769
    StartTime = (Get-Date).AddHours(-1)
} | Group-Object @{E={$_.Properties[0].Value}} |
  Where-Object { $_.Count -gt 10 } |
  Select-Object Count, Name</code></pre>
                </div>

                <!-- ADSI Edit & LDP -->
                <div class="subsection">
                    <h3 class="subsection-title">ADSI Edit &amp; LDP</h3>
                    <p>These low-level tools provide direct access to the AD database. They bypass the safety rails of higher-level tools like Active Directory Users and Computers (ADUC).</p>

                    <ul>
                        <li><strong>ADSI Edit</strong> (<code>adsiedit.msc</code>) &mdash; A Microsoft Management Console snap-in that provides raw attribute-level access to every object in AD. You can view and modify attributes that ADUC does not expose, including schema objects, configuration partitions, and system containers.</li>
                        <li><strong>LDP</strong> (<code>ldp.exe</code>) &mdash; A lightweight LDAP client for binding, searching, comparing, and modifying AD objects. More flexible than ADSI Edit for complex LDAP queries and troubleshooting LDAP connectivity. Also useful for testing LDAP over SSL (port 636) and verifying certificate configurations.</li>
                    </ul>

                    <div class="alert alert-danger">
                        <div class="alert-title">ADSI Edit Safety Warning</div>
                        <p>ADSI Edit performs <strong>no validation</strong> on changes. You can corrupt objects, break replication, or render your domain inoperable with a single incorrect modification. There is no undo. <strong>Never</strong> use ADSI Edit unless you understand exactly which attribute you are modifying and why standard tools cannot accomplish the task. Always make a System State backup before using ADSI Edit on production DCs. Common safe use cases: clearing <code>lockoutTime</code>, modifying <code>servicePrincipalName</code>, viewing <code>msDS-ReplAttributeMetaData</code>.</p>
                    </div>
                </div>

                <!-- PowerShell Diagnostic Module -->
                <div class="subsection">
                    <h3 class="subsection-title">PowerShell Diagnostic Module</h3>
                    <p>The <code>ActiveDirectory</code> and built-in PowerShell modules provide powerful diagnostic cmdlets that complement <code>dcdiag</code> and <code>repadmin</code>.</p>

                    <div class="command-grid">
                        <div class="command-card">
                            <h4>Secure Channel Test</h4>
                            <pre><code class="language-powershell"># Test the trust relationship with the domain
Test-ComputerSecureChannel -Verbose

# Repair a broken secure channel
Test-ComputerSecureChannel -Repair -Verbose

# Alternative: Reset machine account password
Reset-ComputerMachinePassword -Server DC01 `
  -Credential (Get-Credential)</code></pre>
                            <p class="cmd-desc">When a computer falls out of trust with the domain (error "trust relationship failed"), this is the fix.</p>
                        </div>

                        <div class="command-card">
                            <h4>Replication Diagnostics</h4>
                            <pre><code class="language-powershell"># Get replication partner metadata
Get-ADReplicationPartnerMetadata -Target * `
  -Scope Domain |
  Select Server, Partner, LastReplicationSuccess,
    ConsecutiveReplicationFailures |
  Where-Object { $_.ConsecutiveReplicationFailures -gt 0 }

# Get replication failures
Get-ADReplicationFailure -Target * -Scope Domain |
  Select Server, Partner, FirstFailureTime,
    FailureCount, LastError</code></pre>
                            <p class="cmd-desc">PowerShell-native replication monitoring. The <code>-Target *</code> parameter queries all DCs in scope.</p>
                        </div>

                        <div class="command-card">
                            <h4>DNS Diagnostics</h4>
                            <pre><code class="language-powershell"># Verify SRV records for DC locator
Resolve-DnsName -Name _ldap._tcp.dc._msdcs.corp.contoso.com `
  -Type SRV

# Check A record for a specific DC
Resolve-DnsName -Name dc01.corp.contoso.com -Type A

# Test DNS resolution from a specific server
Resolve-DnsName -Name corp.contoso.com `
  -Server 10.0.0.1 -DnsOnly

# Verify all critical SRV records exist
@('_ldap._tcp','_kerberos._tcp','_gc._tcp',
  '_kpasswd._tcp') | ForEach-Object {
    Resolve-DnsName "$_.$domain" -Type SRV -ErrorAction SilentlyContinue
} | Select Name, Type, NameTarget, Port</code></pre>
                            <p class="cmd-desc">AD is entirely dependent on DNS. If SRV records are missing, clients cannot locate DCs, and authentication fails silently.</p>
                        </div>

                        <div class="command-card">
                            <h4>FSMO Role Verification</h4>
                            <pre><code class="language-powershell"># Query all FSMO role holders
Get-ADForest | Select SchemaMaster, DomainNamingMaster
Get-ADDomain | Select PDCEmulator, RIDMaster,
  InfrastructureMaster

# Verify role holder is responding
$roles = @{
    'Schema Master'        = (Get-ADForest).SchemaMaster
    'Domain Naming Master' = (Get-ADForest).DomainNamingMaster
    'PDC Emulator'         = (Get-ADDomain).PDCEmulator
    'RID Master'           = (Get-ADDomain).RIDMaster
    'Infrastructure Master'= (Get-ADDomain).InfrastructureMaster
}
$roles.GetEnumerator() | ForEach-Object {
    [PSCustomObject]@{
        Role   = $_.Key
        Holder = $_.Value
        Online = (Test-Connection $_.Value -Count 1 -Quiet)
    }
}</code></pre>
                            <p class="cmd-desc">FSMO roles must be held by reachable, healthy DCs. If a role holder goes offline, specific operations (RID allocation, password changes, schema updates) will fail.</p>
                        </div>
                    </div>
                </div>

                <!-- Common Issues & Fixes -->
                <div class="subsection">
                    <h3 class="subsection-title">Common Issues &amp; Fixes</h3>
                    <p>The most frequently encountered Active Directory problems and their resolutions.</p>

                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Symptom</th>
                                    <th>Likely Cause</th>
                                    <th>Resolution</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Users cannot log in; "trust relationship between this workstation and the primary domain has failed"</td>
                                    <td>Computer account password out of sync (machine was offline &gt;30 days, or restored from old snapshot)</td>
                                    <td><code>Test-ComputerSecureChannel -Repair</code> or rejoin the domain: <code>Reset-ComputerMachinePassword -Server DC01</code></td>
                                </tr>
                                <tr>
                                    <td>Replication failures; <code>repadmin /replsummary</code> shows errors</td>
                                    <td>DNS misconfiguration, network connectivity, lingering objects, or USN rollback</td>
                                    <td>Check DNS (<code>dcdiag /test:DNS</code>), verify connectivity between DCs, remove lingering objects: <code>repadmin /removelingeringobjects</code></td>
                                </tr>
                                <tr>
                                    <td>Accounts locking out repeatedly with no apparent cause</td>
                                    <td>Cached credentials (mapped drives, scheduled tasks, mobile devices, service accounts using old passwords)</td>
                                    <td>Use <code>Microsoft Account Lockout Tools</code> (<code>LockoutStatus.exe</code>) to find the source DC, then check Event 4740 for the calling computer name</td>
                                </tr>
                                <tr>
                                    <td>DNS resolution fails for AD domain names</td>
                                    <td>Missing SRV records, DNS zone not AD-integrated, scavenging deleted active records, forwarder issues</td>
                                    <td>Run <code>dcdiag /test:DNS /v</code>; re-register SRV records: <code>nltest /dsregdns</code>; restart Netlogon service on DCs</td>
                                </tr>
                                <tr>
                                    <td>Cross-domain/cross-forest authentication fails</td>
                                    <td>Trust broken, DNS conditional forwarder missing, firewall blocking Kerberos/LDAP ports</td>
                                    <td>Verify trust: <code>nltest /sc_verify:trustedDomain</code>; check DNS: <code>Resolve-DnsName _ldap._tcp.dc._msdcs.trusted.com -Type SRV</code>; verify ports 88, 389, 636, 445, 3268</td>
                                </tr>
                                <tr>
                                    <td>Kerberos authentication failures; NTLM fallback</td>
                                    <td>Time skew &gt;5 minutes, duplicate SPNs, missing SPNs, or clock not synced to PDC emulator</td>
                                    <td>Check time: <code>w32tm /monitor</code>; find duplicate SPNs: <code>setspn -X</code>; verify SPN: <code>setspn -L serviceaccount</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Health Check Script -->
                <div class="subsection">
                    <h3 class="subsection-title">Health Check Script</h3>
                    <p>A comprehensive PowerShell script that performs a quick AD health assessment. Run this as a daily scheduled task or before and after maintenance windows.</p>

                    <pre><code class="language-powershell"># AD-HealthCheck.ps1 — Quick Active Directory Health Assessment
# Run on any domain-joined machine with RSAT tools installed

$domain = (Get-ADDomain).DNSRoot
$forest = (Get-ADForest).Name
Write-Host "=== AD Health Check: $domain (Forest: $forest) ===" -ForegroundColor Cyan
Write-Host "Timestamp: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" -ForegroundColor Gray

# 1. DNS Resolution
Write-Host "`n[1/6] DNS Resolution" -ForegroundColor Yellow
$srvRecords = Resolve-DnsName "_ldap._tcp.dc._msdcs.$domain" -Type SRV -ErrorAction SilentlyContinue
if ($srvRecords) {
    Write-Host "  PASS: Found $($srvRecords.Count) LDAP SRV records" -ForegroundColor Green
} else {
    Write-Host "  FAIL: No LDAP SRV records found!" -ForegroundColor Red
}

# 2. DC Connectivity
Write-Host "`n[2/6] Domain Controller Connectivity" -ForegroundColor Yellow
$dcs = Get-ADDomainController -Filter * | Select-Object Name, IPv4Address, IsGlobalCatalog
foreach ($dc in $dcs) {
    $ping = Test-Connection -ComputerName $dc.Name -Count 1 -Quiet
    $status = if ($ping) { "PASS" } else { "FAIL" }
    $color  = if ($ping) { "Green" } else { "Red" }
    $gc     = if ($dc.IsGlobalCatalog) { " [GC]" } else { "" }
    Write-Host "  $status`: $($dc.Name) ($($dc.IPv4Address))$gc" -ForegroundColor $color
}

# 3. FSMO Roles
Write-Host "`n[3/6] FSMO Role Holders" -ForegroundColor Yellow
$fsmo = @{
    'PDC Emulator'  = (Get-ADDomain).PDCEmulator
    'RID Master'    = (Get-ADDomain).RIDMaster
    'Infra Master'  = (Get-ADDomain).InfrastructureMaster
    'Schema Master' = (Get-ADForest).SchemaMaster
    'Naming Master' = (Get-ADForest).DomainNamingMaster
}
$fsmo.GetEnumerator() | ForEach-Object {
    $online = Test-Connection $_.Value -Count 1 -Quiet
    $color  = if ($online) { "Green" } else { "Red" }
    Write-Host "  $($_.Key): $($_.Value) $(if($online){'(Online)'}else{'(OFFLINE!)'})" -ForegroundColor $color
}

# 4. Replication Health
Write-Host "`n[4/6] Replication Status" -ForegroundColor Yellow
$replFailures = Get-ADReplicationFailure -Target * -Scope Domain -ErrorAction SilentlyContinue
if ($replFailures) {
    Write-Host "  WARN: $($replFailures.Count) replication failures detected" -ForegroundColor Red
    $replFailures | Select Server, Partner, FailureCount, FirstFailureTime |
      Format-Table -AutoSize | Out-String | Write-Host
} else {
    Write-Host "  PASS: No replication failures" -ForegroundColor Green
}

# 5. KRBTGT Password Age
Write-Host "`n[5/6] KRBTGT Password Age" -ForegroundColor Yellow
$krbtgt = Get-ADUser -Identity krbtgt -Properties PasswordLastSet
$age = ((Get-Date) - $krbtgt.PasswordLastSet).Days
$color = if ($age -gt 180) { "Red" } elseif ($age -gt 90) { "Yellow" } else { "Green" }
Write-Host "  KRBTGT password last set: $($krbtgt.PasswordLastSet) ($age days ago)" -ForegroundColor $color

# 6. Stale Accounts
Write-Host "`n[6/6] Stale Accounts (inactive >90 days)" -ForegroundColor Yellow
$staleDate = (Get-Date).AddDays(-90)
$staleUsers = (Get-ADUser -Filter {LastLogonDate -lt $staleDate -and Enabled -eq $true} `
  -Properties LastLogonDate).Count
$staleComputers = (Get-ADComputer -Filter {LastLogonDate -lt $staleDate -and Enabled -eq $true} `
  -Properties LastLogonDate).Count
Write-Host "  Stale enabled users: $staleUsers" -ForegroundColor $(if($staleUsers -gt 50){"Yellow"}else{"Green"})
Write-Host "  Stale enabled computers: $staleComputers" -ForegroundColor $(if($staleComputers -gt 20){"Yellow"}else{"Green"})

Write-Host "`n=== Health Check Complete ===" -ForegroundColor Cyan</code></pre>
                </div>

            </div>
        </section>

        <footer class="site-footer">
            <div class="footer-ornament">
                <svg viewBox="0 0 180 80" fill="none" xmlns="http://www.w3.org/2000/svg" width="120" style="display:block;margin:0 auto var(--space-4);">
                    <line x1="90" y1="5" x2="90" y2="75" stroke="#d4a012" stroke-width="1.5" opacity="0.5"/>
                    <line x1="50" y1="40" x2="130" y2="40" stroke="#d4a012" stroke-width="1.5" opacity="0.5"/>
                    <rect x="86" y="1" width="8" height="8" fill="#d4a012" transform="rotate(45 90 5)" opacity="0.6"/>
                    <rect x="86" y="71" width="8" height="8" fill="#d4a012" transform="rotate(45 90 75)" opacity="0.6"/>
                    <circle cx="90" cy="40" r="25" stroke="#d4a012" stroke-width="1" opacity="0.3"/>
                    <circle cx="90" cy="40" r="18" stroke="#d4a012" stroke-width="1" opacity="0.4"/>
                    <circle cx="90" cy="40" r="10" stroke="#d4a012" stroke-width="1.5" opacity="0.6"/>
                    <circle cx="90" cy="40" r="4" fill="#d4a012" opacity="0.5"/>
                </svg>
            </div>
            <p style="font-family: var(--font-heading); font-size: 0.85rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-secondary); margin-bottom: var(--space-4);">Active Directory &amp; IAM &mdash; The Imperial Registry of Identity</p>
            <a href="index.html">Back to Tech Guides</a>
        </footer>

    </div>
</body>
</html>
