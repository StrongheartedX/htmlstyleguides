<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible - Sustainable Infrastructure Automation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Quicksand:wght@400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Typography */
            --font-display: 'Quicksand', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-body: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-code: 'Fira Code', 'Monaco', 'Consolas', monospace;

            /* Solarpunk Colors - Nature meets sustainable technology */
            --leaf-green: #4a7c59;
            --leaf-green-light: #6b9b7a;
            --leaf-green-dark: #2d5a3d;
            --moss-green: #8bab7f;
            --fern-green: #5d8a66;

            --solar-gold: #d4a03c;
            --solar-gold-light: #e8c06a;
            --solar-gold-dark: #b8862a;
            --amber-glow: #f0c75e;

            --sky-blue: #87b5d9;
            --sky-blue-light: #a8cce8;
            --sky-blue-dark: #5a93bf;

            --terracotta: #c17f59;
            --terracotta-light: #d9a080;

            --cream-white: #faf8f3;
            --warm-white: #f5f2eb;
            --soft-beige: #e8e2d5;

            --text-dark: #2c3e2d;
            --text-medium: #4a5d4b;
            --text-light: #6b7d6c;

            /* Organic Shadows */
            --shadow-soft: 0 4px 20px rgba(45, 90, 61, 0.12);
            --shadow-medium: 0 8px 32px rgba(45, 90, 61, 0.16);
            --shadow-strong: 0 12px 48px rgba(45, 90, 61, 0.2);
            --shadow-glow: 0 0 30px rgba(212, 160, 60, 0.25);

            /* Spacing - Generous breathing room */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --space-7: 48px;
            --space-8: 64px;
            --space-9: 96px;

            /* Border Radius - Organic flowing curves */
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --radius-organic: 40% 60% 55% 45% / 55% 45% 55% 45%;
            --radius-leaf: 70% 30% 60% 40% / 40% 60% 30% 70%;
            --radius-full: 9999px;

            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-organic: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-dark);
            background: var(--cream-white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background - Solar sky with organic elements */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(180deg,
                #a8cce8 0%,
                #c8dff0 20%,
                var(--cream-white) 50%,
                var(--warm-white) 100%);
            overflow: hidden;
        }

        /* Decorative sun rays */
        .sun-rays {
            position: absolute;
            top: -100px;
            right: 10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle,
                rgba(240, 199, 94, 0.4) 0%,
                rgba(212, 160, 60, 0.2) 30%,
                transparent 70%);
            border-radius: 50%;
            animation: sun-pulse 8s ease-in-out infinite;
        }

        @keyframes sun-pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* Floating leaves decoration */
        .floating-leaves {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .leaf {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--moss-green);
            border-radius: var(--radius-leaf);
            opacity: 0.3;
            animation: float-leaf 20s ease-in-out infinite;
        }

        .leaf-1 { top: 20%; left: 5%; animation-delay: 0s; transform: rotate(45deg); }
        .leaf-2 { top: 40%; left: 90%; animation-delay: -5s; transform: rotate(-30deg); width: 25px; height: 25px; }
        .leaf-3 { top: 60%; left: 8%; animation-delay: -10s; transform: rotate(60deg); width: 20px; height: 20px; }
        .leaf-4 { top: 75%; left: 85%; animation-delay: -15s; transform: rotate(-45deg); }

        @keyframes float-leaf {
            0%, 100% { transform: translateY(0) rotate(45deg); }
            25% { transform: translateY(-20px) rotate(55deg); }
            50% { transform: translateY(-10px) rotate(35deg); }
            75% { transform: translateY(-25px) rotate(50deg); }
        }

        /* Vine decorations */
        .vine-decoration {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: linear-gradient(180deg,
                transparent 0%,
                rgba(139, 171, 127, 0.1) 50%,
                rgba(139, 171, 127, 0.2) 100%);
        }

        .vine-decoration::before,
        .vine-decoration::after {
            content: '';
            position: absolute;
            bottom: 0;
            width: 120px;
            height: 180px;
            background:
                radial-gradient(ellipse at 50% 100%, var(--moss-green) 0%, transparent 50%),
                radial-gradient(ellipse at 30% 80%, var(--fern-green) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 90%, var(--leaf-green-light) 0%, transparent 45%);
            opacity: 0.25;
        }

        .vine-decoration::before { left: -20px; }
        .vine-decoration::after { right: -20px; transform: scaleX(-1); }

        /* Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-5);
        }

        /* Back Link */
        .back-link {
            display: inline-block;
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--leaf-green);
            text-decoration: none;
            margin-bottom: var(--space-6);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            background: var(--warm-white);
            border: 2px solid var(--moss-green);
            transition: var(--transition-organic);
        }

        .back-link:hover {
            background: var(--leaf-green);
            color: var(--cream-white);
            transform: translateX(-4px);
            box-shadow: var(--shadow-soft);
        }

        /* Header */
        .header {
            text-align: center;
            padding: var(--space-8) var(--space-5);
            margin-bottom: var(--space-8);
            position: relative;
            background: var(--cream-white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(139, 171, 127, 0.2);
        }

        .header-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-5);
            background: linear-gradient(135deg, var(--solar-gold-light) 0%, var(--solar-gold) 50%, var(--solar-gold-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-glow);
            position: relative;
        }

        .header-icon::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            border: 2px dashed var(--solar-gold-light);
            border-radius: 50%;
            animation: rotate-slow 30s linear infinite;
        }

        .header-icon::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
            border-radius: 50%;
            top: 8px;
            left: 12px;
        }

        @keyframes rotate-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: var(--space-4);
            background: linear-gradient(135deg, var(--leaf-green) 0%, var(--solar-gold-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.125rem;
            color: var(--text-medium);
            max-width: 550px;
            margin: 0 auto;
            line-height: 1.8;
        }

        /* Sections */
        .section {
            margin-bottom: var(--space-8);
            padding: var(--space-7);
            background: var(--cream-white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(139, 171, 127, 0.2);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 8px,
                    rgba(212, 160, 60, 0.1) 8px,
                    rgba(212, 160, 60, 0.1) 10px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 8px,
                    rgba(212, 160, 60, 0.1) 8px,
                    rgba(212, 160, 60, 0.1) 10px
                );
            border-radius: 0 var(--radius-xl) 0 var(--radius-xl);
            pointer-events: none;
        }

        .section-header {
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 2px solid var(--moss-green);
        }

        .section-subtitle {
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--solar-gold-dark);
            margin-bottom: var(--space-2);
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--leaf-green);
            margin-bottom: var(--space-3);
        }

        .section-description {
            font-size: 1rem;
            color: var(--text-medium);
            margin-bottom: var(--space-5);
        }

        .subsection {
            margin-bottom: var(--space-6);
        }

        .subsection-title {
            font-family: var(--font-display);
            font-size: 1.375rem;
            font-weight: 600;
            color: var(--fern-green);
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--soft-beige);
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-display);
            color: var(--leaf-green);
            line-height: 1.3;
        }

        p {
            margin-bottom: var(--space-4);
            line-height: 1.8;
        }

        a {
            color: var(--leaf-green);
            text-decoration: none;
            border-bottom: 1px solid var(--moss-green);
            transition: var(--transition-fast);
        }

        a:hover {
            color: var(--solar-gold-dark);
            border-bottom-color: var(--solar-gold);
        }

        /* Code blocks */
        code {
            font-family: var(--font-code);
            background: var(--warm-white);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            color: var(--leaf-green-dark);
            border: 1px solid var(--soft-beige);
        }

        pre {
            font-family: var(--font-code);
            background: var(--warm-white);
            border: 2px solid var(--moss-green);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            overflow-x: auto;
            margin-bottom: var(--space-5);
            font-size: 0.875rem;
            line-height: 1.6;
            box-shadow: var(--shadow-soft);
        }

        pre code {
            background: none;
            border: none;
            padding: 0;
            color: var(--text-dark);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-bottom: var(--space-5);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            background: var(--cream-white);
        }

        thead {
            background: linear-gradient(135deg, var(--leaf-green) 0%, var(--fern-green) 100%);
        }

        th {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--cream-white);
            text-align: left;
            padding: var(--space-4) var(--space-5);
            font-size: 0.875rem;
            letter-spacing: 0.05em;
        }

        td {
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--soft-beige);
            color: var(--text-dark);
        }

        tbody tr {
            transition: var(--transition-fast);
        }

        tbody tr:hover {
            background: var(--warm-white);
        }

        tbody tr:nth-child(even) {
            background: rgba(139, 171, 127, 0.05);
        }

        tbody tr:nth-child(even):hover {
            background: var(--warm-white);
        }

        td:first-child {
            font-family: var(--font-code);
            color: var(--leaf-green);
            font-weight: 500;
        }

        /* Lists */
        ul, ol {
            margin-left: var(--space-5);
            margin-bottom: var(--space-4);
        }

        li {
            margin-bottom: var(--space-2);
            color: var(--text-medium);
        }

        li code {
            background: var(--soft-beige);
        }

        /* Command Grid */
        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-5);
        }

        .command-card {
            background: var(--warm-white);
            border: 2px solid var(--moss-green);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            transition: var(--transition-organic);
        }

        .command-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            border-color: var(--leaf-green);
        }

        .command-card h4 {
            font-family: var(--font-display);
            font-size: 1rem;
            color: var(--leaf-green);
            margin-bottom: var(--space-3);
        }

        .command-card code {
            display: block;
            background: var(--cream-white);
            padding: var(--space-2) var(--space-3);
            margin-bottom: var(--space-2);
            border-radius: var(--radius-sm);
            font-size: 0.8125rem;
        }

        /* Note boxes */
        .note {
            background: linear-gradient(135deg, rgba(135, 181, 217, 0.1) 0%, rgba(139, 171, 127, 0.1) 100%);
            border-left: 4px solid var(--sky-blue);
            border-radius: var(--radius-md);
            padding: var(--space-4) var(--space-5);
            margin-bottom: var(--space-5);
        }

        .note-title {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--sky-blue-dark);
            margin-bottom: var(--space-2);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .note p {
            color: var(--text-medium);
            margin-bottom: 0;
        }

        .tip {
            background: linear-gradient(135deg, rgba(240, 199, 94, 0.1) 0%, rgba(212, 160, 60, 0.1) 100%);
            border-left: 4px solid var(--solar-gold);
            border-radius: var(--radius-md);
            padding: var(--space-4) var(--space-5);
            margin-bottom: var(--space-5);
        }

        .tip-title {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--solar-gold-dark);
            margin-bottom: var(--space-2);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tip p {
            color: var(--text-medium);
            margin-bottom: 0;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: var(--space-8) var(--space-5);
            margin-top: var(--space-9);
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .footer p {
            margin-bottom: var(--space-3);
        }

        .footer a {
            color: var(--leaf-green);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-5) var(--space-4);
            }

            .section {
                padding: var(--space-5);
            }

            .header h1 {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .command-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.75rem;
            }

            th, td {
                padding: var(--space-2) var(--space-3);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--warm-white);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--moss-green);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--leaf-green);
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="background">
        <div class="sun-rays"></div>
        <div class="floating-leaves">
            <div class="leaf leaf-1"></div>
            <div class="leaf leaf-2"></div>
            <div class="leaf leaf-3"></div>
            <div class="leaf leaf-4"></div>
        </div>
        <div class="vine-decoration"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Back Link -->
        <a href="index.html" class="back-link">← Tech Guides</a>

        <!-- Header -->
        <header class="header">
            <div class="header-icon"></div>
            <h1>Ansible</h1>
            <p>Sustainable Infrastructure Automation - Configuration management and orchestration for the future</p>
        </header>

        <!-- Quick Reference Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 01</div>
                <h2 class="section-title">Quick Reference</h2>
                <p class="section-description">Essential commands and configuration for daily Ansible usage</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Essential Commands</h3>

                <pre><code># Ad-hoc commands
ansible &lt;host-pattern&gt; -m &lt;module&gt; -a "&lt;arguments&gt;"
ansible all -m ping
ansible webservers -m shell -a "uptime"
ansible all -m copy -a "src=/etc/hosts dest=/tmp/hosts"

# Playbook execution
ansible-playbook playbook.yml
ansible-playbook -i inventory.ini playbook.yml
ansible-playbook playbook.yml --limit webservers
ansible-playbook playbook.yml --tags "install,config"
ansible-playbook playbook.yml --skip-tags "testing"
ansible-playbook playbook.yml -e "version=1.2.3"

# Check and diff modes
ansible-playbook playbook.yml --check        # Dry run
ansible-playbook playbook.yml --diff         # Show diffs
ansible-playbook playbook.yml --check --diff # Both

# Syntax validation
ansible-playbook playbook.yml --syntax-check
ansible-playbook playbook.yml --list-hosts
ansible-playbook playbook.yml --list-tasks
ansible-playbook playbook.yml --list-tags</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Vault Operations</h3>

                <pre><code># Vault operations
ansible-vault encrypt secrets.yml
ansible-vault decrypt secrets.yml
ansible-vault edit secrets.yml
ansible-vault view secrets.yml
ansible-vault rekey secrets.yml

# Playbook with vault
ansible-playbook playbook.yml --ask-vault-pass
ansible-playbook playbook.yml --vault-password-file ~/.vault_pass</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Galaxy Commands</h3>

                <pre><code># Galaxy commands
ansible-galaxy role init myrole
ansible-galaxy role install username.rolename
ansible-galaxy collection install community.general
ansible-galaxy install -r requirements.yml</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Common ansible.cfg Settings</h3>

                <pre><code>[defaults]
inventory = ./inventory
remote_user = ansible
host_key_checking = False
retry_files_enabled = False
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
forks = 10
timeout = 30

[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False

[ssh_connection]
pipelining = True
ssh_args = -o ControlMaster=auto -o ControlPersist=60s</code></pre>
            </div>
        </section>

        <!-- Inventory Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 02</div>
                <h2 class="section-title">Inventory</h2>
                <p class="section-description">Managing hosts, groups, and inventory structure</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Static Inventory (INI Format)</h3>

                <pre><code># inventory.ini

# Individual hosts
web1.example.com
web2.example.com

# Grouped hosts
[webservers]
web1.example.com
web2.example.com
web3.example.com

[databases]
db1.example.com
db2.example.com

# Host with connection variables
[appservers]
app1.example.com ansible_host=10.0.0.5 ansible_port=2222

# Range patterns
[webfarm]
web[01:20].example.com

# Nested groups
[production:children]
webservers
databases

# Group variables
[webservers:vars]
http_port=80
max_clients=200

[production:vars]
ansible_user=deploy
ansible_become=yes</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Static Inventory (YAML Format)</h3>

                <pre><code>---
# inventory.yml
all:
  children:
    webservers:
      hosts:
        web1.example.com:
          ansible_host: 192.168.1.10
        web2.example.com:
          ansible_host: 192.168.1.11
      vars:
        http_port: 80
        max_clients: 200

    databases:
      hosts:
        db1.example.com:
        db2.example.com:
      vars:
        db_port: 5432

    production:
      children:
        webservers:
        databases:
      vars:
        ansible_user: deploy
        ansible_become: yes</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Directory Structure</h3>

                <pre><code>inventory/
├── hosts                    # Main inventory file
├── host_vars/
│   ├── web1.example.com.yml # Variables for specific host
│   └── db1.example.com.yml
└── group_vars/
    ├── all.yml              # Variables for all hosts
    ├── webservers.yml       # Variables for webservers group
    └── production.yml       # Variables for production group</code></pre>

                <p><strong>group_vars/all.yml:</strong></p>
                <pre><code>---
ntp_server: ntp.example.com
dns_servers:
  - 8.8.8.8
  - 8.8.4.4</code></pre>

                <p><strong>host_vars/web1.example.com.yml:</strong></p>
                <pre><code>---
nginx_worker_processes: 4
app_environment: production
ssl_certificate: /etc/ssl/certs/web1.crt</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Host Patterns</h3>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Pattern</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>all</td>
                                <td>All hosts</td>
                            </tr>
                            <tr>
                                <td>web1.example.com</td>
                                <td>Single host</td>
                            </tr>
                            <tr>
                                <td>webservers</td>
                                <td>Group</td>
                            </tr>
                            <tr>
                                <td>webservers:databases</td>
                                <td>Multiple groups (OR)</td>
                            </tr>
                            <tr>
                                <td>webservers:&production</td>
                                <td>Intersection (AND)</td>
                            </tr>
                            <tr>
                                <td>webservers:!staging</td>
                                <td>Exclusion (NOT)</td>
                            </tr>
                            <tr>
                                <td>web*.example.com</td>
                                <td>Wildcard</td>
                            </tr>
                            <tr>
                                <td>webservers:&production:!web1.example.com</td>
                                <td>Complex pattern</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Ad-Hoc Commands Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 03</div>
                <h2 class="section-title">Ad-Hoc Commands</h2>
                <p class="section-description">Quick one-off tasks without writing playbooks</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Syntax</h3>

                <pre><code>ansible &lt;host-pattern&gt; -m &lt;module&gt; -a "&lt;module-arguments&gt;" [options]</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Common Modules</h3>

                <p><strong>Ping module:</strong></p>
                <pre><code># Test connectivity
ansible all -m ping
ansible webservers -m ping</code></pre>

                <p><strong>Shell module:</strong></p>
                <pre><code># Execute shell commands (supports pipes, redirects)
ansible all -m shell -a "uptime"
ansible webservers -m shell -a "ps aux | grep nginx"
ansible all -m shell -a "echo $TERM"</code></pre>

                <p><strong>Command module:</strong></p>
                <pre><code># Execute commands (no shell features)
ansible all -m command -a "uptime"
ansible all -m command -a "df -h"
ansible all -m command -a "/usr/bin/foo" -a "creates=/path/file"</code></pre>

                <p><strong>Copy module:</strong></p>
                <pre><code># Copy files to remote hosts
ansible webservers -m copy -a "src=/etc/hosts dest=/tmp/hosts"
ansible all -m copy -a "src=/app/config.yml dest=/etc/app/config.yml owner=app group=app mode=0644"
ansible all -m copy -a "content='Hello World\n' dest=/tmp/hello.txt"</code></pre>

                <p><strong>File module:</strong></p>
                <pre><code># Manage files and directories
ansible all -m file -a "path=/tmp/test state=touch"
ansible all -m file -a "path=/tmp/testdir state=directory mode=0755"
ansible all -m file -a "path=/tmp/test state=absent"
ansible all -m file -a "src=/etc/hosts dest=/tmp/hosts state=link"</code></pre>

                <p><strong>Package management:</strong></p>
                <pre><code># Apt (Debian/Ubuntu)
ansible webservers -m apt -a "name=nginx state=present" -b
ansible all -m apt -a "name=git state=latest" -b
ansible all -m apt -a "update_cache=yes" -b

# Yum (RHEL/CentOS)
ansible webservers -m yum -a "name=nginx state=present" -b
ansible all -m yum -a "name=httpd state=latest" -b</code></pre>

                <p><strong>Service module:</strong></p>
                <pre><code># Service management
ansible webservers -m service -a "name=nginx state=started" -b
ansible webservers -m service -a "name=nginx state=restarted" -b
ansible webservers -m service -a "name=nginx enabled=yes" -b</code></pre>

                <p><strong>User module:</strong></p>
                <pre><code># User management
ansible all -m user -a "name=deploy state=present" -b
ansible all -m user -a "name=deploy shell=/bin/bash groups=sudo append=yes" -b
ansible all -m user -a "name=deploy state=absent remove=yes" -b</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Command Options</h3>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Option</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>-i INVENTORY</td>
                                <td>Specify inventory file</td>
                            </tr>
                            <tr>
                                <td>-u USERNAME</td>
                                <td>Remote user</td>
                            </tr>
                            <tr>
                                <td>-b</td>
                                <td>Become (sudo)</td>
                            </tr>
                            <tr>
                                <td>-K</td>
                                <td>Ask for become password</td>
                            </tr>
                            <tr>
                                <td>-k</td>
                                <td>Ask for SSH password</td>
                            </tr>
                            <tr>
                                <td>-f FORKS</td>
                                <td>Number of parallel processes</td>
                            </tr>
                            <tr>
                                <td>-e "var=value"</td>
                                <td>Extra variables</td>
                            </tr>
                            <tr>
                                <td>--limit SUBSET</td>
                                <td>Limit to specific hosts</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Playbooks Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 04</div>
                <h2 class="section-title">Playbooks</h2>
                <p class="section-description">Declarative automation with YAML playbooks</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Basic Playbook Structure</h3>

                <pre><code>---
# webserver.yml
- name: Configure web servers
  hosts: webservers
  become: yes
  vars:
    http_port: 80
    max_clients: 200

  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Start nginx service
      service:
        name: nginx
        state: started
        enabled: yes</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Handlers and Notify</h3>

                <pre><code>---
- name: Configure nginx
  hosts: webservers
  become: yes

  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present

    - name: Copy nginx config
      copy:
        src: files/nginx.conf
        dest: /etc/nginx/nginx.conf
      notify:
        - Restart nginx
        - Check nginx status

    - name: Copy site config
      template:
        src: templates/site.conf.j2
        dest: /etc/nginx/sites-available/default
      notify: Restart nginx

  handlers:
    - name: Restart nginx
      service:
        name: nginx
        state: restarted

    - name: Check nginx status
      command: nginx -t</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Tags</h3>

                <pre><code>---
- name: Complete application setup
  hosts: appservers
  become: yes

  tasks:
    - name: Install packages
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - git
        - python3-pip
      tags:
        - install
        - packages

    - name: Copy application config
      template:
        src: app.conf.j2
        dest: /etc/app/config.conf
      tags:
        - config

    - name: Run database migrations
      command: /opt/app/migrate.sh
      tags:
        - deploy
        - database

    - name: Restart application
      service:
        name: myapp
        state: restarted
      tags:
        - deploy
        - never  # Only runs when explicitly called</code></pre>

                <p><strong>Run with tags:</strong></p>
                <pre><code>ansible-playbook app.yml --tags "install"
ansible-playbook app.yml --tags "config,deploy"
ansible-playbook app.yml --skip-tags "database"
ansible-playbook app.yml --tags "never"</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Conditionals (when)</h3>

                <pre><code>---
- name: Conditional tasks
  hosts: all
  become: yes

  tasks:
    - name: Install Apache (Debian/Ubuntu)
      apt:
        name: apache2
        state: present
      when: ansible_os_family == "Debian"

    - name: Install Apache (RHEL/CentOS)
      yum:
        name: httpd
        state: present
      when: ansible_os_family == "RedHat"

    - name: Shut down Debian 10 systems
      command: /sbin/shutdown -t now
      when:
        - ansible_os_family == "Debian"
        - ansible_distribution_major_version == "10"</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Loops</h3>

                <pre><code>---
- name: Loop examples
  hosts: webservers
  become: yes

  tasks:
    # Simple loop
    - name: Install packages
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - nginx
        - git
        - vim

    # Loop with dictionaries
    - name: Create users
      user:
        name: "{{ item.name }}"
        state: present
        groups: "{{ item.groups }}"
      loop:
        - { name: 'alice', groups: 'sudo' }
        - { name: 'bob', groups: 'developers' }
        - { name: 'charlie', groups: 'developers,docker' }

    # Loop with conditional
    - name: Install packages on Debian only
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - apache2
        - php
      when: ansible_os_family == "Debian"</code></pre>
            </div>
        </section>

        <!-- Variables & Facts Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 05</div>
                <h2 class="section-title">Variables & Facts</h2>
                <p class="section-description">Managing data and system information in Ansible</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Variable Definition</h3>

                <pre><code>---
- name: Variable examples
  hosts: webservers

  # Play-level variables
  vars:
    http_port: 80
    app_version: "1.2.3"
    packages:
      - nginx
      - git
      - vim

  # Variables from files
  vars_files:
    - vars/common.yml
    - vars/{{ ansible_os_family }}.yml

  # Prompt for variables
  vars_prompt:
    - name: deploy_version
      prompt: "Which version to deploy?"
      private: no

    - name: db_password
      prompt: "Database password?"
      private: yes

  tasks:
    - name: Show variables
      debug:
        msg: "Port: {{ http_port }}, Version: {{ app_version }}"</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Variable Precedence</h3>

                <div class="note">
                    <div class="note-title">Variable Priority (Low to High)</div>
                    <ol>
                        <li>Command line values (lowest)</li>
                        <li>Role defaults</li>
                        <li>Inventory file or script group vars</li>
                        <li>Inventory group_vars/all</li>
                        <li>Playbook group_vars/all</li>
                        <li>Inventory group_vars/*</li>
                        <li>Playbook group_vars/*</li>
                        <li>Inventory host vars</li>
                        <li>Inventory host_vars/*</li>
                        <li>Playbook host_vars/*</li>
                        <li>Host facts / cached set_facts</li>
                        <li>Play vars</li>
                        <li>Play vars_files</li>
                        <li>Role vars</li>
                        <li>Block vars</li>
                        <li>Task vars</li>
                        <li>Set_facts / registered vars</li>
                        <li>Extra vars (highest - always win)</li>
                    </ol>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Register Variables</h3>

                <pre><code>---
- name: Register examples
  hosts: webservers

  tasks:
    - name: Check if file exists
      stat:
        path: /etc/app/config.conf
      register: config_file

    - name: Show file info
      debug:
        msg: "File exists: {{ config_file.stat.exists }}"

    - name: Copy config if missing
      copy:
        src: files/config.conf
        dest: /etc/app/config.conf
      when: not config_file.stat.exists

    - name: Get service status
      command: systemctl status nginx
      register: nginx_status
      ignore_errors: yes

    - name: Show nginx status
      debug:
        var: nginx_status.stdout_lines</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">set_fact Module</h3>

                <pre><code>---
- name: Set fact examples
  hosts: all

  tasks:
    - name: Set deployment timestamp
      set_fact:
        deploy_timestamp: "{{ ansible_date_time.iso8601 }}"

    - name: Calculate total memory
      set_fact:
        total_memory_gb: "{{ (ansible_memtotal_mb / 1024) | round(2) }}"

    - name: Build complex fact
      set_fact:
        server_info:
          hostname: "{{ ansible_hostname }}"
          os: "{{ ansible_distribution }}"
          version: "{{ ansible_distribution_version }}"
          ip: "{{ ansible_default_ipv4.address }}"

    - name: Use facts
      debug:
        msg: "Deployed at {{ deploy_timestamp }} on {{ server_info.hostname }}"</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Common Ansible Facts</h3>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fact</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ansible_hostname</td>
                                <td>Short hostname</td>
                            </tr>
                            <tr>
                                <td>ansible_fqdn</td>
                                <td>Fully qualified domain name</td>
                            </tr>
                            <tr>
                                <td>ansible_os_family</td>
                                <td>Debian, RedHat, etc.</td>
                            </tr>
                            <tr>
                                <td>ansible_distribution</td>
                                <td>Ubuntu, CentOS, etc.</td>
                            </tr>
                            <tr>
                                <td>ansible_distribution_version</td>
                                <td>OS version number</td>
                            </tr>
                            <tr>
                                <td>ansible_processor_vcpus</td>
                                <td>Number of CPUs</td>
                            </tr>
                            <tr>
                                <td>ansible_memtotal_mb</td>
                                <td>Total memory in MB</td>
                            </tr>
                            <tr>
                                <td>ansible_default_ipv4.address</td>
                                <td>Primary IP address</td>
                            </tr>
                            <tr>
                                <td>ansible_date_time.iso8601</td>
                                <td>Current timestamp</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Magic Variables</h3>

                <pre><code>---
- name: Magic variables
  hosts: all

  tasks:
    - name: Show inventory info
      debug:
        msg: |
          Inventory hostname: {{ inventory_hostname }}
          Groups: {{ group_names }}
          All groups: {{ groups }}
          Play hosts: {{ ansible_play_hosts }}

    - name: Access hostvars
      debug:
        msg: "Web1 IP: {{ hostvars['web1.example.com'].ansible_default_ipv4.address }}"

    - name: Loop through group
      debug:
        msg: "Host {{ item }} in webservers"
      loop: "{{ groups['webservers'] }}"</code></pre>
            </div>
        </section>

        <!-- Templates & Files Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 06</div>
                <h2 class="section-title">Templates & Files</h2>
                <p class="section-description">Dynamic configuration with Jinja2 templates and file management</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Jinja2 Templates</h3>

                <p><strong>templates/nginx.conf.j2:</strong></p>
                <pre><code># Nginx configuration
user {{ nginx_user }};
worker_processes {{ nginx_worker_processes }};
pid /run/nginx.pid;

events {
    worker_connections {{ nginx_worker_connections }};
}

http {
    sendfile on;
    keepalive_timeout {{ nginx_keepalive_timeout }};

    # Conditional content
    {% if nginx_gzip_enabled %}
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css application/json;
    {% endif %}

    # Loop through upstream servers
    upstream backend {
        {% for server in backend_servers %}
        server {{ server.host }}:{{ server.port }} weight={{ server.weight }};
        {% endfor %}
    }

    include /etc/nginx/sites-enabled/*;
}</code></pre>

                <p><strong>Using the template:</strong></p>
                <pre><code>---
- name: Configure nginx
  hosts: webservers
  become: yes

  vars:
    nginx_user: www-data
    nginx_worker_processes: auto
    nginx_worker_connections: 1024
    nginx_keepalive_timeout: 65
    nginx_gzip_enabled: true
    backend_servers:
      - { host: '10.0.1.10', port: 8080, weight: 3 }
      - { host: '10.0.1.11', port: 8080, weight: 2 }
      - { host: '10.0.1.12', port: 8080, weight: 1 }

  tasks:
    - name: Deploy nginx config
      template:
        src: templates/nginx.conf.j2
        dest: /etc/nginx/nginx.conf
        owner: root
        group: root
        mode: '0644'
        backup: yes
        validate: nginx -t -c %s
      notify: Restart nginx</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Jinja2 Filters</h3>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Filter</th>
                                <th>Example</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>lower</td>
                                <td>"HELLO" | lower</td>
                                <td>hello</td>
                            </tr>
                            <tr>
                                <td>upper</td>
                                <td>"hello" | upper</td>
                                <td>HELLO</td>
                            </tr>
                            <tr>
                                <td>default</td>
                                <td>undefined_var | default('fallback')</td>
                                <td>fallback</td>
                            </tr>
                            <tr>
                                <td>length</td>
                                <td>[1,2,3] | length</td>
                                <td>3</td>
                            </tr>
                            <tr>
                                <td>join</td>
                                <td>[1,2,3] | join(',')</td>
                                <td>1,2,3</td>
                            </tr>
                            <tr>
                                <td>to_json</td>
                                <td>my_dict | to_json</td>
                                <td>JSON string</td>
                            </tr>
                            <tr>
                                <td>to_yaml</td>
                                <td>my_dict | to_yaml</td>
                                <td>YAML string</td>
                            </tr>
                            <tr>
                                <td>basename</td>
                                <td>'/path/to/file.txt' | basename</td>
                                <td>file.txt</td>
                            </tr>
                            <tr>
                                <td>dirname</td>
                                <td>'/path/to/file.txt' | dirname</td>
                                <td>/path/to</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">File Module</h3>

                <pre><code>---
- name: File management
  hosts: webservers
  become: yes

  tasks:
    # Create file
    - name: Create empty file
      file:
        path: /tmp/testfile
        state: touch
        owner: www-data
        group: www-data
        mode: '0644'

    # Create directory
    - name: Create directory
      file:
        path: /opt/myapp/config
        state: directory
        owner: deploy
        group: deploy
        mode: '0755'
        recurse: yes

    # Create symlink
    - name: Create symbolic link
      file:
        src: /opt/myapp/current
        dest: /opt/myapp/app
        state: link

    # Delete file/directory
    - name: Remove file
      file:
        path: /tmp/testfile
        state: absent</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Lineinfile Module</h3>

                <pre><code>---
- name: Lineinfile examples
  hosts: all
  become: yes

  tasks:
    # Add line if not present
    - name: Ensure line in sudoers
      lineinfile:
        path: /etc/sudoers
        line: 'deploy ALL=(ALL) NOPASSWD: ALL'
        validate: '/usr/sbin/visudo -cf %s'

    # Replace line
    - name: Set hostname
      lineinfile:
        path: /etc/hostname
        regexp: '^.*$'
        line: 'webserver01'

    # Remove line
    - name: Remove line
      lineinfile:
        path: /etc/hosts
        regexp: '^192\.168\.1\.100'
        state: absent</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Blockinfile Module</h3>

                <pre><code>---
- name: Blockinfile examples
  hosts: all
  become: yes

  tasks:
    # Insert block
    - name: Add SSH config block
      blockinfile:
        path: /etc/ssh/sshd_config
        block: |
          Match User ansible
              PasswordAuthentication no
              PubkeyAuthentication yes
      notify: Restart sshd

    # Add hosts entries
    - name: Add hosts entries
      blockinfile:
        path: /etc/hosts
        insertafter: EOF
        block: |
          192.168.1.10 web1.example.com
          192.168.1.11 web2.example.com
          192.168.1.12 db1.example.com</code></pre>
            </div>
        </section>

        <!-- Roles & Collections Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 07</div>
                <h2 class="section-title">Roles & Collections</h2>
                <p class="section-description">Organizing and sharing reusable automation content</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Role Directory Structure</h3>

                <pre><code>roles/
└── nginx/
    ├── README.md
    ├── defaults/
    │   └── main.yml        # Default variables (lowest precedence)
    ├── files/
    │   └── nginx.conf      # Static files for copy module
    ├── handlers/
    │   └── main.yml        # Handlers
    ├── meta/
    │   └── main.yml        # Role metadata and dependencies
    ├── tasks/
    │   ├── main.yml        # Main task file
    │   ├── install.yml     # Task includes
    │   └── configure.yml
    ├── templates/
    │   └── site.conf.j2    # Jinja2 templates
    ├── tests/
    │   ├── inventory
    │   └── test.yml        # Test playbook
    └── vars/
        └── main.yml        # Role variables (high precedence)</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Creating a Role</h3>

                <pre><code># Initialize role structure
ansible-galaxy role init nginx
ansible-galaxy role init roles/myapp

# Custom skeleton
ansible-galaxy role init --init-path roles/ --offline myapp</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Role Example</h3>

                <p><strong>roles/nginx/defaults/main.yml:</strong></p>
                <pre><code>---
nginx_port: 80
nginx_worker_processes: auto
nginx_worker_connections: 1024
nginx_remove_default_site: true
nginx_sites:
  - name: default
    server_name: localhost
    root: /var/www/html</code></pre>

                <p><strong>roles/nginx/tasks/main.yml:</strong></p>
                <pre><code>---
- name: Include OS-specific variables
  include_vars: "{{ ansible_os_family }}.yml"

- name: Install nginx
  include_tasks: install.yml

- name: Configure nginx
  include_tasks: configure.yml

- name: Ensure nginx is running
  service:
    name: "{{ nginx_service }}"
    state: started
    enabled: yes</code></pre>

                <p><strong>roles/nginx/handlers/main.yml:</strong></p>
                <pre><code>---
- name: Restart nginx
  service:
    name: "{{ nginx_service }}"
    state: restarted

- name: Reload nginx
  service:
    name: "{{ nginx_service }}"
    state: reloaded</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Using Roles in Playbooks</h3>

                <pre><code>---
# Simple role usage
- name: Configure web servers
  hosts: webservers
  roles:
    - nginx

# Roles with variables
- name: Configure nginx with custom port
  hosts: webservers
  roles:
    - role: nginx
      nginx_port: 8080
      nginx_worker_processes: 4

# Pre and post tasks
- name: Deploy application
  hosts: appservers

  pre_tasks:
    - name: Take server out of load balancer
      command: /usr/local/bin/remove_from_lb.sh

  roles:
    - nginx
    - application

  post_tasks:
    - name: Add server back to load balancer
      command: /usr/local/bin/add_to_lb.sh</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Requirements.yml</h3>

                <pre><code>---
# Roles from Galaxy
roles:
  - name: geerlingguy.nginx
    version: 3.1.4

  - name: geerlingguy.mysql

  - src: https://github.com/user/ansible-role-custom.git
    name: custom
    version: master

# Collections from Galaxy
collections:
  - name: community.general
    version: ">=4.0.0"

  - name: ansible.posix
    version: 1.5.4

  - name: community.mysql</code></pre>

                <p><strong>Installing:</strong></p>
                <pre><code># Install roles
ansible-galaxy role install -r requirements.yml

# Install collections
ansible-galaxy collection install -r requirements.yml

# Force reinstall
ansible-galaxy collection install -r requirements.yml --force</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Using Collections</h3>

                <pre><code>---
- name: Using collections
  hosts: all

  collections:
    - community.general
    - ansible.posix

  tasks:
    # Fully qualified collection name (FQCN)
    - name: Use docker_container module
      community.docker.docker_container:
        name: myapp
        image: nginx
        state: started

    # Short name (when collection is imported)
    - name: Manage firewall
      firewalld:
        port: 80/tcp
        permanent: yes
        state: enabled</code></pre>
            </div>
        </section>

        <!-- Control Flow Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 08</div>
                <h2 class="section-title">Control Flow</h2>
                <p class="section-description">Error handling, delegation, and execution control</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Block, Rescue, Always</h3>

                <pre><code>---
- name: Error handling with blocks
  hosts: webservers
  become: yes

  tasks:
    - name: Handle deployment with error recovery
      block:
        - name: Download application
          get_url:
            url: https://example.com/app.tar.gz
            dest: /tmp/app.tar.gz

        - name: Extract application
          unarchive:
            src: /tmp/app.tar.gz
            dest: /opt/app
            remote_src: yes

        - name: Start application
          service:
            name: myapp
            state: started

      rescue:
        - name: Log error
          debug:
            msg: "Deployment failed, rolling back"

        - name: Restore from backup
          command: /usr/local/bin/restore_backup.sh

      always:
        - name: Cleanup temp files
          file:
            path: /tmp/app.tar.gz
            state: absent</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Delegate_to</h3>

                <pre><code>---
- name: Delegation examples
  hosts: webservers

  tasks:
    # Run task on different host
    - name: Add server to monitoring
      command: /usr/local/bin/add_to_monitoring.sh {{ inventory_hostname }}
      delegate_to: monitoring.example.com

    # Run on localhost (control node)
    - name: Check API availability
      uri:
        url: https://api.example.com/health
        return_content: yes
      delegate_to: localhost
      register: api_status

    # Local action (shortcut)
    - name: Download file locally
      local_action:
        module: get_url
        url: https://example.com/file.txt
        dest: /tmp/file.txt</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Run_once</h3>

                <pre><code>---
- name: Run once examples
  hosts: webservers

  tasks:
    # Run only on first host
    - name: Run database migration (once)
      command: /opt/app/migrate.sh
      run_once: yes

    # Run once with delegation
    - name: Update DNS
      command: /usr/local/bin/update_dns.sh
      delegate_to: dns.example.com
      run_once: yes</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Serial (Rolling Updates)</h3>

                <pre><code>---
- name: Rolling deployment
  hosts: webservers
  serial: 2  # Process 2 hosts at a time

  tasks:
    - name: Remove from load balancer
      command: /usr/local/bin/remove_from_lb.sh {{ inventory_hostname }}
      delegate_to: loadbalancer.example.com

    - name: Deploy new version
      copy:
        src: app-v2.tar.gz
        dest: /opt/app/

    - name: Restart application
      service:
        name: myapp
        state: restarted

    - name: Wait for application
      wait_for:
        port: 8080
        delay: 5
        timeout: 60

    - name: Add back to load balancer
      command: /usr/local/bin/add_to_lb.sh {{ inventory_hostname }}
      delegate_to: loadbalancer.example.com</code></pre>

                <div class="tip">
                    <div class="tip-title">Serial Options</div>
                    <p>You can use percentages (serial: "20%") or multiple batches (serial: [1, 25%, 100%]) for flexible rolling updates.</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Include and Import Tasks</h3>

                <pre><code>---
# import_tasks (static, processed at parse time)
- name: Import tasks example
  hosts: all

  tasks:
    - name: Import installation tasks
      import_tasks: tasks/install.yml

    - name: Import with variables
      import_tasks: tasks/configure.yml
      vars:
        config_file: /etc/app/prod.conf

# include_tasks (dynamic, processed at runtime)
- name: Include tasks example
  hosts: all

  tasks:
    - name: Include tasks conditionally
      include_tasks: tasks/database.yml
      when: setup_database

    - name: Include tasks in loop
      include_tasks: tasks/create_user.yml
      loop:
        - alice
        - bob
        - charlie
      loop_control:
        loop_var: username</code></pre>
            </div>
        </section>

        <!-- Vault & Secrets Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 09</div>
                <h2 class="section-title">Vault & Secrets</h2>
                <p class="section-description">Encrypting sensitive data with Ansible Vault</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Basic Vault Operations</h3>

                <pre><code># Create encrypted file
ansible-vault create secrets.yml

# Encrypt existing file
ansible-vault encrypt vars/passwords.yml

# Decrypt file
ansible-vault decrypt secrets.yml

# Edit encrypted file (opens in editor)
ansible-vault edit secrets.yml

# View encrypted file (read-only)
ansible-vault view secrets.yml

# Change vault password (rekey)
ansible-vault rekey secrets.yml

# Encrypt specific string
ansible-vault encrypt_string 'mysecretpassword' --name 'db_password'
ansible-vault encrypt_string --stdin-name 'api_key'</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Using Encrypted Variables</h3>

                <p><strong>vars/secrets.yml (encrypted):</strong></p>
                <pre><code>---
db_password: "supersecret"
api_key: "abc123xyz789"
ssl_key_password: "keypass123"</code></pre>

                <p><strong>Encrypt it:</strong></p>
                <pre><code>ansible-vault encrypt vars/secrets.yml</code></pre>

                <p><strong>Using in playbook:</strong></p>
                <pre><code>---
- name: Deploy application
  hosts: appservers
  vars_files:
    - vars/secrets.yml

  tasks:
    - name: Configure database connection
      template:
        src: db_config.j2
        dest: /etc/app/db.conf
      # Template can use {{ db_password }}</code></pre>

                <p><strong>Run with vault:</strong></p>
                <pre><code># Prompt for password
ansible-playbook deploy.yml --ask-vault-pass

# Use password file
ansible-playbook deploy.yml --vault-password-file ~/.vault_pass</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Vault Password File</h3>

                <p><strong>~/.vault_pass:</strong></p>
                <pre><code>myVaultPassword123</code></pre>

                <pre><code>chmod 600 ~/.vault_pass</code></pre>

                <p><strong>ansible.cfg:</strong></p>
                <pre><code>[defaults]
vault_password_file = ~/.vault_pass</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Encrypting Specific Strings</h3>

                <pre><code># Encrypt string interactively
ansible-vault encrypt_string 'secretvalue' --name 'my_secret'

# Output:
my_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66386439653765...</code></pre>

                <p><strong>vars/passwords.yml:</strong></p>
                <pre><code>---
# Plain text variables
db_host: db.example.com
db_port: 5432

# Encrypted password
db_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66386439653765653938383866383764623066303764326436613631326634653034366361393834
          3439656537653036383766626239646662363431613134310a383238356266663061363261626635</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Multiple Vault Passwords (Vault IDs)</h3>

                <pre><code># Create with vault ID
ansible-vault create --vault-id dev@prompt secrets_dev.yml
ansible-vault create --vault-id prod@prompt secrets_prod.yml

# Or use password files
ansible-vault create --vault-id dev@~/.vault_pass_dev secrets_dev.yml

# Run with multiple vault IDs
ansible-playbook deploy.yml --vault-id dev@prompt --vault-id prod@prompt</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Best Practices</h3>

                <div class="tip">
                    <div class="tip-title">Vault Best Practices</div>
                    <ul>
                        <li>Don't encrypt entire files - encrypt specific sensitive values</li>
                        <li>Keep encrypted variables separate from plain text variables</li>
                        <li>Use vault IDs for different environments (dev, staging, prod)</li>
                        <li>Store vault passwords securely (password managers, AWS Secrets Manager)</li>
                        <li>Use ansible-vault rekey regularly to rotate passwords</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Advanced Patterns Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 10</div>
                <h2 class="section-title">Advanced Patterns</h2>
                <p class="section-description">Dynamic inventory, callbacks, and advanced techniques</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Dynamic Inventory Script</h3>

                <p><strong>inventory/ec2.py:</strong></p>
                <pre><code>#!/usr/bin/env python3
import json
import boto3

def get_inventory():
    ec2 = boto3.client('ec2', region_name='us-east-1')
    response = ec2.describe_instances(
        Filters=[{'Name': 'instance-state-name', 'Values': ['running']}]
    )

    inventory = {
        'all': {'hosts': []},
        '_meta': {'hostvars': {}}
    }

    for reservation in response['Reservations']:
        for instance in reservation['Instances']:
            hostname = instance.get('PublicDnsName') or instance['InstanceId']
            inventory['all']['hosts'].append(hostname)

            # Add to groups based on tags
            tags = {tag['Key']: tag['Value'] for tag in instance.get('Tags', [])}

            if 'Environment' in tags:
                env = tags['Environment']
                if env not in inventory:
                    inventory[env] = {'hosts': []}
                inventory[env]['hosts'].append(hostname)

            # Set host variables
            inventory['_meta']['hostvars'][hostname] = {
                'ansible_host': instance.get('PublicIpAddress'),
                'instance_type': instance['InstanceType'],
                'instance_id': instance['InstanceId']
            }

    return inventory

if __name__ == '__main__':
    import sys
    if len(sys.argv) == 2 and sys.argv[1] == '--list':
        print(json.dumps(get_inventory(), indent=2))
    elif len(sys.argv) == 3 and sys.argv[1] == '--host':
        print(json.dumps({}))
    else:
        print(json.dumps({}))</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Inventory Plugins</h3>

                <p><strong>inventory/aws_ec2.yml:</strong></p>
                <pre><code>---
plugin: amazon.aws.aws_ec2
regions:
  - us-east-1
  - us-west-2
filters:
  instance-state-name: running
keyed_groups:
  - key: tags.Environment
    prefix: env
  - key: tags.Application
    prefix: app
  - key: instance_type
    prefix: type
hostnames:
  - dns-name
  - private-ip-address
compose:
  ansible_host: public_ip_address</code></pre>

                <p><strong>Use it:</strong></p>
                <pre><code>ansible-inventory -i inventory/aws_ec2.yml --list
ansible-playbook -i inventory/aws_ec2.yml playbook.yml</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Callback Plugins</h3>

                <p><strong>ansible.cfg:</strong></p>
                <pre><code>[defaults]
callback_whitelist = profile_tasks, timer, yaml

# Enable custom callback
callback_plugins = ./plugins/callback</code></pre>

                <div class="note">
                    <div class="note-title">Built-in Callbacks</div>
                    <ul>
                        <li><strong>profile_tasks</strong> - Show execution time for each task</li>
                        <li><strong>timer</strong> - Show total playbook execution time</li>
                        <li><strong>yaml</strong> - YAML output format</li>
                        <li><strong>json</strong> - JSON output format</li>
                    </ul>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Ansible-pull</h3>

                <pre><code># Setup cron job on managed nodes to pull and run playbooks
ansible-pull -U https://github.com/user/ansible-repo.git -i hosts local.yml

# With specific branch
ansible-pull -U https://github.com/user/ansible-repo.git -C production local.yml

# Run every 30 minutes
*/30 * * * * ansible-pull -U https://github.com/user/ansible-repo.git -o local.yml</code></pre>

                <p><strong>local.yml (in git repo):</strong></p>
                <pre><code>---
- name: Local configuration
  hosts: localhost
  connection: local
  become: yes

  tasks:
    - name: Ensure packages are installed
      package:
        name:
          - vim
          - git
        state: present

    - name: Pull latest app code
      git:
        repo: https://github.com/company/app.git
        dest: /opt/app
        version: main</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Strategy Plugins</h3>

                <p><strong>ansible.cfg:</strong></p>
                <pre><code>[defaults]
strategy = free  # or linear (default), debug</code></pre>

                <p><strong>In playbook:</strong></p>
                <pre><code>---
- name: Fast deployment
  hosts: webservers
  strategy: free  # Don't wait for all hosts to complete each task

  tasks:
    - name: Deploy application
      copy:
        src: app.tar.gz
        dest: /opt/app/</code></pre>
            </div>
        </section>

        <!-- Pro Tips Section -->
        <section class="section">
            <div class="section-header">
                <div class="section-subtitle">Section 11</div>
                <h2 class="section-title">Pro Tips</h2>
                <p class="section-description">Best practices and performance optimization</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Idempotency Best Practices</h3>

                <pre><code>---
# BAD - Always reports changed
- name: Append to file (bad)
  shell: echo "line" >> /etc/config

# GOOD - Idempotent
- name: Ensure line in file (good)
  lineinfile:
    path: /etc/config
    line: "line"
    state: present

# Use creates/removes with command module
- name: Extract archive
  command: tar xzf /tmp/app.tar.gz -C /opt/app
  args:
    creates: /opt/app/app.bin

# Use changed_when to control change status
- name: Check service status
  command: systemctl status nginx
  register: nginx_status
  changed_when: false
  failed_when: false</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Check Mode (Dry Run)</h3>

                <pre><code>---
- name: Check mode support
  hosts: all

  tasks:
    # This task supports check mode
    - name: Install package
      apt:
        name: nginx
        state: present

    # Force task to run in check mode
    - name: Always check
      command: /usr/bin/check_script.sh
      check_mode: yes

    # Never run in check mode (always execute)
    - name: Always run
      command: /usr/bin/must_run.sh
      check_mode: no

    # Custom check mode behavior
    - name: Custom check
      command: /usr/bin/deploy.sh
      when: not ansible_check_mode</code></pre>

                <p><strong>Run check mode:</strong></p>
                <pre><code>ansible-playbook playbook.yml --check
ansible-playbook playbook.yml -C</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Debugging</h3>

                <pre><code>---
- name: Debugging techniques
  hosts: localhost
  gather_facts: yes

  vars:
    app_version: "2.1.0"

  tasks:
    # Simple debug message
    - name: Show message
      debug:
        msg: "Deploying version {{ app_version }}"

    # Debug variable
    - name: Show variable
      debug:
        var: ansible_facts

    # Debug with verbosity control
    - name: Verbose debug
      debug:
        msg: "Only shown with -v or higher"
        verbosity: 1

    # Assert for validation
    - name: Validate configuration
      assert:
        that:
          - app_version is defined
          - ansible_distribution in ['Ubuntu', 'Debian']
        fail_msg: "Invalid configuration"
        success_msg: "Configuration valid"</code></pre>

                <p><strong>Verbosity levels:</strong></p>
                <pre><code>ansible-playbook playbook.yml -v      # Verbose
ansible-playbook playbook.yml -vv     # More verbose
ansible-playbook playbook.yml -vvv    # Debug (connection info)
ansible-playbook playbook.yml -vvvv   # SSH debug</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Performance Tuning</h3>

                <p><strong>ansible.cfg optimization:</strong></p>
                <pre><code>[defaults]
# Increase parallel execution
forks = 20

# Disable fact gathering if not needed
gathering = explicit

# Enable fact caching
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
fact_caching_timeout = 3600

# Reduce SSH overhead
host_key_checking = False
retry_files_enabled = False

[ssh_connection]
# Enable pipelining (requires 'requiretty' disabled in sudoers)
pipelining = True

# Reuse SSH connections
ssh_args = -o ControlMaster=auto -o ControlPersist=3600s

# Increase SSH timeout for slow networks
timeout = 30</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Async and Polling</h3>

                <pre><code>---
- name: Async task examples
  hosts: webservers

  tasks:
    # Fire and forget (poll: 0)
    - name: Long background task
      command: /usr/bin/background_task.sh
      async: 3600
      poll: 0
      register: background_job

    # Async with polling
    - name: Task with timeout
      command: /usr/bin/slow_task.sh
      async: 600    # 10 minute timeout
      poll: 10      # Check every 10 seconds

    # Run multiple async tasks
    - name: Start multiple tasks
      command: "/usr/bin/task.sh {{ item }}"
      async: 300
      poll: 0
      loop:
        - task1
        - task2
        - task3
      register: async_tasks

    # Wait for all to complete
    - name: Wait for tasks
      async_status:
        jid: "{{ item.ansible_job_id }}"
      register: async_results
      until: async_results.finished
      retries: 30
      delay: 5
      loop: "{{ async_tasks.results }}"</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Error Handling</h3>

                <pre><code>---
- name: Error handling
  hosts: all

  tasks:
    # Ignore errors
    - name: Try to stop service
      service:
        name: optional-service
        state: stopped
      ignore_errors: yes

    # Custom failure condition
    - name: Check disk space
      shell: df -h / | tail -1 | awk '{print $5}' | sed 's/%//'
      register: disk_usage
      failed_when: disk_usage.stdout|int > 90

    # Multiple failure conditions
    - name: Run command
      command: /usr/bin/check.sh
      register: check_result
      failed_when:
        - check_result.rc != 0
        - "'WARNING' not in check_result.stderr"

    # Retry on failure
    - name: Download file
      get_url:
        url: https://example.com/file.tar.gz
        dest: /tmp/file.tar.gz
      retries: 3
      delay: 5
      register: download
      until: download is success</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Testing and Validation</h3>

                <pre><code>---
- name: Testing playbook
  hosts: webservers

  tasks:
    # Validate before making changes
    - name: Check syntax of config
      command: nginx -t -c {{ config_file }}
      changed_when: false
      check_mode: no

    # Wait for service
    - name: Restart nginx
      service:
        name: nginx
        state: restarted

    - name: Wait for nginx
      wait_for:
        port: 80
        delay: 2
        timeout: 30

    # Validate service is responding
    - name: Check nginx is serving
      uri:
        url: http://localhost
        status_code: 200
      retries: 3
      delay: 5

    # Smoke tests
    - name: Run smoke tests
      command: /usr/local/bin/smoke_test.sh
      changed_when: false</code></pre>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">Key Takeaways</h3>

                <div class="tip">
                    <div class="tip-title">Ansible Best Practices</div>
                    <ul>
                        <li>Always write idempotent playbooks - they should be safe to run multiple times</li>
                        <li>Use roles to organize and share reusable content</li>
                        <li>Leverage vault for secrets management</li>
                        <li>Test with --check and --diff before running in production</li>
                        <li>Use tags for selective execution</li>
                        <li>Keep playbooks simple and readable - complexity is the enemy</li>
                        <li>Document your roles and playbooks with README files</li>
                        <li>Use version control for all Ansible content</li>
                        <li>Prefer declarative modules over shell/command when possible</li>
                        <li>Monitor and optimize performance with callback plugins</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Built with the <a href="../styles/solarpunk.html">Solarpunk</a> design system</p>
            <p>Sustainable infrastructure automation for a hopeful future</p>
        </footer>
    </div>
</body>
</html>
