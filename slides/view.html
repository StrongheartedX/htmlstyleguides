<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slides</title>
<link id="theme-fonts" rel="stylesheet" href="">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { width: 100%; height: 100%; overflow: hidden; background: #000; }
  #viewer { width: 100%; height: 100%; }
  #loading {
    position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
    background: #000; color: #888; font-family: system-ui, sans-serif; font-size: 1.2rem; z-index: 100;
  }
  #loading.hidden { display: none; }
</style>
</head>
<body>
<div id="loading">Loading presentation...</div>
<div id="viewer"></div>

<script src="engine.js"></script>
<script>
(async function() {
  const params = new URLSearchParams(window.location.search);
  const isPreview = params.get('preview');
  const deckName = params.get('deck') || 'demo';

  try {
    let deck;
    if (isPreview) {
      const raw = sessionStorage.getItem('slides-preview');
      if (!raw) throw new Error('No preview data found');
      deck = JSON.parse(raw);
    } else {
      const deckRes = await fetch(`decks/${deckName}.json`);
      if (!deckRes.ok) throw new Error(`Deck "${deckName}" not found`);
      deck = await deckRes.json();
    }

    document.title = deck.title || 'Slides';

    const themeName = params.get('theme') || deck.theme || 'default';
    await loadTheme(themeName);

    SlideEngine.init('#viewer', deck, window.SLIDE_THEME);
    document.getElementById('loading').classList.add('hidden');
  } catch (err) {
    document.getElementById('loading').textContent = err.message;
  }

  function loadTheme(name) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = `themes/${name}.js`;
      script.onload = resolve;
      script.onerror = () => reject(new Error(`Theme "${name}" not found`));
      document.head.appendChild(script);
    });
  }
})();
</script>
</body>
</html>
